import{ct as wt,cu as Rt}from"./index.7f3abd4d.js";function Pt(xt){throw new Error('Could not dynamically require "'+xt+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ut={exports:{}};/*!
 * artplayer.js v4.5.4
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2022 Harvey Zack
 * Released under the MIT License.
 */(function(xt,kt){(function(P,C,n,s,t){var d=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof Rt<"u"?Rt:{},I=typeof d.parcelRequireb749=="function"&&d.parcelRequireb749,x=I.cache||{},D=typeof Pt=="function"&&Pt.bind(xt);function u(p,g){if(!x[p]){if(!P[p]){var m=typeof d.parcelRequireb749=="function"&&d.parcelRequireb749;if(!g&&m)return m(p,!0);if(I)return I(p,!0);if(D&&typeof p=="string")return D(p);var S=new Error("Cannot find module '"+p+"'");throw S.code="MODULE_NOT_FOUND",S}e.resolve=function(c){var h=P[p][1][c];return h!=null?h:c},e.cache={};var o=x[p]=new u.Module(p);P[p][0].call(o.exports,e,o,o.exports,this)}return x[p].exports;function e(c){var h=e.resolve(c);return h===!1?{}:u(h)}}u.isParcelRequire=!0,u.Module=function(p){this.id=p,this.bundle=u,this.exports={}},u.modules=P,u.cache=x,u.parent=I,u.register=function(p,g){P[p]=[function(m,S){S.exports=g},{}]},Object.defineProperty(u,"root",{get:function(){return d.parcelRequireb749}}),d.parcelRequireb749=u;for(var i=0;i<C.length;i++)u(C[i]);var f=u(n);xt.exports=f})({E13ST:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("bundle-text:./style/index.less"),d=s.interopDefault(t),I=P("option-validator"),x=s.interopDefault(I),D=P("./utils/emitter"),u=s.interopDefault(D),i=P("./utils"),f=P("./scheme"),p=s.interopDefault(f),g=P("./config"),m=s.interopDefault(g),S=P("./whitelist"),o=s.interopDefault(S),e=P("./template"),c=s.interopDefault(e),h=P("./i18n"),v=s.interopDefault(h),a=P("./player"),r=s.interopDefault(a),l=P("./control"),A=s.interopDefault(l),T=P("./contextmenu"),b=s.interopDefault(T),L=P("./info"),E=s.interopDefault(L),y=P("./subtitle"),O=s.interopDefault(y),M=P("./events"),R=s.interopDefault(M),F=P("./hotkey"),k=s.interopDefault(F),w=P("./layer"),_=s.interopDefault(w),B=P("./loading"),N=s.interopDefault(B),U=P("./notice"),j=s.interopDefault(U),K=P("./mask"),H=s.interopDefault(K),G=P("./icons"),W=s.interopDefault(G),X=P("./setting"),V=s.interopDefault(X),J=P("./storage"),$=s.interopDefault(J),z=P("./plugins"),Q=s.interopDefault(z),q=P("./mobile"),tt=s.interopDefault(q);let et=0;const rt=[];class Y extends u.default{constructor(nt,at){super(),this.id=++et;const ut=i.mergeDeep(Y.option,nt);this.option=(0,x.default)(ut,p.default),this.isLock=!1,this.isReady=!1,this.isFocus=!1,this.isInput=!1,this.isDestroy=!1,this.whitelist=new o.default(this),this.template=new c.default(this),this.events=new R.default(this),this.whitelist.state?(this.storage=new $.default(this),this.icons=new W.default(this),this.i18n=new v.default(this),this.notice=new j.default(this),this.player=new r.default(this),this.layers=new _.default(this),this.controls=new A.default(this),this.contextmenu=new b.default(this),this.subtitle=new O.default(this),this.info=new E.default(this),this.loading=new N.default(this),this.hotkey=new k.default(this),this.mask=new H.default(this),this.setting=new V.default(this),this.plugins=new Q.default(this)):this.mobile=new tt.default(this),typeof at=="function"&&this.on("ready",()=>at.call(this)),rt.push(this)}static get instances(){return rt}static get version(){return"4.5.4"}static get env(){return"production"}static get build(){return"1659362361789"}static get config(){return m.default}static get utils(){return i}static get scheme(){return p.default}static get Emitter(){return u.default}static get validator(){return x.default}static get kindOf(){return x.default.kindOf}static get html(){return c.default.html}static get option(){return{id:"",container:"#artplayer",url:"",poster:"",title:"",type:"",theme:"#f00",volume:.7,isLive:!1,muted:!1,autoplay:!1,autoSize:!1,autoMini:!1,loop:!1,flip:!1,playbackRate:!1,aspectRatio:!1,screenshot:!1,setting:!1,hotkey:!0,pip:!1,mutex:!0,backdrop:!0,fullscreen:!1,fullscreenWeb:!1,subtitleOffset:!1,miniProgressBar:!1,useSSR:!1,playsInline:!0,lock:!1,fastForward:!1,autoPlayback:!1,autoOrientation:!1,airplay:!1,layers:[],contextmenu:[],controls:[],settings:[],quality:[],highlight:[],plugins:[],whitelist:[],thumbnails:{url:"",number:60,column:10,width:0,height:0},subtitle:{url:"",type:"",style:{},encoding:"utf-8"},moreVideoAttr:{controls:!1,preload:i.isSafari?"auto":"metadata"},icons:{},customType:{},lang:navigator.language.toLowerCase()}}get proxy(){return this.events.proxy}get query(){return this.template.query}destroy(nt=!0){this.events.destroy(),this.template.destroy(nt),rt.splice(rt.indexOf(this),1),this.isDestroy=!0,this.emit("destroy")}}if(n.default=Y,Y.NOTICE_TIME=2e3,Y.SETTING_WIDTH=250,Y.SETTING_ITEM_WIDTH=200,Y.SETTING_ITEM_HEIGHT=35,Y.INDICATOR_SIZE=14,Y.INDICATOR_SIZE_ICON=16,Y.INDICATOR_SIZE_MOBILE=18,Y.INDICATOR_SIZE_MOBILE_ICON=20,Y.VOLUME_PANEL_WIDTH=60,Y.VOLUME_HANDLE_WIDTH=12,Y.RESIZE_TIME=500,Y.SCROLL_TIME=200,Y.SCROLL_GAP=50,Y.AUTO_PLAYBACK_MAX=10,Y.AUTO_PLAYBACK_MIN=5,Y.AUTO_PLAYBACK_TIMEOUT=3e3,Y.RECONNECT_TIME_MAX=5,Y.RECONNECT_SLEEP_TIME=1e3,Y.CONTROL_HIDE_TIME=3e3,Y.DB_CLICE_TIME=300,Y.MOBILE_AUTO_PLAYBACKRATE=3,Y.MOBILE_AUTO_PLAYBACKRATE_TIME=1e3,Y.MOBILE_AUTO_ORIENTATION_TIME=200,Y.INFO_LOOP_TIME=1e3,Y.FAST_FORWARD_VALUE=3,Y.FAST_FORWARD_TIME=1e3,Y.TOUCH_MOVE_RATIO=.5,typeof document<"u"&&!document.getElementById("artplayer-style")){const it=document.createElement("style");it.id="artplayer-style",it.textContent=d.default,document.head.appendChild(it)}typeof window<"u"&&(window.Artplayer=Y),console.log(`%c ArtPlayer %c ${Y.version} %c https://artplayer.org`,"color: #fff; background: #5f5f5f","color: #fff; background: #4bc729","")},{"bundle-text:./style/index.less":"6U764","option-validator":"eaJBf","./utils/emitter":"1SgiG","./utils":"5yYFo","./scheme":"3izFE","./config":"ej4fZ","./whitelist":"7CkCt","./template":"8iGAh","./i18n":"3mM4M","./player":"bCaa0","./control":"3qXcr","./contextmenu":"hTnNz","./info":"bfwuE","./subtitle":"bWZ2U","./events":"9oLaG","./hotkey":"cKO4X","./layer":"kZD92","./loading":"c9b9e","./notice":"SxQeL","./mask":"aJ0dF","./icons":"jx1Wu","./setting":"hdF39","./storage":"bCcu0","./plugins":"1v13t","./mobile":"eD5Ch","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"6U764":[function(P,C,n){C.exports='.art-video-player{z-index:20;width:100%;height:100%;zoom:1;color:#eee;text-align:left;direction:ltr;user-select:none;-webkit-tap-highlight-color:#0000;touch-action:manipulation;-ms-high-contrast-adjust:none;background-color:#000;outline:0;margin:0 auto;font-family:Roboto,Arial,Helvetica,sans-serif;font-size:14px;line-height:1.3;display:flex;position:relative}.art-video-player *,.art-video-player :before,.art-video-player :after{box-sizing:border-box;margin:0;padding:0}.art-video-player ::-webkit-scrollbar{width:5px;height:5px}.art-video-player ::-webkit-scrollbar-thumb{background-color:#666}.art-video-player ::-webkit-scrollbar-thumb:hover{background-color:#ccc}.art-video-player .art-icon{justify-content:center;align-items:center;line-height:1.5;display:inline-flex}.art-video-player .art-icon svg{fill:#fff}.art-video-player img{max-width:100%;vertical-align:top}@supports ((-webkit-backdrop-filter: initial) or (backdrop-filter: initial)){.art-video-player .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000b3!important}}.art-video-player .art-video{z-index:10;width:100%;height:100%;cursor:pointer;background-color:#000;position:absolute;inset:0}.art-video-player .art-poster{z-index:11;width:100%;height:100%;user-select:none;pointer-events:none;background-position:50%;background-repeat:no-repeat;background-size:cover;position:absolute;inset:0}.art-video-player .art-subtitle{z-index:20;width:100%;text-align:center;color:#fff;pointer-events:none;text-shadow:1px 0 1px #000,0 1px 1px #000,-1px 0 1px #000,0 -1px 1px #000,1px 1px 1px #000,-1px -1px 1px #000,1px -1px 1px #000,-1px 1px 1px #000;padding:0 20px;font-size:20px;display:none;position:absolute;bottom:10px}.art-video-player .art-subtitle p{word-break:break-all;height:fit-content;margin:5px 0 0;line-height:1.2}.art-video-player.art-subtitle-show .art-subtitle{display:block}.art-video-player.art-control-show .art-subtitle{bottom:50px}.art-video-player .art-danmuku{z-index:30;width:100%;height:100%;pointer-events:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers{z-index:40;width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers .art-layer{pointer-events:auto}.art-video-player.art-layer-show .art-layers{display:block}.art-video-player .art-mask{z-index:50;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-mask .art-state{width:60px;height:60px;opacity:.85;cursor:pointer;pointer-events:all;justify-content:center;align-items:center;display:flex;position:absolute;bottom:65px;right:30px}.art-video-player.art-mask-show .art-mask{display:flex}.art-video-player.art-mobile .art-state{position:static}.art-video-player .art-loading{z-index:70;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0}.art-video-player.art-loading-show .art-loading{display:flex}.art-video-player .art-bottom{z-index:60;height:100px;opacity:0;visibility:hidden;pointer-events:none;background-image:linear-gradient(#0000,#0006,#000);background-position:bottom;background-repeat:repeat-x;flex-direction:column;justify-content:space-between;padding:50px 10px 0;transition:all .2s ease-in-out;display:flex;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-bottom .art-progress{z-index:0;pointer-events:auto;flex:1;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress{height:4px;cursor:pointer;flex-direction:row;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner{height:50%;width:100%;background:#fff3;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-loaded{z-index:10;height:100%;width:0;background:#fff6;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-played{z-index:20;height:100%;width:0;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight{z-index:30;height:100%;pointer-events:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight span{width:7px;height:100%;pointer-events:auto;background:#fff;display:inline-block;position:absolute;top:0;left:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:hidden;z-index:40;border-radius:50%;justify-content:center;align-items:center;transition:transform .1s ease-in-out;position:absolute;transform:scale(.1)}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator .art-icon{width:100%;height:100%;pointer-events:none;user-select:none}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-tip{z-index:50;height:20px;color:#fff;text-align:center;white-space:nowrap;background:#000000b3;border-radius:3px;padding:0 5px;font-size:12px;font-weight:700;line-height:20px;display:none;position:absolute;top:-25px;left:0}.art-video-player .art-bottom .art-progress .art-control-thumbnails{pointer-events:none;background-color:#000000b3;display:none;position:absolute;bottom:8px;left:0}.art-video-player .art-bottom .art-progress .art-control-loop{width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-loop .art-loop-point{width:2px;height:8px;background:#ffffffbf;position:absolute;top:-2px;left:0}.art-video-player .art-bottom .art-controls{z-index:1;pointer-events:auto;height:45px;justify-content:space-between;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-controls .art-controls-left,.art-video-player .art-bottom .art-controls .art-controls-right{display:flex}.art-video-player .art-bottom .art-controls .art-controls-center{height:100%;flex:1;justify-content:center;align-items:center;padding:0 10px;display:flex}.art-video-player .art-bottom .art-controls .art-controls-right{justify-content:flex-end}.art-video-player .art-bottom .art-controls .art-control{opacity:.9;min-height:36px;min-width:36px;text-align:center;cursor:pointer;white-space:nowrap;justify-content:center;align-items:center;font-size:12px;line-height:1;display:flex}.art-video-player .art-bottom .art-controls .art-control .art-icon{float:left;height:36px;width:36px;justify-content:center;align-items:center;display:flex}.art-video-player .art-bottom .art-controls .art-control:hover{opacity:1}.art-video-player .art-bottom .art-controls .art-control-onlyText{padding:0 10px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel{float:left;width:0;height:100%;transition:margin .2s cubic-bezier(.4,0,1,1),width .2s cubic-bezier(.4,0,1,1);position:relative;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle{width:12px;height:12px;background:#fff;border-radius:12px;margin-top:-6px;position:absolute;top:50%;left:0}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before{background:#fff;left:-54px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{background:#fff3;left:6px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before,.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{content:"";height:3px;width:60px;margin-top:-2px;display:block;position:absolute;top:50%}.art-video-player .art-bottom .art-controls .art-control-volume:hover .art-volume-panel{width:60px}.art-video-player .art-bottom .art-controls .art-control-quality{z-index:30;position:relative}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys{width:100px;text-align:center;color:#fff;background:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;line-height:30px;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item:hover{background-color:#ffffff1a}.art-video-player .art-bottom .art-controls .art-control-quality:hover .art-qualitys{display:block}.art-video-player .art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner{height:100%}.art-video-player .art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:visible;transform:scale(1)}.art-video-player.art-control-show .art-bottom,.art-video-player.art-hover .art-bottom{opacity:1;visibility:visible}.art-video-player.art-error .art-progress-indicator,.art-video-player.art-destroy .art-progress-indicator,.art-video-player.art-error .art-progress-tip,.art-video-player.art-destroy .art-progress-tip{display:none!important}.art-video-player.art-mobile .art-bottom{padding:50px 7px 0}.art-video-player.art-mobile .art-bottom .art-controls{height:40px}.art-video-player.art-mobile .art-bottom .art-progress-indicator{visibility:visible!important;transform:scale(1)!important}.art-video-player .art-notice{z-index:80;width:100%;pointer-events:none;padding:10px;font-size:14px;display:none;position:absolute;top:0;left:0}.art-video-player .art-notice .art-notice-inner{color:#fff;background-color:#0009;border-radius:3px;padding:5px 10px;display:inline-block}.art-video-player.art-notice-show .art-notice{display:flex}.art-video-player .art-contextmenus{z-index:120;min-width:200px;background-color:#000000e6;border-radius:3px;flex-direction:column;padding:5px 0;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-contextmenus .art-contextmenu{cursor:pointer;color:#fff;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;border-bottom:1px solid #ffffff1a;padding:10px 15px;font-size:12px;display:block;overflow:hidden}.art-video-player .art-contextmenus .art-contextmenu a{color:#fff;text-decoration:none}.art-video-player .art-contextmenus .art-contextmenu span{padding:0 7px;display:inline-block}.art-video-player .art-contextmenus .art-contextmenu span:hover,.art-video-player .art-contextmenus .art-contextmenu span.art-current{color:#00c9ff}.art-video-player .art-contextmenus .art-contextmenu:hover{background-color:#ffffff1a}.art-video-player .art-contextmenus .art-contextmenu:last-child{border-bottom:none}.art-video-player.art-contextmenu-show .art-contextmenus{display:flex}.art-video-player .art-settings{z-index:90;height:auto;max-height:300px;background-color:#000000e6;border-radius:3px;font-size:13px;transition:all .2s;display:none;position:absolute;bottom:50px;right:10px;overflow:auto}.art-video-player .art-settings .art-setting-panel{display:none}.art-video-player .art-settings .art-setting-panel.art-current{display:block}.art-video-player .art-settings .art-setting-panel .art-setting-item{height:35px;cursor:pointer;color:#fffc;justify-content:space-between;align-items:center;padding:0 5px;line-height:1;display:flex;overflow:hidden}.art-video-player .art-settings .art-setting-panel .art-setting-item:hover,.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current{color:#fff;background-color:#ffffff1a}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon{width:30px;height:30px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon-check{visibility:hidden;height:15px}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current .art-icon-check{visibility:visible}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left{white-space:nowrap;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left .art-setting-item-left-icon{height:24px;width:24px;justify-content:center;align-items:center;margin-right:10px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right{align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-tooltip{white-space:nowrap;color:#ffffff80;margin-right:5px;font-size:12px}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-icon{height:24px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-range{height:3px;width:80px;appearance:none;background-color:#fff3;outline:none}.art-video-player .art-settings .art-setting-panel .art-setting-item-back{border-bottom:1px solid #ffffff1a}.art-video-player.art-setting-show .art-settings{display:block}.art-video-player.art-mobile .art-settings{max-height:200px}.art-video-player .art-info{z-index:100;width:350px;color:#fff;-webkit-font-smoothing:antialiased;background-color:#000000e6;flex-direction:column;padding:10px;font-family:Noto Sans CJK SC DemiLight,Roboto,Segoe UI,Tahoma,Arial,Helvetica,sans-serif;font-size:12px;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-info .art-info-item{margin-bottom:5px;display:flex}.art-video-player .art-info .art-info-item .art-info-title{width:100px;text-align:right}.art-video-player .art-info .art-info-item .art-info-content{text-overflow:ellipsis;white-space:nowrap;flex:1;padding-left:5px;overflow:hidden}.art-video-player .art-info .art-info-item:last-child{margin-bottom:0}.art-video-player .art-info .art-info-close{cursor:pointer;position:absolute;top:5px;right:5px}.art-video-player.art-info-show .art-info{display:flex}.art-video-player.art-hide-cursor *{cursor:none!important}.art-video-player[data-aspect-ratio] video{box-sizing:content-box;object-fit:fill}.art-video-player.art-fullscreen-web{z-index:9999;width:100%;height:100%;position:fixed;inset:0}.art-video-player .art-mini-header{z-index:110;height:35px;color:#fff;opacity:0;visibility:hidden;background-color:#00000080;justify-content:space-between;align-items:center;line-height:35px;transition:all .2s ease-in-out;display:none;position:absolute;top:0;left:0;right:0}.art-video-player .art-mini-header .art-mini-title{text-overflow:ellipsis;white-space:nowrap;cursor:move;flex:1;padding:0 10px;overflow:hidden}.art-video-player .art-mini-header .art-mini-close{width:35px;text-align:center;cursor:pointer;font-size:22px}.art-video-player.art-is-dragging{opacity:.7}.art-video-player.art-mini{z-index:9999;width:400px;height:225px;position:fixed;box-shadow:0 2px 5px #00000029,0 3px 6px #0003}.art-video-player.art-mini .art-mini-header{user-select:none;display:flex}.art-video-player.art-mini.art-hover .art-mini-header{opacity:1;visibility:visible}.art-video-player.art-mini .art-mask .art-state{position:static}.art-video-player.art-mini .art-contextmenu,.art-video-player.art-mini .art-bottom,.art-video-player.art-mini .art-danmu,.art-video-player.art-mini .art-info,.art-video-player.art-mini .art-layers,.art-video-player.art-mini .art-notice,.art-video-player.art-mini .art-settings,.art-video-player.art-mini .art-subtitle{display:none!important}.art-auto-size{justify-content:center;align-items:center;display:flex}.art-auto-size .art-video-player{transition:all .2s}.art-video-player[data-flip=horizontal] .art-video{transform:scaleX(-1)}.art-video-player[data-flip=vertical] .art-video{transform:scaleY(-1)}.art-video-player .art-layer-miniProgressBar{height:2px;background-color:var(--theme);display:block;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-layer-lock{height:34px;width:34px;color:#fff;background-color:#00000080;border-radius:50%;justify-content:center;align-items:center;display:none;position:absolute;top:calc(50% - 17px);left:15px}.art-video-player .art-layer-autoPlayback{background-color:#000c;border-radius:3px;align-items:center;padding:10px;line-height:1;display:none;position:absolute;bottom:60px;left:20px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close{cursor:pointer;align-items:center;margin-right:10px;display:flex}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close svg{width:15px;height:15px;fill:#00c9ff}.art-video-player .art-layer-autoPlayback .art-autoPlayback-last{margin-right:10px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-jump{color:#00c9ff;cursor:pointer}.art-video-player.art-lock .art-bottom{display:none!important}.art-video-player.art-lock .art-subtitle{bottom:10px!important}.art-video-player.art-lock .art-layer-miniProgressBar{display:block!important}.art-video-player.art-control-show .art-layer-miniProgressBar{display:none}.art-video-player.art-control-show .art-layer-lock{display:flex}.art-video-player .art-control-selector{position:relative}.art-video-player .art-control-selector .art-selector-list{min-width:100px;max-width:200px;max-height:200px;text-align:center;color:#fff;background-color:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px;overflow:auto}.art-video-player .art-control-selector .art-selector-list .art-selector-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;padding:0 5px;line-height:30px;overflow:hidden}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover{background-color:#ffffff1a}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover,.art-video-player .art-control-selector .art-selector-list .art-selector-item.art-current{color:#00c9ff}.art-video-player .art-control-selector:hover .art-selector-list{display:block}[class*=hint--]{font-style:normal;display:inline-block;position:relative}[class*=hint--]:before,[class*=hint--]:after{visibility:hidden;opacity:0;z-index:1000000;pointer-events:none;transition:all .3s;position:absolute;transform:translate(0,0)}[class*=hint--]:hover:before,[class*=hint--]:hover:after{visibility:visible;opacity:1;transition-delay:.1s}[class*=hint--]:before{content:"";z-index:1000001;background:0 0;border:6px solid #0000;position:absolute}[class*=hint--]:after{color:#fff;white-space:nowrap;background:#000;padding:8px 10px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;line-height:12px}[class*=hint--][aria-label]:after{content:attr(aria-label)}[class*=hint--][data-hint]:after{content:attr(data-hint)}[aria-label=""]:before,[aria-label=""]:after,[data-hint=""]:before,[data-hint=""]:after{display:none!important}.hint--top-left:before,.hint--top-right:before,.hint--top:before{border-top-color:#000}.hint--bottom-left:before,.hint--bottom-right:before,.hint--bottom:before{border-bottom-color:#000}.hint--left:before{border-left-color:#000}.hint--right:before{border-right-color:#000}.hint--top:before{margin-bottom:-11px}.hint--top:before,.hint--top:after{bottom:100%;left:50%}.hint--top:before{left:calc(50% - 6px)}.hint--top:after{transform:translate(-50%)}.hint--top:hover:before{transform:translateY(-8px)}.hint--top:hover:after{transform:translate(-50%)translateY(-8px)}.hint--bottom:before{margin-top:-11px}.hint--bottom:before,.hint--bottom:after{top:100%;left:50%}.hint--bottom:before{left:calc(50% - 6px)}.hint--bottom:after{transform:translate(-50%)}.hint--bottom:hover:before{transform:translateY(8px)}.hint--bottom:hover:after{transform:translate(-50%)translateY(8px)}.hint--right:before{margin-bottom:-6px;margin-left:-11px}.hint--right:after{margin-bottom:-14px}.hint--right:before,.hint--right:after{bottom:50%;left:100%}.hint--right:hover:before,.hint--right:hover:after{transform:translate(8px)}.hint--left:before{margin-bottom:-6px;margin-right:-11px}.hint--left:after{margin-bottom:-14px}.hint--left:before,.hint--left:after{bottom:50%;right:100%}.hint--left:hover:before,.hint--left:hover:after{transform:translate(-8px)}.hint--top-left:before{margin-bottom:-11px}.hint--top-left:before,.hint--top-left:after{bottom:100%;left:50%}.hint--top-left:before{left:calc(50% - 6px)}.hint--top-left:after{margin-left:12px;transform:translate(-100%)}.hint--top-left:hover:before{transform:translateY(-8px)}.hint--top-left:hover:after{transform:translate(-100%)translateY(-8px)}.hint--top-right:before{margin-bottom:-11px}.hint--top-right:before,.hint--top-right:after{bottom:100%;left:50%}.hint--top-right:before{left:calc(50% - 6px)}.hint--top-right:after{margin-left:-12px;transform:translate(0)}.hint--top-right:hover:before,.hint--top-right:hover:after{transform:translateY(-8px)}.hint--bottom-left:before{margin-top:-11px}.hint--bottom-left:before,.hint--bottom-left:after{top:100%;left:50%}.hint--bottom-left:before{left:calc(50% - 6px)}.hint--bottom-left:after{margin-left:12px;transform:translate(-100%)}.hint--bottom-left:hover:before{transform:translateY(8px)}.hint--bottom-left:hover:after{transform:translate(-100%)translateY(8px)}.hint--bottom-right:before{margin-top:-11px}.hint--bottom-right:before,.hint--bottom-right:after{top:100%;left:50%}.hint--bottom-right:before{left:calc(50% - 6px)}.hint--bottom-right:after{margin-left:-12px;transform:translate(0)}.hint--bottom-right:hover:before,.hint--bottom-right:hover:after{transform:translateY(8px)}.hint--small:after,.hint--medium:after,.hint--large:after{white-space:normal;word-wrap:break-word;line-height:1.4em}.hint--small:after{width:80px}.hint--medium:after{width:150px}.hint--large:after{width:300px}[class*=hint--]:after{text-shadow:0 -1px #000;box-shadow:4px 4px 8px #0000004d}.hint--error:after{text-shadow:0 -1px #592726;background-color:#b34e4d}.hint--error.hint--top-left:before,.hint--error.hint--top-right:before,.hint--error.hint--top:before{border-top-color:#b34e4d}.hint--error.hint--bottom-left:before,.hint--error.hint--bottom-right:before,.hint--error.hint--bottom:before{border-bottom-color:#b34e4d}.hint--error.hint--left:before{border-left-color:#b34e4d}.hint--error.hint--right:before{border-right-color:#b34e4d}.hint--warning:after{text-shadow:0 -1px #6c5328;background-color:#c09854}.hint--warning.hint--top-left:before,.hint--warning.hint--top-right:before,.hint--warning.hint--top:before{border-top-color:#c09854}.hint--warning.hint--bottom-left:before,.hint--warning.hint--bottom-right:before,.hint--warning.hint--bottom:before{border-bottom-color:#c09854}.hint--warning.hint--left:before{border-left-color:#c09854}.hint--warning.hint--right:before{border-right-color:#c09854}.hint--info:after{text-shadow:0 -1px #1a3c4d;background-color:#3986ac}.hint--info.hint--top-left:before,.hint--info.hint--top-right:before,.hint--info.hint--top:before{border-top-color:#3986ac}.hint--info.hint--bottom-left:before,.hint--info.hint--bottom-right:before,.hint--info.hint--bottom:before{border-bottom-color:#3986ac}.hint--info.hint--left:before{border-left-color:#3986ac}.hint--info.hint--right:before{border-right-color:#3986ac}.hint--success:after{text-shadow:0 -1px #1a321a;background-color:#458746}.hint--success.hint--top-left:before,.hint--success.hint--top-right:before,.hint--success.hint--top:before{border-top-color:#458746}.hint--success.hint--bottom-left:before,.hint--success.hint--bottom-right:before,.hint--success.hint--bottom:before{border-bottom-color:#458746}.hint--success.hint--left:before{border-left-color:#458746}.hint--success.hint--right:before{border-right-color:#458746}.hint--always:after,.hint--always:before{opacity:1;visibility:visible}.hint--always.hint--top:before{transform:translateY(-8px)}.hint--always.hint--top:after{transform:translate(-50%)translateY(-8px)}.hint--always.hint--top-left:before{transform:translateY(-8px)}.hint--always.hint--top-left:after{transform:translate(-100%)translateY(-8px)}.hint--always.hint--top-right:before,.hint--always.hint--top-right:after{transform:translateY(-8px)}.hint--always.hint--bottom:before{transform:translateY(8px)}.hint--always.hint--bottom:after{transform:translate(-50%)translateY(8px)}.hint--always.hint--bottom-left:before{transform:translateY(8px)}.hint--always.hint--bottom-left:after{transform:translate(-100%)translateY(8px)}.hint--always.hint--bottom-right:before,.hint--always.hint--bottom-right:after{transform:translateY(8px)}.hint--always.hint--left:before,.hint--always.hint--left:after{transform:translate(-8px)}.hint--always.hint--right:before,.hint--always.hint--right:after{transform:translate(8px)}.hint--rounded:after{border-radius:4px}.hint--no-animate:before,.hint--no-animate:after{transition-duration:0s}.hint--bounce:before,.hint--bounce:after{-webkit-transition:opacity .3s,visibility .3s,-webkit-transform .3s cubic-bezier(.71,1.7,.77,1.24);-moz-transition:opacity .3s,visibility .3s,-moz-transform .3s cubic-bezier(.71,1.7,.77,1.24);transition:opacity .3s,visibility .3s,transform .3s cubic-bezier(.71,1.7,.77,1.24)}.hint--no-shadow:before,.hint--no-shadow:after{text-shadow:initial;box-shadow:initial}.hint--no-arrow:before{display:none}'},{}],eaJBf:[function(P,C,n){C.exports=function(){function s(i){return(s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f})(i)}var t=Object.prototype.toString,d=function(i){if(i===void 0)return"undefined";if(i===null)return"null";var f=s(i);if(f==="boolean")return"boolean";if(f==="string")return"string";if(f==="number")return"number";if(f==="symbol")return"symbol";if(f==="function")return function(p){return I(p)==="GeneratorFunction"}(i)?"generatorfunction":"function";if(function(p){return Array.isArray?Array.isArray(p):p instanceof Array}(i))return"array";if(function(p){return!(!p.constructor||typeof p.constructor.isBuffer!="function")&&p.constructor.isBuffer(p)}(i))return"buffer";if(function(p){try{if(typeof p.length=="number"&&typeof p.callee=="function")return!0}catch(g){if(g.message.indexOf("callee")!==-1)return!0}return!1}(i))return"arguments";if(function(p){return p instanceof Date||typeof p.toDateString=="function"&&typeof p.getDate=="function"&&typeof p.setDate=="function"}(i))return"date";if(function(p){return p instanceof Error||typeof p.message=="string"&&p.constructor&&typeof p.constructor.stackTraceLimit=="number"}(i))return"error";if(function(p){return p instanceof RegExp||typeof p.flags=="string"&&typeof p.ignoreCase=="boolean"&&typeof p.multiline=="boolean"&&typeof p.global=="boolean"}(i))return"regexp";switch(I(i)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(p){return typeof p.throw=="function"&&typeof p.return=="function"&&typeof p.next=="function"}(i))return"generator";switch(f=t.call(i)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return f.slice(8,-1).toLowerCase().replace(/\s/g,"")};function I(i){return i.constructor?i.constructor.name:null}function x(i,f){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:["option"];return D(i,f,p),u(i,f,p),function(g,m,S){var o=d(m),e=d(g);if(o==="object"){if(e!=="object")throw new Error("[Type Error]: '".concat(S.join("."),"' require 'object' type, but got '").concat(e,"'"));Object.keys(m).forEach(function(c){var h=g[c],v=m[c],a=S.slice();a.push(c),D(h,v,a),u(h,v,a),x(h,v,a)})}if(o==="array"){if(e!=="array")throw new Error("[Type Error]: '".concat(S.join("."),"' require 'array' type, but got '").concat(e,"'"));g.forEach(function(c,h){var v=g[h],a=m[h]||m[0],r=S.slice();r.push(h),D(v,a,r),u(v,a,r),x(v,a,r)})}}(i,f,p),i}function D(i,f,p){if(d(f)==="string"){var g=d(i);if(f[0]==="?"&&(f=f.slice(1)+"|undefined"),!(-1<f.indexOf("|")?f.split("|").map(function(m){return m.toLowerCase().trim()}).filter(Boolean).some(function(m){return g===m}):f.toLowerCase().trim()===g))throw new Error("[Type Error]: '".concat(p.join("."),"' require '").concat(f,"' type, but got '").concat(g,"'"))}}function u(i,f,p){if(d(f)==="function"){var g=f(i,d(i),p);if(g!==!0){var m=d(g);throw m==="string"?new Error(g):m==="error"?g:new Error("[Validator Error]: The scheme for '".concat(p.join("."),"' validator require return true, but got '").concat(g,"'"))}}}return x.kindOf=d,x}()},{}],"1SgiG":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n),n.default=class{on(s,t,d){const I=this.e||(this.e={});return(I[s]||(I[s]=[])).push({fn:t,ctx:d}),this}once(s,t,d){const I=this;function x(...D){I.off(s,x),t.apply(d,D)}return x._=t,this.on(s,x,d)}emit(s,...t){const d=((this.e||(this.e={}))[s]||[]).slice();for(let I=0;I<d.length;I+=1)d[I].fn.apply(d[I].ctx,t);return this}off(s,t){const d=this.e||(this.e={}),I=d[s],x=[];if(I&&t)for(let D=0,u=I.length;D<u;D+=1)I[D].fn!==t&&I[D].fn._!==t&&x.push(I[D]);return x.length?d[s]=x:delete d[s],this}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],b7MJY:[function(P,C,n){n.interopDefault=function(s){return s&&s.__esModule?s:{default:s}},n.defineInteropFlag=function(s){Object.defineProperty(s,"__esModule",{value:!0})},n.exportAll=function(s,t){return Object.keys(s).forEach(function(d){d==="default"||d==="__esModule"||t.hasOwnProperty(d)||Object.defineProperty(t,d,{enumerable:!0,get:function(){return s[d]}})}),t},n.export=function(s,t,d){Object.defineProperty(s,t,{enumerable:!0,get:d})}},{}],"5yYFo":[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("./dom");s.exportAll(t,n);var d=P("./error");s.exportAll(d,n);var I=P("./subtitle");s.exportAll(I,n);var x=P("./file");s.exportAll(x,n);var D=P("./property");s.exportAll(D,n);var u=P("./time");s.exportAll(u,n);var i=P("./format");s.exportAll(i,n);var f=P("./compatibility");s.exportAll(f,n)},{"./dom":"fqaW9","./error":"kNZvP","./subtitle":"eZUgm","./file":"dYeSt","./property":"5ynPA","./time":"kXYeR","./format":"anS7L","./compatibility":"e9wVp","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],fqaW9:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n),s.export(n,"query",()=>d),s.export(n,"queryAll",()=>I),s.export(n,"addClass",()=>x),s.export(n,"removeClass",()=>D),s.export(n,"hasClass",()=>u),s.export(n,"append",()=>i),s.export(n,"remove",()=>f),s.export(n,"setStyle",()=>p),s.export(n,"setStyles",()=>g),s.export(n,"getStyle",()=>m),s.export(n,"sublings",()=>S),s.export(n,"inverseClass",()=>o),s.export(n,"tooltip",()=>e),s.export(n,"isInViewport",()=>c),s.export(n,"includeFromEvent",()=>h),s.export(n,"replaceElement",()=>v);var t=P("./compatibility");function d(a,r=document){return r.querySelector(a)}function I(a,r=document){return Array.from(r.querySelectorAll(a))}function x(a,r){return a.classList.add(r)}function D(a,r){return a.classList.remove(r)}function u(a,r){return a.classList.contains(r)}function i(a,r){return r instanceof Element?a.appendChild(r):a.insertAdjacentHTML("beforeend",String(r)),a.lastElementChild||a.lastChild}function f(a){return a.parentNode.removeChild(a)}function p(a,r,l){return a.style[r]=l,a}function g(a,r){return Object.keys(r).forEach(l=>{p(a,l,r[l])}),a}function m(a,r,l=!0){const A=window.getComputedStyle(a,null).getPropertyValue(r);return l?parseFloat(A):A}function S(a){return Array.from(a.parentElement.children).filter(r=>r!==a)}function o(a,r){S(a).forEach(l=>D(l,r)),x(a,r)}function e(a,r,l="top"){t.isMobile||(a.setAttribute("aria-label",r),x(a,"hint--rounded"),x(a,`hint--${l}`))}function c(a,r=0){const l=a.getBoundingClientRect(),A=window.innerHeight||document.documentElement.clientHeight,T=window.innerWidth||document.documentElement.clientWidth,b=l.top-r<=A&&l.top+l.height+r>=0,L=l.left-r<=T+r&&l.left+l.width+r>=0;return b&&L}function h(a,r){return a.composedPath&&a.composedPath().indexOf(r)>-1}function v(a,r){return r.parentNode.replaceChild(a,r),a}},{"./compatibility":"e9wVp","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],e9wVp:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n),s.export(n,"userAgent",()=>t),s.export(n,"isMobile",()=>d),s.export(n,"isSafari",()=>I),s.export(n,"isWechat",()=>x),s.export(n,"isIE",()=>D),s.export(n,"isAndroid",()=>u),s.export(n,"isIOS",()=>i);const t=typeof window<"u"?window.navigator.userAgent:"",d=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t),I=/^((?!chrome|android).)*safari/i.test(t),x=/MicroMessenger/i.test(t),D=/MSIE|Trident/i.test(t),u=/android/i.test(t),i=/iPad|iPhone|iPod/i.test(t)&&!window.MSStream},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kNZvP:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n),s.export(n,"ArtPlayerError",()=>t),s.export(n,"errorHandle",()=>d);class t extends Error{constructor(x,D){super(x),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,D||this.constructor),this.name="ArtPlayerError"}}function d(I,x){if(!I)throw new t(x);return I}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eZUgm:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");function t(x){return`WEBVTT \r
\r
`.concat((D=x,D.replace(/(\d\d:\d\d:\d\d)[,.](\d+)/g,(u,i,f)=>{let p=f.slice(0,3);return f.length===1&&(p=f+"00"),f.length===2&&(p=f+"0"),`${i},${p}`})).replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").replace(/{[\s\S]*?}/g,"").concat(`\r
\r
`));var D}function d(x){return URL.createObjectURL(new Blob([x],{type:"text/vtt"}))}function I(x){const D=new RegExp("Dialogue:\\s\\d,(\\d+:\\d\\d:\\d\\d.\\d\\d),(\\d+:\\d\\d:\\d\\d.\\d\\d),([^,]*),([^,]*),(?:[^,]*,){4}([\\s\\S]*)$","i");function u(i=""){return i.split(/[:.]/).map((f,p,g)=>{if(p===g.length-1){if(f.length===1)return`.${f}00`;if(f.length===2)return`.${f}0`}else if(f.length===1)return(p===0?"0":":0")+f;return p===0?f:p===g.length-1?`.${f}`:`:${f}`}).join("")}return`WEBVTT

${x.split(/\r?\n/).map(i=>{const f=i.match(D);return f?{start:u(f[1].trim()),end:u(f[2].trim()),text:f[5].replace(/{[\s\S]*?}/g,"").replace(/(\\N)/g,`
`).trim().split(/\r?\n/).map(p=>p.trim()).join(`
`)}:null}).filter(i=>i).map((i,f)=>i?`${f+1}
${i.start} --> ${i.end}
${i.text}`:"").filter(i=>i.trim()).join(`

`)}`}s.defineInteropFlag(n),s.export(n,"srtToVtt",()=>t),s.export(n,"vttToBlob",()=>d),s.export(n,"assToVtt",()=>I)},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],dYeSt:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");function t(I){return I.includes("?")?t(I.split("?")[0]):I.includes("#")?t(I.split("#")[0]):I.trim().toLowerCase().split(".").pop()}function d(I,x){const D=document.createElement("a");D.style.display="none",D.href=I,D.download=x,document.body.appendChild(D),D.click(),document.body.removeChild(D)}s.defineInteropFlag(n),s.export(n,"getExt",()=>t),s.export(n,"download",()=>d)},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"5ynPA":[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n),s.export(n,"def",()=>t),s.export(n,"has",()=>I),s.export(n,"get",()=>x),s.export(n,"mergeDeep",()=>D);const t=Object.defineProperty,{hasOwnProperty:d}=Object.prototype;function I(u,i){return d.call(u,i)}function x(u,i){return Object.getOwnPropertyDescriptor(u,i)}function D(...u){const i=f=>f&&typeof f=="object"&&!Array.isArray(f);return u.reduce((f,p)=>(Object.keys(p).forEach(g=>{const m=f[g],S=p[g];Array.isArray(m)&&Array.isArray(S)?f[g]=m.concat(...S):!i(m)||!i(S)||S instanceof Element?f[g]=S:f[g]=D(m,S)}),f),{})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kXYeR:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");function t(x=0){return new Promise(D=>setTimeout(D,x))}function d(x,D,u){let i;function f(...p){clearTimeout(i),i=setTimeout(function(){i=null,x.apply(u,p)},D)}return f.clearTimeout=function(){clearTimeout(i)},f}function I(x,D){let u,i,f=!1;return function p(...g){if(f)return u=g,void(i=this);f=!0,x.apply(this,g),setTimeout(()=>{f=!1,u&&(p.apply(i,u),u=null,i=null)},D)}}s.defineInteropFlag(n),s.export(n,"sleep",()=>t),s.export(n,"debounce",()=>d),s.export(n,"throttle",()=>I)},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],anS7L:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");function t(x,D,u){return Math.max(Math.min(x,Math.max(D,u)),Math.min(D,u))}function d(x){const D=Math.floor(x/3600),u=Math.floor((x-3600*D)/60),i=Math.floor(x-3600*D-60*u);return(D>0?[D,u,i]:[u,i]).map(f=>f<10?`0${f}`:String(f)).join(":")}function I(x){return x.replace(/[&<>'"]/g,D=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[D]||D)}s.defineInteropFlag(n),s.export(n,"clamp",()=>t),s.export(n,"secondToTime",()=>d),s.export(n,"escape",()=>I)},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"3izFE":[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n),s.export(n,"ComponentOption",()=>p);var t=P("../utils");const d="array",I="boolean",x="string",D="number",u="object",i="function";function f(g,m,S){return(0,t.errorHandle)(m===x||m===D||g instanceof Element,`${S.join(".")} require '${x}' or 'Element' type`)}const p={html:f,disable:`?${I}`,name:`?${x}`,index:`?${D}`,style:`?${u}`,click:`?${i}`,mounted:`?${i}`,tooltip:`?${x}|${D}`,width:`?${D}`,selector:`?${d}`,onSelect:`?${i}`,switch:`?${I}`,onSwitch:`?${i}`,range:`?${d}`,onRange:`?${i}`};n.default={id:x,container:f,url:x,poster:x,title:x,type:x,theme:x,lang:x,volume:D,isLive:I,muted:I,autoplay:I,autoSize:I,autoMini:I,loop:I,flip:I,playbackRate:I,aspectRatio:I,screenshot:I,setting:I,hotkey:I,pip:I,mutex:I,backdrop:I,fullscreen:I,fullscreenWeb:I,subtitleOffset:I,miniProgressBar:I,useSSR:I,playsInline:I,lock:I,fastForward:I,autoPlayback:I,autoOrientation:I,airplay:I,plugins:[i],whitelist:[`${x}|${i}|regexp`],layers:[p],contextmenu:[p],settings:[p],controls:[{...p,position:(g,m,S)=>{const o=["top","left","right"];return(0,t.errorHandle)(o.includes(g),`${S.join(".")} only accept ${o.toString()} as parameters`)}}],quality:[{default:`?${I}`,html:x,url:x}],highlight:[{time:D,text:x}],thumbnails:{url:x,number:D,column:D,width:D,height:D},subtitle:{url:x,type:x,style:u,encoding:x},moreVideoAttr:u,icons:u,customType:u}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ej4fZ:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n),n.default={propertys:["audioTracks","autoplay","buffered","controller","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","loop","mediaGroup","muted","networkState","paused","playbackRate","played","preload","readyState","seekable","seeking","src","startDate","textTracks","videoTracks","volume"],methods:["addTextTrack","canPlayType","load","play","pause"],events:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],prototypes:["width","height","videoWidth","videoHeight","poster","webkitDecodedFrameCount","webkitDroppedFrameCount","playsInline","webkitSupportsFullscreen","webkitDisplayingFullscreen","onenterpictureinpicture","onleavepictureinpicture","disablePictureInPicture","cancelVideoFrameCallback","requestVideoFrameCallback","getVideoPlaybackQuality","requestPictureInPicture","webkitEnterFullScreen","webkitEnterFullscreen","webkitExitFullScreen","webkitExitFullscreen"]}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"7CkCt":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("./utils");n.default=class{constructor(t){this.art=t}get state(){const{option:t,constructor:{kindOf:d}}=this.art;return!s.isMobile||t.whitelist.some(I=>{switch(d(I)){case"string":return I==="*"||s.userAgent.indexOf(I)>-1;case"function":return I(s.userAgent);case"regexp":return I.test(s.userAgent);default:return!1}})}}},{"./utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"8iGAh":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("./utils");class t{constructor(I){this.art=I;const{option:x,constructor:D,whitelist:u}=I;x.container instanceof Element?this.$container=x.container:(this.$container=(0,s.query)(x.container),(0,s.errorHandle)(this.$container,`No container element found by ${x.container}`));const i=this.$container.tagName.toLowerCase();(0,s.errorHandle)(i==="div",`Unsupported container element type, only support 'div' but got '${i}'`),(0,s.errorHandle)(D.instances.every(f=>f.template.$container!==this.$container),"Cannot mount multiple instances on the same dom element"),this.query=this.query.bind(this),this.$container.dataset.artId=I.id,this.$original=this.$container.cloneNode(!0),u.state?this.desktop():this.mobile()}static get html(){return'<div class="art-video-player art-subtitle-show art-layer-show art-control-show art-mask-show"><video class="art-video"></video><div class="art-poster"></div><div class="art-subtitle"></div><div class="art-danmuku"></div><div class="art-layers"></div><div class="art-mask"><div class="art-state"></div></div><div class="art-bottom"><div class="art-progress"></div><div class="art-controls"><div class="art-controls-left"></div><div class="art-controls-center"></div><div class="art-controls-right"></div></div></div><div class="art-loading"></div><div class="art-notice"><div class="art-notice-inner"></div></div><div class="art-settings"></div><div class="art-info"><div class="art-info-panel"><div class="art-info-item"><div class="art-info-title">Player version:</div><div class="art-info-content">4.5.4</div></div><div class="art-info-item"><div class="art-info-title">Video url:</div><div class="art-info-content" data-video="src"></div></div><div class="art-info-item"><div class="art-info-title">Video volume:</div><div class="art-info-content" data-video="volume"></div></div><div class="art-info-item"><div class="art-info-title">Video time:</div><div class="art-info-content" data-video="currentTime"></div></div><div class="art-info-item"><div class="art-info-title">Video duration:</div><div class="art-info-content" data-video="duration"></div></div><div class="art-info-item"><div class="art-info-title">Video resolution:</div><div class="art-info-content"><span data-video="videoWidth"></span> x <span data-video="videoHeight"></span></div></div></div><div class="art-info-close">[x]</div></div><div class="art-mini-header"><div class="art-mini-title"></div><div class="art-mini-close">\xD7</div></div><div class="art-contextmenus"></div></div>'}query(I){return(0,s.query)(I,this.$container)}desktop(){const{option:I}=this.art;I.useSSR||(this.$container.innerHTML=t.html),this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video"),this.$poster=this.query(".art-poster"),this.$subtitle=this.query(".art-subtitle"),this.$danmuku=this.query(".art-danmuku"),this.$bottom=this.query(".art-bottom"),this.$progress=this.query(".art-progress"),this.$controls=this.query(".art-controls"),this.$controlsLeft=this.query(".art-controls-left"),this.$controlsCenter=this.query(".art-controls-center"),this.$controlsRight=this.query(".art-controls-right"),this.$layer=this.query(".art-layers"),this.$loading=this.query(".art-loading"),this.$notice=this.query(".art-notice"),this.$noticeInner=this.query(".art-notice-inner"),this.$mask=this.query(".art-mask"),this.$state=this.query(".art-state"),this.$setting=this.query(".art-settings"),this.$info=this.query(".art-info"),this.$infoPanel=this.query(".art-info-panel"),this.$infoClose=this.query(".art-info-close"),this.$miniHeader=this.query(".art-mini-header"),this.$miniTitle=this.query(".art-mini-title"),this.$miniClose=this.query(".art-mini-close"),this.$contextmenu=this.query(".art-contextmenus"),I.backdrop&&((0,s.addClass)(this.$setting,"art-backdrop-filter"),(0,s.addClass)(this.$contextmenu,"art-backdrop-filter"),(0,s.addClass)(this.$info,"art-backdrop-filter")),s.isMobile&&(0,s.addClass)(this.$player,"art-mobile")}mobile(){this.$container.innerHTML='<div class="art-video-player"><video class="art-video"></video></div>',this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video")}destroy(I){I?(0,s.replaceElement)(this.$original,this.$container):(0,s.addClass)(this.$player,"art-destroy")}}n.default=t},{"./utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"3mM4M":[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("../utils"),d=P("./zh-cn.json"),I=s.interopDefault(d),x=P("./zh-tw.json"),D=s.interopDefault(x),u=P("./pl.json"),i=s.interopDefault(u),f=P("./cs.json"),p=s.interopDefault(f);n.default=class{constructor(g){this.art=g,this.languages={"zh-cn":I.default,"zh-tw":D.default,pl:i.default,cs:p.default},this.init()}init(){const g=this.art.option.lang.toLowerCase();this.language=this.languages[g]||{}}get(g){return this.language[g]||g}update(g){this.languages=(0,t.mergeDeep)(this.languages,g),this.init()}}},{"../utils":"5yYFo","./zh-cn.json":"1f1tr","./zh-tw.json":"3hy9S","./pl.json":"aFOXc","./cs.json":"aNfUP","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"1f1tr":[function(P,C,n){C.exports=JSON.parse('{"Video Info":"\u7EDF\u8BA1\u4FE1\u606F","Close":"\u5173\u95ED","Video Load Failed":"\u52A0\u8F7D\u5931\u8D25","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u6682\u505C","Rate":"\u901F\u5EA6","Mute":"\u9759\u97F3","Video Flip":"\u753B\u9762\u7FFB\u8F6C","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u8FDE\u63A5","Show Setting":"\u663E\u793A\u8BBE\u7F6E","Hide Setting":"\u9690\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u56FE","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u753B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8BA4","Normal":"\u6B63\u5E38","Open":"\u6253\u5F00","Switch Video":"\u5207\u6362","Switch Subtitle":"\u5207\u6362\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7F51\u9875\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7F51\u9875\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u5F00\u542F\u753B\u4E2D\u753B","Exit PIP Mode":"\u9000\u51FA\u753B\u4E2D\u753B","PIP Not Supported":"\u4E0D\u652F\u6301\u753B\u4E2D\u753B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F6C\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],"3hy9S":[function(P,C,n){C.exports=JSON.parse('{"Video Info":"\u7D71\u8A08\u8A0A\u606F","Close":"\u95DC\u9589","Video Load Failed":"\u8F09\u5165\u5931\u6557","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u66AB\u505C","Rate":"\u901F\u5EA6","Mute":"\u975C\u97F3","Video Flip":"\u756B\u9762\u7FFB\u8F49","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u9023\u63A5","Show Setting":"\u986F\u793A\u8BBE\u7F6E","Hide Setting":"\u96B1\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u5716","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u756B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8A8D","Normal":"\u6B63\u5E38","Open":"\u6253\u958B","Switch Video":"\u5207\u63DB","Switch Subtitle":"\u5207\u63DB\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7DB2\u9801\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7DB2\u9801\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u958B\u555F\u756B\u4E2D\u756B","Exit PIP Mode":"\u9000\u51FA\u756B\u4E2D\u756B","PIP Not Supported":"\u4E0D\u652F\u6301\u756B\u4E2D\u756B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F49\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],aFOXc:[function(P,C,n){C.exports=JSON.parse('{"Video Info":"Informacje o wideo","Close":"Zamknij","Video Load Failed":"B\u0142\u0105d \u0142adowania wideo","Volume":"G\u0142o\u015Bno\u015B\u0107","Play":"Odtw\xF3rz","Pause":"Wstrzymaj","Rate":"Oce\u0144","Mute":"Wycisz","Video Flip":"Rotacja wideo","Horizontal":"Pozioma","Vertical":"Pionowa","Reconnect":"Po\u0142\u0105cz ponownie","Show Setting":"Poka\u017C ustawienia","Hide Setting":"Ukryj ustawienia","Screenshot":"Zrzut ekranu","Play Speed":"Pr\u0119dko\u015B\u0107 odtwarzania","Aspect Ratio":"Wsp\xF3\u0142czynnik proporcji","Default":"Domy\u015Blny","Normal":"Normalny","Open":"Otw\xF3rz","Switch Video":"Prze\u0142\u0105cz wideo","Switch Subtitle":"Prze\u0142\u0105cz napisy","Fullscreen":"Pe\u0142ny ekran","Exit Fullscreen":"Zamknij pe\u0142ny ekran","Web Fullscreen":"Tryb pe\u0142nej strony","Exit Web Fullscreen":"Zamknij tryb pe\u0142nej strony","Mini Player":"Miniodtwarzacz","PIP Mode":"Tryb PiP","Exit PIP Mode":"Zamknij tryb PiP","PIP Not Supported":"Tryb PiP nieobs\u0142ugiwany","Fullscreen Not Supported":"Pe\u0142ny ekran nieobs\u0142ugiwany","Subtitle Offset":"Przesuni\u0119cie napis\xF3w","Last Seen":"Ostatnio widziany","Jump Play":"Skocz do gry","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nie jest dost\u0119pny"}')},{}],aNfUP:[function(P,C,n){C.exports=JSON.parse('{"Video Info":"Info o videu","Close":"Zav\u0159\xEDt","Video Load Failed":"Nahr\xE1n\xED videa selhalo","Volume":"Hlasitost","Play":"P\u0159ehr\xE1t","Pause":"Pozastavit","Rate":"Hodnocen\xED","Mute":"Ztlumit","Video Flip":"Oto\u010Dit video","Horizontal":"Horizont\xE1ln\u011B","Vertical":"Vertik\xE1ln\u011B","Reconnect":"Op\u011Btovn\xE9 p\u0159ipojen\xED","Show Setting":"Zobrazit nastaven\xED","Hide Setting":"Skr\xFDt nastaven\xED","Screenshot":"Sn\xEDmek obrazovky","Play Speed":"Rychlost p\u0159ehr\xE1v\xE1n\xED","Aspect Ratio":"Pom\u011Br stran","Default":"V\xFDchoz\xED","Normal":"Norm\xE1ln\xED","Open":"Otev\u0159\xEDt","Switch Video":"P\u0159epnout video","Switch Subtitle":"P\u0159epnout titulky","Fullscreen":"Cel\xE1 obrazovka","Exit Fullscreen":"Opustit re\u017Eim cel\xE9 obrazovky","Web Fullscreen":"Cel\xE1 str\xE1nka","Exit Web Fullscreen":"Zav\u0159\xEDt re\u017Eim cel\xE9 str\xE1nky","Mini Player":"Mini p\u0159ehr\xE1va\u010D","PIP Mode":"Re\u017Eim PIP","Exit PIP Mode":"Opustit re\u017Eim PIP","PIP Not Supported":"Re\u017Eim PIP nen\xED podporov\xE1n","Fullscreen Not Supported":"Re\u017Eim cel\xE9 obrazovky nen\xED podporov\xE1n","Subtitle Offset":"Posun titulk\u016F","Last Seen":"Naposledy vid\u011Bn","Jump Play":"Hra na skok","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nen\xED k dispozici"}')},{}],bCaa0:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("./urlMix"),d=s.interopDefault(t),I=P("./attrMix"),x=s.interopDefault(I),D=P("./playMix"),u=s.interopDefault(D),i=P("./pauseMix"),f=s.interopDefault(i),p=P("./toggleMix"),g=s.interopDefault(p),m=P("./seekMix"),S=s.interopDefault(m),o=P("./volumeMix"),e=s.interopDefault(o),c=P("./currentTimeMix"),h=s.interopDefault(c),v=P("./durationMix"),a=s.interopDefault(v),r=P("./switchMix"),l=s.interopDefault(r),A=P("./playbackRateMix"),T=s.interopDefault(A),b=P("./aspectRatioMix"),L=s.interopDefault(b),E=P("./screenshotMix"),y=s.interopDefault(E),O=P("./fullscreenMix"),M=s.interopDefault(O),R=P("./fullscreenWebMix"),F=s.interopDefault(R),k=P("./pipMix"),w=s.interopDefault(k),_=P("./loadedMix"),B=s.interopDefault(_),N=P("./playedMix"),U=s.interopDefault(N),j=P("./playingMix"),K=s.interopDefault(j),H=P("./autoSizeMix"),G=s.interopDefault(H),W=P("./rectMix"),X=s.interopDefault(W),V=P("./flipMix"),J=s.interopDefault(V),$=P("./miniMix"),z=s.interopDefault($),Q=P("./loopMix"),q=s.interopDefault(Q),tt=P("./posterMix"),et=s.interopDefault(tt),rt=P("./autoHeightMix"),Y=s.interopDefault(rt),it=P("./themeMix"),nt=s.interopDefault(it),at=P("./titleMix"),ut=s.interopDefault(at),st=P("./normalSizeMix"),vt=s.interopDefault(st),ot=P("./subtitleOffsetMix"),ft=s.interopDefault(ot),pt=P("./airplayMix"),yt=s.interopDefault(pt),mt=P("./optionInit"),lt=s.interopDefault(mt),dt=P("./eventInit"),ct=s.interopDefault(dt);n.default=class{constructor(Z){(0,d.default)(Z),(0,x.default)(Z),(0,u.default)(Z),(0,f.default)(Z),(0,g.default)(Z),(0,S.default)(Z),(0,e.default)(Z),(0,h.default)(Z),(0,a.default)(Z),(0,l.default)(Z),(0,T.default)(Z),(0,L.default)(Z),(0,y.default)(Z),(0,M.default)(Z),(0,F.default)(Z),(0,w.default)(Z),(0,B.default)(Z),(0,U.default)(Z),(0,K.default)(Z),(0,G.default)(Z),(0,X.default)(Z),(0,J.default)(Z),(0,z.default)(Z),(0,q.default)(Z),(0,et.default)(Z),(0,Y.default)(Z),(0,nt.default)(Z),(0,ut.default)(Z),(0,vt.default)(Z),(0,ft.default)(Z),(0,yt.default)(Z),(0,ct.default)(Z),(0,lt.default)(Z)}}},{"./urlMix":"9mMBB","./attrMix":"ghisN","./playMix":"l5N6R","./pauseMix":"fVR5i","./toggleMix":"cZiBO","./seekMix":"bsO1Q","./volumeMix":"ivSmC","./currentTimeMix":"8LbXb","./durationMix":"f7tNT","./switchMix":"ejQWi","./playbackRateMix":"kNcxE","./aspectRatioMix":"8v5yt","./screenshotMix":"eLUEv","./fullscreenMix":"ifvhR","./fullscreenWebMix":"dsFtO","./pipMix":"gYMLD","./loadedMix":"fMSRd","./playedMix":"iRHNE","./playingMix":"dQ40z","./autoSizeMix":"iF844","./rectMix":"1hAm8","./flipMix":"dhi4g","./miniMix":"eQPx9","./loopMix":"gQaVE","./posterMix":"7n9Pt","./autoHeightMix":"8Az1F","./themeMix":"kXlsI","./titleMix":"b8f4Q","./normalSizeMix":"4fP62","./subtitleOffsetMix":"gdNfa","./airplayMix":"bDxGv","./optionInit":"luxZi","./eventInit":"b25aJ","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"9mMBB":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{option:d,template:{$video:I}}=t;(0,s.def)(t,"url",{get:()=>I.currentSrc,async set(x){if(x){const D=d.type||(0,s.getExt)(x),u=d.customType[D];D&&u?(await(0,s.sleep)(),t.loading.show=!0,u.call(t,I,x,t)):(t.url&&t.url!==x&&t.once("video:canplay",()=>{t.isReady&&t.emit("restart")}),I.src=x,t.option.url=x,t.emit("url",x))}else await(0,s.sleep)(),t.loading.show=!0}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ghisN:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{template:{$video:d}}=t;(0,s.def)(t,"attr",{value(I,x){if(x===void 0)return d[I];d[I]=x}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],l5N6R:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{i18n:d,notice:I,option:x,constructor:{instances:D},template:{$video:u}}=t;(0,s.def)(t,"play",{value:async function(){const i=await u.play();if(I.show=d.get("Play"),t.emit("play"),x.mutex)for(let f=0;f<D.length;f++){const p=D[f];p!==t&&p.pause()}return i}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],fVR5i:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{template:{$video:d},i18n:I,notice:x}=t;(0,s.def)(t,"pause",{value(){const D=d.pause();return x.show=I.get("Pause"),t.emit("pause"),D}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],cZiBO:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){(0,s.def)(t,"toggle",{value:()=>t.playing?t.pause():t.play()})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bsO1Q:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{notice:d}=t;(0,s.def)(t,"seek",{set(I){t.currentTime=I,t.emit("seek",t.currentTime),t.duration&&(d.show=`${(0,s.secondToTime)(t.currentTime)} / ${(0,s.secondToTime)(t.duration)}`)}}),(0,s.def)(t,"forward",{set(I){t.seek=t.currentTime+I}}),(0,s.def)(t,"backward",{set(I){t.seek=t.currentTime-I}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ivSmC:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{template:{$video:d},i18n:I,notice:x,storage:D}=t;(0,s.def)(t,"volume",{get:()=>d.volume||0,set:u=>{d.volume=(0,s.clamp)(u,0,1),x.show=`${I.get("Volume")}: ${parseInt(100*d.volume,10)}`,d.volume!==0&&D.set("volume",d.volume),t.emit("volume",d.volume)}}),(0,s.def)(t,"muted",{get:()=>d.muted,set:u=>{d.muted=u,t.emit("volume",d.volume)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"8LbXb":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{$video:d}=t.template;(0,s.def)(t,"currentTime",{get:()=>d.currentTime||0,set:I=>{I=parseFloat(I),Number.isNaN(I)||(d.currentTime=(0,s.clamp)(I,0,t.duration))}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],f7tNT:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){(0,s.def)(t,"duration",{get:()=>{const{duration:d}=t.template.$video;return d===1/0?0:d||0}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ejQWi:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{i18n:d,option:I,notice:x}=t;function D(u,i,f){return new Promise(p=>{if(u===t.url)return p(u);const{playing:g}=t;t.pause(),URL.revokeObjectURL(t.url),t.url=u,t.once("video:canplay",()=>{t.playbackRate=!1,t.aspectRatio=!1,t.flip="normal",t.autoSize=I.autoSize,t.currentTime=f,t.notice.show="",g&&t.play(),i&&(x.show=`${d.get("Switch Video")}: ${i}`),t.emit("switch",u),p(u)})})}(0,s.def)(t,"switchQuality",{value:(u,i)=>D(u,i,t.currentTime)}),(0,s.def)(t,"switchUrl",{value:(u,i)=>D(u,i,0)})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kNcxE:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{template:{$video:d},i18n:I,notice:x}=t;(0,s.def)(t,"playbackRate",{get:()=>d.playbackRate,set(D){if(D){if(D===d.playbackRate)return;const u=[.25,.5,.75,1,1.25,1.5,1.75,2,3,4];(0,s.errorHandle)(u.includes(D),`'playbackRate' only accept ${u.toString()} as parameters`),d.playbackRate=D,x.show=`${I.get("Rate")}: ${D===1?I.get("Normal"):`${D}x`}`,t.emit("playbackRate",D)}else t.playbackRate=1,t.emit("playbackRate")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"8v5yt":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{template:{$video:d,$player:I},i18n:x,notice:D}=t;(0,s.def)(t,"aspectRatio",{get:()=>I.dataset.aspectRatio||"default",set(u){u||(u="default");const i=["default","4:3","16:9"];if((0,s.errorHandle)(i.includes(u),`'aspectRatio' only accept ${i.toString()} as parameters`),u==="default")(0,s.setStyle)(d,"width",null),(0,s.setStyle)(d,"height",null),(0,s.setStyle)(d,"padding",null),delete I.dataset.aspectRatio;else{const f=u.split(":").map(Number),{videoWidth:p,videoHeight:g}=d,{clientWidth:m,clientHeight:S}=I,o=p/g,e=f[0]/f[1];if(o>e){const c=e*g/p;(0,s.setStyle)(d,"width",100*c+"%"),(0,s.setStyle)(d,"height","100%"),(0,s.setStyle)(d,"padding",`0 ${(m-m*c)/2}px`)}else{const c=p/e/g;(0,s.setStyle)(d,"width","100%"),(0,s.setStyle)(d,"height",100*c+"%"),(0,s.setStyle)(d,"padding",(S-S*c)/2+"px 0")}I.dataset.aspectRatio=u}D.show=`${x.get("Aspect Ratio")}: ${u==="default"?x.get("Default"):u}`,t.emit("aspectRatio",u)}}),(0,s.def)(t,"aspectRatioReset",{set(u){if(u){const{aspectRatio:i}=t;t.aspectRatio=i}}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eLUEv:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{option:d,notice:I,template:{$video:x}}=t,D=document.createElement("canvas");(0,s.def)(t,"getDataURL",{value:()=>new Promise((u,i)=>{try{D.width=x.videoWidth,D.height=x.videoHeight,D.getContext("2d").drawImage(x,0,0),u(D.toDataURL("image/png"))}catch(f){I.show=f,i(f)}})}),(0,s.def)(t,"getBlobUrl",{value:()=>new Promise((u,i)=>{try{D.width=x.videoWidth,D.height=x.videoHeight,D.getContext("2d").drawImage(x,0,0),D.toBlob(f=>{u(URL.createObjectURL(f))})}catch(f){I.show=f,i(f)}})}),(0,s.def)(t,"screenshot",{value:async()=>{const u=await t.getDataURL();return(0,s.download)(u,`${d.title||"artplayer"}_${(0,s.secondToTime)(x.currentTime)}.png`),t.emit("screenshot",u),u}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ifvhR:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("../libs/screenfull"),d=s.interopDefault(t),I=P("../utils");n.default=function(x){const{i18n:D,notice:u,template:{$video:i,$player:f}}=x;x.once("video:loadedmetadata",()=>{var p;d.default.isEnabled?(p=x,d.default.on("change",()=>p.emit("fullscreen",d.default.isFullscreen)),(0,I.def)(p,"fullscreen",{get:()=>d.default.isFullscreen,async set(g){g?(p.normalSize="fullscreen",p.aspectRatioReset=!0,p.autoSize=!1,await d.default.request(f),(0,I.addClass)(f,"art-fullscreen"),p.emit("resize"),p.emit("fullscreen",!0),u.show=""):(p.aspectRatioReset=!0,p.autoSize=p.option.autoSize,await d.default.exit(),(0,I.removeClass)(f,"art-fullscreen"),p.emit("resize"),p.emit("fullscreen"),u.show="")}})):document.fullscreenEnabled||i.webkitSupportsFullscreen?(g=>{(0,I.def)(g,"fullscreen",{get:()=>i.webkitDisplayingFullscreen,set(m){m?(g.normalSize="fullscreen",i.webkitEnterFullscreen(),g.emit("fullscreen",!0),u.show=""):(i.webkitExitFullscreen(),g.emit("fullscreen"),u.show="")}})})(x):(0,I.def)(x,"fullscreen",{get:()=>!1,set(){u.show=D.get("Fullscreen Not Supported")}}),(0,I.def)(x,"fullscreen",(0,I.get)(x,"fullscreen"))})}},{"../libs/screenfull":"dXDKn","../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],dXDKn:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);const s=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],t=(()=>{if(typeof document>"u")return!1;const x=s[0],D={};for(const u of s)if(u[1]in document){for(const[i,f]of u.entries())D[x[i]]=f;return D}return!1})(),d={change:t.fullscreenchange,error:t.fullscreenerror};let I={request:(x=document.documentElement,D)=>new Promise((u,i)=>{const f=()=>{I.off("change",f),u()};I.on("change",f);const p=x[t.requestFullscreen](D);p instanceof Promise&&p.then(f).catch(i)}),exit:()=>new Promise((x,D)=>{if(!I.isFullscreen)return void x();const u=()=>{I.off("change",u),x()};I.on("change",u);const i=document[t.exitFullscreen]();i instanceof Promise&&i.then(u).catch(D)}),toggle:(x,D)=>I.isFullscreen?I.exit():I.request(x,D),onchange(x){I.on("change",x)},onerror(x){I.on("error",x)},on(x,D){const u=d[x];u&&document.addEventListener(u,D,!1)},off(x,D){const u=d[x];u&&document.removeEventListener(u,D,!1)},raw:t};Object.defineProperties(I,{isFullscreen:{get:()=>Boolean(document[t.fullscreenElement])},element:{enumerable:!0,get:()=>document[t.fullscreenElement]},isEnabled:{enumerable:!0,get:()=>Boolean(document[t.fullscreenEnabled])}}),t||(I={isEnabled:!1}),n.default=I},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],dsFtO:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{notice:d,template:{$player:I}}=t;(0,s.def)(t,"fullscreenWeb",{get:()=>(0,s.hasClass)(I,"art-fullscreen-web"),set(x){x?(t.normalSize="fullscreenWeb",(0,s.addClass)(I,"art-fullscreen-web"),t.aspectRatioReset=!0,t.autoSize=!1,t.emit("resize"),t.emit("fullscreenWeb",!0),d.show=""):((0,s.removeClass)(I,"art-fullscreen-web"),t.aspectRatioReset=!0,t.autoSize=t.option.autoSize,t.emit("resize"),t.emit("fullscreenWeb"),d.show="")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],gYMLD:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{i18n:d,notice:I,template:{$video:x}}=t;document.pictureInPictureEnabled?function(D){const{template:{$video:u},events:{proxy:i},notice:f}=D;u.disablePictureInPicture=!1,(0,s.def)(D,"pip",{get:()=>document.pictureInPictureElement,set(p){p?(D.normalSize="pip",u.requestPictureInPicture().catch(g=>{throw f.show=g,g})):document.exitPictureInPicture().catch(g=>{throw f.show=g,g})}}),i(u,"enterpictureinpicture",()=>{D.emit("pip",!0)}),i(u,"leavepictureinpicture",()=>{D.emit("pip")})}(t):x.webkitSupportsPresentationMode?function(D){const{$video:u}=D.template;u.webkitSetPresentationMode("inline"),(0,s.def)(D,"pip",{get:()=>u.webkitPresentationMode==="picture-in-picture",set(i){i?(D.normalSize="pip",u.webkitSetPresentationMode("picture-in-picture"),D.emit("pip",!0)):(u.webkitSetPresentationMode("inline"),D.emit("pip"))}})}(t):(0,s.def)(t,"pip",{get:()=>!1,set(){I.show=d.get("PIP Not Supported")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],fMSRd:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{$video:d}=t.template;(0,s.def)(t,"loaded",{get:()=>t.loadedTime/d.duration}),(0,s.def)(t,"loadedTime",{get:()=>d.buffered.length?d.buffered.end(d.buffered.length-1):0})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],iRHNE:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){(0,s.def)(t,"played",{get:()=>t.currentTime/t.duration})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],dQ40z:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{$video:d}=t.template;(0,s.def)(t,"playing",{get:()=>d.currentTime>0&&!d.paused&&!d.ended&&d.readyState>2})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],iF844:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{$container:d,$player:I,$video:x}=t.template;(0,s.def)(t,"autoSize",{get:()=>(0,s.hasClass)(d,"art-auto-size"),set(D){if(D){const{videoWidth:u,videoHeight:i}=x,{width:f,height:p}=d.getBoundingClientRect(),g=u/i,m=f/p;if((0,s.addClass)(d,"art-auto-size"),m>g){const S=p*g/f*100;(0,s.setStyle)(I,"width",`${S}%`),(0,s.setStyle)(I,"height","100%")}else{const S=f/g/p*100;(0,s.setStyle)(I,"width","100%"),(0,s.setStyle)(I,"height",`${S}%`)}t.emit("autoSize",{width:t.width,height:t.height})}else(0,s.removeClass)(d,"art-auto-size"),(0,s.setStyle)(I,"width",null),(0,s.setStyle)(I,"height",null),t.emit("autoSize")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"1hAm8":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){(0,s.def)(t,"rect",{get:()=>t.template.$player.getBoundingClientRect()});const d=["bottom","height","left","right","top","width"];for(let I=0;I<d.length;I++){const x=d[I];(0,s.def)(t,x,{get:()=>t.rect[x]})}(0,s.def)(t,"x",{get:()=>t.left+window.pageXOffset}),(0,s.def)(t,"y",{get:()=>t.top+window.pageYOffset})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],dhi4g:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{template:{$player:d},i18n:I,notice:x}=t;(0,s.def)(t,"flip",{get:()=>d.dataset.flip||"normal",set(D){D||(D="normal");const u=["normal","horizontal","vertical"];(0,s.errorHandle)(u.includes(D),`'flip' only accept ${u.toString()} as parameters`),D==="normal"?delete d.dataset.flip:d.dataset.flip=D;const i=D.replace(D[0],D[0].toUpperCase());x.show=`${I.get("Video Flip")}: ${I.get(i)}`,t.emit("flip",D)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eQPx9:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{i18n:d,option:I,storage:x,events:{proxy:D},template:{$player:u,$miniClose:i,$miniTitle:f,$miniHeader:p}}=t;let g=!1,m=0,S=0,o=0,e=0;D(p,"mousedown",c=>{g=!0,m=c.pageX,S=c.pageY,o=t.left,e=t.top}),D(document,"mousemove",c=>{if(g){(0,s.addClass)(u,"art-is-dragging");const h=e+c.pageY-S,v=o+c.pageX-m;(0,s.setStyle)(u,"top",`${h}px`),(0,s.setStyle)(u,"left",`${v}px`),x.set("top",h),x.set("left",v)}}),D(document,"mouseup",()=>{g=!1,(0,s.removeClass)(u,"art-is-dragging")}),D(i,"click",()=>{t.mini=!1,g=!1,(0,s.removeClass)(u,"art-is-dragging")}),(0,s.append)(f,I.title||d.get("Mini Player")),(0,s.def)(t,"mini",{get:()=>(0,s.hasClass)(u,"art-mini"),set(c){if(c){t.normalSize="mini",t.autoSize=!1,(0,s.addClass)(u,"art-mini");const h=x.get("top"),v=x.get("left");if(h&&v)(0,s.setStyle)(u,"top",`${h}px`),(0,s.setStyle)(u,"left",`${v}px`),(0,s.isInViewport)(p)||(x.del("top"),x.del("left"),t.mini=!0);else{const a=window.innerHeight-t.height-50,r=window.innerWidth-t.width-50;x.set("top",a),x.set("left",r),(0,s.setStyle)(u,"top",`${a}px`),(0,s.setStyle)(u,"left",`${r}px`)}t.aspectRatio=!1,t.playbackRate=!1,t.notice.show="",t.emit("mini",!0)}else(0,s.removeClass)(u,"art-mini"),(0,s.setStyle)(u,"top",null),(0,s.setStyle)(u,"left",null),t.aspectRatio=!1,t.playbackRate=!1,t.autoSize=I.autoSize,t.notice.show="",t.emit("mini")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],gQaVE:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){let d=[];(0,s.def)(t,"loop",{get:()=>d,set:I=>{if(Array.isArray(I)&&typeof I[0]=="number"&&typeof I[1]=="number"){const x=(0,s.clamp)(I[0],0,Math.min(I[1],t.duration)),D=(0,s.clamp)(I[1],x,t.duration);D-x>=1?(d=[x,D],t.emit("loop",d)):(d=[],t.emit("loop"))}else d=[],t.emit("loop")}}),t.on("video:timeupdate",()=>{d.length&&(t.currentTime<d[0]||t.currentTime>d[1])&&(t.seek=d[0])})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"7n9Pt":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{option:d,template:{$poster:I}}=t;(0,s.def)(t,"poster",{get:()=>d.poster,set(x){d.poster=x,(0,s.setStyle)(I,"backgroundImage",`url(${x})`)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"8Az1F":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{option:d,template:{$container:I,$video:x}}=t,D=I.style.height;(0,s.def)(t,"autoHeight",{get:()=>(0,s.hasClass)(I,"art-auto-height"),set(u){if(u){const{clientWidth:i}=I,{videoHeight:f,videoWidth:p}=x,g=f*(i/p);(0,s.setStyle)(I,"height",g+"px"),(0,s.addClass)(I,"art-auto-height"),t.autoSize=d.autoSize,t.emit("autoHeight",g)}else(0,s.setStyle)(I,"height",D),(0,s.removeClass)(I,"art-auto-height"),t.autoSize=d.autoSize,t.emit("autoHeight")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kXlsI:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{option:d,template:{$player:I}}=t;(0,s.def)(t,"theme",{get:()=>getComputedStyle(I).getPropertyValue("--theme"),set(x){d.theme=x,I.style.setProperty("--theme",x)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],b8f4Q:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){(0,s.def)(t,"title",{get:()=>t.option.title,set(d){t.option.title=d}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"4fP62":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const d=["mini","pip","fullscreen","fullscreenWeb"];(0,s.def)(t,"normalSize",{get:()=>d.every(I=>!t[I]),set(I){d.filter(x=>x!==I).forEach(x=>{t[x]&&(t[x]=!1)})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],gdNfa:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{clamp:d}=t.constructor.utils,{notice:I,template:x,i18n:D}=t;let u=0,i=[];t.on("subtitle:switch",()=>{i=[]}),(0,s.def)(t,"subtitleOffset",{get:()=>u,set(f){if(x.$track&&x.$track.track){const p=Array.from(x.$track.track.cues);u=d(f,-5,5);for(let g=0;g<p.length;g++){const m=p[g];i[g]||(i[g]={startTime:m.startTime,endTime:m.endTime}),m.startTime=d(i[g].startTime+u,0,t.duration),m.endTime=d(i[g].endTime+u,0,t.duration)}t.subtitle.update(),I.show=`${D.get("Subtitle Offset")}: ${f}s`,t.emit("subtitleOffset",f)}else t.emit("subtitleOffset",0)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bDxGv:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{i18n:d,notice:I,events:{proxy:x},template:{$video:D}}=t;let u=!0;window.WebKitPlaybackTargetAvailabilityEvent&&D.webkitShowPlaybackTargetPicker?x(D,"webkitplaybacktargetavailabilitychanged",i=>{switch(i.availability){case"available":u=!0;break;case"not-available":u=!1}}):u=!1,(0,s.def)(t,"airplay",{value(){u?(D.webkitShowPlaybackTargetPicker(),t.emit("airplay")):I.show=d.get("AirPlay Not Available")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],luxZi:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{option:d,storage:I,template:{$video:x,$poster:D}}=t;Object.keys(d.moreVideoAttr).forEach(i=>{t.attr(i,d.moreVideoAttr[i])}),d.muted&&(t.muted=d.muted),d.volume&&(x.volume=(0,s.clamp)(d.volume,0,1));const u=I.get("volume");typeof u=="number"&&(x.volume=(0,s.clamp)(u,0,1)),d.poster&&(0,s.setStyle)(D,"backgroundImage",`url(${d.poster})`),d.autoplay&&(x.autoplay=d.autoplay),d.playsInline&&(x.playsInline=!0,x["webkit-playsinline"]=!0),d.theme&&(t.theme=d.theme),t.url=d.url}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],b25aJ:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("../config"),d=s.interopDefault(t),I=P("../utils");n.default=function(x){const{i18n:D,notice:u,option:i,constructor:f,events:{proxy:p},template:{$player:g,$video:m,$poster:S}}=x;let o=0;for(let e=0;e<d.default.events.length;e++)p(m,d.default.events[e],c=>{x.emit(`video:${c.type}`,c)});x.on("video:canplay",()=>{o=0,x.loading.show=!1}),x.once("video:canplay",()=>{x.loading.show=!1,x.controls.show=!0,x.mask.show=!0,x.isReady=!0,x.emit("ready")}),x.on("video:ended",()=>{i.loop?(x.seek=0,x.play(),x.controls.show=!1,x.mask.show=!1):(x.controls.show=!0,x.mask.show=!0)}),x.on("video:error",async()=>{o<f.RECONNECT_TIME_MAX?(await(0,I.sleep)(f.RECONNECT_SLEEP_TIME),o+=1,x.url=i.url,u.show=`${D.get("Reconnect")}: ${o}`,x.emit("error",o)):(x.mask.show=!0,x.loading.show=!1,x.controls.show=!0,(0,I.addClass)(g,"art-error"),await(0,I.sleep)(f.RECONNECT_SLEEP_TIME),u.show=D.get("Video Load Failed"),x.destroy(!1))}),x.on("video:loadedmetadata",()=>{x.autoSize=i.autoSize,I.isMobile&&(x.loading.show=!1,x.controls.show=!0,x.mask.show=!0)}),x.on("video:loadstart",()=>{x.loading.show=!0,x.mask.show=!1,x.controls.show=!0}),x.on("video:pause",()=>{x.controls.show=!0,x.mask.show=!0}),x.on("video:play",()=>{x.mask.show=!1,(0,I.setStyle)(S,"display","none")}),x.on("video:playing",()=>{x.mask.show=!1}),x.on("video:seeked",()=>{x.loading.show=!1}),x.on("video:seeking",()=>{x.loading.show=!0,x.mask.show=!1}),x.on("video:timeupdate",()=>{x.mask.show=!1}),x.on("video:waiting",()=>{x.loading.show=!0,x.mask.show=!1})}},{"../config":"ej4fZ","../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"3qXcr":[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("../utils"),d=P("../utils/component"),I=s.interopDefault(d),x=P("./fullscreen"),D=s.interopDefault(x),u=P("./fullscreenWeb"),i=s.interopDefault(u),f=P("./pip"),p=s.interopDefault(f),g=P("./playAndPause"),m=s.interopDefault(g),S=P("./progress"),o=s.interopDefault(S),e=P("./time"),c=s.interopDefault(e),h=P("./volume"),v=s.interopDefault(h),a=P("./setting"),r=s.interopDefault(a),l=P("./thumbnails"),A=s.interopDefault(l),T=P("./screenshot"),b=s.interopDefault(T),L=P("./quality"),E=s.interopDefault(L),y=P("./loop"),O=s.interopDefault(y),M=P("./airplay"),R=s.interopDefault(M);class F extends I.default{constructor(w){super(w),this.name="control";const{constructor:_,events:{proxy:B},template:{$player:N}}=w;let U=Date.now();B(N,["click","mousemove","touchstart","touchmove"],()=>{this.show=!0,(0,t.removeClass)(N,"art-hide-cursor"),(0,t.addClass)(N,"art-hover"),U=Date.now()}),w.on("video:timeupdate",()=>{!w.isInput&&w.playing&&this.show&&Date.now()-U>=_.CONTROL_HIDE_TIME&&(this.show=!1,(0,t.addClass)(N,"art-hide-cursor"),(0,t.removeClass)(N,"art-hover"))}),this.init()}init(){const{option:w}=this.art;w.isLive||this.add((0,o.default)({name:"progress",position:"top",index:10})),!w.thumbnails.url||w.isLive||t.isMobile||this.add((0,A.default)({name:"thumbnails",position:"top",index:20})),this.add((0,O.default)({name:"loop",position:"top",index:30})),this.add((0,m.default)({name:"playAndPause",position:"left",index:10})),this.add((0,v.default)({name:"volume",position:"left",index:20})),w.isLive||this.add((0,c.default)({name:"time",position:"left",index:30})),w.quality.length&&this.add((0,E.default)({name:"quality",position:"right",index:10})),w.screenshot&&!t.isMobile&&this.add((0,b.default)({name:"screenshot",position:"right",index:20})),w.setting&&this.add((0,r.default)({name:"setting",position:"right",index:30})),w.pip&&this.add((0,p.default)({name:"pip",position:"right",index:40})),w.airplay&&window.WebKitPlaybackTargetAvailabilityEvent&&this.add((0,R.default)({name:"airplay",position:"right",index:50})),w.fullscreenWeb&&this.add((0,i.default)({name:"fullscreenWeb",position:"right",index:60})),w.fullscreen&&this.add((0,D.default)({name:"fullscreen",position:"right",index:70}));for(let _=0;_<w.controls.length;_++)this.add(w.controls[_])}add(w){const _=typeof w=="function"?w(this.art):w,{$progress:B,$controlsLeft:N,$controlsRight:U}=this.art.template;switch(_.position){case"top":this.$parent=B;break;case"left":this.$parent=N;break;case"right":this.$parent=U;break;default:(0,t.errorHandle)(!1,"Control option.position must one of 'top', 'left', 'right'")}super.add(_)}}n.default=F},{"../utils":"5yYFo","../utils/component":"5MLcx","./fullscreen":"43BKT","./fullscreenWeb":"kQJHz","./pip":"aWne0","./playAndPause":"4z78f","./progress":"19nwD","./time":"lh90q","./volume":"hsA6A","./setting":"4rv3i","./thumbnails":"lTgvI","./screenshot":"71GuX","./quality":"f9VNW","./loop":"d1O2Q","./airplay":"aIzPt","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"5MLcx":[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("./dom"),d=P("option-validator"),I=s.interopDefault(d),x=P("../scheme"),D=P("./property"),u=P("./error");n.default=class{constructor(i){this.id=0,this.art=i,this.add=this.add.bind(this)}get show(){return(0,t.hasClass)(this.art.template.$player,`art-${this.name}-show`)}set show(i){const{$player:f}=this.art.template,p=`art-${this.name}-show`;i?(0,t.addClass)(f,p):(0,t.removeClass)(f,p),this.art.emit(this.name,i)}set toggle(i){i&&(this.show=!this.show)}add(i){const f=typeof i=="function"?i(this.art):i;if(f.html=f.html||"",(0,I.default)(f,x.ComponentOption),!this.$parent||!this.name||f.disable)return;const p=f.name||`${this.name}${this.id}`;(0,u.errorHandle)(!(0,D.has)(this,p),`Cannot add an existing name [${p}] to the [${this.name}]`),this.id+=1;const g=document.createElement("div");(0,t.addClass)(g,`art-${this.name}`),(0,t.addClass)(g,`art-${this.name}-${p}`);const m=Array.from(this.$parent.children);g.dataset.index=f.index||this.id;const S=m.find(o=>Number(o.dataset.index)>=Number(g.dataset.index));return S?S.insertAdjacentElement("beforebegin",g):(0,t.append)(this.$parent,g),f.html&&(0,t.append)(g,f.html),f.style&&(0,t.setStyles)(g,f.style),f.tooltip&&(0,t.tooltip)(g,f.tooltip),f.click&&this.art.events.proxy(g,"click",o=>{o.preventDefault(),f.click.call(this.art,this,o)}),f.selector&&["left","right"].includes(f.position)&&this.selector(f,g),f.mounted&&f.mounted.call(this.art,g),g.childNodes.length===1&&g.childNodes[0].nodeType===3&&(0,t.addClass)(g,"art-control-onlyText"),(0,D.def)(this,p,{value:g}),g}selector(i,f){const{hover:p,proxy:g}=this.art.events;(0,t.addClass)(f,"art-control-selector");const m=document.createElement("div");(0,t.addClass)(m,"art-selector-value"),(0,t.append)(m,i.html),f.innerText="",(0,t.append)(f,m);const S=i.selector.map((c,h)=>`<div class="art-selector-item ${c.default?"art-current":""}" data-index="${h}">${c.html}</div>`).join(""),o=document.createElement("div");(0,t.addClass)(o,"art-selector-list"),(0,t.append)(o,S),(0,t.append)(f,o);const e=()=>{const c=(0,t.getStyle)(f,"width")/2-(0,t.getStyle)(o,"width")/2;o.style.left=`${c}px`};p(f,e),g(o,"click",async c=>{const h=(c.composedPath()||[]).find(r=>(0,t.hasClass)(r,"art-selector-item"));if(!h)return;(0,t.inverseClass)(h,"art-current");const v=Number(h.dataset.index),a=i.selector[v]||{};if(m.innerText=h.innerText,i.onSelect){const r=await i.onSelect.call(this.art,a,h,c);typeof r!="string"&&typeof r!="number"||(m.innerHTML=r)}e(),this.art.emit("selector",a,h)})}}},{"./dom":"fqaW9","option-validator":"eaJBf","../scheme":"3izFE","./property":"5ynPA","./error":"kNZvP","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"43BKT":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){return d=>({...t,tooltip:d.i18n.get("Fullscreen"),mounted:I=>{const{events:{proxy:x},icons:D,i18n:u}=d,i=(0,s.append)(I,D.fullscreenOn),f=(0,s.append)(I,D.fullscreenOff);(0,s.setStyle)(f,"display","none"),x(I,"click",()=>{d.fullscreen=!d.fullscreen}),d.on("fullscreen",p=>{p?((0,s.tooltip)(I,u.get("Exit Fullscreen")),(0,s.setStyle)(i,"display","none"),(0,s.setStyle)(f,"display","inline-flex")):((0,s.tooltip)(I,u.get("Fullscreen")),(0,s.setStyle)(i,"display","inline-flex"),(0,s.setStyle)(f,"display","none"))})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kQJHz:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){return d=>({...t,tooltip:d.i18n.get("Web Fullscreen"),mounted:I=>{const{events:{proxy:x},icons:D,i18n:u}=d,i=(0,s.append)(I,D.fullscreenWebOn),f=(0,s.append)(I,D.fullscreenWebOff);(0,s.setStyle)(f,"display","none"),x(I,"click",()=>{d.fullscreenWeb=!d.fullscreenWeb}),d.on("fullscreenWeb",p=>{p?((0,s.tooltip)(I,u.get("Exit Web Fullscreen")),(0,s.setStyle)(i,"display","none"),(0,s.setStyle)(f,"display","inline-flex")):((0,s.tooltip)(I,u.get("Web Fullscreen")),(0,s.setStyle)(i,"display","inline-flex"),(0,s.setStyle)(f,"display","none"))})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],aWne0:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){return d=>({...t,tooltip:d.i18n.get("PIP Mode"),mounted:I=>{const{events:{proxy:x},icons:D,i18n:u}=d;(0,s.append)(I,D.pip),x(I,"click",()=>{d.pip=!d.pip}),d.on("pip",i=>{(0,s.tooltip)(I,u.get(i?"Exit PIP Mode":"PIP Mode"))})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"4z78f":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){return d=>({...t,mounted:I=>{const{events:{proxy:x},icons:D,i18n:u}=d,i=(0,s.append)(I,D.play),f=(0,s.append)(I,D.pause);function p(){(0,s.setStyle)(i,"display","flex"),(0,s.setStyle)(f,"display","none")}function g(){(0,s.setStyle)(i,"display","none"),(0,s.setStyle)(f,"display","flex")}(0,s.tooltip)(i,u.get("Play")),(0,s.tooltip)(f,u.get("Pause")),x(i,"click",()=>{d.play()}),x(f,"click",()=>{d.pause()}),d.playing?g():p(),d.on("video:playing",()=>{g()}),d.on("video:pause",()=>{p()})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"19nwD":[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n),s.export(n,"getPosFromEvent",()=>d);var t=P("../utils");function d(I,x){const{$progress:D}=I.template,{left:u}=D.getBoundingClientRect(),i=x.pageX,f=(0,t.clamp)(i-u,0,D.clientWidth),p=f/D.clientWidth*I.duration;return{second:p,time:(0,t.secondToTime)(p),width:f,percentage:(0,t.clamp)(f/D.clientWidth,0,1)}}n.default=function(I){return x=>{const{icons:D,option:u,events:{proxy:i}}=x;return{...I,html:'<div class="art-control-progress-inner"><div class="art-progress-loaded"></div><div class="art-progress-played"></div><div class="art-progress-highlight"></div><div class="art-progress-indicator"></div><div class="art-progress-tip"></div></div>',mounted:f=>{let p=!1;const g=(0,t.query)(".art-progress-loaded",f),m=(0,t.query)(".art-progress-played",f),S=(0,t.query)(".art-progress-highlight",f),o=(0,t.query)(".art-progress-indicator",f),e=(0,t.query)(".art-progress-tip",f);(0,t.setStyle)(m,"backgroundColor","var(--theme)");let c=x.constructor.INDICATOR_SIZE;function h(v,a){v==="loaded"&&(0,t.setStyle)(g,"width",100*a+"%"),v==="played"&&((0,t.setStyle)(m,"width",100*a+"%"),(0,t.setStyle)(o,"left",`calc(${100*a}% - ${c/2}px)`))}D.indicator?(c=x.constructor.INDICATOR_SIZE_ICON,(0,t.append)(o,D.indicator)):(0,t.setStyles)(o,{backgroundColor:"var(--theme)"}),t.isMobile&&(c=x.constructor.INDICATOR_SIZE_MOBILE,D.indicator&&(c=x.constructor.INDICATOR_SIZE_MOBILE_ICON)),(0,t.setStyles)(o,{left:`-${c/2}px`,width:`${c}px`,height:`${c}px`}),x.on("video:loadedmetadata",()=>{for(let v=0;v<u.highlight.length;v++){const a=u.highlight[v],r=(0,t.clamp)(a.time,0,x.duration)/x.duration*100;(0,t.append)(S,`<span data-text="${a.text}" data-time="${a.time}" style="left: ${r}%"></span>`)}}),h("loaded",x.loaded),x.on("setBar",(v,a)=>{h(v,a)}),x.on("video:progress",()=>{h("loaded",x.loaded)}),x.on("video:timeupdate",()=>{h("played",x.played)}),x.on("video:ended",()=>{h("played",1)}),t.isMobile||(i(f,"click",v=>{if(v.target!==o){const{second:a,percentage:r}=d(x,v);h("played",r),x.seek=a}}),i(f,"mousemove",v=>{(0,t.setStyle)(e,"display","block"),(0,t.includeFromEvent)(v,S)?function(a){const{width:r}=d(x,a),{text:l}=a.target.dataset;e.innerHTML=l;const A=e.clientWidth;r<=A/2?(0,t.setStyle)(e,"left",0):r>f.clientWidth-A/2?(0,t.setStyle)(e,"left",f.clientWidth-A+"px"):(0,t.setStyle)(e,"left",r-A/2+"px")}(v):function(a){const{width:r,time:l}=d(x,a);e.innerHTML=l;const A=e.clientWidth;r<=A/2?(0,t.setStyle)(e,"left",0):r>f.clientWidth-A/2?(0,t.setStyle)(e,"left",f.clientWidth-A+"px"):(0,t.setStyle)(e,"left",r-A/2+"px")}(v)}),i(f,"mouseout",()=>{(0,t.setStyle)(e,"display","none")}),i(o,"mousedown",()=>{p=!0}),i(document,"mousemove",v=>{if(p){const{second:a,percentage:r}=d(x,v);h("played",r),x.seek=a}}),i(document,"mouseup",()=>{p&&(p=!1)}))}}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],lh90q:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){return d=>({...t,style:{cursor:"auto"},mounted:I=>{function x(){const u=`${(0,s.secondToTime)(d.currentTime)} / ${(0,s.secondToTime)(d.duration)}`;u!==I.innerText&&(I.innerText=u)}x();const D=["video:loadedmetadata","video:timeupdate","video:progress"];for(let u=0;u<D.length;u++)d.on(D[u],x)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],hsA6A:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){return d=>({...t,mounted:I=>{const{events:{proxy:x},icons:D,i18n:u}=d;let i=!1;const f=d.constructor.VOLUME_PANEL_WIDTH,p=d.constructor.VOLUME_HANDLE_WIDTH,g=(0,s.append)(I,D.volume),m=(0,s.append)(I,D.volumeClose),S=(0,s.append)(I,'<div class="art-volume-panel"></div>'),o=(0,s.append)(S,'<div class="art-volume-slider-handle"></div>');function e(h){const{left:v}=S.getBoundingClientRect();return(0,s.clamp)(h.pageX-v-p/2,0,f-p/2)/(f-p)}function c(h=.7){if(d.muted||h===0)(0,s.setStyle)(g,"display","none"),(0,s.setStyle)(m,"display","flex"),(0,s.setStyle)(o,"left","0");else{const v=(f-p)*h;(0,s.setStyle)(g,"display","flex"),(0,s.setStyle)(m,"display","none"),(0,s.setStyle)(o,"left",`${v}px`)}}(0,s.tooltip)(g,u.get("Mute")),(0,s.setStyle)(m,"display","none"),s.isMobile&&(0,s.setStyle)(S,"display","none"),c(d.volume),d.on("video:volumechange",()=>{c(d.volume)}),x(g,"click",()=>{d.muted=!0}),x(m,"click",()=>{d.muted=!1}),x(S,"click",h=>{d.muted=!1,d.volume=e(h)}),x(o,"mousedown",()=>{i=!0}),x(I,"mousemove",h=>{i&&(d.muted=!1,d.volume=e(h))}),x(document,"mouseup",()=>{i&&(i=!1)})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"4rv3i":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){return d=>({...t,tooltip:d.i18n.get("Show Setting"),mounted:I=>{const{events:{proxy:x},icons:D,i18n:u}=d;(0,s.append)(I,D.setting),x(I,"click",()=>{d.setting.toggle=!0}),d.on("setting",i=>{(0,s.tooltip)(I,u.get(i?"Hide Setting":"Show Setting"))})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],lTgvI:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils"),t=P("./progress");n.default=function(d){return I=>({...d,mounted:x=>{const{option:D,template:{$progress:u,$video:i},events:{proxy:f,loadImg:p}}=I;let g=null,m=!1,S=!1;f(u,"mousemove",async o=>{m||(m=!0,g=await p(D.thumbnails.url),S=!0),S&&((0,s.setStyle)(x,"display","block"),function(e){const{width:c}=(0,t.getPosFromEvent)(I,e),{url:h,number:v,column:a,width:r,height:l}=D.thumbnails,A=r||g.naturalWidth/a,T=l||A/(i.videoWidth/i.videoHeight),b=u.clientWidth/v,L=Math.floor(c/b),E=Math.ceil(L/a)-1,y=L%a||a-1;(0,s.setStyle)(x,"backgroundImage",`url(${h})`),(0,s.setStyle)(x,"height",`${T}px`),(0,s.setStyle)(x,"width",`${A}px`),(0,s.setStyle)(x,"backgroundPosition",`-${y*A}px -${E*T}px`),c<=A/2?(0,s.setStyle)(x,"left",0):c>u.clientWidth-A/2?(0,s.setStyle)(x,"left",u.clientWidth-A+"px"):(0,s.setStyle)(x,"left",c-A/2+"px")}(o))}),f(u,"mouseout",()=>{(0,s.setStyle)(x,"display","none")})}})}},{"../utils":"5yYFo","./progress":"19nwD","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"71GuX":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){return d=>({...t,tooltip:d.i18n.get("Screenshot"),mounted:I=>{const{events:{proxy:x},icons:D}=d;(0,s.append)(I,D.screenshot),x(I,"click",()=>{d.screenshot()})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],f9VNW:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n),n.default=function(s){return t=>{const d=t.option.quality,I=d.find(x=>x.default)||d[0];return{...s,html:I?I.html:"",selector:d,onSelect(x){t.switchQuality(x.url,x.html)}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],d1O2Q:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){return d=>({...t,mounted:I=>{const x=(0,s.append)(I,'<span class="art-loop-point"></span>'),D=(0,s.append)(I,'<span class="art-loop-point"></span>');d.on("loop",u=>{u?((0,s.setStyle)(I,"display","block"),(0,s.setStyle)(x,"left",`calc(${u[0]/d.duration*100}% - ${x.clientWidth}px)`),(0,s.setStyle)(D,"left",u[1]/d.duration*100+"%")):(0,s.setStyle)(I,"display","none")})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],aIzPt:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){return d=>({...t,tooltip:d.i18n.get("AirPlay"),mounted:I=>{const{events:{proxy:x},icons:D}=d;(0,s.append)(I,D.airplay),x(I,"click",()=>d.airplay())}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],hTnNz:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("../utils"),d=P("../utils/component"),I=s.interopDefault(d),x=P("./playbackRate"),D=s.interopDefault(x),u=P("./aspectRatio"),i=s.interopDefault(u),f=P("./flip"),p=s.interopDefault(f),g=P("./info"),m=s.interopDefault(g),S=P("./version"),o=s.interopDefault(S),e=P("./close"),c=s.interopDefault(e);class h extends I.default{constructor(a){super(a),this.name="contextmenu",this.$parent=a.template.$contextmenu,t.isMobile||this.init()}init(){const{option:a,template:{$player:r,$contextmenu:l},events:{proxy:A}}=this.art;a.playbackRate&&this.add((0,D.default)({name:"playbackRate",index:10})),a.aspectRatio&&this.add((0,i.default)({name:"aspectRatio",index:20})),a.flip&&this.add((0,p.default)({name:"flip",index:30})),this.add((0,m.default)({name:"info",index:40})),this.add((0,o.default)({name:"version",index:50})),this.add((0,c.default)({name:"close",index:60}));for(let T=0;T<a.contextmenu.length;T++)this.add(a.contextmenu[T]);A(r,"contextmenu",T=>{T.preventDefault(),this.show=!0;const b=T.clientX,L=T.clientY,{height:E,width:y,left:O,top:M}=r.getBoundingClientRect(),{height:R,width:F}=l.getBoundingClientRect();let k=b-O,w=L-M;b+F>O+y&&(k=y-F),L+R>M+E&&(w=E-R),(0,t.setStyles)(l,{top:`${w}px`,left:`${k}px`})}),A(r,"click",T=>{(0,t.includeFromEvent)(T,l)||(this.show=!1)}),this.art.on("blur",()=>{this.show=!1})}}n.default=h},{"../utils":"5yYFo","../utils/component":"5MLcx","./playbackRate":"1uTBJ","./aspectRatio":"cFKj0","./flip":"l7S3g","./info":"ihHBb","./version":"3q8wK","./close":"sLP7j","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"1uTBJ":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){return d=>{const{i18n:I}=d;return{...t,html:`${I.get("Play Speed")}:<span data-value="0.5">0.5</span><span data-value="0.75">0.75</span><span data-value="1.0" class="art-current">${I.get("Normal")}</span><span data-value="1.25">1.25</span><span data-value="1.5">1.5</span><span data-value="2.0">2.0</span>`,click:(x,D)=>{const{value:u}=D.target.dataset;u&&(d.playbackRate=Number(u),x.show=!1)},mounted:x=>{d.on("playbackRate",D=>{const u=(0,s.queryAll)("span",x).find(i=>Number(i.dataset.value)===D);u&&(0,s.inverseClass)(u,"art-current")})}}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],cFKj0:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){return d=>{const{i18n:I}=d;return{...t,html:`${I.get("Aspect Ratio")}:<span data-value="default" class="art-current">${I.get("Default")}</span><span data-value="4:3">4:3</span><span data-value="16:9">16:9</span>`,click:(x,D)=>{const{value:u}=D.target.dataset;u&&(d.aspectRatio=u,x.show=!1)},mounted:x=>{d.on("aspectRatio",D=>{const u=(0,s.queryAll)("span",x).find(i=>i.dataset.value===D);u&&(0,s.inverseClass)(u,"art-current")})}}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],l7S3g:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){return d=>{const{i18n:I}=d;return{...t,html:`${I.get("Video Flip")}:<span data-value="normal" class="art-current">${I.get("Normal")}</span><span data-value="horizontal">${I.get("Horizontal")}</span><span data-value="vertical">${I.get("Vertical")}</span>`,click:(x,D)=>{const{value:u}=D.target.dataset;u&&(d.flip=u,x.show=!1)},mounted:x=>{d.on("flip",D=>{const u=(0,s.queryAll)("span",x).find(i=>i.dataset.value===D);u&&(0,s.inverseClass)(u,"art-current")})}}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ihHBb:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n),n.default=function(s){return t=>({...s,html:t.i18n.get("Video Info"),click:d=>{t.info.show=!0,d.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"3q8wK":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n),n.default=function(s){return{...s,html:'<a href="https://artplayer.org" target="_blank">ArtPlayer 4.5.4</a>'}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],sLP7j:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n),n.default=function(s){return t=>({...s,html:t.i18n.get("Close"),click:d=>{d.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bfwuE:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("./utils"),d=P("./utils/component"),I=s.interopDefault(d);class x extends I.default{constructor(u){super(u),this.name="info",t.isMobile||this.init()}init(){const{constructor:u,events:{proxy:i},template:{$infoPanel:f,$infoClose:p,$video:g}}=this.art;i(p,"click",()=>{this.show=!1});let m=null;const S=(0,t.queryAll)("[data-video]",f)||[];this.art.on("destroy",()=>{clearTimeout(m)}),function o(){for(let e=0;e<S.length;e++){const c=S[e],h=g[c.dataset.video],v=typeof h=="number"?h.toFixed(2):h;c.innerText!==v&&(c.innerText=v)}m=setTimeout(o,u.INFO_LOOP_TIME)}()}}n.default=x},{"./utils":"5yYFo","./utils/component":"5MLcx","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bWZ2U:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("./utils"),d=P("./utils/component"),I=s.interopDefault(d),x=P("option-validator"),D=s.interopDefault(x),u=P("./scheme"),i=s.interopDefault(u);class f extends I.default{constructor(g){super(g),this.name="subtitle",this.init(g.option.subtitle)}get url(){return this.art.template.$track.src}set url(g){this.switch(g)}get textTrack(){return this.art.template.$video.textTracks[0]}get activeCue(){return this.textTrack.activeCues[0]}style(g,m){const{$subtitle:S}=this.art.template;return typeof g=="object"?(0,t.setStyles)(S,g):(0,t.setStyle)(S,g,m)}update(){const{$subtitle:g}=this.art.template;g.innerHTML="",this.activeCue&&(g.innerHTML=this.activeCue.text.split(/\r?\n/).map(m=>`<p>${(0,t.escape)(m)}</p>`).join(""),this.art.emit("subtitleUpdate",this.activeCue.text))}async switch(g,m={}){const{i18n:S,notice:o,option:e}=this.art,c={...e.subtitle,...m,url:g},h=await this.init(c);return m.name&&(o.show=`${S.get("Switch Subtitle")}: ${m.name}`),h}init(g){if((0,D.default)(g,i.default.subtitle),!g.url)return;const{notice:m,events:{proxy:S},template:{$subtitle:o,$video:e,$track:c}}=this.art;if(!c){const h=document.createElement("track");h.default=!0,h.kind="metadata",e.appendChild(h),this.art.template.$track=h,S(this.textTrack,"cuechange",this.update.bind(this))}return this.style(g.style),(0,t.errorHandle)(window.fetch,"fetch not support"),fetch(g.url).then(h=>h.arrayBuffer()).then(h=>{(0,t.errorHandle)(window.TextDecoder,"TextDecoder not support");const v=new TextDecoder(g.encoding).decode(h);switch(this.art.emit("subtitleLoad",g.url),g.type||(0,t.getExt)(g.url)){case"srt":return(0,t.vttToBlob)((0,t.srtToVtt)(v));case"ass":return(0,t.vttToBlob)((0,t.assToVtt)(v));case"vtt":return(0,t.vttToBlob)(v);default:return g.url}}).then(h=>(o.innerHTML="",this.url===h||(URL.revokeObjectURL(this.url),this.art.template.$track.src=h,this.art.emit("subtitleSwitch",h)),h)).catch(h=>{throw m.show=h,h})}}n.default=f},{"./utils":"5yYFo","./utils/component":"5MLcx","option-validator":"eaJBf","./scheme":"3izFE","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"9oLaG":[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("../utils/error"),d=P("./clickInit"),I=s.interopDefault(d),x=P("./hoverInit"),D=s.interopDefault(x),u=P("./mousemoveInit"),i=s.interopDefault(u),f=P("./resizeInit"),p=s.interopDefault(f),g=P("./gestureInit"),m=s.interopDefault(g),S=P("./viewInit"),o=s.interopDefault(S);n.default=class{constructor(e){this.destroyEvents=[],this.proxy=this.proxy.bind(this),this.hover=this.hover.bind(this),this.loadImg=this.loadImg.bind(this),e.whitelist.state&&((0,I.default)(e,this),(0,D.default)(e,this),(0,i.default)(e,this),(0,p.default)(e,this),(0,m.default)(e,this),(0,o.default)(e,this))}proxy(e,c,h,v={}){if(Array.isArray(c))return c.map(r=>this.proxy(e,r,h,v));e.addEventListener(c,h,v);const a=()=>e.removeEventListener(c,h,v);return this.destroyEvents.push(a),a}hover(e,c,h){c&&this.proxy(e,"mouseenter",c),h&&this.proxy(e,"mouseleave",h)}loadImg(e){return new Promise((c,h)=>{let v;if(e instanceof HTMLImageElement)v=e;else{if(typeof e!="string")return h(new t.ArtPlayerError("Unable to get Image"));v=new Image,v.src=e}if(v.complete)return c(v);this.proxy(v,"load",()=>c(v)),this.proxy(v,"error",()=>h(new t.ArtPlayerError(`Failed to load Image: ${v.src}`)))})}destroy(){for(let e=0;e<this.destroyEvents.length;e++)this.destroyEvents[e]()}}},{"../utils/error":"kNZvP","./clickInit":"hrnqi","./hoverInit":"eIqcL","./mousemoveInit":"hEy8X","./resizeInit":"9c8lQ","./gestureInit":"gzHdo","./viewInit":"cJlT5","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],hrnqi:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t,d){const{constructor:I,template:{$player:x,$video:D}}=t;d.proxy(document,["click","contextmenu"],i=>{(0,s.includeFromEvent)(i,x)?(t.isInput=i.target.tagName==="INPUT",t.isFocus=!0,t.emit("focus")):(t.isInput=!1,t.isFocus=!1,t.emit("blur"))});let u=0;d.proxy(D,"click",()=>{const i=Date.now();i-u<=I.DB_CLICE_TIME?(t.emit("dblclick"),s.isMobile?t.isLock||t.toggle():t.fullscreen=!t.fullscreen):(t.emit("click"),s.isMobile||t.toggle()),u=i})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eIqcL:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t,d){const{$player:I}=t.template;d.hover(I,()=>{(0,s.addClass)(I,"art-hover"),t.emit("hover",!0)},()=>{(0,s.removeClass)(I,"art-hover"),t.emit("hover")})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],hEy8X:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n),n.default=function(s,t){const{$player:d}=s.template;t.proxy(d,"mousemove",I=>{s.emit("mousemove",I)})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"9c8lQ":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t,d){const{option:I}=t,x=(0,s.throttle)(()=>{t.normalSize&&(t.autoSize=I.autoSize),t.aspectRatioReset=!0,t.notice.show="",t.emit("resize")},t.constructor.RESIZE_TIME);d.proxy(window,["orientationchange","resize"],()=>{x()}),screen&&screen.orientation&&screen.orientation.onchange&&d.proxy(screen.orientation,"change",()=>{x()})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],gzHdo:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t,d){if(s.isMobile&&!t.option.isLive){const{$video:I,$bottom:x,$controls:D}=t.template;let u=!1,i=0,f=0,p=0;const g=o=>{if(o.touches.length===1&&!t.isLock){u=!0;const{clientX:e,clientY:c}=o.touches[0];i=e,f=c,p=t.currentTime}},m=o=>{if(o.touches.length===1&&u&&t.duration){const e=t.plugins.autoOrientation&&t.plugins.autoOrientation.state,{clientX:c,clientY:h}=o.touches[0],v=(0,s.clamp)((c-i)/t.width,-1,1),a=(0,s.clamp)((h-f)/t.height,-1,1),r=e?a:v,l=(0,s.clamp)(p+t.duration*r*t.constructor.TOUCH_MOVE_RATIO,0,t.duration);t.seek=l,t.emit("setBar","played",(0,s.clamp)(l/t.duration,0,1)),t.notice.show=`${(0,s.secondToTime)(l)} / ${(0,s.secondToTime)(t.duration)}`}},S=()=>{u&&(i=0,f=0,p=0,u=!1)};d.proxy(x,"touchstart",o=>{(0,s.includeFromEvent)(o,D)||g(o)}),d.proxy(x,"touchmove",m),d.proxy(I,"touchstart",g),d.proxy(I,"touchmove",m),d.proxy(document,"touchend",S)}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],cJlT5:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t,d){const{option:I,constructor:x,template:{$container:D}}=t,u=(0,s.throttle)(()=>{t.emit("view",(0,s.isInViewport)(D,x.SCROLL_GAP))},x.SCROLL_TIME);d.proxy(window,"scroll",()=>{u()}),t.on("view",i=>{I.autoMini&&(t.mini=!i)})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],cKO4X:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("./utils");n.default=class{constructor(t){this.art=t,this.keys={},t.option.hotkey&&!s.isMobile&&this.init()}init(){const{proxy:t}=this.art.events;this.add(27,()=>{this.art.fullscreenWeb&&(this.art.fullscreenWeb=!1)}),this.add(32,()=>{this.art.toggle()}),this.add(37,()=>{this.art.backward=5}),this.add(38,()=>{this.art.volume+=.1}),this.add(39,()=>{this.art.forward=5}),this.add(40,()=>{this.art.volume-=.1}),t(window,"keydown",d=>{if(this.art.isFocus){const I=document.activeElement.tagName.toUpperCase(),x=document.activeElement.getAttribute("contenteditable");if(I!=="INPUT"&&I!=="TEXTAREA"&&x!==""&&x!=="true"){const D=this.keys[d.keyCode];if(D){d.preventDefault();for(let u=0;u<D.length;u++)D[u].call(this.art,d);this.art.emit("hotkey",d)}}}})}add(t,d){return this.keys[t]?this.keys[t].push(d):this.keys[t]=[d],this}remove(t,d){if(this.keys[t]){const I=this.keys[t].indexOf(d);I!==-1&&this.keys[t].splice(I,1)}return this}}},{"./utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kZD92:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("./utils/component"),d=s.interopDefault(t);class I extends d.default{constructor(D){super(D);const{option:u,template:{$layer:i}}=D;this.name="layer",this.$parent=i;for(let f=0;f<u.layers.length;f++)this.add(u.layers[f])}}n.default=I},{"./utils/component":"5MLcx","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],c9b9e:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("./utils"),d=P("./utils/component"),I=s.interopDefault(d);class x extends I.default{constructor(u){super(u),this.name="loading",(0,t.append)(u.template.$loading,u.icons.loading)}}n.default=x},{"./utils":"5yYFo","./utils/component":"5MLcx","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],SxQeL:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("./utils");n.default=class{constructor(t){this.art=t,this.timer=null}set show(t){const{constructor:d,template:{$player:I,$noticeInner:x}}=this.art;t?(x.innerText=t instanceof Error?t.message.trim():t,(0,s.addClass)(I,"art-notice-show"),clearTimeout(this.timer),this.timer=setTimeout(()=>{x.innerText="",(0,s.removeClass)(I,"art-notice-show")},d.NOTICE_TIME)):(0,s.removeClass)(I,"art-notice-show")}}},{"./utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],aJ0dF:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("./utils"),d=P("./utils/component"),I=s.interopDefault(d);class x extends I.default{constructor(u){super(u),this.name="mask";const{template:i,icons:f,events:p}=u,g=(0,t.append)(i.$state,f.state),m=(0,t.append)(i.$state,f.error);(0,t.setStyle)(m,"display","none"),u.on("destroy",()=>{(0,t.setStyle)(g,"display","none"),(0,t.setStyle)(m,"display",null)}),p.proxy(i.$state,"click",()=>u.play())}}n.default=x},{"./utils":"5yYFo","./utils/component":"5MLcx","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],jx1Wu:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("../utils"),d=P("bundle-text:./loading.svg"),I=s.interopDefault(d),x=P("bundle-text:./state.svg"),D=s.interopDefault(x),u=P("bundle-text:./check.svg"),i=s.interopDefault(u),f=P("bundle-text:./play.svg"),p=s.interopDefault(f),g=P("bundle-text:./pause.svg"),m=s.interopDefault(g),S=P("bundle-text:./volume.svg"),o=s.interopDefault(S),e=P("bundle-text:./volume-close.svg"),c=s.interopDefault(e),h=P("bundle-text:./screenshot.svg"),v=s.interopDefault(h),a=P("bundle-text:./setting.svg"),r=s.interopDefault(a),l=P("bundle-text:./arrow-left.svg"),A=s.interopDefault(l),T=P("bundle-text:./arrow-right.svg"),b=s.interopDefault(T),L=P("bundle-text:./playback-rate.svg"),E=s.interopDefault(L),y=P("bundle-text:./aspect-ratio.svg"),O=s.interopDefault(y),M=P("bundle-text:./config.svg"),R=s.interopDefault(M),F=P("bundle-text:./pip.svg"),k=s.interopDefault(F),w=P("bundle-text:./lock.svg"),_=s.interopDefault(w),B=P("bundle-text:./unlock.svg"),N=s.interopDefault(B),U=P("bundle-text:./fullscreen-off.svg"),j=s.interopDefault(U),K=P("bundle-text:./fullscreen-on.svg"),H=s.interopDefault(K),G=P("bundle-text:./fullscreen-web-off.svg"),W=s.interopDefault(G),X=P("bundle-text:./fullscreen-web-on.svg"),V=s.interopDefault(X),J=P("bundle-text:./switch-on.svg"),$=s.interopDefault(J),z=P("bundle-text:./switch-off.svg"),Q=s.interopDefault(z),q=P("bundle-text:./flip.svg"),tt=s.interopDefault(q),et=P("bundle-text:./error.svg"),rt=s.interopDefault(et),Y=P("bundle-text:./close.svg"),it=s.interopDefault(Y),nt=P("bundle-text:./airplay.svg"),at=s.interopDefault(nt);n.default=class{constructor(ut){const st={loading:I.default,state:D.default,play:p.default,pause:m.default,check:i.default,volume:o.default,volumeClose:c.default,screenshot:v.default,setting:r.default,pip:k.default,arrowLeft:A.default,arrowRight:b.default,playbackRate:E.default,aspectRatio:O.default,config:R.default,lock:_.default,flip:tt.default,unlock:N.default,fullscreenOff:j.default,fullscreenOn:H.default,fullscreenWebOff:W.default,fullscreenWebOn:V.default,switchOn:$.default,switchOff:Q.default,error:rt.default,close:it.default,airplay:at.default,...ut.option.icons};Object.keys(st).forEach(vt=>{(0,t.def)(this,vt,{get:()=>{const ot=document.createElement("i");return(0,t.addClass)(ot,"art-icon"),(0,t.addClass)(ot,`art-icon-${vt}`),(0,t.append)(ot,st[vt]),ot}})})}}},{"../utils":"5yYFo","bundle-text:./loading.svg":"gFMCI","bundle-text:./state.svg":"iYMJD","bundle-text:./check.svg":"hyrDV","bundle-text:./play.svg":"eZys6","bundle-text:./pause.svg":"hITjK","bundle-text:./volume.svg":"hNNiX","bundle-text:./volume-close.svg":"dC2M2","bundle-text:./screenshot.svg":"9hKk0","bundle-text:./setting.svg":"47p50","bundle-text:./arrow-left.svg":"5je49","bundle-text:./arrow-right.svg":"2HKZ5","bundle-text:./playback-rate.svg":"hdBpQ","bundle-text:./aspect-ratio.svg":"alUG1","bundle-text:./config.svg":"6B4Bn","bundle-text:./pip.svg":"2Ya1d","bundle-text:./lock.svg":"5Bna4","bundle-text:./unlock.svg":"daCyz","bundle-text:./fullscreen-off.svg":"bx7Yh","bundle-text:./fullscreen-on.svg":"fxY8n","bundle-text:./fullscreen-web-off.svg":"96euD","bundle-text:./fullscreen-web-on.svg":"ccnBB","bundle-text:./switch-on.svg":"26OlL","bundle-text:./switch-off.svg":"i0DjT","bundle-text:./flip.svg":"hdfqR","bundle-text:./error.svg":"9sWnY","bundle-text:./close.svg":"hxSqS","bundle-text:./airplay.svg":"52Tr6","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],gFMCI:[function(P,C,n){C.exports='<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default"><path fill="none" class="bk" d="M0 0h100v100H0z"/><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-1s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(30 105.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(60 75.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(90 65 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(120 58.66 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(150 54.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(180 50 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-150 45.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-120 41.34 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-90 35 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-60 24.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-30 -5.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"/></rect></svg>'},{}],iYMJD:[function(P,C,n){C.exports='<svg xmlns="http://www.w3.org/2000/svg" height="60" width="60" style="filter:drop-shadow(0 1px 1px #000)" viewBox="0 0 24 24"><path d="M20 2H4C1.8 2 0 3.8 0 6v12c0 2.2 1.8 4 4 4h16c2.2 0 4-1.8 4-4V6c0-2.2-1.8-4-4-4zm-4.4 10.8L10.5 16c-.6.5-1.5 0-1.5-.8V8.8c0-.8.9-1.3 1.5-.8l5.1 3.2c.7.3.7 1.3 0 1.6z"/></svg>'},{}],hyrDV:[function(P,C,n){C.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:100%;height:100%"><path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" fill="#fff"/></svg>'},{}],eZys6:[function(P,C,n){C.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M17.982 9.275 8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z"/></svg>'},{}],hITjK:[function(P,C,n){C.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zm8 0a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z"/></svg>'},{}],hNNiX:[function(P,C,n){C.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M10.188 4.65 6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zm4.258-.872a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z"/><path d="M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z"/></svg>'},{}],dC2M2:[function(P,C,n){C.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z"/><path d="M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zm5.195 13.195-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z"/></svg>'},{}],"9hKk0":[function(P,C,n){C.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 50 50"><path d="M19.402 6a5 5 0 0 0-4.902 4.012L14.098 12H9a5 5 0 0 0-5 5v21a5 5 0 0 0 5 5h32a5 5 0 0 0 5-5V17a5 5 0 0 0-5-5h-5.098l-.402-1.988A5 5 0 0 0 30.598 6ZM25 17c5.52 0 10 4.48 10 10s-4.48 10-10 10-10-4.48-10-10 4.48-10 10-10Zm0 2c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8Z"/></svg>'},{}],"47p50":[function(P,C,n){C.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><circle cx="11" cy="11" r="2"/><path d="M19.164 8.861 17.6 8.6a6.978 6.978 0 0 0-1.186-2.099l.574-1.533a1 1 0 0 0-.436-1.217l-1.997-1.153a1.001 1.001 0 0 0-1.272.23l-1.008 1.225a7.04 7.04 0 0 0-2.55.001L8.716 2.829a1 1 0 0 0-1.272-.23L5.447 3.751a1 1 0 0 0-.436 1.217l.574 1.533A6.997 6.997 0 0 0 4.4 8.6l-1.564.261A.999.999 0 0 0 2 9.847v2.306c0 .489.353.906.836.986l1.613.269a7 7 0 0 0 1.228 2.075l-.558 1.487a1 1 0 0 0 .436 1.217l1.997 1.153c.423.244.961.147 1.272-.23l1.04-1.263a7.089 7.089 0 0 0 2.272 0l1.04 1.263a1 1 0 0 0 1.272.23l1.997-1.153a1 1 0 0 0 .436-1.217l-.557-1.487c.521-.61.94-1.31 1.228-2.075l1.613-.269a.999.999 0 0 0 .835-.986V9.847a.999.999 0 0 0-.836-.986zM11 15a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/></svg>'},{}],"5je49":[function(P,C,n){C.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="m19.41 20.09-4.58-4.59 4.58-4.59L18 9.5l-6 6 6 6z" fill="#fff"/></svg>'},{}],"2HKZ5":[function(P,C,n){C.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="m12.59 20.34 4.58-4.59-4.58-4.59L14 9.75l6 6-6 6z" fill="#fff"/></svg>'},{}],hdBpQ:[function(P,C,n){C.exports='<svg height="24" width="24"><path d="M10 8v8l6-4-6-4zM6.3 5l-.6-.8C7.2 3 9 2.2 11 2l.1 1c-1.8.2-3.4.9-4.8 2zM5 6.3l-.8-.6C3 7.2 2.2 9 2 11l1 .1c.2-1.8.9-3.4 2-4.8zm0 11.4c-1.1-1.4-1.8-3.1-2-4.8L2 13c.2 2 1 3.8 2.2 5.4l.8-.7zm6.1 3.3c-1.8-.2-3.4-.9-4.8-2l-.6.8C7.2 21 9 21.8 11 22l.1-1zM22 12c0-5.2-3.9-9.4-9-10l-.1 1c4.6.5 8.1 4.3 8.1 9s-3.5 8.5-8.1 9l.1 1c5.2-.5 9-4.8 9-10z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],alUG1:[function(P,C,n){C.exports=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88" style="width:100%;height:100%;transform:translate(0,0)"><defs><clipPath id="__lottie_element_216"><path d="M0 0h88v88H0z"/></clipPath></defs><g style="display:block" clip-path="url('#__lottie_element_216')"><path fill="#FFF" d="m12.438-12.702-2.82 2.82c-.79.79-.79 2.05 0 2.83l7.07 7.07-7.07 7.07c-.79.79-.79 2.05 0 2.83l2.82 2.83c.79.78 2.05.78 2.83 0l11.32-11.31c.78-.78.78-2.05 0-2.83l-11.32-11.31c-.78-.79-2.04-.79-2.83 0zm-24.88 0c-.74-.74-1.92-.78-2.7-.12l-.13.12-11.31 11.31a2 2 0 0 0-.12 2.7l.12.13 11.31 11.31a2 2 0 0 0 2.7.12l.13-.12 2.83-2.83c.74-.74.78-1.91.11-2.7l-.11-.13-7.07-7.07 7.07-7.07c.74-.74.78-1.91.11-2.7l-.11-.13-2.83-2.82zM28-28c4.42 0 8 3.58 8 8v40c0 4.42-3.58 8-8 8h-56c-4.42 0-8-3.58-8-8v-40c0-4.42 3.58-8 8-8h56z" style="--darkreader-inline-fill:#a8a6a4" transform="translate(44 44)"/></g></svg>`},{}],"6B4Bn":[function(P,C,n){C.exports='<svg height="24" width="24"><path d="M15 17h6v1h-6v-1zm-4 0H3v1h8v2h1v-5h-1v2zm3-9h1V3h-1v2H3v1h11v2zm4-3v1h3V5h-3zM6 14h1V9H6v2H3v1h3v2zm4-2h11v-1H10v1z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2Ya1d":[function(P,C,n){C.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" height="32" width="32"><path d="M25 17h-8v6h8v-6Zm4 8V10.98C29 9.88 28.1 9 27 9H9c-1.1 0-2 .88-2 1.98V25c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2Zm-2 .02H9V10.97h18v14.05Z"/></svg>'},{}],"5Bna4":[function(P,C,n){C.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M298.667 426.667v-85.334a213.333 213.333 0 1 1 426.666 0v85.334H768A85.333 85.333 0 0 1 853.333 512v256A85.333 85.333 0 0 1 768 853.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667zM512 213.333a128 128 0 0 0-128 128v85.334h256v-85.334a128 128 0 0 0-128-128z" fill="#fff"/></svg>'},{}],daCyz:[function(P,C,n){C.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="m666.752 194.517-49.365 74.112A128 128 0 0 0 384 341.333l.043 85.334h384A85.333 85.333 0 0 1 853.376 512v256a85.333 85.333 0 0 1-85.333 85.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667v-85.334a213.333 213.333 0 0 1 368.085-146.816z" fill="#fff"/></svg>'},{}],bx7Yh:[function(P,C,n){C.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M768 298.667h170.667V384h-256V128H768v170.667zM341.333 384h-256v-85.333H256V128h85.333v256zM768 725.333V896h-85.333V640h256v85.333H768zM341.333 640v256H256V725.333H85.333V640h256z"/></svg>'},{}],fxY8n:[function(P,C,n){C.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M625.778 256H768v142.222h113.778v-256h-256V256zM256 398.222V256h142.222V142.222h-256v256H256zm512 227.556V768H625.778v113.778h256v-256H768zM398.222 768H256V625.778H142.222v256h256V768z"/></svg>'},{}],"96euD":[function(P,C,n){C.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zM896 512a64 64 0 0 1 7.488 127.552L896 640H768v128a64 64 0 0 1-56.512 63.552L704 832a64 64 0 0 1-63.552-56.512L640 768V582.592c0-34.496 25.024-66.112 61.632-70.208l8-.384H896zm-640 0a64 64 0 0 1-7.488-127.552L256 384h128V256a64 64 0 0 1 56.512-63.552L448 192a64 64 0 0 1 63.552 56.512L512 256v185.408c0 34.432-25.024 66.112-61.632 70.144l-8 .448H256z"/></svg>'},{}],ccnBB:[function(P,C,n){C.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zm-576 64a64 64 0 0 1 7.488 127.552L448 320H320v128a64 64 0 0 1-56.512 63.552L256 512a64 64 0 0 1-63.552-56.512L192 448V262.592c0-34.432 25.024-66.112 61.632-70.144l8-.448H448zm256 640a64 64 0 0 1-7.488-127.552L704 704h128V576a64 64 0 0 1 56.512-63.552L896 512a64 64 0 0 1 63.552 56.512L960 576v185.408c0 34.496-25.024 66.112-61.632 70.208l-8 .384H704z"/></svg>'},{}],"26OlL":[function(P,C,n){C.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1664 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#648FFC" d="M1152 0H512a512 512 0 0 0 0 1024h640a512 512 0 0 0 0-1024zm0 960a448 448 0 1 1 448-448 448 448 0 0 1-448 448z"/></svg>'},{}],i0DjT:[function(P,C,n){C.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1740 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M511.898 1024h670.515c282.419-.41 511.18-229.478 511.18-511.898 0-282.419-228.761-511.488-511.18-511.897H511.898C229.478.615.717 229.683.717 512.102c0 282.42 228.761 511.488 511.18 511.898zm-.564-975.36A464.589 464.589 0 1 1 48.026 513.024 463.872 463.872 0 0 1 511.334 48.435v.205z"/></svg>'},{}],hdfqR:[function(P,C,n){C.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M554.667 810.667V896h-85.334v-85.333h85.334zm-384-632.662a42.667 42.667 0 0 1 34.986 18.219l203.904 291.328a42.667 42.667 0 0 1 0 48.896L205.611 827.776A42.667 42.667 0 0 1 128 803.328V220.672a42.667 42.667 0 0 1 42.667-42.667zm682.666 0a42.667 42.667 0 0 1 42.368 37.718l.299 4.949v582.656a42.667 42.667 0 0 1-74.24 28.63l-3.413-4.182-203.904-291.328a42.667 42.667 0 0 1-3.03-43.861l3.03-5.035 203.946-291.328a42.667 42.667 0 0 1 34.944-18.219zM554.667 640v85.333h-85.334V640h85.334zm-358.4-320.896V716.8L335.957 512 196.31 319.104zm358.4 150.23v85.333h-85.334v-85.334h85.334zm0-170.667V384h-85.334v-85.333h85.334zm0-170.667v85.333h-85.334V128h85.334z" fill="#fff"/></svg>'},{}],"9sWnY":[function(P,C,n){C.exports='<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="50" height="50"><path d="M593.818 168.55 949.82 763.76c26.153 43.746 10.732 99.738-34.447 125.052-14.397 8.069-30.72 12.308-47.37 12.308H155.976c-52.224 0-94.536-40.96-94.536-91.505 0-16.097 4.383-31.928 12.718-45.875l356.004-595.19c26.173-43.724 84.009-58.654 129.208-33.341a93.082 93.082 0 0 1 34.448 33.341zM512 819.2a61.44 61.44 0 1 0 0-122.88 61.44 61.44 0 0 0 0 122.88zm0-512a72.315 72.315 0 0 0-71.762 81.306l25.723 205.721a46.408 46.408 0 0 0 92.078 0l25.723-205.742A72.315 72.315 0 0 0 512 307.2z"/></svg>'},{}],hxSqS:[function(P,C,n){C.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="m571.733 512 268.8-268.8c17.067-17.067 17.067-42.667 0-59.733-17.066-17.067-42.666-17.067-59.733 0L512 452.267l-268.8-268.8c-17.067-17.067-42.667-17.067-59.733 0-17.067 17.066-17.067 42.666 0 59.733l268.8 268.8-268.8 268.8c-17.067 17.067-17.067 42.667 0 59.733 8.533 8.534 19.2 12.8 29.866 12.8s21.334-4.266 29.867-12.8l268.8-268.8 268.8 268.8c8.533 8.534 19.2 12.8 29.867 12.8s21.333-4.266 29.866-12.8c17.067-17.066 17.067-42.666 0-59.733L571.733 512z"/></svg>'},{}],"52Tr6":[function(P,C,n){C.exports='<svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="#fff"><path d="M16 1H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h3v-2H3V3h12v8h-2v2h3a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1Z"/><path d="M4 17h10l-5-6z"/></g></svg>'},{}],hdF39:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("./flip"),d=s.interopDefault(t),I=P("./aspectRatio"),x=s.interopDefault(I),D=P("./playbackRate"),u=s.interopDefault(D),i=P("./subtitleOffset"),f=s.interopDefault(i),p=P("../utils/component"),g=s.interopDefault(p),m=P("../utils");function S(c,h,v){for(let a=0;a<c.length;a++){const r=c[a];r.$parentItem=h,r.$parentList=v,r.selector&&S(r.selector,r,c)}return c}function o(c){return["string","number"].includes(typeof c)}class e extends g.default{constructor(h){super(h);const{option:v,events:{proxy:a},template:{$setting:r,$player:l}}=h;if(this.name="setting",this.$parent=r,this.option=[],this.events=[],this.cache=new Map,v.setting){v.playbackRate&&this.option.push((0,u.default)(h)),v.aspectRatio&&this.option.push((0,x.default)(h)),v.flip&&this.option.push((0,d.default)(h)),v.subtitleOffset&&this.option.push((0,f.default)(h));for(let A=0;A<v.settings.length;A++)this.option.push(v.settings[A]);this.option=S(this.option),this.init(this.option),h.on("blur",()=>{this.show&&(this.show=!1,this.init(this.option))}),a(l,"click",A=>{!this.show||(0,m.includeFromEvent)(A,h.controls.setting)||(0,m.includeFromEvent)(A,this.$parent)||(this.show=!1,this.init(this.option))})}}add(h){typeof h=="function"?this.option.push(h(this.art)):this.option.push(h),this.cache=new Map,this.events.forEach(v=>v()),this.events=[],this.$parent.innerHTML="",this.option=S(this.option),this.init(this.option)}creatHeader(h){const{icons:v,events:{proxy:a}}=this.art,r=document.createElement("div");(0,m.addClass)(r,"art-setting-item"),(0,m.addClass)(r,"art-setting-item-back");const l=(0,m.append)(r,'<div class="art-setting-item-left"></div>'),A=document.createElement("div");(0,m.addClass)(A,"art-setting-item-left-icon"),(0,m.append)(A,v.arrowLeft),(0,m.append)(l,A),(0,m.append)(l,h.$parentItem.html);const T=a(r,"click",()=>{this.init(h.$parentList)});return this.events.push(T),r}creatItem(h,v){const{icons:a,events:{proxy:r}}=this.art,l=document.createElement("div");(0,m.addClass)(l,"art-setting-item"),o(v.name)&&(l.dataset.name=v.name),o(v.value)&&(l.dataset.value=v.value);const A=(0,m.append)(l,'<div class="art-setting-item-left"></div>'),T=(0,m.append)(l,'<div class="art-setting-item-right"></div>'),b=document.createElement("div");switch((0,m.addClass)(b,"art-setting-item-left-icon"),h){case"switch":case"range":(0,m.append)(b,o(v.icon)||v.icon instanceof Element?v.icon:a.config);break;case"selector":v.selector&&v.selector.length?(0,m.append)(b,o(v.icon)||v.icon instanceof Element?v.icon:a.config):(0,m.append)(b,a.check)}(0,m.append)(A,b),v.$icon=b,(0,m.def)(v,"icon",{configurable:!0,get:()=>b.innerHTML,set(y){o(y)&&(b.innerHTML=y)}});const L=document.createElement("div");(0,m.addClass)(L,"art-setting-item-left-text"),(0,m.append)(L,v.html||""),(0,m.append)(A,L),v.$html=L,(0,m.def)(v,"html",{configurable:!0,get:()=>L.innerHTML,set(y){o(y)&&(L.innerHTML=y)}});const E=document.createElement("div");switch((0,m.addClass)(E,"art-setting-item-right-tooltip"),(0,m.append)(E,v.tooltip||""),(0,m.append)(T,E),v.$tooltip=E,(0,m.def)(v,"tooltip",{configurable:!0,get:()=>E.innerHTML,set(y){o(y)&&(E.innerHTML=y)}}),h){case"switch":{const y=document.createElement("div");(0,m.addClass)(y,"art-setting-item-right-icon");const O=(0,m.append)(y,a.switchOn),M=(0,m.append)(y,a.switchOff);(0,m.setStyle)(v.switch?M:O,"display","none"),(0,m.append)(T,y),v.$switch=v.switch,(0,m.def)(v,"switch",{configurable:!0,get:()=>v.$switch,set(R){v.$switch=R,R?((0,m.setStyle)(M,"display","none"),(0,m.setStyle)(O,"display",null)):((0,m.setStyle)(M,"display",null),(0,m.setStyle)(O,"display","none"))}});break}case"range":{const y=document.createElement("div");(0,m.addClass)(y,"art-setting-item-right-icon");const O=(0,m.append)(y,'<input type="range">');O.value=v.range[0]||0,O.min=v.range[1]||0,O.max=v.range[2]||10,O.step=v.range[3]||1,(0,m.addClass)(O,"art-setting-range"),(0,m.append)(T,y),v.$range=O,(0,m.def)(v,"range",{configurable:!0,get:()=>O.valueAsNumber,set(M){O.value=Number(M)}})}break;case"selector":if(v.selector&&v.selector.length){const y=document.createElement("div");(0,m.addClass)(y,"art-setting-item-right-icon"),(0,m.append)(y,a.arrowRight),(0,m.append)(T,y)}}switch(h){case"switch":if(v.onSwitch){const y=r(l,"click",async O=>{v.switch=await v.onSwitch.call(this.art,v,l,O)});this.events.push(y)}break;case"range":if(v.onRange&&v.$range){const y=r(v.$range,"change",async O=>{v.tooltip=await v.onRange.call(this.art,v,l,O)});this.events.push(y)}break;case"selector":{const y=r(l,"click",async O=>{if(v.selector&&v.selector.length)this.init(v.selector,v.width);else if((0,m.inverseClass)(l,"art-current"),v.$parentList&&this.init(v.$parentList),v.$parentItem&&v.$parentItem.onSelect){const M=await v.$parentItem.onSelect.call(this.art,v,l,O);v.$parentItem.$tooltip&&o(M)&&(v.$parentItem.$tooltip.innerHTML=M)}});this.events.push(y),v.default&&(0,m.addClass)(l,"art-current")}}return l}init(h,v){const{constructor:a}=this.art;if(this.cache.has(h)){const r=this.cache.get(h);(0,m.inverseClass)(r,"art-current"),(0,m.setStyle)(this.$parent,"width",`${r.dataset.width}px`),(0,m.setStyle)(this.$parent,"height",`${r.dataset.height}px`)}else{const r=document.createElement("div");(0,m.addClass)(r,"art-setting-panel"),r.dataset.width=v||a.SETTING_WIDTH,r.dataset.height=h.length*a.SETTING_ITEM_HEIGHT,h[0]&&h[0].$parentItem&&((0,m.append)(r,this.creatHeader(h[0])),r.dataset.height=Number(r.dataset.height)+a.SETTING_ITEM_HEIGHT);for(let l=0;l<h.length;l++){const A=h[l];(0,m.has)(A,"switch")?(0,m.append)(r,this.creatItem("switch",A)):(0,m.has)(A,"range")?(0,m.append)(r,this.creatItem("range",A)):(0,m.append)(r,this.creatItem("selector",A))}(0,m.append)(this.$parent,r),this.cache.set(h,r),(0,m.inverseClass)(r,"art-current"),(0,m.setStyle)(this.$parent,"width",`${r.dataset.width}px`),(0,m.setStyle)(this.$parent,"height",`${r.dataset.height}px`),h[0]&&h[0].$parentItem&&h[0].$parentItem.mounted&&h[0].$parentItem.mounted.call(this.art,r,h[0].$parentItem)}}}n.default=e},{"./flip":"eyzeE","./aspectRatio":"jTfLi","./playbackRate":"aowja","./subtitleOffset":"aPjJK","../utils/component":"5MLcx","../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eyzeE:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{i18n:d,icons:I,constructor:x}=t,D={normal:"Normal",horizontal:"Horizontal",vertical:"Vertical"};function u(i,f,p){f&&(f.innerText=d.get(D[p]));const g=(0,s.queryAll)(".art-setting-item",i).find(m=>m.dataset.value===p);g&&(0,s.inverseClass)(g,"art-current")}return{width:x.SETTING_ITEM_WIDTH,html:d.get("Video Flip"),tooltip:d.get(D[t.flip]),icon:I.flip,selector:Object.keys(D).map(i=>({value:i,default:i===t.flip,html:d.get(D[i])})),onSelect(i){t.flip=i.value},mounted:(i,f)=>{u(i,f.$tooltip,t.flip),t.on("flip",()=>{u(i,f.$tooltip,t.flip)})}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],jTfLi:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{i18n:d,icons:I,constructor:x}=t;function D(i){return i==="default"?d.get("Default"):i}function u(i,f,p){f&&(f.innerText=D(p));const g=(0,s.queryAll)(".art-setting-item",i).find(m=>m.dataset.value===p);g&&(0,s.inverseClass)(g,"art-current")}return{width:x.SETTING_ITEM_WIDTH,html:d.get("Aspect Ratio"),icon:I.aspectRatio,tooltip:D(t.aspectRatio),selector:["default","4:3","16:9"].map(i=>({value:i,default:i===t.aspectRatio,html:D(i)})),onSelect(i){t.aspectRatio=i.value},mounted:(i,f)=>{u(i,f.$tooltip,t.aspectRatio),t.on("aspectRatio",()=>{u(i,f.$tooltip,t.aspectRatio)})}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],aowja:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{i18n:d,icons:I,constructor:x}=t;function D(i){return i===1?d.get("Normal"):i}function u(i,f,p){f&&(f.innerText=D(p));const g=(0,s.queryAll)(".art-setting-item",i).find(m=>Number(m.dataset.value)===p);g&&(0,s.inverseClass)(g,"art-current")}return{width:x.SETTING_ITEM_WIDTH,html:d.get("Play Speed"),tooltip:D(t.playbackRate),icon:I.playbackRate,selector:[.5,.75,1,1.25,1.5,2].map(i=>({value:i,default:i===t.playbackRate,html:D(i)})),onSelect(i){t.playbackRate=i.value},mounted:(i,f)=>{u(i,f.$tooltip,t.playbackRate),t.on("playbackRate",()=>{u(i,f.$tooltip,t.playbackRate)})}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],aPjJK:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{i18n:d,icons:I,constructor:x}=t;function D(i){return i===0?d.get("Normal"):i}function u(i,f,p){f&&(f.innerText=D(p));const g=(0,s.queryAll)(".art-setting-item",i).find(m=>Number(m.dataset.value)===p);g&&(0,s.inverseClass)(g,"art-current")}return{width:x.SETTING_ITEM_WIDTH,html:d.get("Subtitle Offset"),tooltip:D(t.subtitleOffset),icon:I.subtitle,selector:[-5,-4,-3,-2,-1,0,1,2,3,4,5].map(i=>({value:i,default:i===t.subtitleOffset,html:D(i)})),onSelect(i){t.subtitleOffset=i.value},mounted:(i,f)=>{u(i,f.$tooltip,t.subtitleOffset),t.on("subtitleOffset",()=>{u(i,f.$tooltip,t.subtitleOffset)})}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bCcu0:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n),n.default=class{constructor(){this.name="artplayer_settings",this.settings={}}get(s){try{const t=JSON.parse(window.localStorage.getItem(this.name))||{};return s?t[s]:t}catch{return s?this.settings[s]:this.settings}}set(s,t){try{const d=Object.assign({},this.get(),{[s]:t});window.localStorage.setItem(this.name,JSON.stringify(d))}catch{this.settings[s]=t}}del(s){try{const t=this.get();delete t[s],window.localStorage.setItem(this.name,JSON.stringify(t))}catch{delete this.settings[s]}}clear(){try{window.localStorage.removeItem(this.name)}catch{this.settings={}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"1v13t":[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("../utils"),d=P("./miniProgressBar"),I=s.interopDefault(d),x=P("./autoOrientation"),D=s.interopDefault(x),u=P("./autoPlayback"),i=s.interopDefault(u),f=P("./fastForward"),p=s.interopDefault(f),g=P("./lock"),m=s.interopDefault(g);n.default=class{constructor(S){this.art=S,this.id=0;const{option:o}=S;o.miniProgressBar&&!o.isLive&&this.add(I.default),o.lock&&t.isMobile&&this.add(m.default),o.autoPlayback&&!o.isLive&&this.add(i.default),o.autoOrientation&&t.isMobile&&this.add(D.default),o.fastForward&&t.isMobile&&!o.isLive&&this.add(p.default);for(let e=0;e<o.plugins.length;e++)this.add(o.plugins[e])}add(S){this.id+=1;const o=S.call(this,this.art),e=o&&o.name||S.name||`plugin${this.id}`;return(0,t.errorHandle)(!(0,t.has)(this,e),`Cannot add a plugin that already has the same name: ${e}`),(0,t.def)(this,e,{value:o}),this}}},{"../utils":"5yYFo","./miniProgressBar":"2h4YZ","./autoOrientation":"bcdCk","./autoPlayback":"1nHHC","./fastForward":"4gkmX","./lock":"ij5nM","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"2h4YZ":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n),n.default=function(s){return s.on("ready",()=>{s.layers.add({name:"miniProgressBar",mounted(t){s.on("destroy",()=>{t.style.display="none"}),s.on("video:timeupdate",()=>{t.style.width=100*s.played+"%"}),s.on("setBar",(d,I)=>{d==="played"&&(t.style.width=100*I+"%")})}})}),{name:"miniProgressBar"}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bcdCk:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{option:d,constructor:I,template:{$player:x,$video:D}}=t;return t.on("fullscreenWeb",u=>{if(u){const{videoWidth:i,videoHeight:f}=D,{clientWidth:p,clientHeight:g}=document.documentElement;(i>f&&p<g||i<f&&p>g)&&setTimeout(()=>{(0,s.setStyle)(x,"width",`${g}px`),(0,s.setStyle)(x,"height",`${p}px`),(0,s.setStyle)(x,"transform-origin","0 0"),(0,s.setStyle)(x,"transform",`rotate(90deg) translate(0, -${p}px)`),(0,s.addClass)(x,"art-auto-orientation"),t.emit("resize")},I.MOBILE_AUTO_ORIENTATION_TIME)}else(0,s.hasClass)(x,"art-auto-orientation")&&((0,s.setStyle)(x,"width",null),(0,s.setStyle)(x,"height",null),(0,s.setStyle)(x,"transform",null),(0,s.setStyle)(x,"transform-origin",null),(0,s.removeClass)(x,"art-auto-orientation"),t.aspectRatioReset=!0,t.autoSize=d.autoSize,t.notice.show="",t.emit("resize"))}),t.on("fullscreen",async u=>{const i=screen.orientation.type;if(u){const{videoWidth:f,videoHeight:p}=D,{clientWidth:g,clientHeight:m}=document.documentElement;if(f>p&&g<m||f<p&&g>m){const S=i.startsWith("portrait")?"landscape":"portrait";await screen.orientation.lock(S),(0,s.addClass)(x,"art-auto-orientation-fullscreen")}}else(0,s.hasClass)(x,"art-auto-orientation-fullscreen")&&(await screen.orientation.lock(i),(0,s.removeClass)(x,"art-auto-orientation-fullscreen"))}),{name:"autoOrientation",get state(){return(0,s.hasClass)(x,"art-auto-orientation")}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"1nHHC":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{i18n:d,icons:I,storage:x,constructor:D,events:{proxy:u},template:{$poster:i}}=t,f=t.layers.add({name:"autoPlayback",html:'<div class="art-autoPlayback-close"></div><div class="art-autoPlayback-last"></div><div class="art-autoPlayback-jump"></div>'}),p=(0,s.query)(".art-autoPlayback-last",f),g=(0,s.query)(".art-autoPlayback-jump",f),m=(0,s.query)(".art-autoPlayback-close",f);return t.on("video:timeupdate",()=>{const S=x.get("times")||{},o=Object.keys(S);o.length>D.AUTO_PLAYBACK_MAX&&delete S[o[0]],S[t.option.id||t.option.url]=t.currentTime,x.set("times",S)}),t.on("ready",()=>{const S=(x.get("times")||{})[t.option.id||t.option.url];S&&S>=D.AUTO_PLAYBACK_MIN&&((0,s.append)(m,I.close),(0,s.setStyle)(f,"display","flex"),p.innerText=`${d.get("Last Seen")} ${(0,s.secondToTime)(S)}`,g.innerText=d.get("Jump Play"),u(m,"click",()=>{(0,s.setStyle)(f,"display","none")}),u(g,"click",()=>{t.seek=S,t.play(),(0,s.setStyle)(i,"display","none"),(0,s.setStyle)(f,"display","none")}),t.once("video:timeupdate",()=>{setTimeout(()=>{(0,s.setStyle)(f,"display","none")},D.AUTO_PLAYBACK_TIMEOUT)}))}),{name:"autoPlayback",get times(){return x.get("times")||{}},clear:()=>x.del("times"),delete(S){const o=x.get("times")||{};return delete o[S],x.set("times",o),o}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"4gkmX":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{constructor:d,events:{proxy:I},template:{$player:x,$video:D}}=t;let u=null,i=!1;const f=()=>{clearTimeout(u),i&&(i=!1,t.playbackRate=1,(0,s.removeClass)(x,"art-fast-forward"))};return I(D,"touchstart",p=>{p.touches.length===1&&t.playing&&!t.isLock&&(u=setTimeout(()=>{i=!0,t.playbackRate=d.FAST_FORWARD_VALUE,(0,s.addClass)(x,"art-fast-forward")},d.FAST_FORWARD_TIME))}),I(document,"touchmove",f),I(document,"touchend",f),{name:"fastForward",get state(){return(0,s.hasClass)(x,"art-fast-forward")}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ij5nM:[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var s=P("../utils");n.default=function(t){const{layers:d,icons:I,template:{$player:x}}=t;return d.add({name:"lock",mounted(D){const u=(0,s.append)(D,I.lock),i=(0,s.append)(D,I.unlock);(0,s.setStyle)(u,"display","none"),t.on("lock",f=>{f?((0,s.setStyle)(u,"display","inline-flex"),(0,s.setStyle)(i,"display","none")):((0,s.setStyle)(u,"display","none"),(0,s.setStyle)(i,"display","inline-flex"))})},click(){(0,s.hasClass)(x,"art-lock")?((0,s.removeClass)(x,"art-lock"),this.isLock=!1,t.emit("lock",!1)):((0,s.addClass)(x,"art-lock"),this.isLock=!0,t.emit("lock",!0))}}),{name:"lock",get state(){return(0,s.hasClass)(x,"art-lock")}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eD5Ch:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("./config"),d=s.interopDefault(t),I=P("./utils");n.default=class{constructor(x){const{option:D,events:{proxy:u},template:{$video:i}}=x;for(let g=0;g<d.default.events.length;g++)u(i,d.default.events[g],m=>{x.emit(`video:${m.type}`,m)});Object.keys(D.moreVideoAttr).forEach(g=>{i[g]=D.moreVideoAttr[g]}),D.muted&&(i.muted=D.muted),D.volume&&(i.volume=(0,I.clamp)(D.volume,0,1)),D.poster&&(i.poster=D.poster),D.autoplay&&(i.autoplay=D.autoplay),D.playsInline&&(i.playsInline=!0,i["webkit-playsinline"]=!0);const f=D.type||(0,I.getExt)(D.url),p=D.customType[f];f&&p?(p(i,D.url,x),x.emit("customType",f)):(i.src=D.url,x.emit("url",i.src))}}},{"./config":"ej4fZ","./utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}]},["E13ST"],"E13ST")})(Ut);const Xt=wt(Ut.exports);var Nt={exports:{}};/*!
 * artplayer-plugin-danmuku.js v4.4.8
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2022 Harvey Zack
 * Released under the MIT License.
 */(function(xt,kt){(function(P,C,n,s,t){var d=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof Rt<"u"?Rt:{},I=typeof d.parcelRequire93cf=="function"&&d.parcelRequire93cf,x=I.cache||{},D=typeof Pt=="function"&&Pt.bind(xt);function u(p,g){if(!x[p]){if(!P[p]){var m=typeof d.parcelRequire93cf=="function"&&d.parcelRequire93cf;if(!g&&m)return m(p,!0);if(I)return I(p,!0);if(D&&typeof p=="string")return D(p);var S=new Error("Cannot find module '"+p+"'");throw S.code="MODULE_NOT_FOUND",S}e.resolve=function(c){var h=P[p][1][c];return h!=null?h:c},e.cache={};var o=x[p]=new u.Module(p);P[p][0].call(o.exports,e,o,o.exports,this)}return x[p].exports;function e(c){var h=e.resolve(c);return h===!1?{}:u(h)}}u.isParcelRequire=!0,u.Module=function(p){this.id=p,this.bundle=u,this.exports={}},u.modules=P,u.cache=x,u.parent=I,u.register=function(p,g){P[p]=[function(m,S){S.exports=g},{}]},Object.defineProperty(u,"root",{get:function(){return d.parcelRequire93cf}}),d.parcelRequire93cf=u;for(var i=0;i<C.length;i++)u(C[i]);var f=u(n);xt.exports=f})({E13ST:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("./danmuku"),d=s.interopDefault(t),I=P("./setting"),x=s.interopDefault(I);function D(u){return i=>{(function(p){const{version:g,utils:{errorHandle:m}}=p.constructor,S=g.split(".").map(Number);m(S[0]+S[1]/100>=4.04,`Artplayer.js@${g} \u4E0D\u517C\u5BB9\u8BE5\u5F39\u5E55\u5E93\uFF0C\u8BF7\u66F4\u65B0\u5230 4.4.x \u7248\u672C\u4EE5\u4E0A`)})(i);const f=new d.default(i,u);return(0,x.default)(i,f),{name:"artplayerPluginDanmuku",emit:f.emit.bind(f),load:f.load.bind(f),config:f.config.bind(f),hide:f.hide.bind(f),show:f.show.bind(f),get isHide(){return f.isHide},get isStop(){return f.isStop}}}}n.default=D,D.env="production",D.version="4.4.8",D.build="1655097987373",typeof window<"u"&&(window.artplayerPluginDanmuku=D)},{"./danmuku":"8Gtnh","./setting":"jAkJm","@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],"8Gtnh":[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("./bilibili"),d=P("./getDanmuTop"),I=s.interopDefault(d);class x{constructor(u,i){const{constructor:f,template:p}=u;if(this.utils=f.utils,this.validator=f.validator,this.$danmuku=p.$danmuku,this.$player=p.$player,this.art=u,this.queue=[],this.option={},this.$refs=[],this.isStop=!1,this.isHide=!1,this.timer=null,this.config(i),this.option.useWorker)try{this.worker=new Worker(P("27c3930ee158179a"))}catch{}this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.reset=this.reset.bind(this),this.destroy=this.destroy.bind(this),u.on("video:play",this.start),u.on("video:playing",this.start),u.on("video:pause",this.stop),u.on("video:waiting",this.stop),u.on("fullscreen",this.reset),u.on("fullscreenWeb",this.reset),u.on("destroy",this.destroy),this.load()}static get option(){return{danmuku:[],speed:5,margin:["2%","25%"],opacity:1,color:"#FFFFFF",mode:0,fontSize:25,filter:()=>!0,antiOverlap:!0,useWorker:!0,synchronousPlayback:!1,lockTime:5,maxLength:100,minWidth:200,maxWidth:400,mount:void 0,theme:"dark",beforeEmit:()=>!0}}static get scheme(){return{danmuku:"array|function|string",speed:"number",margin:"array",opacity:"number",color:"string",mode:"number",fontSize:"number|string",filter:"function",antiOverlap:"boolean",useWorker:"boolean",synchronousPlayback:"boolean",lockTime:"number",maxLength:"number",minWidth:"number",maxWidth:"number",mount:"undefined|htmldivelement",theme:"string",beforeEmit:"function"}}get isRotate(){return this.art.plugins.autoOrientation&&this.art.plugins.autoOrientation.state}get marginTop(){const{clamp:u}=this.utils,i=this.option.margin[0],{clientHeight:f}=this.$player;return typeof i=="number"?u(i,0,f):typeof i=="string"&&i.endsWith("%")?u(f*(parseFloat(i)/100),0,f):x.option.margin[0]}get marginBottom(){const{clamp:u}=this.utils,i=this.option.margin[1],{clientHeight:f}=this.$player;return typeof i=="number"?u(i,0,f):typeof i=="string"&&i.endsWith("%")?u(f*(parseFloat(i)/100),0,f):x.option.margin[1]}filter(u,i){return this.queue.filter(f=>f.$state===u).map(i)}getLeft(u){const i=u.getBoundingClientRect();return this.isRotate?i.top:i.left}getRef(){const u=this.$refs.pop();if(u)return u;const i=document.createElement("div");return i.style.cssText=`
            user-select: none;
            position: absolute;
            white-space: pre;
            pointer-events: none;
            perspective: 500px;
            display: inline-block;
            will-change: transform;
            font-weight: normal;
            line-height: 1.125;
            visibility: hidden;
            font-family: SimHei, "Microsoft JhengHei", Arial, Helvetica, sans-serif;
            text-shadow: rgb(0, 0, 0) 1px 0px 1px, rgb(0, 0, 0) 0px 1px 1px, rgb(0, 0, 0) 0px -1px 1px, rgb(0, 0, 0) -1px 0px 1px;
        `,i}getReady(){const{currentTime:u}=this.art;return this.queue.filter(i=>i.$state==="ready"||i.$state==="wait"&&u+.1>=i.time&&i.time>=u-.1)}getEmits(){const u=[],{clientWidth:i}=this.$player,f=this.getLeft(this.$player);return this.filter("emit",p=>{const g=p.$ref.offsetTop,m=this.getLeft(p.$ref)-f,S=p.$ref.clientHeight,o=p.$ref.clientWidth,e=m+o,c=i-e,h=e/p.$restTime,v={};v.top=g,v.left=m,v.height=S,v.width=o,v.right=c,v.speed=h,v.distance=e,v.time=p.$restTime,v.mode=p.mode,u.push(v)}),u}getFontSize(u){const{clamp:i}=this.utils,{clientHeight:f}=this.$player;return typeof u=="number"?i(u,12,f):typeof u=="string"&&u.endsWith("%")?i(f*(parseFloat(u)/100),12,f):x.option.fontSize}postMessage(u={}){return new Promise(i=>{if(this.option.useWorker&&this.worker&&this.worker.postMessage)u.id=Date.now(),this.worker.postMessage(u),this.worker.onmessage=f=>{const{data:p}=f;p.id===u.id&&i(p)};else{const f=(0,I.default)(u);i({top:f})}})}async load(){try{let u=[];u=typeof this.option.danmuku=="function"?await this.option.danmuku():typeof this.option.danmuku.then=="function"?await this.option.danmuku:typeof this.option.danmuku=="string"?await(0,t.bilibiliDanmuParseFromUrl)(this.option.danmuku):this.option.danmuku,this.utils.errorHandle(Array.isArray(u),"Danmuku need return an array as result"),this.art.emit("artplayerPluginDanmuku:loaded",u),this.queue=[],this.$danmuku.innerText="",u.forEach(i=>this.emit(i))}catch(u){throw this.art.emit("artplayerPluginDanmuku:error",u),u}return this}config(u){const{clamp:i}=this.utils;return this.option=Object.assign({},x.option,this.option,u),this.validator(this.option,x.scheme),this.option.speed=i(this.option.speed,1,10),this.option.opacity=i(this.option.opacity,0,1),this.option.lockTime=i(Math.floor(this.option.lockTime),0,60),this.option.maxLength=i(this.option.maxLength,0,500),this.option.minWidth=i(this.option.minWidth,0,500),this.option.maxWidth=i(this.option.maxWidth,0,1/0),u.fontSize&&(this.option.fontSize=this.getFontSize(this.option.fontSize),this.reset()),this.art.emit("artplayerPluginDanmuku:config",this.option),this}makeWait(u){u.$state="wait",u.$ref&&(u.$ref.style.visibility="hidden",u.$ref.style.marginLeft="0px",u.$ref.style.transform="translateX(0px)",u.$ref.style.transition="transform 0s linear 0s",this.$refs.push(u.$ref),u.$ref=null)}continue(){const{clientWidth:u}=this.$player;return this.filter("stop",i=>{switch(i.$state="emit",i.$lastStartTime=Date.now(),i.mode){case 0:{const f=u+i.$ref.clientWidth;i.$ref.style.transform=`translateX(${-f}px)`,i.$ref.style.transition=`transform ${i.$restTime}s linear 0s`;break}}}),this}suspend(){const{clientWidth:u}=this.$player;return this.filter("emit",i=>{switch(i.$state="stop",i.mode){case 0:{const f=u-(this.getLeft(i.$ref)-this.getLeft(this.$player));i.$ref.style.transform=`translateX(${-f}px)`,i.$ref.style.transition="transform 0s linear 0s";break}}}),this}reset(){return this.queue.forEach(u=>this.makeWait(u)),this}update(){return this.timer=window.requestAnimationFrame(async()=>{if(this.art.playing&&!this.isHide){this.filter("emit",p=>{const g=(Date.now()-p.$lastStartTime)/1e3;p.$restTime-=g,p.$lastStartTime=Date.now(),p.$restTime<=0&&this.makeWait(p)});const u=this.getReady(),{clientWidth:i,clientHeight:f}=this.$player;for(let p=0;p<u.length;p++){const g=u[p];g.$ref=this.getRef(),g.$ref.innerText=g.text,this.$danmuku.appendChild(g.$ref),g.$ref.style.left=`${i}px`,g.$ref.style.opacity=this.option.opacity,g.$ref.style.fontSize=`${this.option.fontSize}px`,g.$ref.style.color=g.color,g.$ref.style.border=g.border?`1px solid ${g.color}`:null,g.$ref.style.backgroundColor=g.border?"rgb(0 0 0 / 50%)":null,g.$ref.style.marginLeft="0px",g.$lastStartTime=Date.now(),g.$restTime=this.option.synchronousPlayback&&this.art.playbackRate?this.option.speed/Number(this.art.playbackRate):this.option.speed;const m={mode:g.mode,height:g.$ref.clientHeight,speed:(i+g.$ref.clientWidth)/g.$restTime},{top:S}=await this.postMessage({target:m,emits:this.getEmits(),antiOverlap:this.option.antiOverlap,clientWidth:i,clientHeight:f,marginBottom:this.marginBottom,marginTop:this.marginTop});if(g.$ref)if(this.isStop||S===void 0)g.$state="ready",this.$refs.push(g.$ref),g.$ref=null;else switch(g.$state="emit",g.$ref.style.visibility="visible",g.mode){case 0:{g.$ref.style.top=`${S}px`;const o=i+g.$ref.clientWidth;g.$ref.style.transform=`translateX(${-o}px)`,g.$ref.style.transition=`transform ${g.$restTime}s linear 0s`;break}case 1:g.$ref.style.left="50%",g.$ref.style.top=`${S}px`,g.$ref.style.marginLeft=`-${g.$ref.clientWidth/2}px`}}}this.isStop||this.update()}),this}stop(){return this.isStop=!0,this.suspend(),window.cancelAnimationFrame(this.timer),this.art.emit("artplayerPluginDanmuku:stop"),this}start(){return this.isStop=!1,this.continue(),this.update(),this.art.emit("artplayerPluginDanmuku:start"),this}show(){return this.isHide=!1,this.start(),this.$danmuku.style.display="block",this.art.emit("artplayerPluginDanmuku:show"),this}hide(){return this.isHide=!0,this.stop(),this.queue.forEach(u=>this.makeWait(u)),this.$danmuku.style.display="none",this.art.emit("artplayerPluginDanmuku:hide"),this}emit(u){return this.validator(u,{text:"string",mode:"number|undefined",color:"string|undefined",time:"number|undefined",border:"boolean|undefined"}),u.text.trim()&&this.option.filter(u)?(u.time?u.time=this.utils.clamp(u.time,0,1/0):u.time=this.art.currentTime+.5,u.mode===void 0&&(u.mode=this.option.mode),u.color===void 0&&(u.color=this.option.color),this.queue.push({...u,$state:"wait",$ref:null,$restTime:0,$lastStartTime:0}),this):this}destroy(){this.stop(),this.worker&&this.worker.terminate&&this.worker.terminate(),this.art.off("video:play",this.start),this.art.off("video:playing",this.start),this.art.off("video:pause",this.stop),this.art.off("video:waiting",this.stop),this.art.off("fullscreen",this.reset),this.art.off("fullscreenWeb",this.reset),this.art.off("destroy",this.destroy),this.art.emit("artplayerPluginDanmuku:destroy")}}n.default=x},{"./bilibili":"KnwDr","./getDanmuTop":"2Abxf","27c3930ee158179a":"anHwN","@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],KnwDr:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");function t(x){switch(x){case 1:case 2:case 3:default:return 0;case 4:case 5:return 1}}function d(x){if(typeof x!="string")return[];const D=x.matchAll(/<d (?:.*? )??p="(?<p>.+?)"(?: .*?)?>(?<text>.+?)<\/d>/gs);return Array.from(D).map(u=>{const i=u.groups.p.split(",");return i.length>=8?{text:u.groups.text.trim().replaceAll("&quot;",'"').replaceAll("&apos;","'").replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("&amp;","&"),time:Number(i[0]),mode:t(Number(i[1])),fontSize:Number(i[2]),color:`#${Number(i[3]).toString(16)}`,timestamp:Number(i[4]),pool:Number(i[5]),userID:i[6],rowID:Number(i[7])}:null}).filter(Boolean)}function I(x){return fetch(x).then(D=>D.text()).then(D=>d(D))}s.defineInteropFlag(n),s.export(n,"getMode",()=>t),s.export(n,"bilibiliDanmuParseFromXml",()=>d),s.export(n,"bilibiliDanmuParseFromUrl",()=>I)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],"9v6Cv":[function(P,C,n){n.interopDefault=function(s){return s&&s.__esModule?s:{default:s}},n.defineInteropFlag=function(s){Object.defineProperty(s,"__esModule",{value:!0})},n.exportAll=function(s,t){return Object.keys(s).forEach(function(d){d==="default"||d==="__esModule"||t.hasOwnProperty(d)||Object.defineProperty(t,d,{enumerable:!0,get:function(){return s[d]}})}),t},n.export=function(s,t,d){Object.defineProperty(s,t,{enumerable:!0,get:d})}},{}],"2Abxf":[function(P,C,n){P("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n),n.default=function({target:s,emits:t,clientWidth:d,clientHeight:I,marginBottom:x,marginTop:D,antiOverlap:u}){const i=t.filter(p=>p.mode===s.mode&&p.top<=I-x).sort((p,g)=>p.top-g.top);if(i.length===0)return D;i.unshift({top:0,left:0,right:0,height:D,width:d,speed:0,distance:d}),i.push({top:I-x,left:0,right:0,height:x,width:d,speed:0,distance:d});for(let p=1;p<i.length;p+=1){const g=i[p],m=i[p-1],S=m.top+m.height;if(g.top-S>=s.height)return S}const f=[];for(let p=1;p<i.length-1;p+=1){const g=i[p];if(f.length){const m=f[f.length-1];m[0].top===g.top?m.push(g):f.push([g])}else f.push([g])}if(!u){switch(s.mode){case 0:f.sort((p,g)=>{const m=Math.min(...g.map(o=>o.right)),S=Math.min(...p.map(o=>o.right));return m*g.length-S*p.length});break;case 1:f.sort((p,g)=>{const m=Math.max(...g.map(S=>S.width));return Math.max(...p.map(S=>S.width))*p.length-m*g.length})}return f[0][0].top}switch(s.mode){case 0:{const p=f.find(g=>g.every(m=>d<m.distance?!1:s.speed<m.speed?!0:m.right/(s.speed-m.speed)>m.time));return p&&p[0]?p[0].top:void 0}case 1:return}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],anHwN:[function(P,C,n){C.exports="data:application/javascript,function%20getDanmuTop%28%7Btarget%3At%2Cemits%3Ae%2CclientWidth%3An%2CclientHeight%3Ai%2CmarginBottom%3As%2CmarginTop%3Ah%2CantiOverlap%3Ao%7D%29%7Bconst%20r%3De.filter%28%28e%3D%3Ee.mode%3D%3D%3Dt.mode%26%26e.top%3C%3Di-s%29%29.sort%28%28%28t%2Ce%29%3D%3Et.top-e.top%29%29%3Bif%280%3D%3D%3Dr.length%29return%20h%3Br.unshift%28%7Btop%3A0%2Cleft%3A0%2Cright%3A0%2Cheight%3Ah%2Cwidth%3An%2Cspeed%3A0%2Cdistance%3An%7D%29%2Cr.push%28%7Btop%3Ai-s%2Cleft%3A0%2Cright%3A0%2Cheight%3As%2Cwidth%3An%2Cspeed%3A0%2Cdistance%3An%7D%29%3Bfor%28let%20e%3D1%3Be%3Cr.length%3Be%2B%3D1%29%7Bconst%20n%3Dr%5Be%5D%2Ci%3Dr%5Be-1%5D%2Cs%3Di.top%2Bi.height%3Bif%28n.top-s%3E%3Dt.height%29return%20s%7Dconst%20p%3D%5B%5D%3Bfor%28let%20t%3D1%3Bt%3Cr.length-1%3Bt%2B%3D1%29%7Bconst%20e%3Dr%5Bt%5D%3Bif%28p.length%29%7Bconst%20t%3Dp%5Bp.length-1%5D%3Bt%5B0%5D.top%3D%3D%3De.top%3Ft.push%28e%29%3Ap.push%28%5Be%5D%29%7Delse%20p.push%28%5Be%5D%29%7Dif%28%21o%29%7Bswitch%28t.mode%29%7Bcase%200%3Ap.sort%28%28%28t%2Ce%29%3D%3E%7Bconst%20n%3DMath.min%28...e.map%28%28t%3D%3Et.right%29%29%29%2Ci%3DMath.min%28...t.map%28%28t%3D%3Et.right%29%29%29%3Breturn%20n%2ae.length-i%2at.length%7D%29%29%3Bbreak%3Bcase%201%3Ap.sort%28%28%28t%2Ce%29%3D%3E%7Bconst%20n%3DMath.max%28...e.map%28%28t%3D%3Et.width%29%29%29%3Breturn%20Math.max%28...t.map%28%28t%3D%3Et.width%29%29%29%2at.length-n%2ae.length%7D%29%29%7Dreturn%20p%5B0%5D%5B0%5D.top%7Dswitch%28t.mode%29%7Bcase%200%3A%7Bconst%20e%3Dp.find%28%28e%3D%3Ee.every%28%28e%3D%3E%7Bif%28n%3Ce.distance%29return%211%3Bif%28t.speed%3Ce.speed%29return%210%3Breturn%20e.right%2F%28t.speed-e.speed%29%3Ee.time%7D%29%29%29%29%3Breturn%20e%26%26e%5B0%5D%3Fe%5B0%5D.top%3Avoid%200%7Dcase%201%3Areturn%7D%7Donmessage%3Dt%3D%3E%7Bconst%7Bdata%3Ae%7D%3Dt%2Cn%3DgetDanmuTop%28e%29%3Bself.postMessage%28%7Btop%3An%2Cid%3Ae.id%7D%29%7D%3B"},{}],jAkJm:[function(P,C,n){var s=P("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(n);var t=P("bundle-text:./style.less"),d=s.interopDefault(t),I=P("bundle-text:./img/danmu-on.svg"),x=s.interopDefault(I),D=P("bundle-text:./img/danmu-off.svg"),u=s.interopDefault(D),i=P("bundle-text:./img/danmu-config.svg"),f=s.interopDefault(i),p=P("bundle-text:./img/danmu-style.svg"),g=s.interopDefault(p);if(n.default=function(m,S){const{option:o}=S,{template:{$controlsCenter:e,$player:c},constructor:{utils:{removeClass:h,addClass:v,append:a,setStyle:r,tooltip:l,query:A,inverseClass:T}}}=m;function b(M,R){const F=document.createElement("i");return a(F,M),v(F,"art-icon"),v(F,`art-icon-${R}`),F}const L=b(x.default,"danmu-on"),E=b(u.default,"danmu-off"),y=b(f.default,"danmu-config"),O=b(g.default,"danmu-style");(function(){const M=["#FE0302","#FF7204","#FFAA02","#FFD302","#FFFF00","#A0EE00","#00CD00","#019899","#4266BE","#89D5FF","#CC0273","#222222","#9B9B9B","#FFFFFF"].map(V=>`<div class="art-danmuku-style-panel-color${o.color===V?" art-current":""}" data-color="${V}" style="background-color:${V}"></div>`),R=a(e,`<div class="art-danmuku-emitter" style="max-width: ${o.maxWidth?`${o.maxWidth}px`:"100%"}"><div class="art-danmuku-left"><div class="art-danmuku-style"><div class="art-danmuku-style-panel"><div class="art-danmuku-style-panel-inner"><div class="art-danmuku-style-panel-title">\u6A21\u5F0F</div><div class="art-danmuku-style-panel-modes"><div class="art-danmuku-style-panel-mode art-current" data-mode="0">\u6EDA\u52A8</div><div class="art-danmuku-style-panel-mode" data-mode="1">\u9759\u6B62</div></div><div class="art-danmuku-style-panel-title">\u989C\u8272</div><div class="art-danmuku-style-panel-colors">${M.join("")}</div></div></div></div><input class="art-danmuku-input" maxlength="${o.maxLength}" placeholder="\u53D1\u4E2A\u5F39\u5E55\u89C1\u8BC1\u5F53\u4E0B" /></div><div class="art-danmuku-send">\u53D1\u9001</div></div>`),F=A(".art-danmuku-style",R),k=A(".art-danmuku-input",R),w=A(".art-danmuku-send",R),_=A(".art-danmuku-style-panel-inner",R),B=A(".art-danmuku-style-panel-modes",R),N=A(".art-danmuku-style-panel-colors",R),U=o.mount||a(c,'<div class="art-layer-danmuku-emitter"></div>');m.option.backdrop&&v(_,"art-backdrop-filter"),o.theme&&v(R,`art-danmuku-theme-${o.theme}`);let j=null,K=o.mode,H=o.color;function G(V){V<=0?(j=null,w.innerText="\u53D1\u9001",h(w,"art-disabled")):(w.innerText=V,j=setTimeout(()=>G(V-1),1e3))}function W(){const V={mode:K,color:H,border:!0,text:k.value.trim()};j===null&&o.beforeEmit(V)&&(k.value="",S.emit(V),v(w,"art-disabled"),G(o.lockTime),m.emit("artplayerPluginDanmuku:emit",V))}function X(){e.clientWidth<o.minWidth?(a(U,R),r(U,"display","flex"),v(R,"art-danmuku-mount"),o.mount||r(c,"marginBottom","40px")):(a(e,R),r(U,"display","none"),h(R,"art-danmuku-mount"),o.mount||r(c,"marginBottom",null))}a(F,O),m.proxy(w,"click",W),m.proxy(k,"keypress",V=>{V.key==="Enter"&&(V.preventDefault(),W())}),m.proxy(B,"click",V=>{const{dataset:J}=V.target;J.mode&&(K=Number(J.mode),T(V.target,"art-current"))}),m.proxy(N,"click",V=>{const{dataset:J}=V.target;J.color&&(H=J.color,T(V.target,"art-current"))}),X(),m.on("resize",X),m.on("destroy",()=>{o.mount&&R.parentElement===o.mount&&o.mount.removeChild(R)})})(),m.controls.add({position:"right",name:"danmuku",click:function(){S.isHide?(S.show(),m.notice.show="\u5F39\u5E55\u663E\u793A",r(L,"display",null),r(E,"display","none")):(S.hide(),m.notice.show="\u5F39\u5E55\u9690\u85CF",r(L,"display","none"),r(E,"display",null))},mounted(M){a(M,L),a(M,E),l(M,"\u5F39\u5E55\u5F00\u5173"),r(E,"display","none")}}),m.setting.add({name:"danmuku",html:"\u5F39\u5E55\u8BBE\u7F6E",tooltip:"\u66F4\u591A",icon:y,selector:[{width:200,html:"\u64AD\u653E\u901F\u5EA6",icon:"",tooltip:"\u9002\u4E2D",selector:[{html:"\u6781\u6162",time:10},{html:"\u8F83\u6162",time:7.5},{default:!0,html:"\u9002\u4E2D",time:5},{html:"\u8F83\u5FEB",time:2.5},{html:"\u6781\u5FEB",time:1}],onSelect:function(M){return S.config({speed:M.time}),M.html}},{width:200,html:"\u5B57\u4F53\u5927\u5C0F",icon:"",tooltip:"\u9002\u4E2D",selector:[{html:"\u6781\u5C0F",fontSize:"4%"},{html:"\u8F83\u5C0F",fontSize:"5%"},{default:!0,html:"\u9002\u4E2D",fontSize:"6%"},{html:"\u8F83\u5927",fontSize:"7%"},{html:"\u6781\u5927",fontSize:"8%"}],onSelect:function(M){return S.config({fontSize:M.fontSize}),M.html}},{width:200,html:"\u4E0D\u900F\u660E\u5EA6",icon:"",tooltip:"100%",selector:[{default:!0,opacity:1,html:"100%"},{opacity:.75,html:"75%"},{opacity:.5,html:"50%"},{opacity:.25,html:"25%"},{opacity:0,html:"0%"}],onSelect:function(M){return S.config({opacity:M.opacity}),M.html}},{width:200,html:"\u663E\u793A\u8303\u56F4",icon:"",tooltip:"3/4",selector:[{html:"1/4",margin:[10,"75%"]},{html:"\u534A\u5C4F",margin:[10,"50%"]},{default:!0,html:"3/4",margin:[10,"25%"]},{html:"\u6EE1\u5C4F",margin:[10,10]}],onSelect:function(M){return S.config({margin:M.margin}),M.html}},{html:"\u5F39\u5E55\u9632\u91CD\u53E0",icon:"",tooltip:o.antiOverlap?"\u5F00\u542F":"\u5173\u95ED",switch:o.antiOverlap,onSwitch:M=>(S.config({antiOverlap:!M.switch}),M.tooltip=M.switch?"\u5173\u95ED":"\u5F00\u542F",!M.switch)},{html:"\u540C\u6B65\u89C6\u9891\u901F\u5EA6",icon:"",tooltip:o.synchronousPlayback?"\u5F00\u542F":"\u5173\u95ED",switch:o.synchronousPlayback,onSwitch:M=>(S.config({synchronousPlayback:!M.switch}),M.tooltip=M.switch?"\u5173\u95ED":"\u5F00\u542F",!M.switch)}]})},typeof document<"u"&&!document.getElementById("artplayer-plugin-danmuku")){const m=document.createElement("style");m.id="artplayer-plugin-danmuku",m.textContent=d.default,document.head.appendChild(m)}},{"bundle-text:./style.less":"chNhY","bundle-text:./img/danmu-on.svg":"j5M2a","bundle-text:./img/danmu-off.svg":"d9WLf","bundle-text:./img/danmu-config.svg":"8Y3Ij","bundle-text:./img/danmu-style.svg":"hltwt","@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],chNhY:[function(P,C,n){C.exports='.art-danmuku-emitter{height:32px;width:100%;max-width:100%;color:#fff;-webkit-tap-highlight-color:#0000;touch-action:manipulation;-ms-high-contrast-adjust:none;background-color:#ffffff4d;border-radius:3px;font-family:Roboto,Arial,Helvetica,sans-serif;font-size:12px;line-height:1;display:flex;position:relative}.art-danmuku-emitter *,.art-danmuku-emitter :before,.art-danmuku-emitter :after{box-sizing:border-box;margin:0;padding:0}.art-danmuku-emitter .art-icon{justify-content:center;align-items:center;line-height:1.5;display:inline-flex}.art-danmuku-emitter .art-icon svg{fill:#fff}@supports ((-webkit-backdrop-filter: initial) or (backdrop-filter: initial)){.art-danmuku-emitter .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000b3!important}}.art-danmuku-emitter .art-danmuku-left{border-radius:3px 0 0 3px;flex:1;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style{width:32px;justify-content:center;align-items:center;display:flex;position:relative}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel{z-index:999;width:200px;padding-bottom:10px;display:none;position:absolute;bottom:30px;left:-85px}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner{background-color:#000000e6;border-radius:3px;flex-direction:column;padding:10px 10px 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-title{margin-bottom:10px;font-size:13px}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes{justify-content:space-between;margin-bottom:15px;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes .art-danmuku-style-panel-mode{width:47%;cursor:pointer;color:#fff;border:1px solid #fff;justify-content:center;padding:5px 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes .art-danmuku-style-panel-mode.art-current{background-color:#00a1d6;border:1px solid #00a1d6}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors{flex-wrap:wrap;justify-content:space-between;gap:5px;margin-bottom:10px;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color{cursor:pointer;width:20px;height:20px;border:1px solid #fff}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color.art-current{position:relative;box-shadow:0 0 2px #fff}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color.art-current:before{content:"";width:100%;height:100%;border:2px solid #000;position:absolute;inset:0}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style:hover .art-danmuku-style-panel{display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-icon{opacity:.75;cursor:pointer}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-icon:hover{opacity:1}.art-danmuku-emitter .art-danmuku-left .art-danmuku-input{width:100%;color:#fff;background-color:#0000;border:none;outline:none;flex:1;padding:0 10px 0 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-input::placeholder,.art-danmuku-emitter .art-danmuku-left .art-danmuku-input::-webkit-input-placeholder{color:#ffffff80}.art-danmuku-emitter .art-danmuku-send{width:50px;cursor:pointer;background-color:#00a1d6;border-radius:0 3px 3px 0;justify-content:center;align-items:center;display:flex}.art-danmuku-emitter .art-danmuku-send:hover{background-color:#00b5e5}.art-danmuku-emitter .art-danmuku-send.art-disabled{opacity:.5;pointer-events:none}.art-danmuku-emitter.art-danmuku-mount{height:34px;max-width:100%!important}.art-danmuku-emitter.art-danmuku-mount .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel{left:0}.art-danmuku-emitter.art-danmuku-mount .art-danmuku-send{width:60px}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left{background:#f4f4f4;border:1px solid #dadada}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-style .art-icon svg{fill:#666}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input{color:#000}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input::placeholder,.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input::-webkit-input-placeholder{color:#00000080}.art-layer-danmuku-emitter{z-index:99;width:100%;position:absolute;bottom:-40px;left:0;right:0}'},{}],j5M2a:[function(P,C,n){C.exports='<svg viewBox="0 0 1152 1024" width="22" height="22" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M311.467 661.333c0 4.267-4.267 8.534-8.534 12.8 0 4.267 0 4.267-4.266 8.534h-12.8c-4.267 0-8.534-4.267-17.067-8.534-8.533-8.533-17.067-8.533-25.6-8.533-8.533 0-12.8 4.267-17.067 12.8-4.266 12.8-8.533 21.333-4.266 29.867 4.266 8.533 12.8 17.066 25.6 21.333 17.066 8.533 34.133 17.067 46.933 17.067 12.8 0 21.333-4.267 34.133-8.534 8.534-4.266 17.067-17.066 25.6-29.866 8.534-12.8 12.8-34.134 17.067-55.467 4.267-21.333 4.267-51.2 4.267-85.333 0-12.8 0-21.334-4.267-29.867 0-8.533-4.267-12.8-8.533-17.067-4.267-4.266-8.534-8.533-12.8-8.533-4.267 0-12.8-4.267-21.334-4.267h-55.466s-4.267-4.266 0-8.533l4.266-38.4c0-4.267 0-8.533 4.267-8.533h46.933c17.067 0 25.6-4.267 34.134-12.8 8.533-8.534 12.8-21.334 12.8-42.667v-72.533c0-17.067-4.267-34.134-8.534-42.667-12.8-12.8-25.6-17.067-42.666-17.067H243.2c-8.533 0-17.067 0-21.333 4.267-4.267 8.533-4.267 12.8-4.267 25.6 0 8.533 0 17.067 4.267 21.333 4.266 4.267 12.8 8.534 21.333 8.534h64c4.267 0 8.533 0 8.533 4.266v34.134c0 8.533 0 12.8-4.266 12.8 0 0-4.267 4.266-8.534 4.266H268.8c-8.533 0-12.8 0-21.333 4.267-4.267 0-8.534 4.267-8.534 4.267-4.266 4.266-8.533 12.8-8.533 17.066 0 8.534-4.267 17.067-4.267 25.6l-8.533 72.534v29.866c0 8.534 4.267 12.8 8.533 17.067 4.267 4.267 8.534 4.267 17.067 8.533h68.267c4.266 0 8.533 0 8.533 4.267s4.267 8.533 4.267 17.067c0 21.333 0 42.666-4.267 55.466 0 8.534-4.267 21.334-8.533 25.6zM896 486.4c-93.867 0-174.933 51.2-217.6 123.733H571.733V576H640c21.333 0 34.133-4.267 42.667-12.8 8.533-8.533 12.8-21.333 12.8-42.667V358.4c0-21.333-4.267-34.133-12.8-42.667-8.534-8.533-21.334-12.8-42.667-12.8 0-4.266 4.267-4.266 4.267-8.533-4.267 0-4.267-4.267-4.267-4.267 4.267-12.8 8.533-21.333 4.267-25.6 0-8.533-4.267-12.8-12.8-21.333-8.534-4.267-17.067-4.267-21.334-4.267-8.533 4.267-12.8 8.534-21.333 21.334-4.267 8.533-8.533 12.8-12.8 21.333-4.267 8.533-8.533 12.8-12.8 21.333H512c-4.267-8.533-8.533-17.066-8.533-21.333-4.267-8.533-8.534-12.8-12.8-21.333-4.267-12.8-12.8-17.067-21.334-17.067s-17.066 0-25.6 8.533c-8.533 8.534-12.8 12.8-12.8 21.334s0 17.066 8.534 25.6l4.266 4.266L448 307.2c-17.067 0-29.867 4.267-38.4 12.8-8.533 4.267-12.8 21.333-12.8 38.4v157.867c0 21.333 4.267 34.133 12.8 42.666 8.533 8.534 21.333 12.8 42.667 12.8H512v34.134h-98.133c-12.8 0-21.334 0-25.6 4.266-4.267 4.267-8.534 8.534-8.534 21.334v17.066c0 4.267 4.267 8.534 4.267 8.534 4.267 0 4.267 4.266 8.533 4.266H512V716.8c0 12.8 4.267 21.333 8.533 25.6 4.267 4.267 12.8 8.533 21.334 8.533 12.8 0 21.333-4.266 25.6-8.533 4.266-4.267 4.266-12.8 4.266-25.6v-55.467H652.8c-8.533 25.6-12.8 51.2-12.8 76.8 0 140.8 115.2 256 256 256s256-115.2 256-256S1036.8 486.4 896 486.4zm-328.533-128h55.466c4.267 0 4.267 0 4.267 4.267V409.6h-59.733v-51.2zm0 102.4H627.2V512h-55.467v-51.2zM512 516.267h-55.467v-51.2H512v51.2zm0-102.4h-59.733V362.667H512v51.2zm384 499.2c-93.867 0-170.667-76.8-170.667-170.667S802.133 571.733 896 571.733s170.667 76.8 170.667 170.667S989.867 913.067 896 913.067z"/><path fill="#fff" d="M951.467 669.867 878.933 742.4l-29.866-25.6C832 699.733 806.4 704 789.333 721.067c-17.066 17.066-12.8 42.666 4.267 59.733l59.733 51.2c8.534 8.533 17.067 8.533 29.867 8.533s21.333-4.266 29.867-12.8l102.4-102.4c17.066-17.066 17.066-42.666 0-59.733-21.334-12.8-46.934-12.8-64 4.267zm-371.2 209.066H213.333c-72.533 0-128-55.466-128-119.466V230.4c0-64 55.467-119.467 128-119.467h512c72.534 0 128 55.467 128 119.467v140.8c0 25.6 17.067 42.667 42.667 42.667s42.667-17.067 42.667-42.667V230.4c0-115.2-93.867-204.8-213.334-204.8h-512C93.867 25.6 0 119.467 0 230.4v529.067c0 115.2 93.867 204.8 213.333 204.8h366.934c25.6 0 42.666-17.067 42.666-42.667s-21.333-42.667-42.666-42.667z"/></svg>'},{}],d9WLf:[function(P,C,n){C.exports='<svg viewBox="0 0 1152 1024" width="22" height="22" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M311.296 661.504c0 4.096-4.096 8.704-8.704 12.8 0 4.096 0 4.096-4.096 8.704h-12.8c-4.096 0-8.704-4.096-16.896-8.704-8.704-8.704-16.896-8.704-25.6-8.704s-12.8 4.096-16.896 12.8c-4.096 12.8-8.704 21.504-4.096 29.696 4.096 8.704 12.8 16.896 25.6 21.504 16.896 8.704 34.304 16.896 47.104 16.896 12.8 0 21.504-4.096 34.304-8.704 8.704-4.096 16.896-16.896 25.6-29.696s12.8-34.304 16.896-55.296c4.096-21.504 4.096-51.2 4.096-85.504 0-12.8 0-21.504-4.096-29.696 0-8.704-4.096-12.8-8.704-16.896-4.096-4.096-8.704-8.704-12.8-8.704s-12.8-4.096-21.504-4.096h-55.808s-4.096-4.096 0-8.704l4.096-38.4c0-4.096 0-8.704 4.096-8.704h47.104c16.896 0 25.6-4.096 34.304-12.8s12.8-21.504 12.8-42.496v-72.704c0-16.896-4.096-34.304-8.704-42.496-12.8-12.8-25.6-16.896-42.496-16.896H243.2c-8.704 0-16.896 0-21.504 4.096-4.096 8.704-4.096 12.8-4.096 25.6 0 8.704 0 16.896 4.096 21.504 4.096 4.096 12.8 8.704 21.504 8.704h64c4.096 0 8.704 0 8.704 4.096v34.304c0 8.704 0 12.8-4.096 12.8 0 0-4.096 4.096-8.704 4.096H268.8c-8.704 0-12.8 0-21.504 4.096-4.096 0-8.704 4.096-8.704 4.096-4.096 4.096-8.704 12.8-8.704 16.896 0 8.704-4.096 16.896-4.096 25.6l-8.704 72.704v29.696c0 8.704 4.096 12.8 8.704 16.896s8.704 4.096 16.896 8.704h68.096c4.096 0 8.704 0 8.704 4.096s4.096 8.704 4.096 16.896c0 21.504 0 42.496-4.096 55.296.512 9.216-3.584 22.016-8.192 26.624zM896 486.4c-93.696 0-175.104 51.2-217.6 123.904H571.904V576H640c21.504 0 34.304-4.096 42.496-12.8 8.704-8.704 12.8-21.504 12.8-42.496V358.4c0-21.504-4.096-34.304-12.8-42.496-8.704-8.704-21.504-12.8-42.496-12.8 0-4.096 4.096-4.096 4.096-8.704-4.096 0-4.096-4.096-4.096-4.096 4.096-12.8 8.704-21.504 4.096-25.6 0-8.704-4.096-12.8-12.8-21.504-8.704-4.096-16.896-4.096-21.504-4.096-8.704 4.096-12.8 8.704-21.504 21.504-4.096 8.704-8.704 12.8-12.8 21.504s-8.704 12.8-12.8 21.504h-51.2c-4.096-8.704-8.704-16.896-8.704-21.504-4.096-8.704-8.704-12.8-12.8-21.504-4.096-12.8-12.8-16.896-21.504-16.896s-16.896 0-25.6 8.704-12.8 12.8-12.8 21.504 0 16.896 8.704 25.6l4.096 4.096 4.096 4.096c-16.896 0-29.696 4.096-38.4 12.8-8.704 4.096-12.8 21.504-12.8 38.4v157.696c0 21.504 4.096 34.304 12.8 42.496 8.704 8.704 21.504 12.8 42.496 12.8H512v34.304h-98.304c-12.8 0-21.504 0-25.6 4.096s-8.704 8.704-8.704 21.504v16.896c0 4.096 4.096 8.704 4.096 8.704 4.096 0 4.096 4.096 8.704 4.096H512V716.8c0 12.8 4.096 21.504 8.704 25.6 4.096 4.096 12.8 8.704 21.504 8.704 12.8 0 21.504-4.096 25.6-8.704 4.096-4.096 4.096-12.8 4.096-25.6v-55.296H652.8c-8.704 25.6-12.8 51.2-12.8 76.8 0 140.8 115.2 256 256 256s256-115.2 256-256S1036.8 486.4 896 486.4zm-328.704-128h55.296c4.096 0 4.096 0 4.096 4.096V409.6h-59.904v-51.2zm0 102.4H627.2V512h-55.296v-51.2h-4.608zM512 516.096h-55.296v-51.2H512v51.2zm0-102.4h-59.904v-51.2H512v51.2zm384 499.2c-93.696 0-170.496-76.8-170.496-170.496S802.304 571.904 896 571.904s170.496 76.8 170.496 170.496S989.696 912.896 896 912.896z"/><path fill="#fff" d="M580.096 879.104H213.504c-72.704 0-128-55.296-128-119.296V230.4c0-64 55.296-119.296 128-119.296h512c72.704 0 128 55.296 128 119.296v140.8c0 25.6 16.896 42.496 42.496 42.496s42.496-16.896 42.496-42.496V230.4c0-115.2-93.696-204.8-213.504-204.8h-512C93.696 25.6 0 119.296 0 230.4v528.896c0 115.2 93.696 204.8 213.504 204.8h367.104c25.6 0 42.496-16.896 42.496-42.496s-21.504-42.496-43.008-42.496zm171.52 10.752c-15.36-15.36-15.36-40.96 0-56.32l237.568-237.568c15.36-15.36 40.96-15.36 56.32 0s15.36 40.96 0 56.32L807.936 889.856c-15.36 15.36-40.448 15.36-56.32 0z"/></svg>'},{}],"8Y3Ij":[function(P,C,n){C.exports='<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="M16.5 8c1.289 0 2.49.375 3.5 1.022V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7.022A6.5 6.5 0 0 1 16.5 8zM7 13H5a1 1 0 0 1 0-2h2a1 1 0 0 1 0 2zm2-4H5a1 1 0 0 1 0-2h4a1 1 0 0 1 0 2z"/><path d="m20.587 13.696-.787-.131a3.503 3.503 0 0 0-.593-1.051l.301-.804a.46.46 0 0 0-.21-.56l-1.005-.581a.52.52 0 0 0-.656.113l-.499.607a3.53 3.53 0 0 0-1.276 0l-.499-.607a.52.52 0 0 0-.656-.113l-1.005.581a.46.46 0 0 0-.21.56l.301.804c-.254.31-.456.665-.593 1.051l-.787.131a.48.48 0 0 0-.413.465v1.209a.48.48 0 0 0 .413.465l.811.135c.144.382.353.733.614 1.038l-.292.78a.46.46 0 0 0 .21.56l1.005.581a.52.52 0 0 0 .656-.113l.515-.626a3.549 3.549 0 0 0 1.136 0l.515.626a.52.52 0 0 0 .656.113l1.005-.581a.46.46 0 0 0 .21-.56l-.292-.78c.261-.305.47-.656.614-1.038l.811-.135A.48.48 0 0 0 21 15.37v-1.209a.48.48 0 0 0-.413-.465zM16.5 16.057a1.29 1.29 0 1 1 .002-2.582 1.29 1.29 0 0 1-.002 2.582z"/></svg>'},{}],hltwt:[function(P,C,n){C.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22" width="24" height="24"><path d="M17 16H5c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1zM6.96 15c.39 0 .74-.24.89-.6l.65-1.6h5l.66 1.6c.15.36.5.6.89.6.69 0 1.15-.71.88-1.34l-3.88-8.97C11.87 4.27 11.46 4 11 4s-.87.27-1.05.69l-3.88 8.97c-.27.63.2 1.34.89 1.34zM11 5.98 12.87 11H9.13L11 5.98z"/></svg>'},{}]},["E13ST"],"E13ST")})(Nt);const Jt=wt(Nt.exports);var jt={exports:{}};(function(xt,kt){typeof window<"u"&&function(C,n){xt.exports=n()}(Rt,function(){return function(P){var C={};function n(s){if(C[s])return C[s].exports;var t=C[s]={i:s,l:!1,exports:{}};return P[s].call(t.exports,t,t.exports,n),t.l=!0,t.exports}return n.m=P,n.c=C,n.d=function(s,t,d){n.o(s,t)||Object.defineProperty(s,t,{enumerable:!0,get:d})},n.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},n.t=function(s,t){if(t&1&&(s=n(s)),t&8||t&4&&typeof s=="object"&&s&&s.__esModule)return s;var d=Object.create(null);if(n.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:s}),t&2&&typeof s!="string")for(var I in s)n.d(d,I,function(x){return s[x]}.bind(null,I));return d},n.n=function(s){var t=s&&s.__esModule?function(){return s.default}:function(){return s};return n.d(t,"a",t),t},n.o=function(s,t){return Object.prototype.hasOwnProperty.call(s,t)},n.p="/dist/",n(n.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(P,C,n){var s=Object.prototype.hasOwnProperty,t="~";function d(){}Object.create&&(d.prototype=Object.create(null),new d().__proto__||(t=!1));function I(i,f,p){this.fn=i,this.context=f,this.once=p||!1}function x(i,f,p,g,m){if(typeof p!="function")throw new TypeError("The listener must be a function");var S=new I(p,g||i,m),o=t?t+f:f;return i._events[o]?i._events[o].fn?i._events[o]=[i._events[o],S]:i._events[o].push(S):(i._events[o]=S,i._eventsCount++),i}function D(i,f){--i._eventsCount===0?i._events=new d:delete i._events[f]}function u(){this._events=new d,this._eventsCount=0}u.prototype.eventNames=function(){var f=[],p,g;if(this._eventsCount===0)return f;for(g in p=this._events)s.call(p,g)&&f.push(t?g.slice(1):g);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(p)):f},u.prototype.listeners=function(f){var p=t?t+f:f,g=this._events[p];if(!g)return[];if(g.fn)return[g.fn];for(var m=0,S=g.length,o=new Array(S);m<S;m++)o[m]=g[m].fn;return o},u.prototype.listenerCount=function(f){var p=t?t+f:f,g=this._events[p];return g?g.fn?1:g.length:0},u.prototype.emit=function(f,p,g,m,S,o){var e=t?t+f:f;if(!this._events[e])return!1;var c=this._events[e],h=arguments.length,v,a;if(c.fn){switch(c.once&&this.removeListener(f,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,p),!0;case 3:return c.fn.call(c.context,p,g),!0;case 4:return c.fn.call(c.context,p,g,m),!0;case 5:return c.fn.call(c.context,p,g,m,S),!0;case 6:return c.fn.call(c.context,p,g,m,S,o),!0}for(a=1,v=new Array(h-1);a<h;a++)v[a-1]=arguments[a];c.fn.apply(c.context,v)}else{var r=c.length,l;for(a=0;a<r;a++)switch(c[a].once&&this.removeListener(f,c[a].fn,void 0,!0),h){case 1:c[a].fn.call(c[a].context);break;case 2:c[a].fn.call(c[a].context,p);break;case 3:c[a].fn.call(c[a].context,p,g);break;case 4:c[a].fn.call(c[a].context,p,g,m);break;default:if(!v)for(l=1,v=new Array(h-1);l<h;l++)v[l-1]=arguments[l];c[a].fn.apply(c[a].context,v)}}return!0},u.prototype.on=function(f,p,g){return x(this,f,p,g,!1)},u.prototype.once=function(f,p,g){return x(this,f,p,g,!0)},u.prototype.removeListener=function(f,p,g,m){var S=t?t+f:f;if(!this._events[S])return this;if(!p)return D(this,S),this;var o=this._events[S];if(o.fn)o.fn===p&&(!m||o.once)&&(!g||o.context===g)&&D(this,S);else{for(var e=0,c=[],h=o.length;e<h;e++)(o[e].fn!==p||m&&!o[e].once||g&&o[e].context!==g)&&c.push(o[e]);c.length?this._events[S]=c.length===1?c[0]:c:D(this,S)}return this},u.prototype.removeAllListeners=function(f){var p;return f?(p=t?t+f:f,this._events[p]&&D(this,p)):(this._events=new d,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,P.exports=u},"./node_modules/url-toolkit/src/url-toolkit.js":function(P,C,n){(function(s){var t=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,d=/^(?=([^\/?#]*))\1([^]*)$/,I=/(?:\/|^)\.(?=\/)/g,x=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,D={buildAbsoluteURL:function(u,i,f){if(f=f||{},u=u.trim(),i=i.trim(),!i){if(!f.alwaysNormalize)return u;var p=D.parseURL(u);if(!p)throw new Error("Error trying to parse base URL.");return p.path=D.normalizePath(p.path),D.buildURLFromParts(p)}var g=D.parseURL(i);if(!g)throw new Error("Error trying to parse relative URL.");if(g.scheme)return f.alwaysNormalize?(g.path=D.normalizePath(g.path),D.buildURLFromParts(g)):i;var m=D.parseURL(u);if(!m)throw new Error("Error trying to parse base URL.");if(!m.netLoc&&m.path&&m.path[0]!=="/"){var S=d.exec(m.path);m.netLoc=S[1],m.path=S[2]}m.netLoc&&!m.path&&(m.path="/");var o={scheme:m.scheme,netLoc:g.netLoc,path:null,params:g.params,query:g.query,fragment:g.fragment};if(!g.netLoc&&(o.netLoc=m.netLoc,g.path[0]!=="/"))if(!g.path)o.path=m.path,g.params||(o.params=m.params,g.query||(o.query=m.query));else{var e=m.path,c=e.substring(0,e.lastIndexOf("/")+1)+g.path;o.path=D.normalizePath(c)}return o.path===null&&(o.path=f.alwaysNormalize?D.normalizePath(g.path):g.path),D.buildURLFromParts(o)},parseURL:function(u){var i=t.exec(u);return i?{scheme:i[1]||"",netLoc:i[2]||"",path:i[3]||"",params:i[4]||"",query:i[5]||"",fragment:i[6]||""}:null},normalizePath:function(u){for(u=u.split("").reverse().join("").replace(I,"");u.length!==(u=u.replace(x,"")).length;);return u.split("").reverse().join("")},buildURLFromParts:function(u){return u.scheme+u.netLoc+u.path+u.params+u.query+u.fragment}};P.exports=D})()},"./node_modules/webworkify-webpack/index.js":function(P,C,n){function s(f){var p={};function g(S){if(p[S])return p[S].exports;var o=p[S]={i:S,l:!1,exports:{}};return f[S].call(o.exports,o,o.exports,g),o.l=!0,o.exports}g.m=f,g.c=p,g.i=function(S){return S},g.d=function(S,o,e){g.o(S,o)||Object.defineProperty(S,o,{configurable:!1,enumerable:!0,get:e})},g.r=function(S){Object.defineProperty(S,"__esModule",{value:!0})},g.n=function(S){var o=S&&S.__esModule?function(){return S.default}:function(){return S};return g.d(o,"a",o),o},g.o=function(S,o){return Object.prototype.hasOwnProperty.call(S,o)},g.p="/",g.oe=function(S){throw console.error(S),S};var m=g(g.s=ENTRY_MODULE);return m.default||m}var t="[\\.|\\-|\\+|\\w|/|@]+",d="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+t+").*?\\)";function I(f){return(f+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function x(f){return!isNaN(1*f)}function D(f,p,g){var m={};m[g]=[];var S=p.toString(),o=S.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return m;for(var e=o[1],c=new RegExp("(\\\\n|\\W)"+I(e)+d,"g"),h;h=c.exec(S);)h[3]!=="dll-reference"&&m[g].push(h[3]);for(c=new RegExp("\\("+I(e)+'\\("(dll-reference\\s('+t+'))"\\)\\)'+d,"g");h=c.exec(S);)f[h[2]]||(m[g].push(h[1]),f[h[2]]=n(h[1]).m),m[h[2]]=m[h[2]]||[],m[h[2]].push(h[4]);for(var v=Object.keys(m),a=0;a<v.length;a++)for(var r=0;r<m[v[a]].length;r++)x(m[v[a]][r])&&(m[v[a]][r]=1*m[v[a]][r]);return m}function u(f){var p=Object.keys(f);return p.reduce(function(g,m){return g||f[m].length>0},!1)}function i(f,p){for(var g={main:[p]},m={main:[]},S={main:{}};u(g);)for(var o=Object.keys(g),e=0;e<o.length;e++){var c=o[e],h=g[c],v=h.pop();if(S[c]=S[c]||{},!(S[c][v]||!f[c][v])){S[c][v]=!0,m[c]=m[c]||[],m[c].push(v);for(var a=D(f,f[c][v],c),r=Object.keys(a),l=0;l<r.length;l++)g[r[l]]=g[r[l]]||[],g[r[l]]=g[r[l]].concat(a[r[l]])}}return m}P.exports=function(f,p){p=p||{};var g={main:n.m},m=p.all?{main:Object.keys(g.main)}:i(g,f),S="";Object.keys(m).filter(function(v){return v!=="main"}).forEach(function(v){for(var a=0;m[v][a];)a++;m[v].push(a),g[v][a]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",S=S+"var "+v+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(a))+")({"+m[v].map(function(r){return""+JSON.stringify(r)+": "+g[v][r].toString()}).join(",")+`});
`}),S=S+"new (("+s.toString().replace("ENTRY_MODULE",JSON.stringify(f))+")({"+m.main.map(function(v){return""+JSON.stringify(v)+": "+g.main[v].toString()}).join(",")+"}))(self);";var o=new window.Blob([S],{type:"text/javascript"});if(p.bare)return o;var e=window.URL||window.webkitURL||window.mozURL||window.msURL,c=e.createObjectURL(o),h=new window.Worker(c);return h.objectURL=c,h}},"./src/config.ts":function(P,C,n){n.r(C),n.d(C,"hlsDefaultConfig",function(){return l}),n.d(C,"mergeConfig",function(){return T}),n.d(C,"enableStreamingMode",function(){return b});var s=n("./src/controller/abr-controller.ts"),t=n("./src/controller/audio-stream-controller.ts"),d=n("./src/controller/audio-track-controller.ts"),I=n("./src/controller/subtitle-stream-controller.ts"),x=n("./src/controller/subtitle-track-controller.ts"),D=n("./src/controller/buffer-controller.ts"),u=n("./src/controller/timeline-controller.ts"),i=n("./src/controller/cap-level-controller.ts"),f=n("./src/controller/fps-controller.ts"),p=n("./src/controller/eme-controller.ts"),g=n("./src/controller/cmcd-controller.ts"),m=n("./src/utils/xhr-loader.ts"),S=n("./src/utils/fetch-loader.ts"),o=n("./src/utils/cues.ts"),e=n("./src/utils/mediakeys-helper.ts"),c=n("./src/utils/logger.ts");function h(){return h=Object.assign?Object.assign.bind():function(L){for(var E=1;E<arguments.length;E++){var y=arguments[E];for(var O in y)Object.prototype.hasOwnProperty.call(y,O)&&(L[O]=y[O])}return L},h.apply(this,arguments)}function v(L,E){var y=Object.keys(L);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(L);E&&(O=O.filter(function(M){return Object.getOwnPropertyDescriptor(L,M).enumerable})),y.push.apply(y,O)}return y}function a(L){for(var E=1;E<arguments.length;E++){var y=arguments[E]!=null?arguments[E]:{};E%2?v(Object(y),!0).forEach(function(O){r(L,O,y[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(y)):v(Object(y)).forEach(function(O){Object.defineProperty(L,O,Object.getOwnPropertyDescriptor(y,O))})}return L}function r(L,E,y){return E in L?Object.defineProperty(L,E,{value:y,enumerable:!0,configurable:!0,writable:!0}):L[E]=y,L}var l=a(a({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:m.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:s.default,bufferController:D.default,capLevelController:i.default,fpsController:f.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},A()),{},{subtitleStreamController:I.SubtitleStreamController,subtitleTrackController:x.default,timelineController:u.TimelineController,audioStreamController:t.default,audioTrackController:d.default,emeController:p.default,cmcdController:g.default});function A(){return{cueHandler:o.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function T(L,E){if((E.liveSyncDurationCount||E.liveMaxLatencyDurationCount)&&(E.liveSyncDuration||E.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(E.liveMaxLatencyDurationCount!==void 0&&(E.liveSyncDurationCount===void 0||E.liveMaxLatencyDurationCount<=E.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(E.liveMaxLatencyDuration!==void 0&&(E.liveSyncDuration===void 0||E.liveMaxLatencyDuration<=E.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return h({},L,E)}function b(L){var E=L.loader;if(E!==S.default&&E!==m.default)c.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),L.progressive=!1;else{var y=Object(S.fetchSupported)();y&&(L.loader=S.default,L.progressive=!0,L.enableSoftwareAES=!0,c.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(P,C,n){n.r(C);var s=n("./src/polyfills/number.ts"),t=n("./src/utils/ewma-bandwidth-estimator.ts"),d=n("./src/events.ts"),I=n("./src/utils/buffer-helper.ts"),x=n("./src/errors.ts"),D=n("./src/types/loader.ts"),u=n("./src/utils/logger.ts");function i(g,m){for(var S=0;S<m.length;S++){var o=m[S];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(g,o.key,o)}}function f(g,m,S){return m&&i(g.prototype,m),S&&i(g,S),Object.defineProperty(g,"prototype",{writable:!1}),g}var p=function(){function g(S){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=S;var o=S.config;this.bwEstimator=new t.default(o.abrEwmaSlowVoD,o.abrEwmaFastVoD,o.abrEwmaDefaultEstimate),this.registerListeners()}var m=g.prototype;return m.registerListeners=function(){var o=this.hls;o.on(d.Events.FRAG_LOADING,this.onFragLoading,this),o.on(d.Events.FRAG_LOADED,this.onFragLoaded,this),o.on(d.Events.FRAG_BUFFERED,this.onFragBuffered,this),o.on(d.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.on(d.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){var o=this.hls;o.off(d.Events.FRAG_LOADING,this.onFragLoading,this),o.off(d.Events.FRAG_LOADED,this.onFragLoaded,this),o.off(d.Events.FRAG_BUFFERED,this.onFragBuffered,this),o.off(d.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.off(d.Events.ERROR,this.onError,this)},m.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},m.onFragLoading=function(o,e){var c=e.frag;if(c.type===D.PlaylistLevelType.MAIN&&!this.timer){var h;this.fragCurrent=c,this.partCurrent=(h=e.part)!=null?h:null,this.timer=self.setInterval(this.onCheck,100)}},m.onLevelLoaded=function(o,e){var c=this.hls.config;e.details.live?this.bwEstimator.update(c.abrEwmaSlowLive,c.abrEwmaFastLive):this.bwEstimator.update(c.abrEwmaSlowVoD,c.abrEwmaFastVoD)},m._abandonRulesCheck=function(){var o=this.fragCurrent,e=this.partCurrent,c=this.hls,h=c.autoLevelEnabled,v=c.config,a=c.media;if(!(!o||!a)){var r=e?e.stats:o.stats,l=e?e.duration:o.duration;if(r.aborted){u.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!h||a.paused||!a.playbackRate||!a.readyState)){var A=performance.now()-r.loading.start,T=Math.abs(a.playbackRate);if(!(A<=500*l/T)){var b=c.levels,L=c.minAutoLevel,E=b[o.level],y=r.total||Math.max(r.loaded,Math.round(l*E.maxBitrate/8)),O=Math.max(1,r.bwEstimate?r.bwEstimate/8:r.loaded*1e3/A),M=(y-r.loaded)/O,R=a.currentTime,F=(I.BufferHelper.bufferInfo(a,R,v.maxBufferHole).end-R)/T;if(!(F>=2*l/T||M<=F)){var k=Number.POSITIVE_INFINITY,w;for(w=o.level-1;w>L;w--){var _=b[w].maxBitrate;if(k=l*_/(8*.8*O),k<F)break}if(!(k>=M)){var B=this.bwEstimator.getEstimate();u.logger.warn("Fragment "+o.sn+(e?" part "+e.index:"")+" of level "+o.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+w+`
      Current BW estimate: `+(Object(s.isFiniteNumber)(B)?(B/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+M.toFixed(3)+` s
      Estimated load time for the next fragment: `+k.toFixed(3)+` s
      Time to underbuffer: `+F.toFixed(3)+" s"),c.nextLoadLevel=w,this.bwEstimator.sample(A,r.loaded),this.clearTimer(),o.loader&&(this.fragCurrent=this.partCurrent=null,o.loader.abort()),c.trigger(d.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:o,part:e,stats:r})}}}}}},m.onFragLoaded=function(o,e){var c=e.frag,h=e.part;if(c.type===D.PlaylistLevelType.MAIN&&Object(s.isFiniteNumber)(c.sn)){var v=h?h.stats:c.stats,a=h?h.duration:c.duration;if(this.clearTimer(),this.lastLoadedFragLevel=c.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var r=this.hls.levels[c.level],l=(r.loaded?r.loaded.bytes:0)+v.loaded,A=(r.loaded?r.loaded.duration:0)+a;r.loaded={bytes:l,duration:A},r.realBitrate=Math.round(8*l/A)}if(c.bitrateTest){var T={stats:v,frag:c,part:h,id:c.type};this.onFragBuffered(d.Events.FRAG_BUFFERED,T),c.bitrateTest=!1}}},m.onFragBuffered=function(o,e){var c=e.frag,h=e.part,v=h?h.stats:c.stats;if(!v.aborted&&!(c.type!==D.PlaylistLevelType.MAIN||c.sn==="initSegment")){var a=v.parsing.end-v.loading.start;this.bwEstimator.sample(a,v.loaded),v.bwEstimate=this.bwEstimator.getEstimate(),c.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}},m.onError=function(o,e){switch(e.details){case x.ErrorDetails.FRAG_LOAD_ERROR:case x.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},m.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},m.getNextABRAutoLevel=function(){var o=this.fragCurrent,e=this.partCurrent,c=this.hls,h=c.maxAutoLevel,v=c.config,a=c.minAutoLevel,r=c.media,l=e?e.duration:o?o.duration:0,A=r?r.currentTime:0,T=r&&r.playbackRate!==0?Math.abs(r.playbackRate):1,b=this.bwEstimator?this.bwEstimator.getEstimate():v.abrEwmaDefaultEstimate,L=(I.BufferHelper.bufferInfo(r,A,v.maxBufferHole).end-A)/T,E=this.findBestLevel(b,a,h,L,v.abrBandWidthFactor,v.abrBandWidthUpFactor);if(E>=0)return E;u.logger.trace((L?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var y=l?Math.min(l,v.maxStarvationDelay):v.maxStarvationDelay,O=v.abrBandWidthFactor,M=v.abrBandWidthUpFactor;if(!L){var R=this.bitrateTestDelay;if(R){var F=l?Math.min(l,v.maxLoadingDelay):v.maxLoadingDelay;y=F-R,u.logger.trace("bitrate test took "+Math.round(1e3*R)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*y)+" ms"),O=M=1}}return E=this.findBestLevel(b,a,h,L+y,O,M),Math.max(E,0)},m.findBestLevel=function(o,e,c,h,v,a){for(var r,l=this.fragCurrent,A=this.partCurrent,T=this.lastLoadedFragLevel,b=this.hls.levels,L=b[T],E=!!(L!=null&&(r=L.details)!==null&&r!==void 0&&r.live),y=L==null?void 0:L.codecSet,O=A?A.duration:l?l.duration:0,M=c;M>=e;M--){var R=b[M];if(!(!R||y&&R.codecSet!==y)){var F=R.details,k=(A?F==null?void 0:F.partTarget:F==null?void 0:F.averagetargetduration)||O,w=void 0;M<=T?w=v*o:w=a*o;var _=b[M].maxBitrate,B=_*k/w;if(u.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+M+"/"+Math.round(w)+"/"+_+"/"+k+"/"+h+"/"+B),w>_&&(!B||E&&!this.bitrateTestDelay||B<h))return M}}return-1},f(g,[{key:"nextAutoLevel",get:function(){var o=this._nextAutoLevel,e=this.bwEstimator;if(o!==-1&&(!e||!e.canEstimate()))return o;var c=this.getNextABRAutoLevel();return o!==-1&&(c=Math.min(o,c)),c},set:function(o){this._nextAutoLevel=o}}]),g}();C.default=p},"./src/controller/audio-stream-controller.ts":function(P,C,n){n.r(C);var s=n("./src/polyfills/number.ts"),t=n("./src/controller/base-stream-controller.ts"),d=n("./src/events.ts"),I=n("./src/utils/buffer-helper.ts"),x=n("./src/controller/fragment-tracker.ts"),D=n("./src/types/level.ts"),u=n("./src/types/loader.ts"),i=n("./src/loader/fragment.ts"),f=n("./src/demux/chunk-cache.ts"),p=n("./src/demux/transmuxer-interface.ts"),g=n("./src/types/transmuxer.ts"),m=n("./src/controller/fragment-finders.ts"),S=n("./src/utils/discontinuities.ts"),o=n("./src/errors.ts");function e(){return e=Object.assign?Object.assign.bind():function(r){for(var l=1;l<arguments.length;l++){var A=arguments[l];for(var T in A)Object.prototype.hasOwnProperty.call(A,T)&&(r[T]=A[T])}return r},e.apply(this,arguments)}function c(r,l){r.prototype=Object.create(l.prototype),r.prototype.constructor=r,h(r,l)}function h(r,l){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(T,b){return T.__proto__=b,T},h(r,l)}var v=100,a=function(r){c(l,r);function l(T,b){var L;return L=r.call(this,T,b,"[audio-stream-controller]")||this,L.videoBuffer=null,L.videoTrackCC=-1,L.waitingVideoCC=-1,L.audioSwitch=!1,L.trackId=-1,L.waitingData=null,L.mainDetails=null,L.bufferFlushed=!1,L.cachedTrackLoadedData=null,L._registerListeners(),L}var A=l.prototype;return A.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},A._registerListeners=function(){var b=this.hls;b.on(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),b.on(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.on(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.on(d.Events.LEVEL_LOADED,this.onLevelLoaded,this),b.on(d.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),b.on(d.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),b.on(d.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),b.on(d.Events.ERROR,this.onError,this),b.on(d.Events.BUFFER_RESET,this.onBufferReset,this),b.on(d.Events.BUFFER_CREATED,this.onBufferCreated,this),b.on(d.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),b.on(d.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),b.on(d.Events.FRAG_BUFFERED,this.onFragBuffered,this)},A._unregisterListeners=function(){var b=this.hls;b.off(d.Events.MEDIA_ATTACHED,this.onMediaAttached,this),b.off(d.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.off(d.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.off(d.Events.LEVEL_LOADED,this.onLevelLoaded,this),b.off(d.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),b.off(d.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),b.off(d.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),b.off(d.Events.ERROR,this.onError,this),b.off(d.Events.BUFFER_RESET,this.onBufferReset,this),b.off(d.Events.BUFFER_CREATED,this.onBufferCreated,this),b.off(d.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),b.off(d.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),b.off(d.Events.FRAG_BUFFERED,this.onFragBuffered,this)},A.onInitPtsFound=function(b,L){var E=L.frag,y=L.id,O=L.initPTS;if(y==="main"){var M=E.cc;this.initPTS[E.cc]=O,this.log("InitPTS for cc: "+M+" found from main: "+O),this.videoTrackCC=M,this.state===t.State.WAITING_INIT_PTS&&this.tick()}},A.startLoad=function(b){if(!this.levels){this.startPosition=b,this.state=t.State.STOPPED;return}var L=this.lastCurrentTime;this.stopLoad(),this.setInterval(v),this.fragLoadError=0,L>0&&b===-1?(this.log("Override startPosition with lastCurrentTime @"+L.toFixed(3)),b=L,this.state=t.State.IDLE):(this.loadedmetadata=!1,this.state=t.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=b,this.tick()},A.doTick=function(){switch(this.state){case t.State.IDLE:this.doTickIdle();break;case t.State.WAITING_TRACK:{var b,L=this.levels,E=this.trackId,y=L==null||(b=L[E])===null||b===void 0?void 0:b.details;if(y){if(this.waitForCdnTuneIn(y))break;this.state=t.State.WAITING_INIT_PTS}break}case t.State.FRAG_LOADING_WAITING_RETRY:{var O,M=performance.now(),R=this.retryDate;(!R||M>=R||(O=this.media)!==null&&O!==void 0&&O.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=t.State.IDLE);break}case t.State.WAITING_INIT_PTS:{var F=this.waitingData;if(F){var k=F.frag,w=F.part,_=F.cache,B=F.complete;if(this.initPTS[k.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=t.State.FRAG_LOADING;var N=_.flush(),U={frag:k,part:w,payload:N,networkDetails:null};this._handleFragmentLoadProgress(U),B&&r.prototype._handleFragmentLoadComplete.call(this,U)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+k.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var j=this.getLoadPosition(),K=I.BufferHelper.bufferInfo(this.mediaBuffer,j,this.config.maxBufferHole),H=Object(m.fragmentWithinToleranceTest)(K.end,this.config.maxFragLookUpTolerance,k);H<0&&(this.log("Waiting fragment cc ("+k.cc+") @ "+k.start+" cancelled because another fragment at "+K.end+" is needed"),this.clearWaitingFragment())}}else this.state=t.State.IDLE}}this.onTickEnd()},A.clearWaitingFragment=function(){var b=this.waitingData;b&&(this.fragmentTracker.removeFragment(b.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=t.State.IDLE)},A.resetLoadingState=function(){this.clearWaitingFragment(),r.prototype.resetLoadingState.call(this)},A.onTickEnd=function(){var b=this.media;if(!(!b||!b.readyState)){var L=this.mediaBuffer?this.mediaBuffer:b,E=L.buffered;!this.loadedmetadata&&E.length&&(this.loadedmetadata=!0),this.lastCurrentTime=b.currentTime}},A.doTickIdle=function(){var b,L,E=this.hls,y=this.levels,O=this.media,M=this.trackId,R=E.config;if(!(!y||!y[M])&&!(!O&&(this.startFragRequested||!R.startFragPrefetch))){var F=y[M],k=F.details;if(!k||k.live&&this.levelLastLoaded!==M||this.waitForCdnTuneIn(k)){this.state=t.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,i.ElementaryStreamTypes.AUDIO,u.PlaylistLevelType.AUDIO));var w=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,u.PlaylistLevelType.AUDIO);if(w!==null){var _=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,u.PlaylistLevelType.MAIN),B=w.len,N=this.getMaxBufferLength(_==null?void 0:_.len),U=this.audioSwitch;if(!(B>=N&&!U)){if(!U&&this._streamEnded(w,k)){E.trigger(d.Events.BUFFER_EOS,{type:"audio"}),this.state=t.State.ENDED;return}var j=k.fragments,K=j[0].start,H=w.end;if(U){var G=this.getLoadPosition();H=G,k.PTSKnown&&G<K&&(w.end>K||w.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),O.currentTime=K+.05)}if(!(_&&H>_.end+k.targetduration)&&!((!_||!_.len)&&w.len)){var W=this.getNextFragment(H,k);if(!W){this.bufferFlushed=!0;return}((b=W.decryptdata)===null||b===void 0?void 0:b.keyFormat)==="identity"&&!((L=W.decryptdata)!==null&&L!==void 0&&L.key)?this.loadKey(W,k):this.loadFragment(W,k,H)}}}}},A.getMaxBufferLength=function(b){var L=r.prototype.getMaxBufferLength.call(this);return b?Math.max(L,b):L},A.onMediaDetaching=function(){this.videoBuffer=null,r.prototype.onMediaDetaching.call(this)},A.onAudioTracksUpdated=function(b,L){var E=L.audioTracks;this.resetTransmuxer(),this.levels=E.map(function(y){return new D.Level(y)})},A.onAudioTrackSwitching=function(b,L){var E=!!L.url;this.trackId=L.id;var y=this.fragCurrent;y!=null&&y.loader&&y.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),E?this.setInterval(v):this.resetTransmuxer(),E?(this.audioSwitch=!0,this.state=t.State.IDLE):this.state=t.State.STOPPED,this.tick()},A.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},A.onLevelLoaded=function(b,L){this.mainDetails=L.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(d.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},A.onAudioTrackLoaded=function(b,L){var E;if(this.mainDetails==null){this.cachedTrackLoadedData=L;return}var y=this.levels,O=L.details,M=L.id;if(!y){this.warn("Audio tracks were reset while loading level "+M);return}this.log("Track "+M+" loaded ["+O.startSN+","+O.endSN+"],duration:"+O.totalduration);var R=y[M],F=0;if(O.live||(E=R.details)!==null&&E!==void 0&&E.live){var k=this.mainDetails;if(O.fragments[0]||(O.deltaUpdateFailed=!0),O.deltaUpdateFailed||!k)return;!R.details&&O.hasProgramDateTime&&k.hasProgramDateTime?(Object(S.alignMediaPlaylistByPDT)(O,k),F=O.fragments[0].start):F=this.alignPlaylists(O,R.details)}R.details=O,this.levelLastLoaded=M,!this.startFragRequested&&(this.mainDetails||!O.live)&&this.setStartPosition(R.details,F),this.state===t.State.WAITING_TRACK&&!this.waitForCdnTuneIn(O)&&(this.state=t.State.IDLE),this.tick()},A._handleFragmentLoadProgress=function(b){var L,E=b.frag,y=b.part,O=b.payload,M=this.config,R=this.trackId,F=this.levels;if(!F){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+E.sn+" of level "+E.level+" will not be buffered");return}var k=F[R];console.assert(k,"Audio track is defined on fragment load progress");var w=k.details;console.assert(w,"Audio track details are defined on fragment load progress");var _=M.defaultAudioCodec||k.audioCodec||"mp4a.40.2",B=this.transmuxer;B||(B=this.transmuxer=new p.default(this.hls,u.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var N=this.initPTS[E.cc],U=(L=E.initSegment)===null||L===void 0?void 0:L.data;if(N!==void 0){var j=!1,K=y?y.index:-1,H=K!==-1,G=new g.ChunkMetadata(E.level,E.sn,E.stats.chunkCount,O.byteLength,K,H);B.push(O,U,_,"",E,y,w.totalduration,j,G,N)}else{this.log("Unknown video PTS for cc "+E.cc+", waiting for video PTS before demuxing audio frag "+E.sn+" of ["+w.startSN+" ,"+w.endSN+"],track "+R);var W=this.waitingData=this.waitingData||{frag:E,part:y,cache:new f.default,complete:!1},X=W.cache;X.push(new Uint8Array(O)),this.waitingVideoCC=this.videoTrackCC,this.state=t.State.WAITING_INIT_PTS}},A._handleFragmentLoadComplete=function(b){if(this.waitingData){this.waitingData.complete=!0;return}r.prototype._handleFragmentLoadComplete.call(this,b)},A.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},A.onBufferCreated=function(b,L){var E=L.tracks.audio;E&&(this.mediaBuffer=E.buffer),L.tracks.video&&(this.videoBuffer=L.tracks.video.buffer)},A.onFragBuffered=function(b,L){var E=L.frag,y=L.part;if(E.type===u.PlaylistLevelType.AUDIO){if(this.fragContextChanged(E)){this.warn("Fragment "+E.sn+(y?" p: "+y.index:"")+" of level "+E.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}E.sn!=="initSegment"&&(this.fragPrevious=E,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(d.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(E,y)}},A.onError=function(b,L){switch(L.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(u.PlaylistLevelType.AUDIO,L);break;case o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==t.State.ERROR&&this.state!==t.State.STOPPED&&(this.state=L.fatal?t.State.ERROR:t.State.IDLE,this.warn(L.details+" while loading frag, switching to "+this.state+" state"));break;case o.ErrorDetails.BUFFER_FULL_ERROR:if(L.parent==="audio"&&(this.state===t.State.PARSING||this.state===t.State.PARSED)){var E=!0,y=this.getFwdBufferInfo(this.mediaBuffer,u.PlaylistLevelType.AUDIO);y&&y.len>.5&&(E=!this.reduceMaxBufferLength(y.len)),E&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,r.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},A.onBufferFlushed=function(b,L){var E=L.type;E===i.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},A._handleTransmuxComplete=function(b){var L,E="audio",y=this.hls,O=b.remuxResult,M=b.chunkMeta,R=this.getCurrentContext(M);if(!R){this.warn("The loading context changed while buffering fragment "+M.sn+" of level "+M.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(M.level);return}var F=R.frag,k=R.part,w=R.level.details,_=O.audio,B=O.text,N=O.id3,U=O.initSegment;if(!(this.fragContextChanged(F)||!w)){if(this.state=t.State.PARSING,this.audioSwitch&&_&&this.completeAudioSwitch(),U!=null&&U.tracks&&(this._bufferInitSegment(U.tracks,F,M),y.trigger(d.Events.FRAG_PARSING_INIT_SEGMENT,{frag:F,id:E,tracks:U.tracks})),_){var j=_.startPTS,K=_.endPTS,H=_.startDTS,G=_.endDTS;k&&(k.elementaryStreams[i.ElementaryStreamTypes.AUDIO]={startPTS:j,endPTS:K,startDTS:H,endDTS:G}),F.setElementaryStreamInfo(i.ElementaryStreamTypes.AUDIO,j,K,H,G),this.bufferFragmentData(_,F,k,M)}if(N!=null&&(L=N.samples)!==null&&L!==void 0&&L.length){var W=e({id:E,frag:F,details:w},N);y.trigger(d.Events.FRAG_PARSING_METADATA,W)}if(B){var X=e({id:E,frag:F,details:w},B);y.trigger(d.Events.FRAG_PARSING_USERDATA,X)}}},A._bufferInitSegment=function(b,L,E){if(this.state===t.State.PARSING){b.video&&delete b.video;var y=b.audio;if(!!y){y.levelCodec=y.codec,y.id="audio",this.log("Init audio buffer, container:"+y.container+", codecs[parsed]=["+y.codec+"]"),this.hls.trigger(d.Events.BUFFER_CODECS,b);var O=y.initSegment;if(O!=null&&O.byteLength){var M={type:"audio",frag:L,part:null,chunkMeta:E,parent:L.type,data:O};this.hls.trigger(d.Events.BUFFER_APPENDING,M)}this.tick()}}},A.loadFragment=function(b,L,E){var y=this.fragmentTracker.getState(b);this.fragCurrent=b,(this.audioSwitch||y===x.FragmentState.NOT_LOADED||y===x.FragmentState.PARTIAL)&&(b.sn==="initSegment"?this._loadInitSegment(b):L.live&&!Object(s.isFiniteNumber)(this.initPTS[b.cc])?(this.log("Waiting for video PTS in continuity counter "+b.cc+" of live stream before loading audio fragment "+b.sn+" of level "+this.trackId),this.state=t.State.WAITING_INIT_PTS):(this.startFragRequested=!0,r.prototype.loadFragment.call(this,b,L,E)))},A.completeAudioSwitch=function(){var b=this.hls,L=this.media,E=this.trackId;L&&(this.log("Switching audio track : flushing all audio"),r.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,b.trigger(d.Events.AUDIO_TRACK_SWITCHED,{id:E})},l}(t.default);C.default=a},"./src/controller/audio-track-controller.ts":function(P,C,n){n.r(C);var s=n("./src/events.ts"),t=n("./src/errors.ts"),d=n("./src/controller/base-playlist-controller.ts"),I=n("./src/types/loader.ts");function x(p,g){for(var m=0;m<g.length;m++){var S=g[m];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(p,S.key,S)}}function D(p,g,m){return g&&x(p.prototype,g),m&&x(p,m),Object.defineProperty(p,"prototype",{writable:!1}),p}function u(p,g){p.prototype=Object.create(g.prototype),p.prototype.constructor=p,i(p,g)}function i(p,g){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(S,o){return S.__proto__=o,S},i(p,g)}var f=function(p){u(g,p);function g(S){var o;return o=p.call(this,S,"[audio-track-controller]")||this,o.tracks=[],o.groupId=null,o.tracksInGroup=[],o.trackId=-1,o.trackName="",o.selectDefaultTrack=!0,o.registerListeners(),o}var m=g.prototype;return m.registerListeners=function(){var o=this.hls;o.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.on(s.Events.LEVEL_LOADING,this.onLevelLoading,this),o.on(s.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),o.on(s.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),o.on(s.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){var o=this.hls;o.off(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.off(s.Events.LEVEL_LOADING,this.onLevelLoading,this),o.off(s.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),o.off(s.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),o.off(s.Events.ERROR,this.onError,this)},m.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,p.prototype.destroy.call(this)},m.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},m.onManifestParsed=function(o,e){this.tracks=e.audioTracks||[]},m.onAudioTrackLoaded=function(o,e){var c=e.id,h=e.details,v=this.tracksInGroup[c];if(!v){this.warn("Invalid audio track id "+c);return}var a=v.details;v.details=e.details,this.log("audioTrack "+c+" loaded ["+h.startSN+"-"+h.endSN+"]"),c===this.trackId&&(this.retryCount=0,this.playlistLoaded(c,e,a))},m.onLevelLoading=function(o,e){this.switchLevel(e.level)},m.onLevelSwitching=function(o,e){this.switchLevel(e.level)},m.switchLevel=function(o){var e=this.hls.levels[o];if(!!(e!=null&&e.audioGroupIds)){var c=e.audioGroupIds[e.urlId];if(this.groupId!==c){this.groupId=c;var h=this.tracks.filter(function(a){return!c||a.groupId===c});this.selectDefaultTrack&&!h.some(function(a){return a.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=h;var v={audioTracks:h};this.log("Updating audio tracks, "+h.length+' track(s) found in "'+c+'" group-id'),this.hls.trigger(s.Events.AUDIO_TRACKS_UPDATED,v),this.selectInitialTrack()}}},m.onError=function(o,e){p.prototype.onError.call(this,o,e),!(e.fatal||!e.context)&&e.context.type===I.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},m.setAudioTrack=function(o){var e=this.tracksInGroup;if(o<0||o>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var c=e[this.trackId];this.log("Now switching to audio-track index "+o);var h=e[o],v=h.id,a=h.groupId,r=a===void 0?"":a,l=h.name,A=h.type,T=h.url;if(this.trackId=o,this.trackName=l,this.selectDefaultTrack=!1,this.hls.trigger(s.Events.AUDIO_TRACK_SWITCHING,{id:v,groupId:r,name:l,type:A,url:T}),!(h.details&&!h.details.live)){var b=this.switchParams(h.url,c==null?void 0:c.details);this.loadPlaylist(b)}},m.selectInitialTrack=function(){var o=this.tracksInGroup;console.assert(o.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,c=this.findTrackId(e)||this.findTrackId();c!==-1?this.setAudioTrack(c):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(s.Events.ERROR,{type:t.ErrorTypes.MEDIA_ERROR,details:t.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},m.findTrackId=function(o){for(var e=this.tracksInGroup,c=0;c<e.length;c++){var h=e[c];if((!this.selectDefaultTrack||h.default)&&(!o||o===h.name))return h.id}return-1},m.loadPlaylist=function(o){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var c=e.id,h=e.groupId,v=e.url;if(o)try{v=o.addDirectives(v)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("loading audio-track playlist for id: "+c),this.clearTimer(),this.hls.trigger(s.Events.AUDIO_TRACK_LOADING,{url:v,id:c,groupId:h,deliveryDirectives:o||null})}},D(g,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(o){this.selectDefaultTrack=!1,this.setAudioTrack(o)}}]),g}(d.default);C.default=f},"./src/controller/base-playlist-controller.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return D});var s=n("./src/polyfills/number.ts"),t=n("./src/types/level.ts"),d=n("./src/controller/level-helper.ts"),I=n("./src/utils/logger.ts"),x=n("./src/errors.ts"),D=function(){function u(f,p){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=I.logger.log.bind(I.logger,p+":"),this.warn=I.logger.warn.bind(I.logger,p+":"),this.hls=f}var i=u.prototype;return i.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},i.onError=function(p,g){g.fatal&&g.type===x.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},i.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},i.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},i.stopLoad=function(){this.canLoad=!1,this.clearTimer()},i.switchParams=function(p,g){var m=g==null?void 0:g.renditionReports;if(m)for(var S=0;S<m.length;S++){var o=m[S],e=""+o.URI;if(e===p.slice(-e.length)){var c=parseInt(o["LAST-MSN"]),h=parseInt(o["LAST-PART"]);if(g&&this.hls.config.lowLatencyMode){var v=Math.min(g.age-g.partTarget,g.targetduration);h!==void 0&&v>g.partTarget&&(h+=1)}if(Object(s.isFiniteNumber)(c))return new t.HlsUrlParameters(c,Object(s.isFiniteNumber)(h)?h:void 0,t.HlsSkip.No)}}},i.loadPlaylist=function(p){},i.shouldLoadTrack=function(p){return this.canLoad&&p&&!!p.url&&(!p.details||p.details.live)},i.playlistLoaded=function(p,g,m){var S=this,o=g.details,e=g.stats,c=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(o.advancedDateTime=Date.now()-c,o.live||m!=null&&m.live){if(o.reloaded(m),m&&this.log("live playlist "+p+" "+(o.advanced?"REFRESHED "+o.lastPartSn+"-"+o.lastPartIndex:"MISSED")),m&&o.fragments.length>0&&Object(d.mergeDetails)(m,o),!this.canLoad||!o.live)return;var h,v=void 0,a=void 0;if(o.canBlockReload&&o.endSN&&o.advanced){var r=this.hls.config.lowLatencyMode,l=o.lastPartSn,A=o.endSN,T=o.lastPartIndex,b=T!==-1,L=l===A,E=r?0:T;b?(v=L?A+1:l,a=L?E:T+1):v=A+1;var y=o.age,O=y+o.ageHeader,M=Math.min(O-o.partTarget,o.targetduration*1.5);if(M>0){if(m&&M>m.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+m.tuneInGoal+" to: "+M+" with playlist age: "+o.age),M=0;else{var R=Math.floor(M/o.targetduration);if(v+=R,a!==void 0){var F=Math.round(M%o.targetduration/o.partTarget);a+=F}this.log("CDN Tune-in age: "+o.ageHeader+"s last advanced "+y.toFixed(2)+"s goal: "+M+" skip sn "+R+" to part "+a)}o.tuneInGoal=M}if(h=this.getDeliveryDirectives(o,g.deliveryDirectives,v,a),r||!L){this.loadPlaylist(h);return}}else h=this.getDeliveryDirectives(o,g.deliveryDirectives,v,a);var k=Object(d.computeReloadInterval)(o,e);v!==void 0&&o.canBlockReload&&(k-=o.partTarget||1),this.log("reload live playlist "+p+" in "+Math.round(k)+" ms"),this.timer=self.setTimeout(function(){return S.loadPlaylist(h)},k)}else this.clearTimer()},i.getDeliveryDirectives=function(p,g,m,S){var o=Object(t.getSkipValue)(p,m);return g!=null&&g.skip&&p.deltaUpdateFailed&&(m=g.msn,S=g.part,o=t.HlsSkip.No),new t.HlsUrlParameters(m,S,o)},i.retryLoadingOrFail=function(p){var g=this,m=this.hls.config,S=this.retryCount<m.levelLoadingMaxRetry;if(S){var o;if(this.retryCount++,p.details.indexOf("LoadTimeOut")>-1&&(o=p.context)!==null&&o!==void 0&&o.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+p.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*m.levelLoadingRetryDelay,m.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return g.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+p.details+'"')}}else this.warn('cannot recover from error "'+p.details+'"'),this.clearTimer(),p.fatal=!0;return S},u}()},"./src/controller/base-stream-controller.ts":function(P,C,n){n.r(C),n.d(C,"State",function(){return A}),n.d(C,"default",function(){return T});var s=n("./src/polyfills/number.ts"),t=n("./src/task-loop.ts"),d=n("./src/controller/fragment-tracker.ts"),I=n("./src/utils/buffer-helper.ts"),x=n("./src/utils/logger.ts"),D=n("./src/events.ts"),u=n("./src/errors.ts"),i=n("./src/types/transmuxer.ts"),f=n("./src/utils/mp4-tools.ts"),p=n("./src/utils/discontinuities.ts"),g=n("./src/controller/fragment-finders.ts"),m=n("./src/controller/level-helper.ts"),S=n("./src/loader/fragment-loader.ts"),o=n("./src/crypt/decrypter.ts"),e=n("./src/utils/time-ranges.ts"),c=n("./src/types/loader.ts");function h(b,L){for(var E=0;E<L.length;E++){var y=L[E];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(b,y.key,y)}}function v(b,L,E){return L&&h(b.prototype,L),E&&h(b,E),Object.defineProperty(b,"prototype",{writable:!1}),b}function a(b){if(b===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b}function r(b,L){b.prototype=Object.create(L.prototype),b.prototype.constructor=b,l(b,L)}function l(b,L){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,O){return y.__proto__=O,y},l(b,L)}var A={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},T=function(b){r(L,b);function L(y,O,M){var R;return R=b.call(this)||this,R.hls=void 0,R.fragPrevious=null,R.fragCurrent=null,R.fragmentTracker=void 0,R.transmuxer=null,R._state=A.STOPPED,R.media=void 0,R.mediaBuffer=void 0,R.config=void 0,R.bitrateTest=!1,R.lastCurrentTime=0,R.nextLoadPosition=0,R.startPosition=0,R.loadedmetadata=!1,R.fragLoadError=0,R.retryDate=0,R.levels=null,R.fragmentLoader=void 0,R.levelLastLoaded=null,R.startFragRequested=!1,R.decrypter=void 0,R.initPTS=[],R.onvseeking=null,R.onvended=null,R.logPrefix="",R.log=void 0,R.warn=void 0,R.logPrefix=M,R.log=x.logger.log.bind(x.logger,M+":"),R.warn=x.logger.warn.bind(x.logger,M+":"),R.hls=y,R.fragmentLoader=new S.default(y.config),R.fragmentTracker=O,R.config=y.config,R.decrypter=new o.default(y,y.config),y.on(D.Events.KEY_LOADED,R.onKeyLoaded,a(R)),R}var E=L.prototype;return E.doTick=function(){this.onTickEnd()},E.onTickEnd=function(){},E.startLoad=function(O){},E.stopLoad=function(){this.fragmentLoader.abort();var O=this.fragCurrent;O&&this.fragmentTracker.removeFragment(O),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=A.STOPPED},E._streamEnded=function(O,M){var R=this.fragCurrent,F=this.fragmentTracker;if(!M.live&&R&&R.sn>=M.endSN&&!O.nextStart){var k=M.partList;if(k!=null&&k.length){var w=k[k.length-1],_=I.BufferHelper.isBuffered(this.media,w.start+w.duration/2);return _}var B=F.getState(R);return B===d.FragmentState.PARTIAL||B===d.FragmentState.OK}return!1},E.onMediaAttached=function(O,M){var R=this.media=this.mediaBuffer=M.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),R.addEventListener("seeking",this.onvseeking),R.addEventListener("ended",this.onvended);var F=this.config;this.levels&&F.autoStartLoad&&this.state===A.STOPPED&&this.startLoad(F.startPosition)},E.onMediaDetaching=function(){var O=this.media;O!=null&&O.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),O&&(O.removeEventListener("seeking",this.onvseeking),O.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},E.onMediaSeeking=function(){var O=this.config,M=this.fragCurrent,R=this.media,F=this.mediaBuffer,k=this.state,w=R?R.currentTime:0,_=I.BufferHelper.bufferInfo(F||R,w,O.maxBufferHole);if(this.log("media seeking to "+(Object(s.isFiniteNumber)(w)?w.toFixed(3):w)+", state: "+k),k===A.ENDED)this.resetLoadingState();else if(M&&!_.len){var B=O.maxFragLookUpTolerance,N=M.start-B,U=M.start+M.duration+B,j=w>U;(w<N||j)&&(j&&M.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),M.loader.abort()),this.resetLoadingState())}R&&(this.lastCurrentTime=w),!this.loadedmetadata&&!_.len&&(this.nextLoadPosition=this.startPosition=w),this.tickImmediate()},E.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},E.onKeyLoaded=function(O,M){if(!(this.state!==A.KEY_LOADING||M.frag!==this.fragCurrent||!this.levels)){this.state=A.IDLE;var R=this.levels[M.frag.level].details;R&&this.loadFragment(M.frag,R,M.frag.start)}},E.onHandlerDestroying=function(){this.stopLoad(),b.prototype.onHandlerDestroying.call(this)},E.onHandlerDestroyed=function(){this.state=A.STOPPED,this.hls.off(D.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,b.prototype.onHandlerDestroyed.call(this)},E.loadKey=function(O,M){this.log("Loading key for "+O.sn+" of ["+M.startSN+"-"+M.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+O.level),this.state=A.KEY_LOADING,this.fragCurrent=O,this.hls.trigger(D.Events.KEY_LOADING,{frag:O})},E.loadFragment=function(O,M,R){this._loadFragForPlayback(O,M,R)},E._loadFragForPlayback=function(O,M,R){var F=this,k=function(_){if(F.fragContextChanged(O)){F.warn("Fragment "+O.sn+(_.part?" p: "+_.part.index:"")+" of level "+O.level+" was dropped during download."),F.fragmentTracker.removeFragment(O);return}O.stats.chunkCount++,F._handleFragmentLoadProgress(_)};this._doFragLoad(O,M,R,k).then(function(w){if(!!w){F.fragLoadError=0;var _=F.state;if(F.fragContextChanged(O)){(_===A.FRAG_LOADING||!F.fragCurrent&&_===A.PARSING)&&(F.fragmentTracker.removeFragment(O),F.state=A.IDLE);return}"payload"in w&&(F.log("Loaded fragment "+O.sn+" of level "+O.level),F.hls.trigger(D.Events.FRAG_LOADED,w)),F._handleFragmentLoadComplete(w)}}).catch(function(w){F.state!==A.STOPPED&&(F.warn(w),F.resetFragmentLoading(O))})},E.flushMainBuffer=function(O,M,R){if(R===void 0&&(R=null),!!(O-M)){var F={startOffset:O,endOffset:M,type:R};this.fragLoadError=0,this.hls.trigger(D.Events.BUFFER_FLUSHING,F)}},E._loadInitSegment=function(O){var M=this;this._doFragLoad(O).then(function(R){if(!R||M.fragContextChanged(O)||!M.levels)throw new Error("init load aborted");return R}).then(function(R){var F=M.hls,k=R.payload,w=O.decryptdata;if(k&&k.byteLength>0&&w&&w.key&&w.iv&&w.method==="AES-128"){var _=self.performance.now();return M.decrypter.webCryptoDecrypt(new Uint8Array(k),w.key.buffer,w.iv.buffer).then(function(B){var N=self.performance.now();return F.trigger(D.Events.FRAG_DECRYPTED,{frag:O,payload:B,stats:{tstart:_,tdecrypt:N}}),R.payload=B,R})}return R}).then(function(R){var F=M.fragCurrent,k=M.hls,w=M.levels;if(!w)throw new Error("init load aborted, missing levels");var _=w[O.level].details;console.assert(_,"Level details are defined when init segment is loaded");var B=O.stats;M.state=A.IDLE,M.fragLoadError=0,O.data=new Uint8Array(R.payload),B.parsing.start=B.buffering.start=self.performance.now(),B.parsing.end=B.buffering.end=self.performance.now(),R.frag===F&&k.trigger(D.Events.FRAG_BUFFERED,{stats:B,frag:F,part:null,id:O.type}),M.tick()}).catch(function(R){M.warn(R),M.resetFragmentLoading(O)})},E.fragContextChanged=function(O){var M=this.fragCurrent;return!O||!M||O.level!==M.level||O.sn!==M.sn||O.urlId!==M.urlId},E.fragBufferedComplete=function(O,M){var R=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+O.type+" sn: "+O.sn+(M?" part: "+M.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+O.level+" "+e.default.toString(I.BufferHelper.getBuffered(R))),this.state=A.IDLE,this.tick()},E._handleFragmentLoadComplete=function(O){var M=this.transmuxer;if(!!M){var R=O.frag,F=O.part,k=O.partsLoaded,w=!k||k.length===0||k.some(function(B){return!B}),_=new i.ChunkMetadata(R.level,R.sn,R.stats.chunkCount+1,0,F?F.index:-1,!w);M.flush(_)}},E._handleFragmentLoadProgress=function(O){},E._doFragLoad=function(O,M,R,F){var k=this;if(R===void 0&&(R=null),!this.levels)throw new Error("frag load aborted, missing levels");if(R=Math.max(O.start,R||0),this.config.lowLatencyMode&&M){var w=M.partList;if(w&&F){R>O.end&&M.fragmentHint&&(O=M.fragmentHint);var _=this.getNextPart(w,O,R);if(_>-1){var B=w[_];return this.log("Loading part sn: "+O.sn+" p: "+B.index+" cc: "+O.cc+" of playlist ["+M.startSN+"-"+M.endSN+"] parts [0-"+_+"-"+(w.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+O.level+", target: "+parseFloat(R.toFixed(3))),this.nextLoadPosition=B.start+B.duration,this.state=A.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:O,part:w[_],targetBufferTime:R}),this.doFragPartsLoad(O,w,_,F).catch(function(N){return k.handleFragLoadError(N)})}else if(!O.url||this.loadedEndOfParts(w,R))return Promise.resolve(null)}}return this.log("Loading fragment "+O.sn+" cc: "+O.cc+" "+(M?"of ["+M.startSN+"-"+M.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+O.level+", target: "+parseFloat(R.toFixed(3))),Object(s.isFiniteNumber)(O.sn)&&!this.bitrateTest&&(this.nextLoadPosition=O.start+O.duration),this.state=A.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:O,targetBufferTime:R}),this.fragmentLoader.load(O,F).catch(function(N){return k.handleFragLoadError(N)})},E.doFragPartsLoad=function(O,M,R,F){var k=this;return new Promise(function(w,_){var B=[],N=function U(j){var K=M[j];k.fragmentLoader.loadPart(O,K,F).then(function(H){B[K.index]=H;var G=H.part;k.hls.trigger(D.Events.FRAG_LOADED,H);var W=M[j+1];if(W&&W.fragment===O)U(j+1);else return w({frag:O,part:G,partsLoaded:B})}).catch(_)};N(R)})},E.handleFragLoadError=function(O){var M=O.data;return M&&M.details===u.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(M.frag,M.part):this.hls.trigger(D.Events.ERROR,M),null},E._handleTransmuxerFlush=function(O){var M=this.getCurrentContext(O);if(!M||this.state!==A.PARSING){this.fragCurrent||(this.state=A.IDLE);return}var R=M.frag,F=M.part,k=M.level,w=self.performance.now();R.stats.parsing.end=w,F&&(F.stats.parsing.end=w),this.updateLevelTiming(R,F,k,O.partial)},E.getCurrentContext=function(O){var M=this.levels,R=O.level,F=O.sn,k=O.part;if(!M||!M[R])return this.warn("Levels object was unset while buffering fragment "+F+" of level "+R+". The current chunk will not be buffered."),null;var w=M[R],_=k>-1?Object(m.getPartWith)(w,F,k):null,B=_?_.fragment:Object(m.getFragmentWithSN)(w,F,this.fragCurrent);return B?{frag:B,part:_,level:w}:null},E.bufferFragmentData=function(O,M,R,F){if(!(!O||this.state!==A.PARSING)){var k=O.data1,w=O.data2,_=k;if(k&&w&&(_=Object(f.appendUint8Array)(k,w)),!(!_||!_.length)){var B={type:O.type,frag:M,part:R,chunkMeta:F,parent:M.type,data:_};this.hls.trigger(D.Events.BUFFER_APPENDING,B),O.dropped&&O.independent&&!R&&this.flushBufferGap(M)}}},E.flushBufferGap=function(O){var M=this.media;if(!!M){if(!I.BufferHelper.isBuffered(M,M.currentTime)){this.flushMainBuffer(0,O.start);return}var R=M.currentTime,F=I.BufferHelper.bufferInfo(M,R,0),k=O.duration,w=Math.min(this.config.maxFragLookUpTolerance*2,k*.25),_=Math.max(Math.min(O.start-w,F.end-w),R+w);O.start-_>w&&this.flushMainBuffer(_,O.start)}},E.getFwdBufferInfo=function(O,M){var R=this.config,F=this.getLoadPosition();if(!Object(s.isFiniteNumber)(F))return null;var k=I.BufferHelper.bufferInfo(O,F,R.maxBufferHole);if(k.len===0&&k.nextStart!==void 0){var w=this.fragmentTracker.getBufferedFrag(F,M);if(w&&k.nextStart<w.end)return I.BufferHelper.bufferInfo(O,F,Math.max(k.nextStart,R.maxBufferHole))}return k},E.getMaxBufferLength=function(O){var M=this.config,R;return O?R=Math.max(8*M.maxBufferSize/O,M.maxBufferLength):R=M.maxBufferLength,Math.min(R,M.maxMaxBufferLength)},E.reduceMaxBufferLength=function(O){var M=this.config,R=O||M.maxBufferLength;return M.maxMaxBufferLength>=R?(M.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+M.maxMaxBufferLength+"s"),!0):!1},E.getNextFragment=function(O,M){var R=M.fragments,F=R.length;if(!F)return null;var k=this.config,w=R[0].start,_;if(M.live){var B=k.initialLiveManifestSize;if(F<B)return this.warn("Not enough fragments to start playback (have: "+F+", need: "+B+")"),null;!M.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(_=this.getInitialLiveFragment(M,R),this.startPosition=_?this.hls.liveSyncPosition||_.start:O)}else O<=w&&(_=R[0]);if(!_){var N=k.lowLatencyMode?M.partEnd:M.fragmentEnd;_=this.getFragmentAtPosition(O,N,M)}return this.mapToInitFragWhenRequired(_)},E.mapToInitFragWhenRequired=function(O){return O!=null&&O.initSegment&&!(O!=null&&O.initSegment.data)&&!this.bitrateTest?O.initSegment:O},E.getNextPart=function(O,M,R){for(var F=-1,k=!1,w=!0,_=0,B=O.length;_<B;_++){var N=O[_];if(w=w&&!N.independent,F>-1&&R<N.start)break;var U=N.loaded;!U&&(k||N.independent||w)&&N.fragment===M&&(F=_),k=U}return F},E.loadedEndOfParts=function(O,M){var R=O[O.length-1];return R&&M>R.start&&R.loaded},E.getInitialLiveFragment=function(O,M){var R=this.fragPrevious,F=null;if(R){if(O.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+R.programDateTime),F=Object(g.findFragmentByPDT)(M,R.endProgramDateTime,this.config.maxFragLookUpTolerance)),!F){var k=R.sn+1;if(k>=O.startSN&&k<=O.endSN){var w=M[k-O.startSN];R.cc===w.cc&&(F=w,this.log("Live playlist, switching playlist, load frag with next SN: "+F.sn))}F||(F=Object(g.findFragWithCC)(M,R.cc),F&&this.log("Live playlist, switching playlist, load frag with same CC: "+F.sn))}}else{var _=this.hls.liveSyncPosition;_!==null&&(F=this.getFragmentAtPosition(_,this.bitrateTest?O.fragmentEnd:O.edge,O))}return F},E.getFragmentAtPosition=function(O,M,R){var F=this.config,k=this.fragPrevious,w=R.fragments,_=R.endSN,B=R.fragmentHint,N=F.maxFragLookUpTolerance,U=!!(F.lowLatencyMode&&R.partList&&B);U&&B&&!this.bitrateTest&&(w=w.concat(B),_=B.sn);var j;if(O<M){var K=O>M-N?0:N;j=Object(g.findFragmentByPTS)(k,w,O,K)}else j=w[w.length-1];if(j){var H=j.sn-R.startSN,G=k&&j.level===k.level,W=w[H+1];k&&j.sn===k.sn&&!U&&G&&(j.sn<_&&this.fragmentTracker.getState(W)!==d.FragmentState.OK?(this.log("SN "+j.sn+" just loaded, load next one: "+W.sn),j=W):j=null)}return j},E.synchronizeToLiveEdge=function(O){var M=this.config,R=this.media;if(!!R){var F=this.hls.liveSyncPosition,k=R.currentTime,w=O.fragments[0].start,_=O.edge,B=k>=w-M.maxFragLookUpTolerance&&k<=_;if(F!==null&&R.duration>F&&(k<F||!B)){var N=M.liveMaxLatencyDuration!==void 0?M.liveMaxLatencyDuration:M.liveMaxLatencyDurationCount*O.targetduration;(!B&&R.readyState<4||k<_-N)&&(this.loadedmetadata||(this.nextLoadPosition=F),R.readyState&&(this.warn("Playback: "+k.toFixed(3)+" is located too far from the end of live sliding playlist: "+_+", reset currentTime to : "+F.toFixed(3)),R.currentTime=F))}}},E.alignPlaylists=function(O,M){var R=this.levels,F=this.levelLastLoaded,k=this.fragPrevious,w=F!==null?R[F]:null,_=O.fragments.length;if(!_)return this.warn("No fragments in live playlist"),0;var B=O.fragments[0].start,N=!M,U=O.alignedSliding&&Object(s.isFiniteNumber)(B);if(N||!U&&!B){Object(p.alignStream)(k,w,O);var j=O.fragments[0].start;return this.log("Live playlist sliding: "+j.toFixed(2)+" start-sn: "+(M?M.startSN:"na")+"->"+O.startSN+" prev-sn: "+(k?k.sn:"na")+" fragments: "+_),j}return B},E.waitForCdnTuneIn=function(O){var M=3;return O.live&&O.canBlockReload&&O.partTarget&&O.tuneInGoal>Math.max(O.partHoldBack,O.partTarget*M)},E.setStartPosition=function(O,M){var R=this.startPosition;if(R<M&&(R=-1),R===-1||this.lastCurrentTime===-1){var F=O.startTimeOffset;Object(s.isFiniteNumber)(F)?(R=M+F,F<0&&(R+=O.totalduration),R=Math.min(Math.max(M,R),M+O.totalduration),this.log("Start time offset "+F+" found in playlist, adjust startPosition to "+R),this.startPosition=R):O.live?R=this.hls.liveSyncPosition||M:this.startPosition=R=0,this.lastCurrentTime=R}this.nextLoadPosition=R},E.getLoadPosition=function(){var O=this.media,M=0;return this.loadedmetadata&&O?M=O.currentTime:this.nextLoadPosition&&(M=this.nextLoadPosition),M},E.handleFragLoadAborted=function(O,M){this.transmuxer&&O.sn!=="initSegment"&&O.stats.aborted&&(this.warn("Fragment "+O.sn+(M?" part"+M.index:"")+" of level "+O.level+" was aborted"),this.resetFragmentLoading(O))},E.resetFragmentLoading=function(O){(!this.fragCurrent||!this.fragContextChanged(O))&&(this.state=A.IDLE)},E.onFragmentOrKeyLoadError=function(O,M){if(!M.fatal){var R=M.frag;if(!(!R||R.type!==O)){var F=this.fragCurrent;console.assert(F&&R.sn===F.sn&&R.level===F.level&&R.urlId===F.urlId,"Frag load error must match current frag to retry");var k=this.config;if(this.fragLoadError+1<=k.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(R.level))return;var w=Math.min(Math.pow(2,this.fragLoadError)*k.fragLoadingRetryDelay,k.fragLoadingMaxRetryTimeout);this.warn("Fragment "+R.sn+" of "+O+" "+R.level+" failed to load, retrying in "+w+"ms"),this.retryDate=self.performance.now()+w,this.fragLoadError++,this.state=A.FRAG_LOADING_WAITING_RETRY}else M.levelRetry?(O===c.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=A.IDLE):(x.logger.error(M.details+" reaches max retry, redispatch as fatal ..."),M.fatal=!0,this.hls.stopLoad(),this.state=A.ERROR)}}},E.afterBufferFlushed=function(O,M,R){if(!!O){var F=I.BufferHelper.getBuffered(O);this.fragmentTracker.detectEvictedFragments(M,F,R),this.state===A.ENDED&&this.resetLoadingState()}},E.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=A.IDLE},E.resetLiveStartWhenNotLoaded=function(O){if(!this.loadedmetadata){this.startFragRequested=!1;var M=this.levels?this.levels[O].details:null;if(M!=null&&M.live)return this.startPosition=-1,this.setStartPosition(M,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},E.updateLevelTiming=function(O,M,R,F){var k=this,w=R.details;console.assert(!!w,"level.details must be defined");var _=Object.keys(O.elementaryStreams).reduce(function(B,N){var U=O.elementaryStreams[N];if(U){var j=U.endPTS-U.startPTS;if(j<=0)return k.warn("Could not parse fragment "+O.sn+" "+N+" duration reliably ("+j+")"),B||!1;var K=F?0:Object(m.updateFragPTSDTS)(w,O,U.startPTS,U.endPTS,U.startDTS,U.endDTS);return k.hls.trigger(D.Events.LEVEL_PTS_UPDATED,{details:w,level:R,drift:K,type:N,frag:O,start:U.startPTS,end:U.endPTS}),!0}return B},!1);_||(this.warn("Found no media in fragment "+O.sn+" of level "+R.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=A.PARSED,this.hls.trigger(D.Events.FRAG_PARSED,{frag:O,part:M})},E.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},v(L,[{key:"state",get:function(){return this._state},set:function(O){var M=this._state;M!==O&&(this._state=O,this.log(M+"->"+O))}}]),L}(t.default)},"./src/controller/buffer-controller.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return g});var s=n("./src/polyfills/number.ts"),t=n("./src/events.ts"),d=n("./src/utils/logger.ts"),I=n("./src/errors.ts"),x=n("./src/utils/buffer-helper.ts"),D=n("./src/utils/mediasource-helper.ts"),u=n("./src/loader/fragment.ts"),i=n("./src/controller/buffer-operation-queue.ts"),f=Object(D.getMediaSource)(),p=/([ha]vc.)(?:\.[^.,]+)+/,g=function(){function m(o){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var c=e.hls,h=e.media,v=e.mediaSource;d.logger.log("[buffer-controller]: Media source opened"),h&&(e.updateMediaElementDuration(),c.trigger(t.Events.MEDIA_ATTACHED,{media:h})),v&&v.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){d.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){d.logger.log("[buffer-controller]: Media source ended")},this.hls=o,this._initSourceBuffer(),this.registerListeners()}var S=m.prototype;return S.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},S.destroy=function(){this.unregisterListeners(),this.details=null},S.registerListeners=function(){var e=this.hls;e.on(t.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(t.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(t.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(t.Events.BUFFER_RESET,this.onBufferReset,this),e.on(t.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(t.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(t.Events.BUFFER_EOS,this.onBufferEos,this),e.on(t.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(t.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(t.Events.FRAG_PARSED,this.onFragParsed,this),e.on(t.Events.FRAG_CHANGED,this.onFragChanged,this)},S.unregisterListeners=function(){var e=this.hls;e.off(t.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(t.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(t.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(t.Events.BUFFER_RESET,this.onBufferReset,this),e.off(t.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(t.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(t.Events.BUFFER_EOS,this.onBufferEos,this),e.off(t.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(t.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(t.Events.FRAG_PARSED,this.onFragParsed,this),e.off(t.Events.FRAG_CHANGED,this.onFragChanged,this)},S._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new i.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},S.onManifestParsed=function(e,c){var h=2;(c.audio&&!c.video||!c.altAudio)&&(h=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=h,this.details=null,d.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},S.onMediaAttaching=function(e,c){var h=this.media=c.media;if(h&&f){var v=this.mediaSource=new f;v.addEventListener("sourceopen",this._onMediaSourceOpen),v.addEventListener("sourceended",this._onMediaSourceEnded),v.addEventListener("sourceclose",this._onMediaSourceClose),h.src=self.URL.createObjectURL(v),this._objectUrl=h.src}},S.onMediaDetaching=function(){var e=this.media,c=this.mediaSource,h=this._objectUrl;if(c){if(d.logger.log("[buffer-controller]: media source detaching"),c.readyState==="open")try{c.endOfStream()}catch(v){d.logger.warn("[buffer-controller]: onMediaDetaching: "+v.message+" while calling endOfStream")}this.onBufferReset(),c.removeEventListener("sourceopen",this._onMediaSourceOpen),c.removeEventListener("sourceended",this._onMediaSourceEnded),c.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(h&&self.URL.revokeObjectURL(h),e.src===h?(e.removeAttribute("src"),e.load()):d.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(t.Events.MEDIA_DETACHED,void 0)},S.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(c){var h=e.sourceBuffer[c];try{h&&(e.removeBufferListeners(c),e.mediaSource&&e.mediaSource.removeSourceBuffer(h),e.sourceBuffer[c]=void 0)}catch(v){d.logger.warn("[buffer-controller]: Failed to reset the "+c+" buffer",v)}}),this._initSourceBuffer()},S.onBufferCodecs=function(e,c){var h=this,v=this.getSourceBufferTypes().length;Object.keys(c).forEach(function(a){if(v){var r=h.tracks[a];if(r&&typeof r.buffer.changeType=="function"){var l=c[a],A=l.id,T=l.codec,b=l.levelCodec,L=l.container,E=l.metadata,y=(r.levelCodec||r.codec).replace(p,"$1"),O=(b||T).replace(p,"$1");if(y!==O){var M=L+";codecs="+(b||T);h.appendChangeType(a,M),d.logger.log("[buffer-controller]: switching codec "+y+" to "+O),h.tracks[a]={buffer:r.buffer,codec:T,container:L,levelCodec:b,metadata:E,id:A}}}}else h.pendingTracks[a]=c[a]}),!v&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},S.appendChangeType=function(e,c){var h=this,v=this.operationQueue,a={execute:function(){var l=h.sourceBuffer[e];l&&(d.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+c),l.changeType(c)),v.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(l){d.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",l)}};v.append(a,e)},S.onBufferAppending=function(e,c){var h=this,v=this.hls,a=this.operationQueue,r=this.tracks,l=c.data,A=c.type,T=c.frag,b=c.part,L=c.chunkMeta,E=L.buffering[A],y=self.performance.now();E.start=y;var O=T.stats.buffering,M=b?b.stats.buffering:null;O.start===0&&(O.start=y),M&&M.start===0&&(M.start=y);var R=r.audio,F=A==="audio"&&L.id===1&&(R==null?void 0:R.container)==="audio/mpeg",k={execute:function(){if(E.executeStart=self.performance.now(),F){var _=h.sourceBuffer[A];if(_){var B=T.start-_.timestampOffset;Math.abs(B)>=.1&&(d.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+T.start+" (delta: "+B+") sn: "+T.sn+")"),_.timestampOffset=T.start)}}h.appendExecutor(l,A)},onStart:function(){},onComplete:function(){var _=self.performance.now();E.executeEnd=E.end=_,O.first===0&&(O.first=_),M&&M.first===0&&(M.first=_);var B=h.sourceBuffer,N={};for(var U in B)N[U]=x.BufferHelper.getBuffered(B[U]);h.appendError=0,h.hls.trigger(t.Events.BUFFER_APPENDED,{type:A,frag:T,part:b,chunkMeta:L,parent:T.type,timeRanges:N})},onError:function(_){d.logger.error("[buffer-controller]: Error encountered while trying to append to the "+A+" SourceBuffer",_);var B={type:I.ErrorTypes.MEDIA_ERROR,parent:T.type,details:I.ErrorDetails.BUFFER_APPEND_ERROR,err:_,fatal:!1};_.code===DOMException.QUOTA_EXCEEDED_ERR?B.details=I.ErrorDetails.BUFFER_FULL_ERROR:(h.appendError++,B.details=I.ErrorDetails.BUFFER_APPEND_ERROR,h.appendError>v.config.appendErrorMaxRetry&&(d.logger.error("[buffer-controller]: Failed "+v.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),B.fatal=!0)),v.trigger(t.Events.ERROR,B)}};a.append(k,A)},S.onBufferFlushing=function(e,c){var h=this,v=this.operationQueue,a=function(l){return{execute:h.removeExecutor.bind(h,l,c.startOffset,c.endOffset),onStart:function(){},onComplete:function(){h.hls.trigger(t.Events.BUFFER_FLUSHED,{type:l})},onError:function(T){d.logger.warn("[buffer-controller]: Failed to remove from "+l+" SourceBuffer",T)}}};c.type?v.append(a(c.type),c.type):this.getSourceBufferTypes().forEach(function(r){v.append(a(r),r)})},S.onFragParsed=function(e,c){var h=this,v=c.frag,a=c.part,r=[],l=a?a.elementaryStreams:v.elementaryStreams;l[u.ElementaryStreamTypes.AUDIOVIDEO]?r.push("audiovideo"):(l[u.ElementaryStreamTypes.AUDIO]&&r.push("audio"),l[u.ElementaryStreamTypes.VIDEO]&&r.push("video"));var A=function(){var b=self.performance.now();v.stats.buffering.end=b,a&&(a.stats.buffering.end=b);var L=a?a.stats:v.stats;h.hls.trigger(t.Events.FRAG_BUFFERED,{frag:v,part:a,stats:L,id:v.type})};r.length===0&&d.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+v.type+" level: "+v.level+" sn: "+v.sn),this.blockBuffers(A,r)},S.onFragChanged=function(e,c){this.flushBackBuffer()},S.onBufferEos=function(e,c){var h=this,v=this.getSourceBufferTypes().reduce(function(a,r){var l=h.sourceBuffer[r];return(!c.type||c.type===r)&&l&&!l.ended&&(l.ended=!0,d.logger.log("[buffer-controller]: "+r+" sourceBuffer now EOS")),a&&!!(!l||l.ended)},!0);v&&this.blockBuffers(function(){var a=h.mediaSource;!a||a.readyState!=="open"||a.endOfStream()})},S.onLevelUpdated=function(e,c){var h=c.details;!h.fragments.length||(this.details=h,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},S.flushBackBuffer=function(){var e=this.hls,c=this.details,h=this.media,v=this.sourceBuffer;if(!(!h||c===null)){var a=this.getSourceBufferTypes();if(!!a.length){var r=c.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!(!Object(s.isFiniteNumber)(r)||r<0)){var l=h.currentTime,A=c.levelTargetDuration,T=Math.max(r,A),b=Math.floor(l/A)*A-T;a.forEach(function(L){var E=v[L];if(E){var y=x.BufferHelper.getBuffered(E);y.length>0&&b>y.start(0)&&(e.trigger(t.Events.BACK_BUFFER_REACHED,{bufferEnd:b}),c.live&&e.trigger(t.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:b}),e.trigger(t.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:b,type:L}))}})}}}},S.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var e=this.details,c=this.hls,h=this.media,v=this.mediaSource,a=e.fragments[0].start+e.totalduration,r=h.duration,l=Object(s.isFiniteNumber)(v.duration)?v.duration:0;e.live&&c.config.liveDurationInfinity?(d.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),v.duration=1/0,this.updateSeekableRange(e)):(a>l&&a>r||!Object(s.isFiniteNumber)(r))&&(d.logger.log("[buffer-controller]: Updating Media Source duration to "+a.toFixed(3)),v.duration=a)}},S.updateSeekableRange=function(e){var c=this.mediaSource,h=e.fragments,v=h.length;if(v&&e.live&&c!==null&&c!==void 0&&c.setLiveSeekableRange){var a=Math.max(0,h[0].start),r=Math.max(a,a+e.totalduration);c.setLiveSeekableRange(a,r)}},S.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,c=this.operationQueue,h=this.pendingTracks,v=Object.keys(h).length;if(v&&!e||v===2){this.createSourceBuffers(h),this.pendingTracks={};var a=this.getSourceBufferTypes();if(a.length===0){this.hls.trigger(t.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}a.forEach(function(r){c.executeNext(r)})}},S.createSourceBuffers=function(e){var c=this.sourceBuffer,h=this.mediaSource;if(!h)throw Error("createSourceBuffers called when mediaSource was null");var v=0;for(var a in e)if(!c[a]){var r=e[a];if(!r)throw Error("source buffer exists for track "+a+", however track does not");var l=r.levelCodec||r.codec,A=r.container+";codecs="+l;d.logger.log("[buffer-controller]: creating sourceBuffer("+A+")");try{var T=c[a]=h.addSourceBuffer(A),b=a;this.addBufferListener(b,"updatestart",this._onSBUpdateStart),this.addBufferListener(b,"updateend",this._onSBUpdateEnd),this.addBufferListener(b,"error",this._onSBUpdateError),this.tracks[a]={buffer:T,codec:l,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id},v++}catch(L){d.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+L.message),this.hls.trigger(t.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:L,mimeType:A})}}v&&this.hls.trigger(t.Events.BUFFER_CREATED,{tracks:this.tracks})},S._onSBUpdateStart=function(e){var c=this.operationQueue,h=c.current(e);h.onStart()},S._onSBUpdateEnd=function(e){var c=this.operationQueue,h=c.current(e);h.onComplete(),c.shiftAndExecuteNext(e)},S._onSBUpdateError=function(e,c){d.logger.error("[buffer-controller]: "+e+" SourceBuffer error",c),this.hls.trigger(t.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var h=this.operationQueue.current(e);h&&h.onError(c)},S.removeExecutor=function(e,c,h){var v=this.media,a=this.mediaSource,r=this.operationQueue,l=this.sourceBuffer,A=l[e];if(!v||!a||!A){d.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),r.shiftAndExecuteNext(e);return}var T=Object(s.isFiniteNumber)(v.duration)?v.duration:1/0,b=Object(s.isFiniteNumber)(a.duration)?a.duration:1/0,L=Math.max(0,c),E=Math.min(h,T,b);E>L?(d.logger.log("[buffer-controller]: Removing ["+L+","+E+"] from the "+e+" SourceBuffer"),console.assert(!A.updating,e+" sourceBuffer must not be updating"),A.remove(L,E)):r.shiftAndExecuteNext(e)},S.appendExecutor=function(e,c){var h=this.operationQueue,v=this.sourceBuffer,a=v[c];if(!a){d.logger.warn("[buffer-controller]: Attempting to append to the "+c+" SourceBuffer, but it does not exist"),h.shiftAndExecuteNext(c);return}a.ended=!1,console.assert(!a.updating,c+" sourceBuffer must not be updating"),a.appendBuffer(e)},S.blockBuffers=function(e,c){var h=this;if(c===void 0&&(c=this.getSourceBufferTypes()),!c.length){d.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}var v=this.operationQueue,a=c.map(function(r){return v.appendBlocker(r)});Promise.all(a).then(function(){e(),c.forEach(function(r){var l=h.sourceBuffer[r];(!l||!l.updating)&&v.shiftAndExecuteNext(r)})})},S.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},S.addBufferListener=function(e,c,h){var v=this.sourceBuffer[e];if(!!v){var a=h.bind(this,e);this.listeners[e].push({event:c,listener:a}),v.addEventListener(c,a)}},S.removeBufferListeners=function(e){var c=this.sourceBuffer[e];!c||this.listeners[e].forEach(function(h){c.removeEventListener(h.event,h.listener)})},m}()},"./src/controller/buffer-operation-queue.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return t});var s=n("./src/utils/logger.ts"),t=function(){function d(x){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=x}var I=d.prototype;return I.append=function(D,u){var i=this.queues[u];i.push(D),i.length===1&&this.buffers[u]&&this.executeNext(u)},I.insertAbort=function(D,u){var i=this.queues[u];i.unshift(D),this.executeNext(u)},I.appendBlocker=function(D){var u,i=new Promise(function(p){u=p}),f={execute:u,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(f,D),i},I.executeNext=function(D){var u=this.buffers,i=this.queues,f=u[D],p=i[D];if(p.length){var g=p[0];try{g.execute()}catch(m){s.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),g.onError(m),(!f||!f.updating)&&(p.shift(),this.executeNext(D))}}},I.shiftAndExecuteNext=function(D){this.queues[D].shift(),this.executeNext(D)},I.current=function(D){return this.queues[D][0]},d}()},"./src/controller/cap-level-controller.ts":function(P,C,n){n.r(C);var s=n("./src/events.ts");function t(x,D){for(var u=0;u<D.length;u++){var i=D[u];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(x,i.key,i)}}function d(x,D,u){return D&&t(x.prototype,D),u&&t(x,u),Object.defineProperty(x,"prototype",{writable:!1}),x}var I=function(){function x(u){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=u,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var D=x.prototype;return D.setStreamController=function(i){this.streamController=i},D.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},D.registerListeners=function(){var i=this.hls;i.on(s.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.on(s.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(s.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},D.unregisterListener=function(){var i=this.hls;i.off(s.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.off(s.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(s.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},D.onFpsDropLevelCapping=function(i,f){x.isLevelAllowed(f.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(f.droppedLevel)},D.onMediaAttaching=function(i,f){this.media=f.media instanceof HTMLVideoElement?f.media:null},D.onManifestParsed=function(i,f){var p=this.hls;this.restrictedLevels=[],this.firstLevel=f.firstLevel,p.config.capLevelToPlayerSize&&f.video&&this.startCapping()},D.onBufferCodecs=function(i,f){var p=this.hls;p.config.capLevelToPlayerSize&&f.video&&this.startCapping()},D.onMediaDetaching=function(){this.stopCapping()},D.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var i=this.hls.levels;if(i.length){var f=this.hls;f.autoLevelCapping=this.getMaxLevel(i.length-1),f.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=f.autoLevelCapping}}},D.getMaxLevel=function(i){var f=this,p=this.hls.levels;if(!p.length)return-1;var g=p.filter(function(m,S){return x.isLevelAllowed(S,f.restrictedLevels)&&S<=i});return this.clientRect=null,x.getMaxLevelByMediaSize(g,this.mediaWidth,this.mediaHeight)},D.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},D.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},D.getDimensions=function(){if(this.clientRect)return this.clientRect;var i=this.media,f={width:0,height:0};if(i){var p=i.getBoundingClientRect();f.width=p.width,f.height=p.height,!f.width&&!f.height&&(f.width=p.right-p.left||i.width||0,f.height=p.bottom-p.top||i.height||0)}return this.clientRect=f,f},x.isLevelAllowed=function(i,f){return f===void 0&&(f=[]),f.indexOf(i)===-1},x.getMaxLevelByMediaSize=function(i,f,p){if(!i||!i.length)return-1;for(var g=function(c,h){return h?c.width!==h.width||c.height!==h.height:!0},m=i.length-1,S=0;S<i.length;S+=1){var o=i[S];if((o.width>=f||o.height>=p)&&g(o,i[S+1])){m=S;break}}return m},d(x,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var i=1;if(!this.hls.config.ignoreDevicePixelRatio)try{i=self.devicePixelRatio}catch{}return i}}]),x}();C.default=I},"./src/controller/cmcd-controller.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return g});var s=n("./src/events.ts"),t=n("./src/types/cmcd.ts"),d=n("./src/utils/buffer-helper.ts"),I=n("./src/utils/logger.ts");function x(m,S){for(var o=0;o<S.length;o++){var e=S[o];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(m,e.key,e)}}function D(m,S,o){return S&&x(m.prototype,S),o&&x(m,o),Object.defineProperty(m,"prototype",{writable:!1}),m}function u(m,S){var o=typeof Symbol<"u"&&m[Symbol.iterator]||m["@@iterator"];if(o)return(o=o.call(m)).next.bind(o);if(Array.isArray(m)||(o=i(m))||S&&m&&typeof m.length=="number"){o&&(m=o);var e=0;return function(){return e>=m.length?{done:!0}:{done:!1,value:m[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function i(m,S){if(!!m){if(typeof m=="string")return f(m,S);var o=Object.prototype.toString.call(m).slice(8,-1);if(o==="Object"&&m.constructor&&(o=m.constructor.name),o==="Map"||o==="Set")return Array.from(m);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return f(m,S)}}function f(m,S){(S==null||S>m.length)&&(S=m.length);for(var o=0,e=new Array(S);o<S;o++)e[o]=m[o];return e}function p(){return p=Object.assign?Object.assign.bind():function(m){for(var S=1;S<arguments.length;S++){var o=arguments[S];for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(m[e]=o[e])}return m},p.apply(this,arguments)}var g=function(){function m(o){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(v){try{e.apply(v,{ot:t.CMCDObjectType.MANIFEST,su:!e.initialized})}catch(a){I.logger.warn("Could not generate manifest CMCD data.",a)}},this.applyFragmentData=function(v){try{var a=v.frag,r=e.hls.levels[a.level],l=e.getObjectType(a),A={d:a.duration*1e3,ot:l};(l===t.CMCDObjectType.VIDEO||l===t.CMCDObjectType.AUDIO||l==t.CMCDObjectType.MUXED)&&(A.br=r.bitrate/1e3,A.tb=e.getTopBandwidth(l)/1e3,A.bl=e.getBufferLength(l)),e.apply(v,A)}catch(T){I.logger.warn("Could not generate segment CMCD data.",T)}},this.hls=o;var c=this.config=o.config,h=c.cmcd;h!=null&&(c.pLoader=this.createPlaylistLoader(),c.fLoader=this.createFragmentLoader(),this.sid=h.sessionId||m.uuid(),this.cid=h.contentId,this.useHeaders=h.useHeaders===!0,this.registerListeners())}var S=m.prototype;return S.registerListeners=function(){var e=this.hls;e.on(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(s.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(s.Events.BUFFER_CREATED,this.onBufferCreated,this)},S.unregisterListeners=function(){var e=this.hls;e.off(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(s.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(s.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},S.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},S.onMediaAttached=function(e,c){this.media=c.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},S.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},S.onBufferCreated=function(e,c){var h,v;this.audioBuffer=(h=c.tracks.audio)===null||h===void 0?void 0:h.buffer,this.videoBuffer=(v=c.tracks.video)===null||v===void 0?void 0:v.buffer},S.createData=function(){var e;return{v:t.CMCDVersion,sf:t.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},S.apply=function(e,c){c===void 0&&(c={}),p(c,this.createData());var h=c.ot===t.CMCDObjectType.INIT||c.ot===t.CMCDObjectType.VIDEO||c.ot===t.CMCDObjectType.MUXED;if(this.starved&&h&&(c.bs=!0,c.su=!0,this.starved=!1),c.su==null&&(c.su=this.buffering),this.useHeaders){var v=m.toHeaders(c);if(!Object.keys(v).length)return;e.headers||(e.headers={}),p(e.headers,v)}else{var a=m.toQuery(c);if(!a)return;e.url=m.appendQueryToUri(e.url,a)}},S.getObjectType=function(e){var c=e.type;if(c==="subtitle")return t.CMCDObjectType.TIMED_TEXT;if(e.sn==="initSegment")return t.CMCDObjectType.INIT;if(c==="audio")return t.CMCDObjectType.AUDIO;if(c==="main")return this.hls.audioTracks.length?t.CMCDObjectType.VIDEO:t.CMCDObjectType.MUXED},S.getTopBandwidth=function(e){var c=0,h,v=this.hls;if(e===t.CMCDObjectType.AUDIO)h=v.audioTracks;else{var a=v.maxAutoLevel,r=a>-1?a+1:v.levels.length;h=v.levels.slice(0,r)}for(var l=u(h),A;!(A=l()).done;){var T=A.value;T.bitrate>c&&(c=T.bitrate)}return c>0?c:NaN},S.getBufferLength=function(e){var c=this.hls.media,h=e===t.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!h||!c)return NaN;var v=d.BufferHelper.bufferInfo(h,c.currentTime,this.config.maxBufferHole);return v.len*1e3},S.createPlaylistLoader=function(){var e=this.config.pLoader,c=this.applyPlaylistData,h=e||this.config.loader;return function(){function v(r){this.loader=void 0,this.loader=new h(r)}var a=v.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(l,A,T){c(l),this.loader.load(l,A,T)},D(v,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),v}()},S.createFragmentLoader=function(){var e=this.config.fLoader,c=this.applyFragmentData,h=e||this.config.loader;return function(){function v(r){this.loader=void 0,this.loader=new h(r)}var a=v.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(l,A,T){c(l),this.loader.load(l,A,T)},D(v,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),v}()},m.uuid=function(){var e=URL.createObjectURL(new Blob),c=e.toString();return URL.revokeObjectURL(e),c.slice(c.lastIndexOf("/")+1)},m.serialize=function(e){for(var c=[],h=function(F){return!Number.isNaN(F)&&F!=null&&F!==""&&F!==!1},v=function(F){return Math.round(F)},a=function(F){return v(F/100)*100},r=function(F){return encodeURIComponent(F)},l={br:v,d:v,bl:a,dl:a,mtp:a,nor:r,rtp:a,tb:v},A=Object.keys(e||{}).sort(),T=u(A),b;!(b=T()).done;){var L=b.value,E=e[L];if(!!h(E)&&!(L==="v"&&E===1)&&!(L=="pr"&&E===1)){var y=l[L];y&&(E=y(E));var O=typeof E,M=void 0;L==="ot"||L==="sf"||L==="st"?M=L+"="+E:O==="boolean"?M=L:O==="number"?M=L+"="+E:M=L+"="+JSON.stringify(E),c.push(M)}}return c.join(",")},m.toHeaders=function(e){for(var c=Object.keys(e),h={},v=["Object","Request","Session","Status"],a=[{},{},{},{}],r={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},l=0,A=c;l<A.length;l++){var T=A[l],b=r[T]!=null?r[T]:1;a[b][T]=e[T]}for(var L=0;L<a.length;L++){var E=m.serialize(a[L]);E&&(h["CMCD-"+v[L]]=E)}return h},m.toQuery=function(e){return"CMCD="+encodeURIComponent(m.serialize(e))},m.appendQueryToUri=function(e,c){if(!c)return e;var h=e.includes("?")?"&":"?";return""+e+h+c},m}()},"./src/controller/eme-controller.ts":function(P,C,n){n.r(C);var s=n("./src/events.ts"),t=n("./src/errors.ts"),d=n("./src/utils/logger.ts"),I=n("./src/utils/mediakeys-helper.ts");function x(g,m){for(var S=0;S<m.length;S++){var o=m[S];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(g,o.key,o)}}function D(g,m,S){return m&&x(g.prototype,m),S&&x(g,S),Object.defineProperty(g,"prototype",{writable:!1}),g}var u=3,i=function(m,S,o){var e={audioCapabilities:[],videoCapabilities:[]};return m.forEach(function(c){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+c+'"',robustness:o.audioRobustness||""})}),S.forEach(function(c){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+c+'"',robustness:o.videoRobustness||""})}),[e]},f=function(m,S,o,e){switch(m){case I.KeySystems.WIDEVINE:return i(S,o,e);default:throw new Error("Unknown key-system: "+m)}},p=function(){function g(S){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=S,this._config=S.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var m=g.prototype;return m.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},m._registerListeners=function(){this.hls.on(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(s.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(s.Events.MANIFEST_PARSED,this.onManifestParsed,this)},m._unregisterListeners=function(){this.hls.off(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(s.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(s.Events.MANIFEST_PARSED,this.onManifestParsed,this)},m.getLicenseServerUrl=function(o){switch(o){case I.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+o+'"')},m._attemptKeySystemAccess=function(o,e,c){var h=this,v=f(o,e,c,this._drmSystemOptions);d.logger.log("Requesting encrypted media key-system access");var a=this.requestMediaKeySystemAccess(o,v);this.mediaKeysPromise=a.then(function(r){return h._onMediaKeySystemAccessObtained(o,r)}),a.catch(function(r){d.logger.error('Failed to obtain key-system "'+o+'" access:',r)})},m._onMediaKeySystemAccessObtained=function(o,e){var c=this;d.logger.log('Access for key-system "'+o+'" obtained');var h={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:o};this._mediaKeysList.push(h);var v=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(a){return h.mediaKeys=a,d.logger.log('Media-keys created for key-system "'+o+'"'),c._onMediaKeysCreated(),a});return v.catch(function(a){d.logger.error("Failed to create media-keys:",a)}),v},m._onMediaKeysCreated=function(){var o=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),o._onNewMediaKeySession(e.mediaKeysSession))})},m._onNewMediaKeySession=function(o){var e=this;d.logger.log("New key-system session "+o.sessionId),o.addEventListener("message",function(c){e._onKeySessionMessage(o,c.message)},!1)},m._onKeySessionMessage=function(o,e){d.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(c){d.logger.log("Received license data (length: "+(c&&c.byteLength)+"), updating key-session"),o.update(c).catch(function(h){d.logger.warn("Updating key-session failed: "+h)})})},m.onMediaEncrypted=function(o){var e=this;if(d.logger.log('Media is encrypted using "'+o.initDataType+'" init data type'),!this.mediaKeysPromise){d.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(s.Events.ERROR,{type:t.ErrorTypes.KEY_SYSTEM_ERROR,details:t.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var c=function(v){!e._media||(e._attemptSetMediaKeys(v),e._generateRequestWithPreferredKeySession(o.initDataType,o.initData))};this.mediaKeysPromise.then(c).catch(c)},m._attemptSetMediaKeys=function(o){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys){d.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(s.Events.ERROR,{type:t.ErrorTypes.KEY_SYSTEM_ERROR,details:t.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}d.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},m._generateRequestWithPreferredKeySession=function(o,e){var c=this,h=this._mediaKeysList[0];if(!h){d.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(s.Events.ERROR,{type:t.ErrorTypes.KEY_SYSTEM_ERROR,details:t.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(h.mediaKeysSessionInitialized){d.logger.warn("Key-Session already initialized but requested again");return}var v=h.mediaKeysSession;if(!v){d.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(s.Events.ERROR,{type:t.ErrorTypes.KEY_SYSTEM_ERROR,details:t.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!e){d.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(s.Events.ERROR,{type:t.ErrorTypes.KEY_SYSTEM_ERROR,details:t.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}d.logger.log('Generating key-session request for "'+o+'" init data type'),h.mediaKeysSessionInitialized=!0,v.generateRequest(o,e).then(function(){d.logger.debug("Key-session generation succeeded")}).catch(function(a){d.logger.error("Error generating key-session request:",a),c.hls.trigger(s.Events.ERROR,{type:t.ErrorTypes.KEY_SYSTEM_ERROR,details:t.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},m._createLicenseXhr=function(o,e,c){var h=new XMLHttpRequest;h.responseType="arraybuffer",h.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,h,o,e,c);var v=this._licenseXhrSetup;if(v)try{v.call(this.hls,h,o),v=void 0}catch(a){d.logger.error(a)}try{h.readyState||h.open("POST",o,!0),v&&v.call(this.hls,h,o)}catch(a){throw new Error("issue setting up KeySystem license XHR "+a)}return h},m._onLicenseRequestReadyStageChange=function(o,e,c,h){switch(o.readyState){case 4:if(o.status===200){this._requestLicenseFailureCount=0,d.logger.log("License request succeeded");var v=o.response,a=this._licenseResponseCallback;if(a)try{v=a.call(this.hls,o,e)}catch(l){d.logger.error(l)}h(v)}else{if(d.logger.error("License Request XHR failed ("+e+"). Status: "+o.status+" ("+o.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u){this.hls.trigger(s.Events.ERROR,{type:t.ErrorTypes.KEY_SYSTEM_ERROR,details:t.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var r=u-this._requestLicenseFailureCount+1;d.logger.warn("Retrying license request, "+r+" attempts left"),this._requestLicense(c,h)}break}},m._generateLicenseRequestChallenge=function(o,e){switch(o.mediaKeySystemDomain){case I.KeySystems.WIDEVINE:return e}throw new Error("unsupported key-system: "+o.mediaKeySystemDomain)},m._requestLicense=function(o,e){d.logger.log("Requesting content license for key-system");var c=this._mediaKeysList[0];if(!c){d.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(s.Events.ERROR,{type:t.ErrorTypes.KEY_SYSTEM_ERROR,details:t.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var h=this.getLicenseServerUrl(c.mediaKeySystemDomain),v=this._createLicenseXhr(h,o,e);d.logger.log("Sending license request to URL: "+h);var a=this._generateLicenseRequestChallenge(c,o);v.send(a)}catch(r){d.logger.error("Failure requesting DRM license: "+r),this.hls.trigger(s.Events.ERROR,{type:t.ErrorTypes.KEY_SYSTEM_ERROR,details:t.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},m.onMediaAttached=function(o,e){if(!!this._emeEnabled){var c=e.media;this._media=c,c.addEventListener("encrypted",this._onMediaEncrypted)}},m.onMediaDetached=function(){var o=this._media,e=this._mediaKeysList;!o||(o.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(c){if(c.mediaKeysSession)return c.mediaKeysSession.close().catch(function(){})})).then(function(){return o.setMediaKeys(null)}).catch(function(){}))},m.onManifestParsed=function(o,e){if(!!this._emeEnabled){var c=e.levels.map(function(v){return v.audioCodec}).filter(function(v){return!!v}),h=e.levels.map(function(v){return v.videoCodec}).filter(function(v){return!!v});this._attemptKeySystemAccess(I.KeySystems.WIDEVINE,c,h)}},D(g,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),g}();C.default=p},"./src/controller/fps-controller.ts":function(P,C,n){n.r(C);var s=n("./src/events.ts"),t=n("./src/utils/logger.ts"),d=function(){function I(D){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=D,this.registerListeners()}var x=I.prototype;return x.setStreamController=function(u){this.streamController=u},x.registerListeners=function(){this.hls.on(s.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},x.unregisterListeners=function(){this.hls.off(s.Events.MEDIA_ATTACHING,this.onMediaAttaching)},x.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},x.onMediaAttaching=function(u,i){var f=this.hls.config;if(f.capLevelOnFPSDrop){var p=i.media instanceof self.HTMLVideoElement?i.media:null;this.media=p,p&&typeof p.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),f.fpsDroppedMonitoringPeriod)}},x.checkFPS=function(u,i,f){var p=performance.now();if(i){if(this.lastTime){var g=p-this.lastTime,m=f-this.lastDroppedFrames,S=i-this.lastDecodedFrames,o=1e3*m/g,e=this.hls;if(e.trigger(s.Events.FPS_DROP,{currentDropped:m,currentDecoded:S,totalDroppedFrames:f}),o>0&&m>e.config.fpsDroppedMonitoringThreshold*S){var c=e.currentLevel;t.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=c)&&(c=c-1,e.trigger(s.Events.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:e.currentLevel}),e.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=p,this.lastDroppedFrames=f,this.lastDecodedFrames=i}},x.checkFPSInterval=function(){var u=this.media;if(u)if(this.isVideoPlaybackQualityAvailable){var i=u.getVideoPlaybackQuality();this.checkFPS(u,i.totalVideoFrames,i.droppedVideoFrames)}else this.checkFPS(u,u.webkitDecodedFrameCount,u.webkitDroppedFrameCount)},I}();C.default=d},"./src/controller/fragment-finders.ts":function(P,C,n){n.r(C),n.d(C,"findFragmentByPDT",function(){return d}),n.d(C,"findFragmentByPTS",function(){return I}),n.d(C,"fragmentWithinToleranceTest",function(){return x}),n.d(C,"pdtWithinToleranceTest",function(){return D}),n.d(C,"findFragWithCC",function(){return u});var s=n("./src/polyfills/number.ts"),t=n("./src/utils/binary-search.ts");function d(i,f,p){if(f===null||!Array.isArray(i)||!i.length||!Object(s.isFiniteNumber)(f))return null;var g=i[0].programDateTime;if(f<(g||0))return null;var m=i[i.length-1].endProgramDateTime;if(f>=(m||0))return null;p=p||0;for(var S=0;S<i.length;++S){var o=i[S];if(D(f,p,o))return o}return null}function I(i,f,p,g){p===void 0&&(p=0),g===void 0&&(g=0);var m=null;if(i?m=f[i.sn-f[0].sn+1]||null:p===0&&f[0].start===0&&(m=f[0]),m&&x(p,g,m)===0)return m;var S=t.default.search(f,x.bind(null,p,g));return S||m}function x(i,f,p){i===void 0&&(i=0),f===void 0&&(f=0);var g=Math.min(f,p.duration+(p.deltaPTS?p.deltaPTS:0));return p.start+p.duration-g<=i?1:p.start-g>i&&p.start?-1:0}function D(i,f,p){var g=Math.min(f,p.duration+(p.deltaPTS?p.deltaPTS:0))*1e3,m=p.endProgramDateTime||0;return m-g>i}function u(i,f){return t.default.search(i,function(p){return p.cc<f?1:p.cc>f?-1:0})}},"./src/controller/fragment-tracker.ts":function(P,C,n){n.r(C),n.d(C,"FragmentState",function(){return d}),n.d(C,"FragmentTracker",function(){return I});var s=n("./src/events.ts"),t=n("./src/types/loader.ts"),d;(function(u){u.NOT_LOADED="NOT_LOADED",u.APPENDING="APPENDING",u.PARTIAL="PARTIAL",u.OK="OK"})(d||(d={}));var I=function(){function u(f){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=f,this._registerListeners()}var i=u.prototype;return i._registerListeners=function(){var p=this.hls;p.on(s.Events.BUFFER_APPENDED,this.onBufferAppended,this),p.on(s.Events.FRAG_BUFFERED,this.onFragBuffered,this),p.on(s.Events.FRAG_LOADED,this.onFragLoaded,this)},i._unregisterListeners=function(){var p=this.hls;p.off(s.Events.BUFFER_APPENDED,this.onBufferAppended,this),p.off(s.Events.FRAG_BUFFERED,this.onFragBuffered,this),p.off(s.Events.FRAG_LOADED,this.onFragLoaded,this)},i.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},i.getAppendedFrag=function(p,g){if(g===t.PlaylistLevelType.MAIN){var m=this.activeFragment,S=this.activeParts;if(!m)return null;if(S)for(var o=S.length;o--;){var e=S[o],c=e?e.end:m.appendedPTS;if(e.start<=p&&c!==void 0&&p<=c)return o>9&&(this.activeParts=S.slice(o-9)),e}else if(m.start<=p&&m.appendedPTS!==void 0&&p<=m.appendedPTS)return m}return this.getBufferedFrag(p,g)},i.getBufferedFrag=function(p,g){for(var m=this.fragments,S=Object.keys(m),o=S.length;o--;){var e=m[S[o]];if((e==null?void 0:e.body.type)===g&&e.buffered){var c=e.body;if(c.start<=p&&p<=c.end)return c}}return null},i.detectEvictedFragments=function(p,g,m){var S=this;Object.keys(this.fragments).forEach(function(o){var e=S.fragments[o];if(!!e){if(!e.buffered){e.body.type===m&&S.removeFragment(e.body);return}var c=e.range[p];!c||c.time.some(function(h){var v=!S.isTimeBuffered(h.startPTS,h.endPTS,g);return v&&S.removeFragment(e.body),v})}})},i.detectPartialFragments=function(p){var g=this,m=this.timeRanges,S=p.frag,o=p.part;if(!(!m||S.sn==="initSegment")){var e=D(S),c=this.fragments[e];!c||(Object.keys(m).forEach(function(h){var v=S.elementaryStreams[h];if(!!v){var a=m[h],r=o!==null||v.partial===!0;c.range[h]=g.getBufferedTimes(S,o,r,a)}}),c.loaded=null,Object.keys(c.range).length?c.buffered=!0:this.removeFragment(c.body))}},i.fragBuffered=function(p){var g=D(p),m=this.fragments[g];m&&(m.loaded=null,m.buffered=!0)},i.getBufferedTimes=function(p,g,m,S){for(var o={time:[],partial:m},e=g?g.start:p.start,c=g?g.end:p.end,h=p.minEndPTS||c,v=p.maxStartPTS||e,a=0;a<S.length;a++){var r=S.start(a)-this.bufferPadding,l=S.end(a)+this.bufferPadding;if(v>=r&&h<=l){o.time.push({startPTS:Math.max(e,S.start(a)),endPTS:Math.min(c,S.end(a))});break}else if(e<l&&c>r)o.partial=!0,o.time.push({startPTS:Math.max(e,S.start(a)),endPTS:Math.min(c,S.end(a))});else if(c<=r)break}return o},i.getPartialFragment=function(p){var g=null,m,S,o,e=0,c=this.bufferPadding,h=this.fragments;return Object.keys(h).forEach(function(v){var a=h[v];!a||x(a)&&(S=a.body.start-c,o=a.body.end+c,p>=S&&p<=o&&(m=Math.min(p-S,o-p),e<=m&&(g=a.body,e=m)))}),g},i.getState=function(p){var g=D(p),m=this.fragments[g];return m?m.buffered?x(m)?d.PARTIAL:d.OK:d.APPENDING:d.NOT_LOADED},i.isTimeBuffered=function(p,g,m){for(var S,o,e=0;e<m.length;e++){if(S=m.start(e)-this.bufferPadding,o=m.end(e)+this.bufferPadding,p>=S&&g<=o)return!0;if(g<=S)return!1}return!1},i.onFragLoaded=function(p,g){var m=g.frag,S=g.part;if(!(m.sn==="initSegment"||m.bitrateTest||S)){var o=D(m);this.fragments[o]={body:m,loaded:g,buffered:!1,range:Object.create(null)}}},i.onBufferAppended=function(p,g){var m=this,S=g.frag,o=g.part,e=g.timeRanges;if(S.type===t.PlaylistLevelType.MAIN)if(this.activeFragment=S,o){var c=this.activeParts;c||(this.activeParts=c=[]),c.push(o)}else this.activeParts=null;this.timeRanges=e,Object.keys(e).forEach(function(h){var v=e[h];if(m.detectEvictedFragments(h,v),!o)for(var a=0;a<v.length;a++)S.appendedPTS=Math.max(v.end(a),S.appendedPTS||0)})},i.onFragBuffered=function(p,g){this.detectPartialFragments(g)},i.hasFragment=function(p){var g=D(p);return!!this.fragments[g]},i.removeFragmentsInRange=function(p,g,m){var S=this;Object.keys(this.fragments).forEach(function(o){var e=S.fragments[o];if(!!e&&e.buffered){var c=e.body;c.type===m&&c.start<g&&c.end>p&&S.removeFragment(c)}})},i.removeFragment=function(p){var g=D(p);p.stats.loaded=0,p.clearElementaryStreamInfo(),delete this.fragments[g]},i.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},u}();function x(u){var i,f;return u.buffered&&(((i=u.range.video)===null||i===void 0?void 0:i.partial)||((f=u.range.audio)===null||f===void 0?void 0:f.partial))}function D(u){return u.type+"_"+u.level+"_"+u.urlId+"_"+u.sn}},"./src/controller/gap-controller.ts":function(P,C,n){n.r(C),n.d(C,"STALL_MINIMUM_DURATION_MS",function(){return x}),n.d(C,"MAX_START_GAP_JUMP",function(){return D}),n.d(C,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return u}),n.d(C,"SKIP_BUFFER_RANGE_START",function(){return i}),n.d(C,"default",function(){return f});var s=n("./src/utils/buffer-helper.ts"),t=n("./src/errors.ts"),d=n("./src/events.ts"),I=n("./src/utils/logger.ts"),x=250,D=2,u=.1,i=.05,f=function(){function p(m,S,o,e){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=m,this.media=S,this.fragmentTracker=o,this.hls=e}var g=p.prototype;return g.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},g.poll=function(S,o){var e=this.config,c=this.media,h=this.stalled;if(c!==null){var v=c.currentTime,a=c.seeking,r=this.seeking&&!a,l=!this.seeking&&a;if(this.seeking=a,v!==S){if(this.moved=!0,h!==null){if(this.stallReported){var A=self.performance.now()-h;I.logger.warn("playback not stuck anymore @"+v+", after "+Math.round(A)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((l||r)&&(this.stalled=null),!(c.paused&&!a||c.ended||c.playbackRate===0||!s.BufferHelper.getBuffered(c).length)){var T=s.BufferHelper.bufferInfo(c,v,0),b=T.len>0,L=T.nextStart||0;if(!(!b&&!L)){if(a){var E=T.len>D,y=!L||o&&o.start<=v||L-v>D&&!this.fragmentTracker.getPartialFragment(v);if(E||y)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var O,M=Math.max(L,T.start||0)-v,R=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,F=R==null||(O=R.details)===null||O===void 0?void 0:O.live,k=F?R.details.targetduration*2:D;if(M>0&&M<=k){this._trySkipBufferHole(null);return}}var w=self.performance.now();if(h===null){this.stalled=w;return}var _=w-h;if(!(!a&&_>=x&&(this._reportStall(T),!this.media))){var B=s.BufferHelper.bufferInfo(c,v,e.maxBufferHole);this._tryFixBufferStall(B,_)}}}}},g._tryFixBufferStall=function(S,o){var e=this.config,c=this.fragmentTracker,h=this.media;if(h!==null){var v=h.currentTime,a=c.getPartialFragment(v);if(a){var r=this._trySkipBufferHole(a);if(r||!this.media)return}S.len>e.maxBufferHole&&o>e.highBufferWatchdogPeriod*1e3&&(I.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},g._reportStall=function(S){var o=this.hls,e=this.media,c=this.stallReported;!c&&e&&(this.stallReported=!0,I.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer ("+JSON.stringify(S)+")"),o.trigger(d.Events.ERROR,{type:t.ErrorTypes.MEDIA_ERROR,details:t.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:S.len}))},g._trySkipBufferHole=function(S){var o=this.config,e=this.hls,c=this.media;if(c===null)return 0;for(var h=c.currentTime,v=0,a=s.BufferHelper.getBuffered(c),r=0;r<a.length;r++){var l=a.start(r);if(h+o.maxBufferHole>=v&&h<l){var A=Math.max(l+i,c.currentTime+u);return I.logger.warn("skipping hole, adjusting currentTime from "+h+" to "+A),this.moved=!0,this.stalled=null,c.currentTime=A,S&&e.trigger(d.Events.ERROR,{type:t.ErrorTypes.MEDIA_ERROR,details:t.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+h+" to "+A,frag:S}),A}v=a.end(r)}return 0},g._tryNudgeBuffer=function(){var S=this.config,o=this.hls,e=this.media,c=this.nudgeRetry;if(e!==null){var h=e.currentTime;if(this.nudgeRetry++,c<S.nudgeMaxRetry){var v=h+(c+1)*S.nudgeOffset;I.logger.warn("Nudging 'currentTime' from "+h+" to "+v),e.currentTime=v,o.trigger(d.Events.ERROR,{type:t.ErrorTypes.MEDIA_ERROR,details:t.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else I.logger.error("Playhead still not moving while enough data buffered @"+h+" after "+S.nudgeMaxRetry+" nudges"),o.trigger(d.Events.ERROR,{type:t.ErrorTypes.MEDIA_ERROR,details:t.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},p}()},"./src/controller/id3-track-controller.ts":function(P,C,n){n.r(C);var s=n("./src/polyfills/number.ts"),t=n("./src/events.ts"),d=n("./src/utils/texttrack-utils.ts"),I=n("./src/demux/id3.ts"),x=n("./src/loader/date-range.ts"),D=n("./src/types/demuxer.ts"),u=.25;function i(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function f(m,S){return m.getTime()/1e3-S}function p(m){return Uint8Array.from(m.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var g=function(){function m(o){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=o,this._registerListeners()}var S=m.prototype;return S.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},S._registerListeners=function(){var e=this.hls;e.on(t.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(t.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(t.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(t.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(t.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(t.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},S._unregisterListeners=function(){var e=this.hls;e.off(t.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(t.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(t.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(t.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(t.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(t.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},S.onMediaAttached=function(e,c){this.media=c.media},S.onMediaDetaching=function(){!this.id3Track||(Object(d.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},S.onManifestLoading=function(){this.dateRangeCuesAppended={}},S.createTrack=function(e){var c=this.getID3Track(e.textTracks);return c.mode="hidden",c},S.getID3Track=function(e){if(!!this.media){for(var c=0;c<e.length;c++){var h=e[c];if(h.kind==="metadata"&&h.label==="id3")return Object(d.sendAddTrackEvent)(h,this.media),h}return this.media.addTextTrack("metadata","id3")}},S.onFragParsingMetadata=function(e,c){if(!!this.media){var h=this.hls.config,v=h.enableEmsgMetadataCues,a=h.enableID3MetadataCues;if(!(!v&&!a)){var r=c.frag,l=c.samples,A=c.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var T=A.edge||r.end,b=i(),L=!1,E={},y=0;y<l.length;y++){var O=l[y].type;if(!(O===D.MetadataSchema.emsg&&!v||!a)){var M=I.getID3Frames(l[y].data);if(M){var R=l[y].pts,F=T,k=F-R;k<=0&&(F=R+u);for(var w=0;w<M.length;w++){var _=M[w];if(!I.isTimeStampFrame(_)){var B=new b(R,F,"");B.value=_,O&&(B.type=O),this.id3Track.addCue(B),E[_.key]=null,L=!0}}}}}L&&this.updateId3CueEnds(E)}}},S.updateId3CueEnds=function(e){var c,h=(c=this.id3Track)===null||c===void 0?void 0:c.cues;if(h)for(var v=h.length;v--;){var a,r=h[v],l=(a=r.value)===null||a===void 0?void 0:a.key;if(l&&l in e){var A=e[l];A&&r.endTime!==A&&(r.endTime=A),e[l]=r.startTime}}},S.onBufferFlushing=function(e,c){var h=c.startOffset,v=c.endOffset,a=c.type,r=this.id3Track,l=this.hls;if(!!l){var A=l.config,T=A.enableEmsgMetadataCues,b=A.enableID3MetadataCues;if(r&&(T||b)){var L;a==="audio"?L=function(y){return y.type===D.MetadataSchema.audioId3&&b}:a==="video"?L=function(y){return y.type===D.MetadataSchema.emsg&&T}:L=function(y){return y.type===D.MetadataSchema.audioId3&&b||y.type===D.MetadataSchema.emsg&&T},Object(d.removeCuesInRange)(r,h,v,L)}}},S.onLevelUpdated=function(e,c){var h=this,v=c.details;if(!(!this.media||!v.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var a=this.dateRangeCuesAppended,r=this.id3Track,l=v.dateRanges,A=Object.keys(l);if(r)for(var T=Object.keys(a).filter(function(k){return!A.includes(k)}),b=function(w){var _=T[w];Object.keys(a[_].cues).forEach(function(B){r.removeCue(a[_].cues[B])}),delete a[_]},L=T.length;L--;)b(L);var E=v.fragments[v.fragments.length-1];if(!(A.length===0||!Object(s.isFiniteNumber)(E==null?void 0:E.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var y=E.programDateTime/1e3-E.start,O=v.edge||E.end,M=i(),R=function(w){var _=A[w],B=l[_],N=a[_],U=(N==null?void 0:N.cues)||{},j=(N==null?void 0:N.durationKnown)||!1,K=f(B.startDate,y),H=O,G=B.endDate;if(G)H=f(G,y),j=!0;else if(B.endOnNext&&!j){var W=A.reduce(function(Q,q){var tt=l[q];return tt.class===B.class&&tt.id!==q&&tt.startDate>B.startDate&&Q.push(tt),Q},[]).sort(function(Q,q){return Q.startDate.getTime()-q.startDate.getTime()})[0];W&&(H=f(W.startDate,y),j=!0)}for(var X=Object.keys(B.attr),V=0;V<X.length;V++){var J=X[V];if(!(J===x.DateRangeAttribute.ID||J===x.DateRangeAttribute.CLASS||J===x.DateRangeAttribute.START_DATE||J===x.DateRangeAttribute.DURATION||J===x.DateRangeAttribute.END_DATE||J===x.DateRangeAttribute.END_ON_NEXT)){var $=U[J];if($)j&&!N.durationKnown&&($.endTime=H);else{var z=B.attr[J];$=new M(K,H,""),(J===x.DateRangeAttribute.SCTE35_OUT||J===x.DateRangeAttribute.SCTE35_IN)&&(z=p(z)),$.value={key:J,data:z},$.type=D.MetadataSchema.dateRange,h.id3Track.addCue($),U[J]=$}}}a[_]={cues:U,dateRange:B,durationKnown:j}},F=0;F<A.length;F++)R(F)}}},m}();C.default=g},"./src/controller/latency-controller.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return D});var s=n("./src/errors.ts"),t=n("./src/events.ts"),d=n("./src/utils/logger.ts");function I(u,i){for(var f=0;f<i.length;f++){var p=i[f];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(u,p.key,p)}}function x(u,i,f){return i&&I(u.prototype,i),f&&I(u,f),Object.defineProperty(u,"prototype",{writable:!1}),u}var D=function(){function u(f){var p=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return p.timeupdate()},this.hls=f,this.config=f.config,this.registerListeners()}var i=u.prototype;return i.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},i.registerListeners=function(){this.hls.on(t.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(t.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(t.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(t.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(t.Events.ERROR,this.onError,this)},i.unregisterListeners=function(){this.hls.off(t.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(t.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(t.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(t.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(t.Events.ERROR,this.onError)},i.onMediaAttached=function(p,g){this.media=g.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},i.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},i.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},i.onLevelUpdated=function(p,g){var m=g.details;this.levelDetails=m,m.advanced&&this.timeupdate(),!m.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},i.onError=function(p,g){g.details===s.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,d.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},i.timeupdate=function(){var p=this.media,g=this.levelDetails;if(!(!p||!g)){this.currentTime=p.currentTime;var m=this.computeLatency();if(m!==null){this._latency=m;var S=this.config,o=S.lowLatencyMode,e=S.maxLiveSyncPlaybackRate;if(!(!o||e===1)){var c=this.targetLatency;if(c!==null){var h=m-c,v=Math.min(this.maxLatency,c+g.targetduration),a=h<v;if(g.live&&a&&h>.05&&this.forwardBufferLength>1){var r=Math.min(2,Math.max(1,e)),l=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20;p.playbackRate=Math.min(r,Math.max(1,l))}else p.playbackRate!==1&&p.playbackRate!==0&&(p.playbackRate=1)}}}}},i.estimateLiveEdge=function(){var p=this.levelDetails;return p===null?null:p.edge+p.age},i.computeLatency=function(){var p=this.estimateLiveEdge();return p===null?null:p-this.currentTime},x(u,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var p=this.config,g=this.levelDetails;return p.liveMaxLatencyDuration!==void 0?p.liveMaxLatencyDuration:g?p.liveMaxLatencyDurationCount*g.targetduration:0}},{key:"targetLatency",get:function(){var p=this.levelDetails;if(p===null)return null;var g=p.holdBack,m=p.partHoldBack,S=p.targetduration,o=this.config,e=o.liveSyncDuration,c=o.liveSyncDurationCount,h=o.lowLatencyMode,v=this.hls.userConfig,a=h&&m||g;(v.liveSyncDuration||v.liveSyncDurationCount||a===0)&&(a=e!==void 0?e:c*S);var r=S,l=1;return a+Math.min(this.stallCount*l,r)}},{key:"liveSyncPosition",get:function(){var p=this.estimateLiveEdge(),g=this.targetLatency,m=this.levelDetails;if(p===null||g===null||m===null)return null;var S=m.edge,o=p-g-this.edgeStalled,e=S-m.totalduration,c=S-(this.config.lowLatencyMode&&m.partTarget||m.targetduration);return Math.min(Math.max(e,o),c)}},{key:"drift",get:function(){var p=this.levelDetails;return p===null?1:p.drift}},{key:"edgeStalled",get:function(){var p=this.levelDetails;if(p===null)return 0;var g=(this.config.lowLatencyMode&&p.partTarget||p.targetduration)*3;return Math.max(p.age-g,0)}},{key:"forwardBufferLength",get:function(){var p=this.media,g=this.levelDetails;if(!p||!g)return 0;var m=p.buffered.length;return(m?p.buffered.end(m-1):g.edge)-this.currentTime}}]),u}()},"./src/controller/level-controller.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return o});var s=n("./src/types/level.ts"),t=n("./src/events.ts"),d=n("./src/errors.ts"),I=n("./src/utils/codecs.ts"),x=n("./src/controller/level-helper.ts"),D=n("./src/controller/base-playlist-controller.ts"),u=n("./src/types/loader.ts");function i(){return i=Object.assign?Object.assign.bind():function(e){for(var c=1;c<arguments.length;c++){var h=arguments[c];for(var v in h)Object.prototype.hasOwnProperty.call(h,v)&&(e[v]=h[v])}return e},i.apply(this,arguments)}function f(e,c){for(var h=0;h<c.length;h++){var v=c[h];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(e,v.key,v)}}function p(e,c,h){return c&&f(e.prototype,c),h&&f(e,h),Object.defineProperty(e,"prototype",{writable:!1}),e}function g(e,c){e.prototype=Object.create(c.prototype),e.prototype.constructor=e,m(e,c)}function m(e,c){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,a){return v.__proto__=a,v},m(e,c)}var S=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),o=function(e){g(c,e);function c(v){var a;return a=e.call(this,v,"[level-controller]")||this,a._levels=[],a._firstLevel=-1,a._startLevel=void 0,a.currentLevelIndex=-1,a.manualLevelIndex=-1,a.onParsedComplete=void 0,a._registerListeners(),a}var h=c.prototype;return h._registerListeners=function(){var a=this.hls;a.on(t.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.on(t.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(t.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.on(t.Events.FRAG_LOADED,this.onFragLoaded,this),a.on(t.Events.ERROR,this.onError,this)},h._unregisterListeners=function(){var a=this.hls;a.off(t.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.off(t.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(t.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.off(t.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(t.Events.ERROR,this.onError,this)},h.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},h.startLoad=function(){var a=this._levels;a.forEach(function(r){r.loadError=0}),e.prototype.startLoad.call(this)},h.onManifestLoaded=function(a,r){var l=[],A=[],T=[],b,L={},E,y=!1,O=!1,M=!1;if(r.levels.forEach(function(w){var _=w.attrs;y=y||!!(w.width&&w.height),O=O||!!w.videoCodec,M=M||!!w.audioCodec,S&&w.audioCodec&&w.audioCodec.indexOf("mp4a.40.34")!==-1&&(w.audioCodec=void 0);var B=w.bitrate+"-"+w.attrs.RESOLUTION+"-"+w.attrs.CODECS;E=L[B],E?E.url.push(w.url):(E=new s.Level(w),L[B]=E,l.push(E)),_&&(_.AUDIO&&Object(x.addGroupId)(E,"audio",_.AUDIO),_.SUBTITLES&&Object(x.addGroupId)(E,"text",_.SUBTITLES))}),(y||O)&&M&&(l=l.filter(function(w){var _=w.videoCodec,B=w.width,N=w.height;return!!_||!!(B&&N)})),l=l.filter(function(w){var _=w.audioCodec,B=w.videoCodec;return(!_||Object(I.isCodecSupportedInMp4)(_,"audio"))&&(!B||Object(I.isCodecSupportedInMp4)(B,"video"))}),r.audioTracks&&(A=r.audioTracks.filter(function(w){return!w.audioCodec||Object(I.isCodecSupportedInMp4)(w.audioCodec,"audio")}),Object(x.assignTrackIdsByGroup)(A)),r.subtitles&&(T=r.subtitles,Object(x.assignTrackIdsByGroup)(T)),l.length>0){b=l[0].bitrate,l.sort(function(w,_){return w.bitrate-_.bitrate}),this._levels=l;for(var R=0;R<l.length;R++)if(l[R].bitrate===b){this._firstLevel=R,this.log("manifest loaded, "+l.length+" level(s) found, first bitrate: "+b);break}var F=M&&!O,k={levels:l,audioTracks:A,subtitleTracks:T,firstLevel:this._firstLevel,stats:r.stats,audio:M,video:O,altAudio:!F&&A.some(function(w){return!!w.url})};this.hls.trigger(t.Events.MANIFEST_PARSED,k),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(t.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:r.url,reason:"no level with compatible codecs found in manifest"})},h.onError=function(a,r){if(e.prototype.onError.call(this,a,r),!r.fatal){var l=r.context,A=this._levels[this.currentLevelIndex];if(l&&(l.type===u.PlaylistContextType.AUDIO_TRACK&&A.audioGroupIds&&l.groupId===A.audioGroupIds[A.urlId]||l.type===u.PlaylistContextType.SUBTITLE_TRACK&&A.textGroupIds&&l.groupId===A.textGroupIds[A.urlId])){this.redundantFailover(this.currentLevelIndex);return}var T=!1,b=!0,L;switch(r.details){case d.ErrorDetails.FRAG_LOAD_ERROR:case d.ErrorDetails.FRAG_LOAD_TIMEOUT:case d.ErrorDetails.KEY_LOAD_ERROR:case d.ErrorDetails.KEY_LOAD_TIMEOUT:if(r.frag){var E=this._levels[r.frag.level];E?(E.fragmentError++,E.fragmentError>this.hls.config.fragLoadingMaxRetry&&(L=r.frag.level)):L=r.frag.level}break;case d.ErrorDetails.LEVEL_LOAD_ERROR:case d.ErrorDetails.LEVEL_LOAD_TIMEOUT:l&&(l.deliveryDirectives&&(b=!1),L=l.level),T=!0;break;case d.ErrorDetails.REMUX_ALLOC_ERROR:L=r.level,T=!0;break}L!==void 0&&this.recoverLevel(r,L,T,b)}},h.recoverLevel=function(a,r,l,A){var T=a.details,b=this._levels[r];if(b.loadError++,l){var L=this.retryLoadingOrFail(a);if(L)a.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(A){var E=b.url.length;if(E>1&&b.loadError<E)a.levelRetry=!0,this.redundantFailover(r);else if(this.manualLevelIndex===-1){var y=r===0?this._levels.length-1:r-1;this.currentLevelIndex!==y&&this._levels[y].loadError===0&&(this.warn(T+": switch to "+y),a.levelRetry=!0,this.hls.nextAutoLevel=y)}}},h.redundantFailover=function(a){var r=this._levels[a],l=r.url.length;if(l>1){var A=(r.urlId+1)%l;this.warn("Switching to redundant URL-id "+A),this._levels.forEach(function(T){T.urlId=A}),this.level=a}},h.onFragLoaded=function(a,r){var l=r.frag;if(l!==void 0&&l.type===u.PlaylistLevelType.MAIN){var A=this._levels[l.level];A!==void 0&&(A.fragmentError=0,A.loadError=0)}},h.onLevelLoaded=function(a,r){var l,A=r.level,T=r.details,b=this._levels[A];if(!b){var L;this.warn("Invalid level index "+A),(L=r.deliveryDirectives)!==null&&L!==void 0&&L.skip&&(T.deltaUpdateFailed=!0);return}A===this.currentLevelIndex?(b.fragmentError===0&&(b.loadError=0,this.retryCount=0),this.playlistLoaded(A,r,b.details)):(l=r.deliveryDirectives)!==null&&l!==void 0&&l.skip&&(T.deltaUpdateFailed=!0)},h.onAudioTrackSwitched=function(a,r){var l=this.hls.levels[this.currentLevelIndex];if(!!l&&l.audioGroupIds){for(var A=-1,T=this.hls.audioTracks[r.id].groupId,b=0;b<l.audioGroupIds.length;b++)if(l.audioGroupIds[b]===T){A=b;break}A!==l.urlId&&(l.urlId=A,this.startLoad())}},h.loadPlaylist=function(a){var r=this.currentLevelIndex,l=this._levels[r];if(this.canLoad&&l&&l.url.length>0){var A=l.urlId,T=l.url[A];if(a)try{T=a.addDirectives(T)}catch(b){this.warn("Could not construct new URL with HLS Delivery Directives: "+b)}this.log("Attempt loading level index "+r+(a?" at sn "+a.msn+" part "+a.part:"")+" with URL-id "+A+" "+T),this.clearTimer(),this.hls.trigger(t.Events.LEVEL_LOADING,{url:T,level:r,id:A,deliveryDirectives:a||null})}},h.removeLevel=function(a,r){var l=function(b,L){return L!==r},A=this._levels.filter(function(T,b){return b!==a?!0:T.url.length>1&&r!==void 0?(T.url=T.url.filter(l),T.audioGroupIds&&(T.audioGroupIds=T.audioGroupIds.filter(l)),T.textGroupIds&&(T.textGroupIds=T.textGroupIds.filter(l)),T.urlId=0,!0):!1}).map(function(T,b){var L=T.details;return L!=null&&L.fragments&&L.fragments.forEach(function(E){E.level=b}),T});this._levels=A,this.hls.trigger(t.Events.LEVELS_UPDATED,{levels:A})},p(c,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(a){var r,l=this._levels;if(l.length!==0&&!(this.currentLevelIndex===a&&(r=l[a])!==null&&r!==void 0&&r.details)){if(a<0||a>=l.length){var A=a<0;if(this.hls.trigger(t.Events.ERROR,{type:d.ErrorTypes.OTHER_ERROR,details:d.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:A,reason:"invalid level idx"}),A)return;a=Math.min(a,l.length-1)}this.clearTimer();var T=this.currentLevelIndex,b=l[T],L=l[a];this.log("switching to level "+a+" from "+T),this.currentLevelIndex=a;var E=i({},L,{level:a,maxBitrate:L.maxBitrate,uri:L.uri,urlId:L.urlId});delete E._urlId,this.hls.trigger(t.Events.LEVEL_SWITCHING,E);var y=L.details;if(!y||y.live){var O=this.switchParams(L.uri,b==null?void 0:b.details);this.loadPlaylist(O)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(a){this.manualLevelIndex=a,this._startLevel===void 0&&(this._startLevel=a),a!==-1&&(this.level=a)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(a){this._firstLevel=a}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var a=this.hls.config.startLevel;return a!==void 0?a:this._firstLevel}else return this._startLevel},set:function(a){this._startLevel=a}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(a){this.level=a,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=a)}}]),c}(D.default)},"./src/controller/level-helper.ts":function(P,C,n){n.r(C),n.d(C,"addGroupId",function(){return x}),n.d(C,"assignTrackIdsByGroup",function(){return D}),n.d(C,"updatePTS",function(){return u}),n.d(C,"updateFragPTSDTS",function(){return f}),n.d(C,"mergeDetails",function(){return p}),n.d(C,"mapPartIntersection",function(){return m}),n.d(C,"mapFragmentIntersection",function(){return S}),n.d(C,"adjustSliding",function(){return o}),n.d(C,"addSliding",function(){return e}),n.d(C,"computeReloadInterval",function(){return c}),n.d(C,"getFragmentWithSN",function(){return h}),n.d(C,"getPartWith",function(){return v});var s=n("./src/polyfills/number.ts"),t=n("./src/utils/logger.ts"),d=n("./src/loader/date-range.ts");function I(){return I=Object.assign?Object.assign.bind():function(a){for(var r=1;r<arguments.length;r++){var l=arguments[r];for(var A in l)Object.prototype.hasOwnProperty.call(l,A)&&(a[A]=l[A])}return a},I.apply(this,arguments)}function x(a,r,l){switch(r){case"audio":a.audioGroupIds||(a.audioGroupIds=[]),a.audioGroupIds.push(l);break;case"text":a.textGroupIds||(a.textGroupIds=[]),a.textGroupIds.push(l);break}}function D(a){var r={};a.forEach(function(l){var A=l.groupId||"";l.id=r[A]=r[A]||0,r[A]++})}function u(a,r,l){var A=a[r],T=a[l];i(A,T)}function i(a,r){var l=r.startPTS;if(Object(s.isFiniteNumber)(l)){var A=0,T;r.sn>a.sn?(A=l-a.start,T=a):(A=a.start-l,T=r),T.duration!==A&&(T.duration=A)}else if(r.sn>a.sn){var b=a.cc===r.cc;b&&a.minEndPTS?r.start=a.start+(a.minEndPTS-a.start):r.start=a.start+a.duration}else r.start=Math.max(a.start-r.duration,0)}function f(a,r,l,A,T,b){var L=A-l;L<=0&&(t.logger.warn("Fragment should have a positive duration",r),A=l+r.duration,b=T+r.duration);var E=l,y=A,O=r.startPTS,M=r.endPTS;if(Object(s.isFiniteNumber)(O)){var R=Math.abs(O-l);Object(s.isFiniteNumber)(r.deltaPTS)?r.deltaPTS=Math.max(R,r.deltaPTS):r.deltaPTS=R,E=Math.max(l,O),l=Math.min(l,O),T=Math.min(T,r.startDTS),y=Math.min(A,M),A=Math.max(A,M),b=Math.max(b,r.endDTS)}r.duration=A-l;var F=l-r.start;r.appendedPTS=A,r.start=r.startPTS=l,r.maxStartPTS=E,r.startDTS=T,r.endPTS=A,r.minEndPTS=y,r.endDTS=b;var k=r.sn;if(!a||k<a.startSN||k>a.endSN)return 0;var w,_=k-a.startSN,B=a.fragments;for(B[_]=r,w=_;w>0;w--)i(B[w],B[w-1]);for(w=_;w<B.length-1;w++)i(B[w],B[w+1]);return a.fragmentHint&&i(B[B.length-1],a.fragmentHint),a.PTSKnown=a.alignedSliding=!0,F}function p(a,r){for(var l=null,A=a.fragments,T=A.length-1;T>=0;T--){var b=A[T].initSegment;if(b){l=b;break}}a.fragmentHint&&delete a.fragmentHint.endPTS;var L=0,E;if(S(a,r,function(w,_){w.relurl&&(L=w.cc-_.cc),Object(s.isFiniteNumber)(w.startPTS)&&Object(s.isFiniteNumber)(w.endPTS)&&(_.start=_.startPTS=w.startPTS,_.startDTS=w.startDTS,_.appendedPTS=w.appendedPTS,_.maxStartPTS=w.maxStartPTS,_.endPTS=w.endPTS,_.endDTS=w.endDTS,_.minEndPTS=w.minEndPTS,_.duration=w.endPTS-w.startPTS,_.duration&&(E=_),r.PTSKnown=r.alignedSliding=!0),_.elementaryStreams=w.elementaryStreams,_.loader=w.loader,_.stats=w.stats,_.urlId=w.urlId,w.initSegment&&(_.initSegment=w.initSegment,l=w.initSegment)}),l){var y=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;y.forEach(function(w){var _;(!w.initSegment||w.initSegment.relurl===((_=l)===null||_===void 0?void 0:_.relurl))&&(w.initSegment=l)})}if(r.skippedSegments)if(r.deltaUpdateFailed=r.fragments.some(function(w){return!w}),r.deltaUpdateFailed){t.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var O=r.skippedSegments;O--;)r.fragments.shift();r.startSN=r.fragments[0].sn,r.startCC=r.fragments[0].cc}else r.canSkipDateRanges&&(r.dateRanges=g(a.dateRanges,r.dateRanges,r.recentlyRemovedDateranges));var M=r.fragments;if(L){t.logger.warn("discontinuity sliding from playlist, take drift into account");for(var R=0;R<M.length;R++)M[R].cc+=L}r.skippedSegments&&(r.startCC=r.fragments[0].cc),m(a.partList,r.partList,function(w,_){_.elementaryStreams=w.elementaryStreams,_.stats=w.stats}),E?f(r,E,E.startPTS,E.endPTS,E.startDTS,E.endDTS):o(a,r),M.length&&(r.totalduration=r.edge-M[0].start),r.driftStartTime=a.driftStartTime,r.driftStart=a.driftStart;var F=r.advancedDateTime;if(r.advanced&&F){var k=r.edge;r.driftStart||(r.driftStartTime=F,r.driftStart=k),r.driftEndTime=F,r.driftEnd=k}else r.driftEndTime=a.driftEndTime,r.driftEnd=a.driftEnd,r.advancedDateTime=a.advancedDateTime}function g(a,r,l){var A=I({},a);return l&&l.forEach(function(T){delete A[T]}),Object.keys(r).forEach(function(T){var b=new d.DateRange(r[T].attr,A[T]);b.isValid?A[T]=b:t.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(r[T].attr)+'"')}),A}function m(a,r,l){if(a&&r)for(var A=0,T=0,b=a.length;T<=b;T++){var L=a[T],E=r[T+A];L&&E&&L.index===E.index&&L.fragment.sn===E.fragment.sn?l(L,E):A--}}function S(a,r,l){for(var A=r.skippedSegments,T=Math.max(a.startSN,r.startSN)-r.startSN,b=(a.fragmentHint?1:0)+(A?r.endSN:Math.min(a.endSN,r.endSN))-r.startSN,L=r.startSN-a.startSN,E=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments,y=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments,O=T;O<=b;O++){var M=y[L+O],R=E[O];A&&!R&&O<A&&(R=r.fragments[O]=M),M&&R&&l(M,R)}}function o(a,r){var l=r.startSN+r.skippedSegments-a.startSN,A=a.fragments;l<0||l>=A.length||e(r,A[l].start)}function e(a,r){if(r){for(var l=a.fragments,A=a.skippedSegments;A<l.length;A++)l[A].start+=r;a.fragmentHint&&(a.fragmentHint.start+=r)}}function c(a,r){var l=1e3*a.levelTargetDuration,A=l/2,T=a.age,b=T>0&&T<l*3,L=r.loading.end-r.loading.start,E,y=a.availabilityDelay;if(a.updated===!1)if(b){var O=333*a.misses;E=Math.max(Math.min(A,L*2),O),a.availabilityDelay=(a.availabilityDelay||0)+E}else E=A;else b?(y=Math.min(y||l/2,T),a.availabilityDelay=y,E=y+l-T):E=l-L;return Math.round(E)}function h(a,r,l){if(!a||!a.details)return null;var A=a.details,T=A.fragments[r-A.startSN];return T||(T=A.fragmentHint,T&&T.sn===r)?T:r<A.startSN&&l&&l.sn===r?l:null}function v(a,r,l){if(!a||!a.details)return null;var A=a.details.partList;if(A)for(var T=A.length;T--;){var b=A[T];if(b.index===l&&b.fragment.sn===r)return b}return null}},"./src/controller/stream-controller.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return v});var s=n("./src/polyfills/number.ts"),t=n("./src/controller/base-stream-controller.ts"),d=n("./src/is-supported.ts"),I=n("./src/events.ts"),x=n("./src/utils/buffer-helper.ts"),D=n("./src/controller/fragment-tracker.ts"),u=n("./src/types/loader.ts"),i=n("./src/loader/fragment.ts"),f=n("./src/demux/transmuxer-interface.ts"),p=n("./src/types/transmuxer.ts"),g=n("./src/controller/gap-controller.ts"),m=n("./src/errors.ts");function S(a,r){for(var l=0;l<r.length;l++){var A=r[l];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(a,A.key,A)}}function o(a,r,l){return r&&S(a.prototype,r),l&&S(a,l),Object.defineProperty(a,"prototype",{writable:!1}),a}function e(a,r){a.prototype=Object.create(r.prototype),a.prototype.constructor=a,c(a,r)}function c(a,r){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(A,T){return A.__proto__=T,A},c(a,r)}var h=100,v=function(a){e(r,a);function r(A,T){var b;return b=a.call(this,A,T,"[stream-controller]")||this,b.audioCodecSwap=!1,b.gapController=null,b.level=-1,b._forceStartLoad=!1,b.altAudio=!1,b.audioOnly=!1,b.fragPlaying=null,b.onvplaying=null,b.onvseeked=null,b.fragLastKbps=0,b.couldBacktrack=!1,b.backtrackFragment=null,b.audioCodecSwitch=!1,b.videoBuffer=null,b._registerListeners(),b}var l=r.prototype;return l._registerListeners=function(){var T=this.hls;T.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),T.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),T.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),T.on(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),T.on(I.Events.LEVEL_LOADING,this.onLevelLoading,this),T.on(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),T.on(I.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),T.on(I.Events.ERROR,this.onError,this),T.on(I.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),T.on(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),T.on(I.Events.BUFFER_CREATED,this.onBufferCreated,this),T.on(I.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),T.on(I.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),T.on(I.Events.FRAG_BUFFERED,this.onFragBuffered,this)},l._unregisterListeners=function(){var T=this.hls;T.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),T.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),T.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),T.off(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),T.off(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),T.off(I.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),T.off(I.Events.ERROR,this.onError,this),T.off(I.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),T.off(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),T.off(I.Events.BUFFER_CREATED,this.onBufferCreated,this),T.off(I.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),T.off(I.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),T.off(I.Events.FRAG_BUFFERED,this.onFragBuffered,this)},l.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},l.startLoad=function(T){if(this.levels){var b=this.lastCurrentTime,L=this.hls;if(this.stopLoad(),this.setInterval(h),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var E=L.startLevel;E===-1&&(L.config.testBandwidth?(E=0,this.bitrateTest=!0):E=L.nextAutoLevel),this.level=L.nextLoadLevel=E,this.loadedmetadata=!1}b>0&&T===-1&&(this.log("Override startPosition with lastCurrentTime @"+b.toFixed(3)),T=b),this.state=t.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=T,this.tick()}else this._forceStartLoad=!0,this.state=t.State.STOPPED},l.stopLoad=function(){this._forceStartLoad=!1,a.prototype.stopLoad.call(this)},l.doTick=function(){switch(this.state){case t.State.IDLE:this.doTickIdle();break;case t.State.WAITING_LEVEL:{var T,b=this.levels,L=this.level,E=b==null||(T=b[L])===null||T===void 0?void 0:T.details;if(E&&(!E.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(E))break;this.state=t.State.IDLE;break}break}case t.State.FRAG_LOADING_WAITING_RETRY:{var y,O=self.performance.now(),M=this.retryDate;(!M||O>=M||(y=this.media)!==null&&y!==void 0&&y.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=t.State.IDLE)}break}this.onTickEnd()},l.onTickEnd=function(){a.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},l.doTickIdle=function(){var T,b,L=this.hls,E=this.levelLastLoaded,y=this.levels,O=this.media,M=L.config,R=L.nextLoadLevel;if(!(E===null||!O&&(this.startFragRequested||!M.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!y||!y[R])){var F=y[R];this.level=L.nextLoadLevel=R;var k=F.details;if(!k||this.state===t.State.WAITING_LEVEL||k.live&&this.levelLastLoaded!==R){this.state=t.State.WAITING_LEVEL;return}var w=this.getMainFwdBufferInfo();if(w!==null){var _=w.len,B=this.getMaxBufferLength(F.maxBitrate);if(!(_>=B)){if(this._streamEnded(w,k)){var N={};this.altAudio&&(N.type="video"),this.hls.trigger(I.Events.BUFFER_EOS,N),this.state=t.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>w.end&&(this.backtrackFragment=null);var U=this.backtrackFragment?this.backtrackFragment.start:w.end,j=this.getNextFragment(U,k);if(this.couldBacktrack&&!this.fragPrevious&&j&&j.sn!=="initSegment"&&this.fragmentTracker.getState(j)!==D.FragmentState.OK){var K,H=((K=this.backtrackFragment)!=null?K:j).sn,G=H-k.startSN,W=k.fragments[G-1];W&&j.cc===W.cc&&(j=W,this.fragmentTracker.removeFragment(W))}else this.backtrackFragment&&w.len&&(this.backtrackFragment=null);if(j&&this.fragmentTracker.getState(j)===D.FragmentState.OK&&this.nextLoadPosition>U){var X=this.audioOnly&&!this.altAudio?i.ElementaryStreamTypes.AUDIO:i.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(O,X,u.PlaylistLevelType.MAIN),j=this.getNextFragment(this.nextLoadPosition,k)}!j||(j.initSegment&&!j.initSegment.data&&!this.bitrateTest&&(j=j.initSegment),((T=j.decryptdata)===null||T===void 0?void 0:T.keyFormat)==="identity"&&!((b=j.decryptdata)!==null&&b!==void 0&&b.key)?this.loadKey(j,k):this.loadFragment(j,k,U))}}}},l.loadFragment=function(T,b,L){var E,y=this.fragmentTracker.getState(T);this.fragCurrent=T,y===D.FragmentState.NOT_LOADED||y===D.FragmentState.PARTIAL?T.sn==="initSegment"?this._loadInitSegment(T):this.bitrateTest?(T.bitrateTest=!0,this.log("Fragment "+T.sn+" of level "+T.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(T)):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,T,b,L)):y===D.FragmentState.APPENDING?this.reduceMaxBufferLength(T.duration)&&this.fragmentTracker.removeFragment(T):((E=this.media)===null||E===void 0?void 0:E.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},l.getAppendedFrag=function(T){var b=this.fragmentTracker.getAppendedFrag(T,u.PlaylistLevelType.MAIN);return b&&"fragment"in b?b.fragment:b},l.getBufferedFrag=function(T){return this.fragmentTracker.getBufferedFrag(T,u.PlaylistLevelType.MAIN)},l.followingBufferedFrag=function(T){return T?this.getBufferedFrag(T.end+.5):null},l.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},l.nextLevelSwitch=function(){var T=this.levels,b=this.media;if(b!=null&&b.readyState){var L,E=this.getAppendedFrag(b.currentTime);if(E&&E.start>1&&this.flushMainBuffer(0,E.start-1),!b.paused&&T){var y=this.hls.nextLoadLevel,O=T[y],M=this.fragLastKbps;M&&this.fragCurrent?L=this.fragCurrent.duration*O.maxBitrate/(1e3*M)+1:L=0}else L=0;var R=this.getBufferedFrag(b.currentTime+L);if(R){var F=this.followingBufferedFrag(R);if(F){this.abortCurrentFrag();var k=F.maxStartPTS?F.maxStartPTS:F.start,w=F.duration,_=Math.max(R.end,k+Math.min(Math.max(w-this.config.maxFragLookUpTolerance,w*.5),w*.75));this.flushMainBuffer(_,Number.POSITIVE_INFINITY)}}}},l.abortCurrentFrag=function(){var T=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,T!=null&&T.loader&&T.loader.abort(),this.state){case t.State.KEY_LOADING:case t.State.FRAG_LOADING:case t.State.FRAG_LOADING_WAITING_RETRY:case t.State.PARSING:case t.State.PARSED:this.state=t.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},l.flushMainBuffer=function(T,b){a.prototype.flushMainBuffer.call(this,T,b,this.altAudio?"video":null)},l.onMediaAttached=function(T,b){a.prototype.onMediaAttached.call(this,T,b);var L=b.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),L.addEventListener("playing",this.onvplaying),L.addEventListener("seeked",this.onvseeked),this.gapController=new g.default(this.config,L,this.fragmentTracker,this.hls)},l.onMediaDetaching=function(){var T=this.media;T&&(T.removeEventListener("playing",this.onvplaying),T.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),a.prototype.onMediaDetaching.call(this)},l.onMediaPlaying=function(){this.tick()},l.onMediaSeeked=function(){var T=this.media,b=T?T.currentTime:null;Object(s.isFiniteNumber)(b)&&this.log("Media seeked to "+b.toFixed(3)),this.tick()},l.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(I.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},l.onManifestParsed=function(T,b){var L=!1,E=!1,y;b.levels.forEach(function(O){y=O.audioCodec,y&&(y.indexOf("mp4a.40.2")!==-1&&(L=!0),y.indexOf("mp4a.40.5")!==-1&&(E=!0))}),this.audioCodecSwitch=L&&E&&!Object(d.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=b.levels,this.startFragRequested=!1},l.onLevelLoading=function(T,b){var L=this.levels;if(!(!L||this.state!==t.State.IDLE)){var E=L[b.level];(!E.details||E.details.live&&this.levelLastLoaded!==b.level||this.waitForCdnTuneIn(E.details))&&(this.state=t.State.WAITING_LEVEL)}},l.onLevelLoaded=function(T,b){var L,E=this.levels,y=b.level,O=b.details,M=O.totalduration;if(!E){this.warn("Levels were reset while loading level "+y);return}this.log("Level "+y+" loaded ["+O.startSN+","+O.endSN+"], cc ["+O.startCC+", "+O.endCC+"] duration:"+M);var R=this.fragCurrent;R&&(this.state===t.State.FRAG_LOADING||this.state===t.State.FRAG_LOADING_WAITING_RETRY)&&R.level!==b.level&&R.loader&&(this.state=t.State.IDLE,this.backtrackFragment=null,R.loader.abort());var F=E[y],k=0;if(O.live||(L=F.details)!==null&&L!==void 0&&L.live){if(O.fragments[0]||(O.deltaUpdateFailed=!0),O.deltaUpdateFailed)return;k=this.alignPlaylists(O,F.details)}if(F.details=O,this.levelLastLoaded=y,this.hls.trigger(I.Events.LEVEL_UPDATED,{details:O,level:y}),this.state===t.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(O))return;this.state=t.State.IDLE}this.startFragRequested?O.live&&this.synchronizeToLiveEdge(O):this.setStartPosition(O,k),this.tick()},l._handleFragmentLoadProgress=function(T){var b,L=T.frag,E=T.part,y=T.payload,O=this.levels;if(!O){this.warn("Levels were reset while fragment load was in progress. Fragment "+L.sn+" of level "+L.level+" will not be buffered");return}var M=O[L.level],R=M.details;if(!R){this.warn("Dropping fragment "+L.sn+" of level "+L.level+" after level details were reset");return}var F=M.videoCodec,k=R.PTSKnown||!R.live,w=(b=L.initSegment)===null||b===void 0?void 0:b.data,_=this._getAudioCodec(M),B=this.transmuxer=this.transmuxer||new f.default(this.hls,u.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),N=E?E.index:-1,U=N!==-1,j=new p.ChunkMetadata(L.level,L.sn,L.stats.chunkCount,y.byteLength,N,U),K=this.initPTS[L.cc];B.push(y,w,_,F,L,E,R.totalduration,k,j,K)},l.onAudioTrackSwitching=function(T,b){var L=this.altAudio,E=!!b.url,y=b.id;if(!E){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var O=this.fragCurrent;O!=null&&O.loader&&(this.log("Switching to main audio track, cancel main fragment load"),O.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var M=this.hls;L&&M.trigger(I.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),M.trigger(I.Events.AUDIO_TRACK_SWITCHED,{id:y})}},l.onAudioTrackSwitched=function(T,b){var L=b.id,E=!!this.hls.audioTracks[L].url;if(E){var y=this.videoBuffer;y&&this.mediaBuffer!==y&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=y)}this.altAudio=E,this.tick()},l.onBufferCreated=function(T,b){var L=b.tracks,E,y,O=!1;for(var M in L){var R=L[M];if(R.id==="main"){if(y=M,E=R,M==="video"){var F=L[M];F&&(this.videoBuffer=F.buffer)}}else O=!0}O&&E?(this.log("Alternate track found, use "+y+".buffered to schedule main fragment loading"),this.mediaBuffer=E.buffer):this.mediaBuffer=this.media},l.onFragBuffered=function(T,b){var L=b.frag,E=b.part;if(!(L&&L.type!==u.PlaylistLevelType.MAIN)){if(this.fragContextChanged(L)){this.warn("Fragment "+L.sn+(E?" p: "+E.index:"")+" of level "+L.level+" finished buffering, but was aborted. state: "+this.state),this.state===t.State.PARSED&&(this.state=t.State.IDLE);return}var y=E?E.stats:L.stats;this.fragLastKbps=Math.round(8*y.total/(y.buffering.end-y.loading.first)),L.sn!=="initSegment"&&(this.fragPrevious=L),this.fragBufferedComplete(L,E)}},l.onError=function(T,b){switch(b.details){case m.ErrorDetails.FRAG_LOAD_ERROR:case m.ErrorDetails.FRAG_LOAD_TIMEOUT:case m.ErrorDetails.KEY_LOAD_ERROR:case m.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(u.PlaylistLevelType.MAIN,b);break;case m.ErrorDetails.LEVEL_LOAD_ERROR:case m.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==t.State.ERROR&&(b.fatal?(this.warn(""+b.details),this.state=t.State.ERROR):!b.levelRetry&&this.state===t.State.WAITING_LEVEL&&(this.state=t.State.IDLE));break;case m.ErrorDetails.BUFFER_FULL_ERROR:if(b.parent==="main"&&(this.state===t.State.PARSING||this.state===t.State.PARSED)){var L=!0,E=this.getFwdBufferInfo(this.media,u.PlaylistLevelType.MAIN);E&&E.len>.5&&(L=!this.reduceMaxBufferLength(E.len)),L&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},l.checkBuffer=function(){var T=this.media,b=this.gapController;if(!(!T||!b||!T.readyState)){var L=x.BufferHelper.getBuffered(T);if(!this.loadedmetadata&&L.length)this.loadedmetadata=!0,this.seekToStartPos();else{var E=this.state!==t.State.IDLE?this.fragCurrent:null;b.poll(this.lastCurrentTime,E)}this.lastCurrentTime=T.currentTime}},l.onFragLoadEmergencyAborted=function(){this.state=t.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},l.onBufferFlushed=function(T,b){var L=b.type;if(L!==i.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var E=(L===i.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(E,L,u.PlaylistLevelType.MAIN)}},l.onLevelsUpdated=function(T,b){this.levels=b.levels},l.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},l.seekToStartPos=function(){var T=this.media,b=T.currentTime,L=this.startPosition;if(L>=0&&b<L){if(T.seeking){this.log("could not seek to "+L+", already seeking at "+b);return}var E=x.BufferHelper.getBuffered(T),y=E.length?E.start(0):0,O=y-L;O>0&&(O<this.config.maxBufferHole||O<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+O+" to match buffer start"),L+=O,this.startPosition=L),this.log("seek to target start position "+L+" from current time "+b),T.currentTime=L}},l._getAudioCodec=function(T){var b=this.config.defaultAudioCodec||T.audioCodec;return this.audioCodecSwap&&b&&(this.log("Swapping audio codec"),b.indexOf("mp4a.40.5")!==-1?b="mp4a.40.2":b="mp4a.40.5"),b},l._loadBitrateTestFrag=function(T){var b=this;this._doFragLoad(T).then(function(L){var E=b.hls;if(!(!L||E.nextLoadLevel||b.fragContextChanged(T))){b.fragLoadError=0,b.state=t.State.IDLE,b.startFragRequested=!1,b.bitrateTest=!1;var y=T.stats;y.parsing.start=y.parsing.end=y.buffering.start=y.buffering.end=self.performance.now(),E.trigger(I.Events.FRAG_LOADED,L)}})},l._handleTransmuxComplete=function(T){var b,L="main",E=this.hls,y=T.remuxResult,O=T.chunkMeta,M=this.getCurrentContext(O);if(!M){this.warn("The loading context changed while buffering fragment "+O.sn+" of level "+O.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(O.level);return}var R=M.frag,F=M.part,k=M.level,w=y.video,_=y.text,B=y.id3,N=y.initSegment,U=k.details,j=this.altAudio?void 0:y.audio;if(!this.fragContextChanged(R)){if(this.state=t.State.PARSING,N){N.tracks&&(this._bufferInitSegment(k,N.tracks,R,O),E.trigger(I.Events.FRAG_PARSING_INIT_SEGMENT,{frag:R,id:L,tracks:N.tracks}));var K=N.initPTS,H=N.timescale;Object(s.isFiniteNumber)(K)&&(this.initPTS[R.cc]=K,E.trigger(I.Events.INIT_PTS_FOUND,{frag:R,id:L,initPTS:K,timescale:H}))}if(w&&y.independent!==!1){if(U){var G=w.startPTS,W=w.endPTS,X=w.startDTS,V=w.endDTS;if(F)F.elementaryStreams[w.type]={startPTS:G,endPTS:W,startDTS:X,endDTS:V};else if(w.firstKeyFrame&&w.independent&&(this.couldBacktrack=!0),w.dropped&&w.independent){var J=this.getMainFwdBufferInfo(),$=(J?J.end:this.getLoadPosition())+this.config.maxBufferHole,z=w.firstKeyFramePTS?w.firstKeyFramePTS:G;if($<z-this.config.maxBufferHole){this.backtrack(R);return}R.setElementaryStreamInfo(w.type,R.start,W,R.start,V,!0)}R.setElementaryStreamInfo(w.type,G,W,X,V),this.backtrackFragment&&(this.backtrackFragment=R),this.bufferFragmentData(w,R,F,O)}}else if(y.independent===!1){this.backtrack(R);return}if(j){var Q=j.startPTS,q=j.endPTS,tt=j.startDTS,et=j.endDTS;F&&(F.elementaryStreams[i.ElementaryStreamTypes.AUDIO]={startPTS:Q,endPTS:q,startDTS:tt,endDTS:et}),R.setElementaryStreamInfo(i.ElementaryStreamTypes.AUDIO,Q,q,tt,et),this.bufferFragmentData(j,R,F,O)}if(U&&B!==null&&B!==void 0&&(b=B.samples)!==null&&b!==void 0&&b.length){var rt={id:L,frag:R,details:U,samples:B.samples};E.trigger(I.Events.FRAG_PARSING_METADATA,rt)}if(U&&_){var Y={id:L,frag:R,details:U,samples:_.samples};E.trigger(I.Events.FRAG_PARSING_USERDATA,Y)}}},l._bufferInitSegment=function(T,b,L,E){var y=this;if(this.state===t.State.PARSING){this.audioOnly=!!b.audio&&!b.video,this.altAudio&&!this.audioOnly&&delete b.audio;var O=b.audio,M=b.video,R=b.audiovideo;if(O){var F=T.audioCodec,k=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(F&&(F.indexOf("mp4a.40.5")!==-1?F="mp4a.40.2":F="mp4a.40.5"),O.metadata.channelCount!==1&&k.indexOf("firefox")===-1&&(F="mp4a.40.5")),k.indexOf("android")!==-1&&O.container!=="audio/mpeg"&&(F="mp4a.40.2",this.log("Android: force audio codec to "+F)),T.audioCodec&&T.audioCodec!==F&&this.log('Swapping manifest audio codec "'+T.audioCodec+'" for "'+F+'"'),O.levelCodec=F,O.id="main",this.log("Init audio buffer, container:"+O.container+", codecs[selected/level/parsed]=["+(F||"")+"/"+(T.audioCodec||"")+"/"+O.codec+"]")}M&&(M.levelCodec=T.videoCodec,M.id="main",this.log("Init video buffer, container:"+M.container+", codecs[level/parsed]=["+(T.videoCodec||"")+"/"+M.codec+"]")),R&&this.log("Init audiovideo buffer, container:"+R.container+", codecs[level/parsed]=["+(T.attrs.CODECS||"")+"/"+R.codec+"]"),this.hls.trigger(I.Events.BUFFER_CODECS,b),Object.keys(b).forEach(function(w){var _=b[w],B=_.initSegment;B!=null&&B.byteLength&&y.hls.trigger(I.Events.BUFFER_APPENDING,{type:w,data:B,frag:L,part:null,chunkMeta:E,parent:L.type})}),this.tick()}},l.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,u.PlaylistLevelType.MAIN)},l.backtrack=function(T){this.couldBacktrack=!0,this.backtrackFragment=T,this.resetTransmuxer(),this.flushBufferGap(T),this.fragmentTracker.removeFragment(T),this.fragPrevious=null,this.nextLoadPosition=T.start,this.state=t.State.IDLE},l.checkFragmentChanged=function(){var T=this.media,b=null;if(T&&T.readyState>1&&T.seeking===!1){var L=T.currentTime;if(x.BufferHelper.isBuffered(T,L)?b=this.getAppendedFrag(L):x.BufferHelper.isBuffered(T,L+.1)&&(b=this.getAppendedFrag(L+.1)),b){this.backtrackFragment=null;var E=this.fragPlaying,y=b.level;(!E||b.sn!==E.sn||E.level!==y||b.urlId!==E.urlId)&&(this.hls.trigger(I.Events.FRAG_CHANGED,{frag:b}),(!E||E.level!==y)&&this.hls.trigger(I.Events.LEVEL_SWITCHED,{level:y}),this.fragPlaying=b)}}},o(r,[{key:"nextLevel",get:function(){var T=this.nextBufferedFrag;return T?T.level:-1}},{key:"currentFrag",get:function(){var T=this.media;return T?this.fragPlaying||this.getAppendedFrag(T.currentTime):null}},{key:"currentProgramDateTime",get:function(){var T=this.media;if(T){var b=T.currentTime,L=this.currentFrag;if(L&&Object(s.isFiniteNumber)(b)&&Object(s.isFiniteNumber)(L.programDateTime)){var E=L.programDateTime+(b-L.start)*1e3;return new Date(E)}}return null}},{key:"currentLevel",get:function(){var T=this.currentFrag;return T?T.level:-1}},{key:"nextBufferedFrag",get:function(){var T=this.currentFrag;return T?this.followingBufferedFrag(T):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),r}(t.default)},"./src/controller/subtitle-stream-controller.ts":function(P,C,n){n.r(C),n.d(C,"SubtitleStreamController",function(){return e});var s=n("./src/events.ts"),t=n("./src/utils/buffer-helper.ts"),d=n("./src/controller/fragment-finders.ts"),I=n("./src/utils/discontinuities.ts"),x=n("./src/controller/level-helper.ts"),D=n("./src/controller/fragment-tracker.ts"),u=n("./src/controller/base-stream-controller.ts"),i=n("./src/types/loader.ts"),f=n("./src/types/level.ts");function p(c,h){for(var v=0;v<h.length;v++){var a=h[v];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(c,a.key,a)}}function g(c,h,v){return h&&p(c.prototype,h),v&&p(c,v),Object.defineProperty(c,"prototype",{writable:!1}),c}function m(c,h){c.prototype=Object.create(h.prototype),c.prototype.constructor=c,S(c,h)}function S(c,h){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,r){return a.__proto__=r,a},S(c,h)}var o=500,e=function(c){m(h,c);function h(a,r){var l;return l=c.call(this,a,r,"[subtitle-stream-controller]")||this,l.levels=[],l.currentTrackId=-1,l.tracksBuffered=[],l.mainDetails=null,l._registerListeners(),l}var v=h.prototype;return v.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},v._registerListeners=function(){var r=this.hls;r.on(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(s.Events.ERROR,this.onError,this),r.on(s.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(s.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.on(s.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(s.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.on(s.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},v._unregisterListeners=function(){var r=this.hls;r.off(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(s.Events.ERROR,this.onError,this),r.off(s.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(s.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.off(s.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(s.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.off(s.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},v.startLoad=function(){this.stopLoad(),this.state=u.State.IDLE,this.setInterval(o),this.tick()},v.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},v.onLevelLoaded=function(r,l){this.mainDetails=l.details},v.onSubtitleFragProcessed=function(r,l){var A=l.frag,T=l.success;if(this.fragPrevious=A,this.state=u.State.IDLE,!!T){var b=this.tracksBuffered[this.currentTrackId];if(!!b){for(var L,E=A.start,y=0;y<b.length;y++)if(E>=b[y].start&&E<=b[y].end){L=b[y];break}var O=A.start+A.duration;L?L.end=O:(L={start:E,end:O},b.push(L)),this.fragmentTracker.fragBuffered(A)}}},v.onBufferFlushing=function(r,l){var A=l.startOffset,T=l.endOffset;if(A===0&&T!==Number.POSITIVE_INFINITY){var b=this.currentTrackId,L=this.levels;if(!L.length||!L[b]||!L[b].details)return;var E=L[b].details,y=E.targetduration,O=T-y;if(O<=0)return;l.endOffsetSubtitles=Math.max(0,O),this.tracksBuffered.forEach(function(M){for(var R=0;R<M.length;){if(M[R].end<=O){M.shift();continue}else if(M[R].start<O)M[R].start=O;else break;R++}}),this.fragmentTracker.removeFragmentsInRange(A,O,i.PlaylistLevelType.SUBTITLE)}},v.onError=function(r,l){var A,T=l.frag;!T||T.type!==i.PlaylistLevelType.SUBTITLE||((A=this.fragCurrent)!==null&&A!==void 0&&A.loader&&this.fragCurrent.loader.abort(),this.state=u.State.IDLE)},v.onSubtitleTracksUpdated=function(r,l){var A=this,T=l.subtitleTracks;this.tracksBuffered=[],this.levels=T.map(function(b){return new f.Level(b)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(b){A.tracksBuffered[b.id]=[]}),this.mediaBuffer=null},v.onSubtitleTrackSwitch=function(r,l){if(this.currentTrackId=l.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var A=this.levels[this.currentTrackId];A!=null&&A.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,A&&this.setInterval(o)},v.onSubtitleTrackLoaded=function(r,l){var A,T=l.details,b=l.id,L=this.currentTrackId,E=this.levels;if(!!E.length){var y=E[L];if(!(b>=E.length||b!==L||!y)){if(this.mediaBuffer=this.mediaBufferTimeRanges,T.live||(A=y.details)!==null&&A!==void 0&&A.live){var O=this.mainDetails;if(T.deltaUpdateFailed||!O)return;var M=O.fragments[0];if(!y.details)T.hasProgramDateTime&&O.hasProgramDateTime?Object(I.alignMediaPlaylistByPDT)(T,O):M&&Object(x.addSliding)(T,M.start);else{var R=this.alignPlaylists(T,y.details);R===0&&M&&Object(x.addSliding)(T,M.start)}}if(y.details=T,this.levelLastLoaded=b,this.tick(),T.live&&!this.fragCurrent&&this.media&&this.state===u.State.IDLE){var F=Object(d.findFragmentByPTS)(null,T.fragments,this.media.currentTime,0);F||(this.warn("Subtitle playlist not aligned with playback"),y.details=void 0)}}}},v._handleFragmentLoadComplete=function(r){var l=r.frag,A=r.payload,T=l.decryptdata,b=this.hls;if(!this.fragContextChanged(l)&&A&&A.byteLength>0&&T&&T.key&&T.iv&&T.method==="AES-128"){var L=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(A),T.key.buffer,T.iv.buffer).then(function(E){var y=performance.now();b.trigger(s.Events.FRAG_DECRYPTED,{frag:l,payload:E,stats:{tstart:L,tdecrypt:y}})})}},v.doTick=function(){if(!this.media){this.state=u.State.IDLE;return}if(this.state===u.State.IDLE){var r=this.currentTrackId,l=this.levels;if(!l.length||!l[r]||!l[r].details)return;var A=l[r].details,T=A.targetduration,b=this.config,L=this.media,E=t.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,L.currentTime-T,b.maxBufferHole),y=E.end,O=E.len,M=this.getMaxBufferLength()+T;if(O>M)return;console.assert(A,"Subtitle track details are defined on idle subtitle stream controller tick");var R=A.fragments,F=R.length,k=A.edge,w,_=this.fragPrevious;if(y<k){var B=b.maxFragLookUpTolerance;w=Object(d.findFragmentByPTS)(_,R,Math.max(R[0].start,y),B),!w&&_&&_.start<R[0].start&&(w=R[0])}else w=R[F-1];if(w=this.mapToInitFragWhenRequired(w),!w)return;w.encrypted?this.loadKey(w,A):this.fragmentTracker.getState(w)===D.FragmentState.NOT_LOADED&&this.loadFragment(w,A,y)}},v.loadFragment=function(r,l,A){this.fragCurrent=r,r.sn==="initSegment"?this._loadInitSegment(r):c.prototype.loadFragment.call(this,r,l,A)},g(h,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),h}(u.default)},"./src/controller/subtitle-track-controller.ts":function(P,C,n){n.r(C);var s=n("./src/events.ts"),t=n("./src/utils/texttrack-utils.ts"),d=n("./src/controller/base-playlist-controller.ts"),I=n("./src/types/loader.ts");function x(g,m){for(var S=0;S<m.length;S++){var o=m[S];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(g,o.key,o)}}function D(g,m,S){return m&&x(g.prototype,m),S&&x(g,S),Object.defineProperty(g,"prototype",{writable:!1}),g}function u(g,m){g.prototype=Object.create(m.prototype),g.prototype.constructor=g,i(g,m)}function i(g,m){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,e){return o.__proto__=e,o},i(g,m)}var f=function(g){u(m,g);function m(o){var e;return e=g.call(this,o,"[subtitle-track-controller]")||this,e.media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e._subtitleDisplay=!0,e.registerListeners(),e}var S=m.prototype;return S.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,g.prototype.destroy.call(this)},S.registerListeners=function(){var e=this.hls;e.on(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(s.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(s.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(s.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(s.Events.ERROR,this.onError,this)},S.unregisterListeners=function(){var e=this.hls;e.off(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(s.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(s.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(s.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(s.Events.ERROR,this.onError,this)},S.onMediaAttached=function(e,c){this.media=c.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},S.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},S.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var e=p(this.media.textTracks);e.forEach(function(c){Object(t.clearCurrentCues)(c)}),this.subtitleTrack=-1,this.media=null}},S.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},S.onManifestParsed=function(e,c){this.tracks=c.subtitleTracks},S.onSubtitleTrackLoaded=function(e,c){var h=c.id,v=c.details,a=this.trackId,r=this.tracksInGroup[a];if(!r){this.warn("Invalid subtitle track id "+h);return}var l=r.details;r.details=c.details,this.log("subtitle track "+h+" loaded ["+v.startSN+"-"+v.endSN+"]"),h===this.trackId&&(this.retryCount=0,this.playlistLoaded(h,c,l))},S.onLevelLoading=function(e,c){this.switchLevel(c.level)},S.onLevelSwitching=function(e,c){this.switchLevel(c.level)},S.switchLevel=function(e){var c=this.hls.levels[e];if(!!(c!=null&&c.textGroupIds)){var h=c.textGroupIds[c.urlId];if(this.groupId!==h){var v=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,a=this.tracks.filter(function(A){return!h||A.groupId===h});this.tracksInGroup=a;var r=this.findTrackId(v==null?void 0:v.name)||this.findTrackId();this.groupId=h;var l={subtitleTracks:a};this.log("Updating subtitle tracks, "+a.length+' track(s) found in "'+h+'" group-id'),this.hls.trigger(s.Events.SUBTITLE_TRACKS_UPDATED,l),r!==-1&&this.setSubtitleTrack(r,v)}}},S.findTrackId=function(e){for(var c=this.tracksInGroup,h=0;h<c.length;h++){var v=c[h];if((!this.selectDefaultTrack||v.default)&&(!e||e===v.name))return v.id}return-1},S.onError=function(e,c){g.prototype.onError.call(this,e,c),!(c.fatal||!c.context)&&c.context.type===I.PlaylistContextType.SUBTITLE_TRACK&&c.context.id===this.trackId&&c.context.groupId===this.groupId&&this.retryLoadingOrFail(c)},S.loadPlaylist=function(e){var c=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(c)){var h=c.id,v=c.groupId,a=c.url;if(e)try{a=e.addDirectives(a)}catch(r){this.warn("Could not construct new URL with HLS Delivery Directives: "+r)}this.log("Loading subtitle playlist for id "+h),this.hls.trigger(s.Events.SUBTITLE_TRACK_LOADING,{url:a,id:h,groupId:v,deliveryDirectives:e||null})}},S.toggleTrackModes=function(e){var c=this,h=this.media,v=this.trackId;if(!!h){var a=p(h.textTracks),r=a.filter(function(T){return T.groupId===c.groupId});if(e===-1)[].slice.call(a).forEach(function(T){T.mode="disabled"});else{var l=r[v];l&&(l.mode="disabled")}var A=r[e];A&&(A.mode=this.subtitleDisplay?"showing":"hidden")}},S.setSubtitleTrack=function(e,c){var h,v=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(h=v[e])!==null&&h!==void 0&&h.details)||e<-1||e>=v.length)){this.clearTimer();var a=v[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,a){var r=a.id,l=a.groupId,A=l===void 0?"":l,T=a.name,b=a.type,L=a.url;this.hls.trigger(s.Events.SUBTITLE_TRACK_SWITCH,{id:r,groupId:A,name:T,type:b,url:L});var E=this.switchParams(a.url,c==null?void 0:c.details);this.loadPlaylist(E)}else this.hls.trigger(s.Events.SUBTITLE_TRACK_SWITCH,{id:e})}},S.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,c=p(this.media.textTracks),h=0;h<c.length;h++)if(c[h].mode==="hidden")e=h;else if(c[h].mode==="showing"){e=h;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},D(m,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var c=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,c)}}]),m}(d.default);function p(g){for(var m=[],S=0;S<g.length;S++){var o=g[S];o.kind==="subtitles"&&o.label&&m.push(g[S])}return m}C.default=f},"./src/controller/timeline-controller.ts":function(P,C,n){n.r(C),n.d(C,"TimelineController",function(){return g});var s=n("./src/polyfills/number.ts"),t=n("./src/events.ts"),d=n("./src/utils/cea-608-parser.ts"),I=n("./src/utils/output-filter.ts"),x=n("./src/utils/webvtt-parser.ts"),D=n("./src/utils/texttrack-utils.ts"),u=n("./src/utils/imsc1-ttml-parser.ts"),i=n("./src/utils/mp4-tools.ts"),f=n("./src/types/loader.ts"),p=n("./src/utils/logger.ts"),g=function(){function e(h){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=o(),this.captionsProperties=void 0,this.hls=h,this.config=h.config,this.Cues=h.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var v=new I.default(this,"textTrack1"),a=new I.default(this,"textTrack2"),r=new I.default(this,"textTrack3"),l=new I.default(this,"textTrack4");this.cea608Parser1=new d.default(1,v,a),this.cea608Parser2=new d.default(3,r,l)}h.on(t.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.on(t.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.on(t.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.on(t.Events.MANIFEST_LOADED,this.onManifestLoaded,this),h.on(t.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),h.on(t.Events.FRAG_LOADING,this.onFragLoading,this),h.on(t.Events.FRAG_LOADED,this.onFragLoaded,this),h.on(t.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),h.on(t.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),h.on(t.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),h.on(t.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),h.on(t.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var c=e.prototype;return c.destroy=function(){var v=this.hls;v.off(t.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),v.off(t.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.off(t.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(t.Events.MANIFEST_LOADED,this.onManifestLoaded,this),v.off(t.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.off(t.Events.FRAG_LOADING,this.onFragLoading,this),v.off(t.Events.FRAG_LOADED,this.onFragLoaded,this),v.off(t.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),v.off(t.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),v.off(t.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),v.off(t.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),v.off(t.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},c.addCues=function(v,a,r,l,A){for(var T=!1,b=A.length;b--;){var L=A[b],E=S(L[0],L[1],a,r);if(E>=0&&(L[0]=Math.min(L[0],a),L[1]=Math.max(L[1],r),T=!0,E/(r-a)>.5))return}if(T||A.push([a,r]),this.config.renderTextTracksNatively){var y=this.captionsTracks[v];this.Cues.newCue(y,a,r,l)}else{var O=this.Cues.newCue(null,a,r,l);this.hls.trigger(t.Events.CUES_PARSED,{type:"captions",cues:O,track:v})}},c.onInitPtsFound=function(v,a){var r=this,l=a.frag,A=a.id,T=a.initPTS,b=a.timescale,L=this.unparsedVttFrags;A==="main"&&(this.initPTS[l.cc]=T,this.timescale[l.cc]=b),L.length&&(this.unparsedVttFrags=[],L.forEach(function(E){r.onFragLoaded(t.Events.FRAG_LOADED,E)}))},c.getExistingTrack=function(v){var a=this.media;if(a)for(var r=0;r<a.textTracks.length;r++){var l=a.textTracks[r];if(l[v])return l}return null},c.createCaptionsTrack=function(v){this.config.renderTextTracksNatively?this.createNativeTrack(v):this.createNonNativeTrack(v)},c.createNativeTrack=function(v){if(!this.captionsTracks[v]){var a=this.captionsProperties,r=this.captionsTracks,l=this.media,A=a[v],T=A.label,b=A.languageCode,L=this.getExistingTrack(v);if(L)r[v]=L,Object(D.clearCurrentCues)(r[v]),Object(D.sendAddTrackEvent)(r[v],l);else{var E=this.createTextTrack("captions",T,b);E&&(E[v]=!0,r[v]=E)}}},c.createNonNativeTrack=function(v){if(!this.nonNativeCaptionsTracks[v]){var a=this.captionsProperties[v];if(!!a){var r=a.label,l={_id:v,label:r,kind:"captions",default:a.media?!!a.media.default:!1,closedCaptions:a.media};this.nonNativeCaptionsTracks[v]=l,this.hls.trigger(t.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[l]})}}},c.createTextTrack=function(v,a,r){var l=this.media;if(!!l)return l.addTextTrack(v,a,r)},c.onMediaAttaching=function(v,a){this.media=a.media,this._cleanTracks()},c.onMediaDetaching=function(){var v=this.captionsTracks;Object.keys(v).forEach(function(a){Object(D.clearCurrentCues)(v[a]),delete v[a]}),this.nonNativeCaptionsTracks={}},c.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=o(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},c._cleanTracks=function(){var v=this.media;if(!!v){var a=v.textTracks;if(a)for(var r=0;r<a.length;r++)Object(D.clearCurrentCues)(a[r])}},c.onSubtitleTracksUpdated=function(v,a){var r=this;this.textTracks=[];var l=a.subtitleTracks||[],A=l.some(function(E){return E.textCodec===u.IMSC1_CODEC});if(this.config.enableWebVTT||A&&this.config.enableIMSC1){var T=this.tracks&&l&&this.tracks.length===l.length;if(this.tracks=l||[],this.config.renderTextTracksNatively){var b=this.media?this.media.textTracks:[];this.tracks.forEach(function(E,y){var O;if(y<b.length){for(var M=null,R=0;R<b.length;R++)if(m(b[R],E)){M=b[R];break}M&&(O=M)}if(O)Object(D.clearCurrentCues)(O);else{var F=r._captionsOrSubtitlesFromCharacteristics(E);O=r.createTextTrack(F,E.name,E.lang),O&&(O.mode="disabled")}O&&(O.groupId=E.groupId,r.textTracks.push(O))})}else if(!T&&this.tracks&&this.tracks.length){var L=this.tracks.map(function(E){return{label:E.name,kind:E.type.toLowerCase(),default:E.default,subtitleTrack:E}});this.hls.trigger(t.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:L})}}},c._captionsOrSubtitlesFromCharacteristics=function(v){var a;if((a=v.attrs)!==null&&a!==void 0&&a.CHARACTERISTICS){var r=/transcribes-spoken-dialog/gi.test(v.attrs.CHARACTERISTICS),l=/describes-music-and-sound/gi.test(v.attrs.CHARACTERISTICS);if(r&&l)return"captions"}return"subtitles"},c.onManifestLoaded=function(v,a){var r=this;this.config.enableCEA708Captions&&a.captions&&a.captions.forEach(function(l){var A=/(?:CC|SERVICE)([1-4])/.exec(l.instreamId);if(!!A){var T="textTrack"+A[1],b=r.captionsProperties[T];!b||(b.label=l.name,l.lang&&(b.languageCode=l.lang),b.media=l)}})},c.onFragLoading=function(v,a){var r=this.cea608Parser1,l=this.cea608Parser2,A=this.lastSn,T=this.lastPartIndex;if(!(!this.enabled||!(r&&l))&&a.frag.type===f.PlaylistLevelType.MAIN){var b,L,E=a.frag.sn,y=(b=a==null||(L=a.part)===null||L===void 0?void 0:L.index)!=null?b:-1;E===A+1||E===A&&y===T+1||(r.reset(),l.reset()),this.lastSn=E,this.lastPartIndex=y}},c.onFragLoaded=function(v,a){var r=a.frag,l=a.payload,A=this.initPTS,T=this.unparsedVttFrags;if(r.type===f.PlaylistLevelType.SUBTITLE)if(l.byteLength){if(!Object(s.isFiniteNumber)(A[r.cc])){T.push(a),A.length&&this.hls.trigger(t.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")});return}var b=r.decryptdata,L="stats"in a;if(b==null||b.key==null||b.method!=="AES-128"||L){var E=this.tracks[r.level],y=this.vttCCs;y[r.cc]||(y[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),E&&E.textCodec===u.IMSC1_CODEC?this._parseIMSC1(r,l):this._parseVTTs(r,l,y)}}else this.hls.trigger(t.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},c._parseIMSC1=function(v,a){var r=this,l=this.hls;Object(u.parseIMSC1)(a,this.initPTS[v.cc],this.timescale[v.cc],function(A){r._appendCues(A,v.level),l.trigger(t.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:v})},function(A){p.logger.log("Failed to parse IMSC1: "+A),l.trigger(t.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:v,error:A})})},c._parseVTTs=function(v,a,r){var l,A=this,T=this.hls,b=(l=v.initSegment)!==null&&l!==void 0&&l.data?Object(i.appendUint8Array)(v.initSegment.data,new Uint8Array(a)):a;Object(x.parseWebVTT)(b,this.initPTS[v.cc],this.timescale[v.cc],r,v.cc,v.start,function(L){A._appendCues(L,v.level),T.trigger(t.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:v})},function(L){A._fallbackToIMSC1(v,a),p.logger.log("Failed to parse VTT cue: "+L),T.trigger(t.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:v,error:L})})},c._fallbackToIMSC1=function(v,a){var r=this,l=this.tracks[v.level];l.textCodec||Object(u.parseIMSC1)(a,this.initPTS[v.cc],this.timescale[v.cc],function(){l.textCodec=u.IMSC1_CODEC,r._parseIMSC1(v,a)},function(){l.textCodec="wvtt"})},c._appendCues=function(v,a){var r=this.hls;if(this.config.renderTextTracksNatively){var l=this.textTracks[a];if(!l||l.mode==="disabled")return;v.forEach(function(b){return Object(D.addCueToTrack)(l,b)})}else{var A=this.tracks[a];if(!A)return;var T=A.default?"default":"subtitles"+a;r.trigger(t.Events.CUES_PARSED,{type:"subtitles",cues:v,track:T})}},c.onFragDecrypted=function(v,a){var r=a.frag;if(r.type===f.PlaylistLevelType.SUBTITLE){if(!Object(s.isFiniteNumber)(this.initPTS[r.cc])){this.unparsedVttFrags.push(a);return}this.onFragLoaded(t.Events.FRAG_LOADED,a)}},c.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},c.onFragParsingUserdata=function(v,a){var r=this.cea608Parser1,l=this.cea608Parser2;if(!(!this.enabled||!(r&&l)))for(var A=0;A<a.samples.length;A++){var T=a.samples[A].bytes;if(T){var b=this.extractCea608Data(T);r.addData(a.samples[A].pts,b[0]),l.addData(a.samples[A].pts,b[1])}}},c.onBufferFlushing=function(v,a){var r=a.startOffset,l=a.endOffset,A=a.endOffsetSubtitles,T=a.type,b=this.media;if(!(!b||b.currentTime<l)){if(!T||T==="video"){var L=this.captionsTracks;Object.keys(L).forEach(function(y){return Object(D.removeCuesInRange)(L[y],r,l)})}if(this.config.renderTextTracksNatively&&r===0&&A!==void 0){var E=this.textTracks;Object.keys(E).forEach(function(y){return Object(D.removeCuesInRange)(E[y],r,A)})}}},c.extractCea608Data=function(v){for(var a=[[],[]],r=v[0]&31,l=2,A=0;A<r;A++){var T=v[l++],b=127&v[l++],L=127&v[l++];if(!(b===0&&L===0)){var E=(4&T)!==0;if(E){var y=3&T;(y===0||y===1)&&(a[y].push(b),a[y].push(L))}}}return a},e}();function m(e,c){return e&&e.label===c.name&&!(e.textTrack1||e.textTrack2)}function S(e,c,h,v){return Math.min(c,v)-Math.max(e,h)}function o(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return s});var s=function(){function t(I,x){this.subtle=void 0,this.aesIV=void 0,this.subtle=I,this.aesIV=x}var d=t.prototype;return d.decrypt=function(x,D){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},D,x)},t}()},"./src/crypt/aes-decryptor.ts":function(P,C,n){n.r(C),n.d(C,"removePadding",function(){return t}),n.d(C,"default",function(){return d});var s=n("./src/utils/typed-array.ts");function t(I){var x=I.byteLength,D=x&&new DataView(I.buffer).getUint8(x-1);return D?Object(s.sliceUint8)(I,0,x-D):I}var d=function(){function I(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var x=I.prototype;return x.uint8ArrayToUint32Array_=function(u){for(var i=new DataView(u),f=new Uint32Array(4),p=0;p<4;p++)f[p]=i.getUint32(p*4);return f},x.initTable=function(){var u=this.sBox,i=this.invSBox,f=this.subMix,p=f[0],g=f[1],m=f[2],S=f[3],o=this.invSubMix,e=o[0],c=o[1],h=o[2],v=o[3],a=new Uint32Array(256),r=0,l=0,A=0;for(A=0;A<256;A++)A<128?a[A]=A<<1:a[A]=A<<1^283;for(A=0;A<256;A++){var T=l^l<<1^l<<2^l<<3^l<<4;T=T>>>8^T&255^99,u[r]=T,i[T]=r;var b=a[r],L=a[b],E=a[L],y=a[T]*257^T*16843008;p[r]=y<<24|y>>>8,g[r]=y<<16|y>>>16,m[r]=y<<8|y>>>24,S[r]=y,y=E*16843009^L*65537^b*257^r*16843008,e[T]=y<<24|y>>>8,c[T]=y<<16|y>>>16,h[T]=y<<8|y>>>24,v[T]=y,r?(r=b^a[a[a[E^b]]],l^=a[a[l]]):r=l=1}},x.expandKey=function(u){for(var i=this.uint8ArrayToUint32Array_(u),f=!0,p=0;p<i.length&&f;)f=i[p]===this.key[p],p++;if(!f){this.key=i;var g=this.keySize=i.length;if(g!==4&&g!==6&&g!==8)throw new Error("Invalid aes key size="+g);var m=this.ksRows=(g+6+1)*4,S,o,e=this.keySchedule=new Uint32Array(m),c=this.invKeySchedule=new Uint32Array(m),h=this.sBox,v=this.rcon,a=this.invSubMix,r=a[0],l=a[1],A=a[2],T=a[3],b,L;for(S=0;S<m;S++){if(S<g){b=e[S]=i[S];continue}L=b,S%g===0?(L=L<<8|L>>>24,L=h[L>>>24]<<24|h[L>>>16&255]<<16|h[L>>>8&255]<<8|h[L&255],L^=v[S/g|0]<<24):g>6&&S%g===4&&(L=h[L>>>24]<<24|h[L>>>16&255]<<16|h[L>>>8&255]<<8|h[L&255]),e[S]=b=(e[S-g]^L)>>>0}for(o=0;o<m;o++)S=m-o,o&3?L=e[S]:L=e[S-4],o<4||S<=4?c[o]=L:c[o]=r[h[L>>>24]]^l[h[L>>>16&255]]^A[h[L>>>8&255]]^T[h[L&255]],c[o]=c[o]>>>0}},x.networkToHostOrderSwap=function(u){return u<<24|(u&65280)<<8|(u&16711680)>>8|u>>>24},x.decrypt=function(u,i,f){for(var p=this.keySize+6,g=this.invKeySchedule,m=this.invSBox,S=this.invSubMix,o=S[0],e=S[1],c=S[2],h=S[3],v=this.uint8ArrayToUint32Array_(f),a=v[0],r=v[1],l=v[2],A=v[3],T=new Int32Array(u),b=new Int32Array(T.length),L,E,y,O,M,R,F,k,w,_,B,N,U,j,K=this.networkToHostOrderSwap;i<T.length;){for(w=K(T[i]),_=K(T[i+1]),B=K(T[i+2]),N=K(T[i+3]),M=w^g[0],R=N^g[1],F=B^g[2],k=_^g[3],U=4,j=1;j<p;j++)L=o[M>>>24]^e[R>>16&255]^c[F>>8&255]^h[k&255]^g[U],E=o[R>>>24]^e[F>>16&255]^c[k>>8&255]^h[M&255]^g[U+1],y=o[F>>>24]^e[k>>16&255]^c[M>>8&255]^h[R&255]^g[U+2],O=o[k>>>24]^e[M>>16&255]^c[R>>8&255]^h[F&255]^g[U+3],M=L,R=E,F=y,k=O,U=U+4;L=m[M>>>24]<<24^m[R>>16&255]<<16^m[F>>8&255]<<8^m[k&255]^g[U],E=m[R>>>24]<<24^m[F>>16&255]<<16^m[k>>8&255]<<8^m[M&255]^g[U+1],y=m[F>>>24]<<24^m[k>>16&255]<<16^m[M>>8&255]<<8^m[R&255]^g[U+2],O=m[k>>>24]<<24^m[M>>16&255]<<16^m[R>>8&255]<<8^m[F&255]^g[U+3],b[i]=K(L^a),b[i+1]=K(O^r),b[i+2]=K(y^l),b[i+3]=K(E^A),a=w,r=_,l=B,A=N,i=i+4}return b.buffer},I}()},"./src/crypt/decrypter.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return i});var s=n("./src/crypt/aes-crypto.ts"),t=n("./src/crypt/fast-aes-key.ts"),d=n("./src/crypt/aes-decryptor.ts"),I=n("./src/utils/logger.ts"),x=n("./src/utils/mp4-tools.ts"),D=n("./src/utils/typed-array.ts"),u=16,i=function(){function f(g,m,S){var o=S===void 0?{}:S,e=o.removePKCS7Padding,c=e===void 0?!0:e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=g,this.config=m,this.removePKCS7Padding=c,c)try{var h=self.crypto;h&&(this.subtle=h.subtle||h.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var p=f.prototype;return p.destroy=function(){this.observer=null},p.isSync=function(){return this.config.enableSoftwareAES},p.flush=function(){var m=this.currentResult;if(!m){this.reset();return}var S=new Uint8Array(m);return this.reset(),this.removePKCS7Padding?Object(d.removePadding)(S):S},p.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},p.decrypt=function(m,S,o,e){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(m),S,o);var c=this.flush();c&&e(c.buffer)}else this.webCryptoDecrypt(new Uint8Array(m),S,o).then(e)},p.softwareDecrypt=function(m,S,o){var e=this.currentIV,c=this.currentResult,h=this.remainderData;this.logOnce("JS AES decrypt"),h&&(m=Object(x.appendUint8Array)(h,m),this.remainderData=null);var v=this.getValidChunk(m);if(!v.length)return null;e&&(o=e);var a=this.softwareDecrypter;a||(a=this.softwareDecrypter=new d.default),a.expandKey(S);var r=c;return this.currentResult=a.decrypt(v.buffer,0,o),this.currentIV=Object(D.sliceUint8)(v,-16).buffer,r||null},p.webCryptoDecrypt=function(m,S,o){var e=this,c=this.subtle;return(this.key!==S||!this.fastAesKey)&&(this.key=S,this.fastAesKey=new t.default(c,S)),this.fastAesKey.expandKey().then(function(h){if(!c)return Promise.reject(new Error("web crypto not initialized"));var v=new s.default(c,o);return v.decrypt(m.buffer,h)}).catch(function(h){return e.onWebCryptoError(h,m,S,o)})},p.onWebCryptoError=function(m,S,o,e){return I.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",m),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(S,o,e)},p.getValidChunk=function(m){var S=m,o=m.length-m.length%u;return o!==m.length&&(S=Object(D.sliceUint8)(m,0,o),this.remainderData=Object(D.sliceUint8)(m,o)),S},p.logOnce=function(m){!this.logEnabled||(I.logger.log("[decrypter.ts]: "+m),this.logEnabled=!1)},f}()},"./src/crypt/fast-aes-key.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return s});var s=function(){function t(I,x){this.subtle=void 0,this.key=void 0,this.subtle=I,this.key=x}var d=t.prototype;return d.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}()},"./src/demux/aacdemuxer.ts":function(P,C,n){n.r(C);var s=n("./src/demux/base-audio-demuxer.ts"),t=n("./src/demux/adts.ts"),d=n("./src/utils/logger.ts"),I=n("./src/demux/id3.ts");function x(i,f){i.prototype=Object.create(f.prototype),i.prototype.constructor=i,D(i,f)}function D(i,f){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,m){return g.__proto__=m,g},D(i,f)}var u=function(i){x(f,i);function f(g,m){var S;return S=i.call(this)||this,S.observer=void 0,S.config=void 0,S.observer=g,S.config=m,S}var p=f.prototype;return p.resetInitSegment=function(m,S,o,e){i.prototype.resetInitSegment.call(this,m,S,o,e),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:S,duration:e,inputTimeScale:9e4,dropped:0}},f.probe=function(m){if(!m)return!1;for(var S=I.getID3Data(m,0)||[],o=S.length,e=m.length;o<e;o++)if(t.probe(m,o))return d.logger.log("ADTS sync word found !"),!0;return!1},p.canParse=function(m,S){return t.canParse(m,S)},p.appendFrame=function(m,S,o){t.initTrackConfig(m,this.observer,S,o,m.manifestCodec);var e=t.appendFrame(m,S,o,this.basePTS,this.frameIndex);if(e&&e.missing===0)return e},f}(s.default);u.minProbeByteLength=9,C.default=u},"./src/demux/adts.ts":function(P,C,n){n.r(C),n.d(C,"getAudioConfig",function(){return I}),n.d(C,"isHeaderPattern",function(){return x}),n.d(C,"getHeaderLength",function(){return D}),n.d(C,"getFullFrameLength",function(){return u}),n.d(C,"canGetFrameLength",function(){return i}),n.d(C,"isHeader",function(){return f}),n.d(C,"canParse",function(){return p}),n.d(C,"probe",function(){return g}),n.d(C,"initTrackConfig",function(){return m}),n.d(C,"getFrameDuration",function(){return S}),n.d(C,"parseFrameHeader",function(){return o}),n.d(C,"appendFrame",function(){return e});var s=n("./src/utils/logger.ts"),t=n("./src/errors.ts"),d=n("./src/events.ts");function I(c,h,v,a){var r,l,A,T,b=navigator.userAgent.toLowerCase(),L=a,E=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=((h[v+2]&192)>>>6)+1;var y=(h[v+2]&60)>>>2;if(y>E.length-1){c.trigger(d.Events.ERROR,{type:t.ErrorTypes.MEDIA_ERROR,details:t.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+y});return}return A=(h[v+2]&1)<<2,A|=(h[v+3]&192)>>>6,s.logger.log("manifest codec:"+a+", ADTS type:"+r+", samplingIndex:"+y),/firefox/i.test(b)?y>=6?(r=5,T=new Array(4),l=y-3):(r=2,T=new Array(2),l=y):b.indexOf("android")!==-1?(r=2,T=new Array(2),l=y):(r=5,T=new Array(4),a&&(a.indexOf("mp4a.40.29")!==-1||a.indexOf("mp4a.40.5")!==-1)||!a&&y>=6?l=y-3:((a&&a.indexOf("mp4a.40.2")!==-1&&(y>=6&&A===1||/vivaldi/i.test(b))||!a&&A===1)&&(r=2,T=new Array(2)),l=y)),T[0]=r<<3,T[0]|=(y&14)>>1,T[1]|=(y&1)<<7,T[1]|=A<<3,r===5&&(T[1]|=(l&14)>>1,T[2]=(l&1)<<7,T[2]|=2<<2,T[3]=0),{config:T,samplerate:E[y],channelCount:A,codec:"mp4a.40."+r,manifestCodec:L}}function x(c,h){return c[h]===255&&(c[h+1]&246)===240}function D(c,h){return c[h+1]&1?7:9}function u(c,h){return(c[h+3]&3)<<11|c[h+4]<<3|(c[h+5]&224)>>>5}function i(c,h){return h+5<c.length}function f(c,h){return h+1<c.length&&x(c,h)}function p(c,h){return i(c,h)&&x(c,h)&&u(c,h)<=c.length-h}function g(c,h){if(f(c,h)){var v=D(c,h);if(h+v>=c.length)return!1;var a=u(c,h);if(a<=v)return!1;var r=h+a;return r===c.length||f(c,r)}return!1}function m(c,h,v,a,r){if(!c.samplerate){var l=I(h,v,a,r);if(!l)return;c.config=l.config,c.samplerate=l.samplerate,c.channelCount=l.channelCount,c.codec=l.codec,c.manifestCodec=l.manifestCodec,s.logger.log("parsed codec:"+c.codec+", rate:"+l.samplerate+", channels:"+l.channelCount)}}function S(c){return 1024*9e4/c}function o(c,h){var v=D(c,h);if(h+v<=c.length){var a=u(c,h)-v;if(a>0)return{headerLength:v,frameLength:a}}}function e(c,h,v,a,r){var l=S(c.samplerate),A=a+r*l,T=o(h,v),b;if(T){var L=T.frameLength,E=T.headerLength,y=E+L,O=Math.max(0,v+y-h.length);O?(b=new Uint8Array(y-E),b.set(h.subarray(v+E,h.length),0)):b=h.subarray(v+E,v+y);var M={unit:b,pts:A};return O||c.samples.push(M),{sample:M,length:y,missing:O}}var R=h.length-v;b=new Uint8Array(R),b.set(h.subarray(v,h.length),0);var F={unit:b,pts:A};return{sample:F,length:R,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(P,C,n){n.r(C),n.d(C,"initPTSFn",function(){return i});var s=n("./src/polyfills/number.ts"),t=n("./src/demux/id3.ts"),d=n("./src/types/demuxer.ts"),I=n("./src/demux/dummy-demuxed-track.ts"),x=n("./src/utils/mp4-tools.ts"),D=n("./src/utils/typed-array.ts"),u=function(){function f(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var p=f.prototype;return p.resetInitSegment=function(m,S,o,e){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},p.resetTimeStamp=function(m){this.initPTS=m,this.resetContiguity()},p.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},p.canParse=function(m,S){return!1},p.appendFrame=function(m,S,o){},p.demux=function(m,S){this.cachedData&&(m=Object(x.appendUint8Array)(this.cachedData,m),this.cachedData=null);var o=t.getID3Data(m,0),e=o?o.length:0,c,h,v=this._audioTrack,a=this._id3Track,r=o?t.getTimeStamp(o):void 0,l=m.length;for((this.basePTS===null||this.frameIndex===0&&Object(s.isFiniteNumber)(r))&&(this.basePTS=i(r,S,this.initPTS)),o&&o.length>0&&a.samples.push({pts:this.basePTS,dts:this.basePTS,data:o,type:d.MetadataSchema.audioId3}),h=this.basePTS;e<l;){if(this.canParse(m,e)){var A=this.appendFrame(v,m,e);A?(this.frameIndex++,h=A.sample.pts,e+=A.length,c=e):e=l}else t.canParse(m,e)?(o=t.getID3Data(m,e),a.samples.push({pts:h,dts:h,data:o,type:d.MetadataSchema.audioId3}),e+=o.length,c=e):e++;if(e===l&&c!==l){var T=Object(D.sliceUint8)(m,c);this.cachedData?this.cachedData=Object(x.appendUint8Array)(this.cachedData,T):this.cachedData=T}}return{audioTrack:v,videoTrack:Object(I.dummyTrack)(),id3Track:a,textTrack:Object(I.dummyTrack)()}},p.demuxSampleAes=function(m,S,o){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},p.flush=function(m){var S=this.cachedData;return S&&(this.cachedData=null,this.demux(S,0)),{audioTrack:this._audioTrack,videoTrack:Object(I.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(I.dummyTrack)()}},p.destroy=function(){},f}(),i=function(p,g,m){return Object(s.isFiniteNumber)(p)?p*90:g*9e4+(m||0)};C.default=u},"./src/demux/chunk-cache.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return s});var s=function(){function d(){this.chunks=[],this.dataLength=0}var I=d.prototype;return I.push=function(D){this.chunks.push(D),this.dataLength+=D.length},I.flush=function(){var D=this.chunks,u=this.dataLength,i;if(D.length)D.length===1?i=D[0]:i=t(D,u);else return new Uint8Array(0);return this.reset(),i},I.reset=function(){this.chunks.length=0,this.dataLength=0},d}();function t(d,I){for(var x=new Uint8Array(I),D=0,u=0;u<d.length;u++){var i=d[u];x.set(i,D),D+=i.length}return x}},"./src/demux/dummy-demuxed-track.ts":function(P,C,n){n.r(C),n.d(C,"dummyTrack",function(){return s});function s(t,d){return t===void 0&&(t=""),d===void 0&&(d=9e4),{type:t,id:-1,pid:-1,inputTimeScale:d,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(P,C,n){n.r(C);var s=n("./src/utils/logger.ts"),t=function(){function d(x){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=x,this.bytesAvailable=x.byteLength,this.word=0,this.bitsAvailable=0}var I=d.prototype;return I.loadWord=function(){var D=this.data,u=this.bytesAvailable,i=D.byteLength-u,f=new Uint8Array(4),p=Math.min(4,u);if(p===0)throw new Error("no bytes available");f.set(D.subarray(i,i+p)),this.word=new DataView(f.buffer).getUint32(0),this.bitsAvailable=p*8,this.bytesAvailable-=p},I.skipBits=function(D){var u;this.bitsAvailable>D?(this.word<<=D,this.bitsAvailable-=D):(D-=this.bitsAvailable,u=D>>3,D-=u>>3,this.bytesAvailable-=u,this.loadWord(),this.word<<=D,this.bitsAvailable-=D)},I.readBits=function(D){var u=Math.min(this.bitsAvailable,D),i=this.word>>>32-u;return D>32&&s.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=u,this.bitsAvailable>0?this.word<<=u:this.bytesAvailable>0&&this.loadWord(),u=D-u,u>0&&this.bitsAvailable?i<<u|this.readBits(u):i},I.skipLZ=function(){var D;for(D=0;D<this.bitsAvailable;++D)if((this.word&2147483648>>>D)!==0)return this.word<<=D,this.bitsAvailable-=D,D;return this.loadWord(),D+this.skipLZ()},I.skipUEG=function(){this.skipBits(1+this.skipLZ())},I.skipEG=function(){this.skipBits(1+this.skipLZ())},I.readUEG=function(){var D=this.skipLZ();return this.readBits(D+1)-1},I.readEG=function(){var D=this.readUEG();return 1&D?1+D>>>1:-1*(D>>>1)},I.readBoolean=function(){return this.readBits(1)===1},I.readUByte=function(){return this.readBits(8)},I.readUShort=function(){return this.readBits(16)},I.readUInt=function(){return this.readBits(32)},I.skipScalingList=function(D){for(var u=8,i=8,f,p=0;p<D;p++)i!==0&&(f=this.readEG(),i=(u+f+256)%256),u=i===0?u:i},I.readSPS=function(){var D=0,u=0,i=0,f=0,p,g,m,S=this.readUByte.bind(this),o=this.readBits.bind(this),e=this.readUEG.bind(this),c=this.readBoolean.bind(this),h=this.skipBits.bind(this),v=this.skipEG.bind(this),a=this.skipUEG.bind(this),r=this.skipScalingList.bind(this);S();var l=S();if(o(5),h(3),S(),a(),l===100||l===110||l===122||l===244||l===44||l===83||l===86||l===118||l===128){var A=e();if(A===3&&h(1),a(),a(),h(1),c())for(g=A!==3?8:12,m=0;m<g;m++)c()&&(m<6?r(16):r(64))}a();var T=e();if(T===0)e();else if(T===1)for(h(1),v(),v(),p=e(),m=0;m<p;m++)v();a(),h(1);var b=e(),L=e(),E=o(1);E===0&&h(1),h(1),c()&&(D=e(),u=e(),i=e(),f=e());var y=[1,1];if(c()&&c()){var O=S();switch(O){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:{y=[S()<<8|S(),S()<<8|S()];break}}}return{width:Math.ceil((b+1)*16-D*2-u*2),height:(2-E)*(L+1)*16-(E?2:4)*(i+f),pixelRatio:y}},I.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},d}();C.default=t},"./src/demux/id3.ts":function(P,C,n){n.r(C),n.d(C,"isHeader",function(){return s}),n.d(C,"isFooter",function(){return t}),n.d(C,"getID3Data",function(){return d}),n.d(C,"canParse",function(){return x}),n.d(C,"getTimeStamp",function(){return D}),n.d(C,"isTimeStampFrame",function(){return u}),n.d(C,"getID3Frames",function(){return f}),n.d(C,"decodeFrame",function(){return p}),n.d(C,"utf8ArrayToStr",function(){return e}),n.d(C,"testables",function(){return c});var s=function(r,l){return l+10<=r.length&&r[l]===73&&r[l+1]===68&&r[l+2]===51&&r[l+3]<255&&r[l+4]<255&&r[l+6]<128&&r[l+7]<128&&r[l+8]<128&&r[l+9]<128},t=function(r,l){return l+10<=r.length&&r[l]===51&&r[l+1]===68&&r[l+2]===73&&r[l+3]<255&&r[l+4]<255&&r[l+6]<128&&r[l+7]<128&&r[l+8]<128&&r[l+9]<128},d=function(r,l){for(var A=l,T=0;s(r,l);){T+=10;var b=I(r,l+6);T+=b,t(r,l+10)&&(T+=10),l+=T}if(T>0)return r.subarray(A,A+T)},I=function(r,l){var A=0;return A=(r[l]&127)<<21,A|=(r[l+1]&127)<<14,A|=(r[l+2]&127)<<7,A|=r[l+3]&127,A},x=function(r,l){return s(r,l)&&I(r,l+6)+10<=r.length-l},D=function(r){for(var l=f(r),A=0;A<l.length;A++){var T=l[A];if(u(T))return o(T)}},u=function(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"},i=function(r){var l=String.fromCharCode(r[0],r[1],r[2],r[3]),A=I(r,4),T=10;return{type:l,size:A,data:r.subarray(T,T+A)}},f=function(r){for(var l=0,A=[];s(r,l);){var T=I(r,l+6);l+=10;for(var b=l+T;l+8<b;){var L=i(r.subarray(l)),E=p(L);E&&A.push(E),l+=L.size+10}t(r,l)&&(l+=10)}return A},p=function(r){return r.type==="PRIV"?g(r):r.type[0]==="W"?S(r):m(r)},g=function(r){if(!(r.size<2)){var l=e(r.data,!0),A=new Uint8Array(r.data.subarray(l.length+1));return{key:r.type,info:l,data:A.buffer}}},m=function(r){if(!(r.size<2)){if(r.type==="TXXX"){var l=1,A=e(r.data.subarray(l),!0);l+=A.length+1;var T=e(r.data.subarray(l));return{key:r.type,info:A,data:T}}var b=e(r.data.subarray(1));return{key:r.type,data:b}}},S=function(r){if(r.type==="WXXX"){if(r.size<2)return;var l=1,A=e(r.data.subarray(l),!0);l+=A.length+1;var T=e(r.data.subarray(l));return{key:r.type,info:A,data:T}}var b=e(r.data);return{key:r.type,data:b}},o=function(r){if(r.data.byteLength===8){var l=new Uint8Array(r.data),A=l[3]&1,T=(l[4]<<23)+(l[5]<<15)+(l[6]<<7)+l[7];return T/=45,A&&(T+=4772185884e-2),Math.round(T)}},e=function(r,l){l===void 0&&(l=!1);var A=v();if(A){var T=A.decode(r);if(l){var b=T.indexOf("\0");return b!==-1?T.substring(0,b):T}return T.replace(/\0/g,"")}for(var L=r.length,E,y,O,M="",R=0;R<L;){if(E=r[R++],E===0&&l)return M;if(E===0||E===3)continue;switch(E>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:M+=String.fromCharCode(E);break;case 12:case 13:y=r[R++],M+=String.fromCharCode((E&31)<<6|y&63);break;case 14:y=r[R++],O=r[R++],M+=String.fromCharCode((E&15)<<12|(y&63)<<6|(O&63)<<0);break}}return M},c={decodeTextFrame:m},h;function v(){return!h&&typeof self.TextDecoder<"u"&&(h=new self.TextDecoder("utf-8")),h}},"./src/demux/mp3demuxer.ts":function(P,C,n){n.r(C);var s=n("./src/demux/base-audio-demuxer.ts"),t=n("./src/demux/id3.ts"),d=n("./src/utils/logger.ts"),I=n("./src/demux/mpegaudio.ts");function x(i,f){i.prototype=Object.create(f.prototype),i.prototype.constructor=i,D(i,f)}function D(i,f){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,m){return g.__proto__=m,g},D(i,f)}var u=function(i){x(f,i);function f(){return i.apply(this,arguments)||this}var p=f.prototype;return p.resetInitSegment=function(m,S,o,e){i.prototype.resetInitSegment.call(this,m,S,o,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:S,duration:e,inputTimeScale:9e4,dropped:0}},f.probe=function(m){if(!m)return!1;for(var S=t.getID3Data(m,0)||[],o=S.length,e=m.length;o<e;o++)if(I.probe(m,o))return d.logger.log("MPEG Audio sync word found !"),!0;return!1},p.canParse=function(m,S){return I.canParse(m,S)},p.appendFrame=function(m,S,o){if(this.basePTS!==null)return I.appendFrame(m,S,o,this.basePTS,this.frameIndex)},f}(s.default);u.minProbeByteLength=4,C.default=u},"./src/demux/mp4demuxer.ts":function(P,C,n){n.r(C);var s=n("./src/polyfills/number.ts"),t=n("./src/types/demuxer.ts"),d=n("./src/utils/mp4-tools.ts"),I=n("./src/demux/dummy-demuxed-track.ts"),x=/\/emsg[-/]ID3/i,D=function(){function u(f,p){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=p}var i=u.prototype;return i.resetTimeStamp=function(){},i.resetInitSegment=function(p,g,m,S){var o=Object(d.parseInitSegment)(p),e=this.videoTrack=Object(I.dummyTrack)("video",1),c=this.audioTrack=Object(I.dummyTrack)("audio",1),h=this.txtTrack=Object(I.dummyTrack)("text",1);if(this.id3Track=Object(I.dummyTrack)("id3",1),this.timeOffset=0,o.video){var v=o.video,a=v.id,r=v.timescale,l=v.codec;e.id=a,e.timescale=h.timescale=r,e.codec=l}if(o.audio){var A=o.audio,T=A.id,b=A.timescale,L=A.codec;c.id=T,c.timescale=b,c.codec=L}h.id=d.RemuxerTrackIdConfig.text,e.sampleDuration=0,e.duration=c.duration=S},i.resetContiguity=function(){},u.probe=function(p){return p=p.length>16384?p.subarray(0,16384):p,Object(d.findBox)(p,["moof"]).length>0},i.demux=function(p,g){this.timeOffset=g;var m=p,S=this.videoTrack,o=this.txtTrack;if(this.config.progressive){this.remainderData&&(m=Object(d.appendUint8Array)(this.remainderData,p));var e=Object(d.segmentValidRange)(m);this.remainderData=e.remainder,S.samples=e.valid||new Uint8Array}else S.samples=m;var c=this.extractID3Track(S,g);return o.samples=Object(d.parseSamples)(g,S),{videoTrack:S,audioTrack:this.audioTrack,id3Track:c,textTrack:this.txtTrack}},i.flush=function(){var p=this.timeOffset,g=this.videoTrack,m=this.txtTrack;g.samples=this.remainderData||new Uint8Array,this.remainderData=null;var S=this.extractID3Track(g,this.timeOffset);return m.samples=Object(d.parseSamples)(p,g),{videoTrack:g,audioTrack:Object(I.dummyTrack)(),id3Track:S,textTrack:Object(I.dummyTrack)()}},i.extractID3Track=function(p,g){var m=this.id3Track;if(p.samples.length){var S=Object(d.findBox)(p.samples,["emsg"]);S&&S.forEach(function(o){var e=Object(d.parseEmsg)(o);if(x.test(e.schemeIdUri)){var c=Object(s.isFiniteNumber)(e.presentationTime)?e.presentationTime/e.timeScale:g+e.presentationTimeDelta/e.timeScale,h=e.payload;m.samples.push({data:h,len:h.byteLength,dts:c,pts:c,type:t.MetadataSchema.emsg})}})}return m},i.demuxSampleAes=function(p,g,m){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},i.destroy=function(){},u}();D.minProbeByteLength=1024,C.default=D},"./src/demux/mpegaudio.ts":function(P,C,n){n.r(C),n.d(C,"appendFrame",function(){return D}),n.d(C,"parseHeader",function(){return u}),n.d(C,"isHeaderPattern",function(){return i}),n.d(C,"isHeader",function(){return f}),n.d(C,"canParse",function(){return p}),n.d(C,"probe",function(){return g});var s=null,t=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],d=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],I=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],x=[0,1,1,4];function D(m,S,o,e,c){if(!(o+24>S.length)){var h=u(S,o);if(h&&o+h.frameLength<=S.length){var v=h.samplesPerFrame*9e4/h.sampleRate,a=e+c*v,r={unit:S.subarray(o,o+h.frameLength),pts:a,dts:a};return m.config=[],m.channelCount=h.channelCount,m.samplerate=h.sampleRate,m.samples.push(r),{sample:r,length:h.frameLength,missing:0}}}}function u(m,S){var o=m[S+1]>>3&3,e=m[S+1]>>1&3,c=m[S+2]>>4&15,h=m[S+2]>>2&3;if(o!==1&&c!==0&&c!==15&&h!==3){var v=m[S+2]>>1&1,a=m[S+3]>>6,r=o===3?3-e:e===3?3:4,l=t[r*14+c-1]*1e3,A=o===3?0:o===2?1:2,T=d[A*3+h],b=a===3?1:2,L=I[o][e],E=x[e],y=L*8*E,O=Math.floor(L*l/T+v)*E;if(s===null){var M=navigator.userAgent||"",R=M.match(/Chrome\/(\d+)/i);s=R?parseInt(R[1]):0}var F=!!s&&s<=87;return F&&e===2&&l>=224e3&&a===0&&(m[S+3]=m[S+3]|128),{sampleRate:T,channelCount:b,frameLength:O,samplesPerFrame:y}}}function i(m,S){return m[S]===255&&(m[S+1]&224)===224&&(m[S+1]&6)!==0}function f(m,S){return S+1<m.length&&i(m,S)}function p(m,S){var o=4;return i(m,S)&&o<=m.length-S}function g(m,S){if(S+1<m.length&&i(m,S)){var o=4,e=u(m,S),c=o;e!=null&&e.frameLength&&(c=e.frameLength);var h=S+c;return h===m.length||f(m,h)}return!1}},"./src/demux/sample-aes.ts":function(P,C,n){n.r(C);var s=n("./src/crypt/decrypter.ts"),t=n("./src/demux/tsdemuxer.ts"),d=function(){function I(D,u,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new s.default(D,u,{removePKCS7Padding:!1})}var x=I.prototype;return x.decryptBuffer=function(u,i){this.decrypter.decrypt(u,this.keyData.key.buffer,this.keyData.iv.buffer,i)},x.decryptAacSample=function(u,i,f,p){var g=u[i].unit;if(!(g.length<=16)){var m=g.subarray(16,g.length-g.length%16),S=m.buffer.slice(m.byteOffset,m.byteOffset+m.length),o=this;this.decryptBuffer(S,function(e){var c=new Uint8Array(e);g.set(c,16),p||o.decryptAacSamples(u,i+1,f)})}},x.decryptAacSamples=function(u,i,f){for(;;i++){if(i>=u.length){f();return}if(!(u[i].unit.length<32)){var p=this.decrypter.isSync();if(this.decryptAacSample(u,i,f,p),!p)return}}},x.getAvcEncryptedData=function(u){for(var i=Math.floor((u.length-48)/160)*16+16,f=new Int8Array(i),p=0,g=32;g<u.length-16;g+=160,p+=16)f.set(u.subarray(g,g+16),p);return f},x.getAvcDecryptedUnit=function(u,i){for(var f=new Uint8Array(i),p=0,g=32;g<u.length-16;g+=160,p+=16)u.set(f.subarray(p,p+16),g);return u},x.decryptAvcSample=function(u,i,f,p,g,m){var S=Object(t.discardEPB)(g.data),o=this.getAvcEncryptedData(S),e=this;this.decryptBuffer(o.buffer,function(c){g.data=e.getAvcDecryptedUnit(S,c),m||e.decryptAvcSamples(u,i,f+1,p)})},x.decryptAvcSamples=function(u,i,f,p){if(u instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;i++,f=0){if(i>=u.length){p();return}for(var g=u[i].units;!(f>=g.length);f++){var m=g[f];if(!(m.data.length<=48||m.type!==1&&m.type!==5)){var S=this.decrypter.isSync();if(this.decryptAvcSample(u,i,f,p,m,S),!S)return}}}},I}();C.default=d},"./src/demux/transmuxer-interface.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return f});var s=n("./node_modules/webworkify-webpack/index.js"),t=n("./src/events.ts"),d=n("./src/demux/transmuxer.ts"),I=n("./src/utils/logger.ts"),x=n("./src/errors.ts"),D=n("./src/utils/mediasource-helper.ts"),u=n("./node_modules/eventemitter3/index.js"),i=Object(D.getMediaSource)()||{isTypeSupported:function(){return!1}},f=function(){function p(m,S,o,e){var c=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=m,this.id=S,this.onTransmuxComplete=o,this.onFlush=e;var h=m.config,v=function(T,b){b=b||{},b.frag=c.frag,b.id=c.id,m.trigger(T,b)};this.observer=new u.EventEmitter,this.observer.on(t.Events.FRAG_DECRYPTED,v),this.observer.on(t.Events.ERROR,v);var a={mp4:i.isTypeSupported("video/mp4"),mpeg:i.isTypeSupported("audio/mpeg"),mp3:i.isTypeSupported('audio/mp4; codecs="mp3"')},r=navigator.vendor;if(h.enableWorker&&typeof Worker<"u"){I.logger.log("demuxing in webworker");var l;try{l=this.worker=s("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),l.addEventListener("message",this.onwmsg),l.onerror=function(A){m.trigger(t.Events.ERROR,{type:x.ErrorTypes.OTHER_ERROR,details:x.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(A.message+"  ("+A.filename+":"+A.lineno+")")})},l.postMessage({cmd:"init",typeSupported:a,vendor:r,id:S,config:JSON.stringify(h)})}catch(A){I.logger.warn("Error in worker:",A),I.logger.error("Error while initializing DemuxerWorker, fallback to inline"),l&&self.URL.revokeObjectURL(l.objectURL),this.transmuxer=new d.default(this.observer,a,h,r,S),this.worker=null}}else this.transmuxer=new d.default(this.observer,a,h,r,S)}var g=p.prototype;return g.destroy=function(){var S=this.worker;if(S)S.removeEventListener("message",this.onwmsg),S.terminate(),this.worker=null,this.onwmsg=void 0;else{var o=this.transmuxer;o&&(o.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},g.push=function(S,o,e,c,h,v,a,r,l,A){var T,b,L=this;l.transmuxing.start=self.performance.now();var E=this.transmuxer,y=this.worker,O=v?v.start:h.start,M=h.decryptdata,R=this.frag,F=!(R&&h.cc===R.cc),k=!(R&&l.level===R.level),w=R?l.sn-R.sn:-1,_=this.part?l.part-this.part.index:-1,B=w===0&&l.id>1&&l.id===(R==null?void 0:R.stats.chunkCount),N=!k&&(w===1||w===0&&(_===1||B&&_<=0)),U=self.performance.now();(k||w||h.stats.parsing.start===0)&&(h.stats.parsing.start=U),v&&(_||!N)&&(v.stats.parsing.start=U);var j=!(R&&((T=h.initSegment)===null||T===void 0?void 0:T.url)===((b=R.initSegment)===null||b===void 0?void 0:b.url)),K=new d.TransmuxState(F,N,r,k,O,j);if(!N||F||j){I.logger.log("[transmuxer-interface, "+h.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+`
        discontinuity: `+F+`
        trackSwitch: `+k+`
        contiguous: `+N+`
        accurateTimeOffset: `+r+`
        timeOffset: `+O+`
        initSegmentChange: `+j);var H=new d.TransmuxConfig(e,c,o,a,A);this.configureTransmuxer(H)}if(this.frag=h,this.part=v,y)y.postMessage({cmd:"demux",data:S,decryptdata:M,chunkMeta:l,state:K},S instanceof ArrayBuffer?[S]:[]);else if(E){var G=E.push(S,M,l,K);Object(d.isPromise)(G)?G.then(function(W){L.handleTransmuxComplete(W)}):this.handleTransmuxComplete(G)}},g.flush=function(S){var o=this;S.transmuxing.start=self.performance.now();var e=this.transmuxer,c=this.worker;if(c)c.postMessage({cmd:"flush",chunkMeta:S});else if(e){var h=e.flush(S);Object(d.isPromise)(h)?h.then(function(v){o.handleFlushResult(v,S)}):this.handleFlushResult(h,S)}},g.handleFlushResult=function(S,o){var e=this;S.forEach(function(c){e.handleTransmuxComplete(c)}),this.onFlush(o)},g.onWorkerMessage=function(S){var o=S.data,e=this.hls;switch(o.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(o.data);break}case"flush":{this.onFlush(o.data);break}case"workerLog":I.logger[o.data.logType]&&I.logger[o.data.logType](o.data.message);break;default:{o.data=o.data||{},o.data.frag=this.frag,o.data.id=this.id,e.trigger(o.event,o.data);break}}},g.configureTransmuxer=function(S){var o=this.worker,e=this.transmuxer;o?o.postMessage({cmd:"configure",config:S}):e&&e.configure(S)},g.handleTransmuxComplete=function(S){S.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(S)},p}()},"./src/demux/transmuxer-worker.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return x});var s=n("./src/demux/transmuxer.ts"),t=n("./src/events.ts"),d=n("./src/utils/logger.ts"),I=n("./node_modules/eventemitter3/index.js");function x(p){var g=new I.EventEmitter,m=function(e,c){p.postMessage({event:e,data:c})};g.on(t.Events.FRAG_DECRYPTED,m),g.on(t.Events.ERROR,m);var S=function(){var e=function(v){var a=function(l){m("workerLog",{logType:v,message:l})};d.logger[v]=a};for(var c in d.logger)e(c)};p.addEventListener("message",function(o){var e=o.data;switch(e.cmd){case"init":{var c=JSON.parse(e.config);p.transmuxer=new s.default(g,e.typeSupported,c,e.vendor,e.id),Object(d.enableLogs)(c.debug),S(),m("init",null);break}case"configure":{p.transmuxer.configure(e.config);break}case"demux":{var h=p.transmuxer.push(e.data,e.decryptdata,e.chunkMeta,e.state);Object(s.isPromise)(h)?h.then(function(r){D(p,r)}):D(p,h);break}case"flush":{var v=e.chunkMeta,a=p.transmuxer.flush(v);Object(s.isPromise)(a)?a.then(function(r){i(p,r,v)}):i(p,a,v);break}}})}function D(p,g){if(f(g.remuxResult))return!1;var m=[],S=g.remuxResult,o=S.audio,e=S.video;return o&&u(m,o),e&&u(m,e),p.postMessage({event:"transmuxComplete",data:g},m),!0}function u(p,g){g.data1&&p.push(g.data1.buffer),g.data2&&p.push(g.data2.buffer)}function i(p,g,m){var S=g.reduce(function(o,e){return D(p,e)||o},!1);S||p.postMessage({event:"transmuxComplete",data:g[0]}),p.postMessage({event:"flush",data:m})}function f(p){return!p.audio&&!p.video&&!p.text&&!p.id3&&!p.initSegment}},"./src/demux/transmuxer.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return c}),n.d(C,"isPromise",function(){return a}),n.d(C,"TransmuxConfig",function(){return r}),n.d(C,"TransmuxState",function(){return l});var s=n("./src/events.ts"),t=n("./src/errors.ts"),d=n("./src/crypt/decrypter.ts"),I=n("./src/demux/aacdemuxer.ts"),x=n("./src/demux/mp4demuxer.ts"),D=n("./src/demux/tsdemuxer.ts"),u=n("./src/demux/mp3demuxer.ts"),i=n("./src/remux/mp4-remuxer.ts"),f=n("./src/remux/passthrough-remuxer.ts"),p=n("./src/demux/chunk-cache.ts"),g=n("./src/utils/mp4-tools.ts"),m=n("./src/utils/logger.ts"),S;try{S=self.performance.now.bind(self.performance)}catch{m.logger.debug("Unable to use Performance API on this environment"),S=self.Date.now}var o=[{demux:D.default,remux:i.default},{demux:x.default,remux:f.default},{demux:I.default,remux:i.default},{demux:u.default,remux:i.default}],e=1024;o.forEach(function(A){var T=A.demux;e=Math.max(e,T.minProbeByteLength)});var c=function(){function A(b,L,E,y,O){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new p.default,this.observer=b,this.typeSupported=L,this.config=E,this.vendor=y,this.id=O}var T=A.prototype;return T.configure=function(L){this.transmuxConfig=L,this.decrypter&&this.decrypter.reset()},T.push=function(L,E,y,O){var M=this,R=y.transmuxing;R.executeStart=S();var F=new Uint8Array(L),k=this.cache,w=this.config,_=this.currentTransmuxState,B=this.transmuxConfig;O&&(this.currentTransmuxState=O);var N=h(F,E);if(N&&N.method==="AES-128"){var U=this.getDecrypter();if(w.enableSoftwareAES){var j=U.softwareDecrypt(F,N.key.buffer,N.iv.buffer);if(!j)return R.executeEnd=S(),v(y);F=new Uint8Array(j)}else return this.decryptionPromise=U.webCryptoDecrypt(F,N.key.buffer,N.iv.buffer).then(function(it){var nt=M.push(it,null,y);return M.decryptionPromise=null,nt}),this.decryptionPromise}var K=O||_,H=K.contiguous,G=K.discontinuity,W=K.trackSwitch,X=K.accurateTimeOffset,V=K.timeOffset,J=K.initSegmentChange,$=B.audioCodec,z=B.videoCodec,Q=B.defaultInitPts,q=B.duration,tt=B.initSegmentData;if((G||W||J)&&this.resetInitSegment(tt,$,z,q),(G||J)&&this.resetInitialTimestamp(Q),H||this.resetContiguity(),this.needsProbing(F,G,W)){if(k.dataLength){var et=k.flush();F=Object(g.appendUint8Array)(et,F)}this.configureTransmuxer(F,B)}var rt=this.transmux(F,N,V,X,y),Y=this.currentTransmuxState;return Y.contiguous=!0,Y.discontinuity=!1,Y.trackSwitch=!1,R.executeEnd=S(),rt},T.flush=function(L){var E=this,y=L.transmuxing;y.executeStart=S();var O=this.decrypter,M=this.cache,R=this.currentTransmuxState,F=this.decryptionPromise;if(F)return F.then(function(){return E.flush(L)});var k=[],w=R.timeOffset;if(O){var _=O.flush();_&&k.push(this.push(_,null,L))}var B=M.dataLength;M.reset();var N=this.demuxer,U=this.remuxer;if(!N||!U)return B>=e&&this.observer.emit(s.Events.ERROR,s.Events.ERROR,{type:t.ErrorTypes.MEDIA_ERROR,details:t.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),y.executeEnd=S(),[v(L)];var j=N.flush(w);return a(j)?j.then(function(K){return E.flushRemux(k,K,L),k}):(this.flushRemux(k,j,L),k)},T.flushRemux=function(L,E,y){var O=E.audioTrack,M=E.videoTrack,R=E.id3Track,F=E.textTrack,k=this.currentTransmuxState,w=k.accurateTimeOffset,_=k.timeOffset;m.logger.log("[transmuxer.ts]: Flushed fragment "+y.sn+(y.part>-1?" p: "+y.part:"")+" of level "+y.level);var B=this.remuxer.remux(O,M,R,F,_,w,!0,this.id);L.push({remuxResult:B,chunkMeta:y}),y.transmuxing.executeEnd=S()},T.resetInitialTimestamp=function(L){var E=this.demuxer,y=this.remuxer;!E||!y||(E.resetTimeStamp(L),y.resetTimeStamp(L))},T.resetContiguity=function(){var L=this.demuxer,E=this.remuxer;!L||!E||(L.resetContiguity(),E.resetNextTimestamp())},T.resetInitSegment=function(L,E,y,O){var M=this.demuxer,R=this.remuxer;!M||!R||(M.resetInitSegment(L,E,y,O),R.resetInitSegment(L,E,y))},T.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},T.transmux=function(L,E,y,O,M){var R;return E&&E.method==="SAMPLE-AES"?R=this.transmuxSampleAes(L,E,y,O,M):R=this.transmuxUnencrypted(L,y,O,M),R},T.transmuxUnencrypted=function(L,E,y,O){var M=this.demuxer.demux(L,E,!1,!this.config.progressive),R=M.audioTrack,F=M.videoTrack,k=M.id3Track,w=M.textTrack,_=this.remuxer.remux(R,F,k,w,E,y,!1,this.id);return{remuxResult:_,chunkMeta:O}},T.transmuxSampleAes=function(L,E,y,O,M){var R=this;return this.demuxer.demuxSampleAes(L,E,y).then(function(F){var k=R.remuxer.remux(F.audioTrack,F.videoTrack,F.id3Track,F.textTrack,y,O,!1,R.id);return{remuxResult:k,chunkMeta:M}})},T.configureTransmuxer=function(L,E){for(var y=this.config,O=this.observer,M=this.typeSupported,R=this.vendor,F=E.audioCodec,k=E.defaultInitPts,w=E.duration,_=E.initSegmentData,B=E.videoCodec,N,U=0,j=o.length;U<j;U++)if(o[U].demux.probe(L)){N=o[U];break}N||(m.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),N={demux:x.default,remux:f.default});var K=this.demuxer,H=this.remuxer,G=N.remux,W=N.demux;(!H||!(H instanceof G))&&(this.remuxer=new G(O,y,M,R)),(!K||!(K instanceof W))&&(this.demuxer=new W(O,y,M),this.probe=W.probe),this.resetInitSegment(_,F,B,w),this.resetInitialTimestamp(k)},T.needsProbing=function(L,E,y){return!this.demuxer||!this.remuxer||E||y},T.getDecrypter=function(){var L=this.decrypter;return L||(L=this.decrypter=new d.default(this.observer,this.config)),L},A}();function h(A,T){var b=null;return A.byteLength>0&&T!=null&&T.key!=null&&T.iv!==null&&T.method!=null&&(b=T),b}var v=function(T){return{remuxResult:{},chunkMeta:T}};function a(A){return"then"in A&&A.then instanceof Function}var r=function(T,b,L,E,y){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=T,this.videoCodec=b,this.initSegmentData=L,this.duration=E,this.defaultInitPts=y},l=function(T,b,L,E,y,O){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=T,this.contiguous=b,this.accurateTimeOffset=L,this.trackSwitch=E,this.timeOffset=y,this.initSegmentChange=O}},"./src/demux/tsdemuxer.ts":function(P,C,n){n.r(C),n.d(C,"discardEPB",function(){return h});var s=n("./src/demux/adts.ts"),t=n("./src/demux/mpegaudio.ts"),d=n("./src/demux/exp-golomb.ts"),I=n("./src/demux/sample-aes.ts"),x=n("./src/events.ts"),D=n("./src/utils/mp4-tools.ts"),u=n("./src/utils/logger.ts"),i=n("./src/errors.ts"),f=n("./src/types/demuxer.ts");function p(){return p=Object.assign?Object.assign.bind():function(v){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(v[l]=r[l])}return v},p.apply(this,arguments)}var g=function(){function v(r,l,A){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=r,this.config=l,this.typeSupported=A}v.probe=function(l){var A=v.syncOffset(l);return A<0?!1:(A&&u.logger.warn("MPEG2-TS detected but first sync word found @ offset "+A+", junk ahead ?"),!0)},v.syncOffset=function(l){for(var A=Math.min(1e3,l.length-564),T=0;T<A;){if(l[T]===71&&l[T+188]===71&&l[T+2*188]===71)return T;T++}return-1},v.createTrack=function(l,A){return{container:l==="video"||l==="audio"?"video/mp2t":void 0,type:l,id:D.RemuxerTrackIdConfig[l],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:l==="audio"?A:void 0}};var a=v.prototype;return a.resetInitSegment=function(l,A,T,b){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=v.createTrack("video"),this._audioTrack=v.createTrack("audio",b),this._id3Track=v.createTrack("id3"),this._txtTrack=v.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.audioCodec=A,this.videoCodec=T,this._duration=b},a.resetTimeStamp=function(){},a.resetContiguity=function(){var l=this._audioTrack,A=this._avcTrack,T=this._id3Track;l&&(l.pesData=null),A&&(A.pesData=null),T&&(T.pesData=null),this.aacOverFlow=null},a.demux=function(l,A,T,b){T===void 0&&(T=!1),b===void 0&&(b=!1),T||(this.sampleAes=null);var L,E=this._avcTrack,y=this._audioTrack,O=this._id3Track,M=this._txtTrack,R=E.pid,F=E.pesData,k=y.pid,w=O.pid,_=y.pesData,B=O.pesData,N=!1,U=this.pmtParsed,j=this._pmtId,K=l.length;if(this.remainderData&&(l=Object(D.appendUint8Array)(this.remainderData,l),K=l.length,this.remainderData=null),K<188&&!b)return this.remainderData=l,{audioTrack:y,videoTrack:E,id3Track:O,textTrack:M};var H=Math.max(0,v.syncOffset(l));K-=(K+H)%188,K<l.byteLength&&!b&&(this.remainderData=new Uint8Array(l.buffer,K,l.buffer.byteLength-K));for(var G=0,W=H;W<K;W+=188)if(l[W]===71){var X=!!(l[W+1]&64),V=((l[W+1]&31)<<8)+l[W+2],J=(l[W+3]&48)>>4,$=void 0;if(J>1){if($=W+5+l[W+4],$===W+188)continue}else $=W+4;switch(V){case R:X&&(F&&(L=e(F))&&this.parseAVCPES(E,M,L,!1),F={data:[],size:0}),F&&(F.data.push(l.subarray($,W+188)),F.size+=W+188-$);break;case k:if(X){if(_&&(L=e(_)))switch(y.segmentCodec){case"aac":this.parseAACPES(y,L);break;case"mp3":this.parseMPEGPES(y,L);break}_={data:[],size:0}}_&&(_.data.push(l.subarray($,W+188)),_.size+=W+188-$);break;case w:X&&(B&&(L=e(B))&&this.parseID3PES(O,L),B={data:[],size:0}),B&&(B.data.push(l.subarray($,W+188)),B.size+=W+188-$);break;case 0:X&&($+=l[$]+1),j=this._pmtId=S(l,$);break;case j:{X&&($+=l[$]+1);var z=o(l,$,this.typeSupported,T);R=z.avc,R>0&&(E.pid=R),k=z.audio,k>0&&(y.pid=k,y.segmentCodec=z.segmentCodec),w=z.id3,w>0&&(O.pid=w),N&&!U&&(u.logger.log("reparse from beginning"),N=!1,W=H-188),U=this.pmtParsed=!0;break}case 17:case 8191:break;default:N=!0;break}}else G++;G>0&&this.observer.emit(x.Events.ERROR,x.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+G+" TS packet/s that do not start with 0x47"}),E.pesData=F,y.pesData=_,O.pesData=B;var Q={audioTrack:y,videoTrack:E,id3Track:O,textTrack:M};return b&&this.extractRemainingSamples(Q),Q},a.flush=function(){var l=this.remainderData;this.remainderData=null;var A;return l?A=this.demux(l,-1,!1,!0):A={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(A),this.sampleAes?this.decrypt(A,this.sampleAes):A},a.extractRemainingSamples=function(l){var A=l.audioTrack,T=l.videoTrack,b=l.id3Track,L=l.textTrack,E=T.pesData,y=A.pesData,O=b.pesData,M;if(E&&(M=e(E))?(this.parseAVCPES(T,L,M,!0),T.pesData=null):T.pesData=E,y&&(M=e(y))){switch(A.segmentCodec){case"aac":this.parseAACPES(A,M);break;case"mp3":this.parseMPEGPES(A,M);break}A.pesData=null}else y!=null&&y.size&&u.logger.log("last AAC PES packet truncated,might overlap between fragments"),A.pesData=y;O&&(M=e(O))?(this.parseID3PES(b,M),b.pesData=null):b.pesData=O},a.demuxSampleAes=function(l,A,T){var b=this.demux(l,T,!0,!this.config.progressive),L=this.sampleAes=new I.default(this.observer,this.config,A);return this.decrypt(b,L)},a.decrypt=function(l,A){return new Promise(function(T){var b=l.audioTrack,L=l.videoTrack;b.samples&&b.segmentCodec==="aac"?A.decryptAacSamples(b.samples,0,function(){L.samples?A.decryptAvcSamples(L.samples,0,0,function(){T(l)}):T(l)}):L.samples&&A.decryptAvcSamples(L.samples,0,0,function(){T(l)})})},a.destroy=function(){this._duration=0},a.parseAVCPES=function(l,A,T,b){var L=this,E=this.parseAVCNALu(l,T.data),y=this.avcSample,O,M=!1;T.data=null,y&&E.length&&!l.audFound&&(c(y,l),y=this.avcSample=m(!1,T.pts,T.dts,"")),E.forEach(function(R){switch(R.type){case 1:{O=!0,y||(y=L.avcSample=m(!0,T.pts,T.dts,"")),y.frame=!0;var F=R.data;if(M&&F.length>4){var k=new d.default(F).readSliceType();(k===2||k===4||k===7||k===9)&&(y.key=!0)}break}case 5:O=!0,y||(y=L.avcSample=m(!0,T.pts,T.dts,"")),y.key=!0,y.frame=!0;break;case 6:{O=!0,Object(D.parseSEIMessageFromNALu)(h(R.data),T.pts,A.samples);break}case 7:if(O=!0,M=!0,!l.sps){var w=new d.default(R.data),_=w.readSPS();l.width=_.width,l.height=_.height,l.pixelRatio=_.pixelRatio,l.sps=[R.data],l.duration=L._duration;for(var B=R.data.subarray(1,4),N="avc1.",U=0;U<3;U++){var j=B[U].toString(16);j.length<2&&(j="0"+j),N+=j}l.codec=N}break;case 8:O=!0,l.pps||(l.pps=[R.data]);break;case 9:O=!1,l.audFound=!0,y&&c(y,l),y=L.avcSample=m(!1,T.pts,T.dts,"");break;case 12:O=!0;break;default:O=!1,y&&(y.debug+="unknown NAL "+R.type+" ");break}if(y&&O){var K=y.units;K.push(R)}}),b&&y&&(c(y,l),this.avcSample=null)},a.getLastNalUnit=function(l){var A,T=this.avcSample,b;if((!T||T.units.length===0)&&(T=l[l.length-1]),(A=T)!==null&&A!==void 0&&A.units){var L=T.units;b=L[L.length-1]}return b},a.parseAVCNALu=function(l,A){var T=A.byteLength,b=l.naluState||0,L=b,E=[],y=0,O,M,R,F=-1,k=0;for(b===-1&&(F=0,k=A[0]&31,b=0,y=1);y<T;){if(O=A[y++],!b){b=O?0:1;continue}if(b===1){b=O?0:2;continue}if(!O)b=3;else if(O===1){if(F>=0){var w={data:A.subarray(F,y-b-1),type:k};E.push(w)}else{var _=this.getLastNalUnit(l.samples);if(_&&(L&&y<=4-L&&_.state&&(_.data=_.data.subarray(0,_.data.byteLength-L)),M=y-b-1,M>0)){var B=new Uint8Array(_.data.byteLength+M);B.set(_.data,0),B.set(A.subarray(0,M),_.data.byteLength),_.data=B,_.state=0}}y<T?(R=A[y]&31,F=y,k=R,b=0):b=-1}else b=0}if(F>=0&&b>=0){var N={data:A.subarray(F,T),type:k,state:b};E.push(N)}if(E.length===0){var U=this.getLastNalUnit(l.samples);if(U){var j=new Uint8Array(U.data.byteLength+A.byteLength);j.set(U.data,0),j.set(A,U.data.byteLength),U.data=j}}return l.naluState=b,E},a.parseAACPES=function(l,A){var T=0,b=this.aacOverFlow,L=A.data;if(b){this.aacOverFlow=null;var E=b.missing,y=b.sample.unit.byteLength;if(E===-1){var O=new Uint8Array(y+L.byteLength);O.set(b.sample.unit,0),O.set(L,y),L=O}else{var M=y-E;b.sample.unit.set(L.subarray(0,E),M),l.samples.push(b.sample),T=b.missing}}var R,F;for(R=T,F=L.length;R<F-1&&!s.isHeader(L,R);R++);if(R!==T){var k,w;if(R<F-1?(k="AAC PES did not start with ADTS header,offset:"+R,w=!1):(k="no ADTS header found in AAC PES",w=!0),u.logger.warn("parsing error:"+k),this.observer.emit(x.Events.ERROR,x.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:w,reason:k}),w)return}s.initTrackConfig(l,this.observer,L,R,this.audioCodec);var _;if(A.pts!==void 0)_=A.pts;else if(b){var B=s.getFrameDuration(l.samplerate);_=b.sample.pts+B}else{u.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var N=0,U;R<F;)if(U=s.appendFrame(l,L,R,_,N),R+=U.length,U.missing){this.aacOverFlow=U;break}else for(N++;R<F-1&&!s.isHeader(L,R);R++);},a.parseMPEGPES=function(l,A){var T=A.data,b=T.length,L=0,E=0,y=A.pts;if(y===void 0){u.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;E<b;)if(t.isHeader(T,E)){var O=t.appendFrame(l,T,E,y,L);if(O)E+=O.length,L++;else break}else E++},a.parseID3PES=function(l,A){if(A.pts===void 0){u.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var T=p({},A,{type:this._avcTrack?f.MetadataSchema.emsg:f.MetadataSchema.audioId3});l.samples.push(T)},v}();g.minProbeByteLength=188;function m(v,a,r,l){return{key:v,frame:!1,pts:a,dts:r,units:[],debug:l,length:0}}function S(v,a){return(v[a+10]&31)<<8|v[a+11]}function o(v,a,r,l){var A={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},T=(v[a+1]&15)<<8|v[a+2],b=a+3+T-4,L=(v[a+10]&15)<<8|v[a+11];for(a+=12+L;a<b;){var E=(v[a+1]&31)<<8|v[a+2];switch(v[a]){case 207:if(!l){u.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:A.audio===-1&&(A.audio=E);break;case 21:A.id3===-1&&(A.id3=E);break;case 219:if(!l){u.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:A.avc===-1&&(A.avc=E);break;case 3:case 4:r.mpeg!==!0&&r.mp3!==!0?u.logger.log("MPEG audio found, not supported in this browser"):A.audio===-1&&(A.audio=E,A.segmentCodec="mp3");break;case 36:u.logger.warn("Unsupported HEVC stream type found");break}a+=((v[a+3]&15)<<8|v[a+4])+5}return A}function e(v){var a=0,r,l,A,T,b,L=v.data;if(!v||v.size===0)return null;for(;L[0].length<19&&L.length>1;){var E=new Uint8Array(L[0].length+L[1].length);E.set(L[0]),E.set(L[1],L[0].length),L[0]=E,L.splice(1,1)}r=L[0];var y=(r[0]<<16)+(r[1]<<8)+r[2];if(y===1){if(l=(r[4]<<8)+r[5],l&&l>v.size-6)return null;var O=r[7];O&192&&(T=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,O&64?(b=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,T-b>60*9e4&&(u.logger.warn(Math.round((T-b)/9e4)+"s delta between PTS and DTS, align them"),T=b)):b=T),A=r[8];var M=A+9;if(v.size<=M)return null;v.size-=M;for(var R=new Uint8Array(v.size),F=0,k=L.length;F<k;F++){r=L[F];var w=r.byteLength;if(M)if(M>w){M-=w;continue}else r=r.subarray(M),w-=M,M=0;R.set(r,a),a+=w}return l&&(l-=A+3),{data:R,pts:T,dts:b,len:l}}return null}function c(v,a){if(v.units.length&&v.frame){if(v.pts===void 0){var r=a.samples,l=r.length;if(l){var A=r[l-1];v.pts=A.pts,v.dts=A.dts}else{a.dropped++;return}}a.samples.push(v)}v.debug.length&&u.logger.log(v.pts+"/"+v.dts+":"+v.debug)}function h(v){for(var a=v.byteLength,r=[],l=1;l<a-2;)v[l]===0&&v[l+1]===0&&v[l+2]===3?(r.push(l+2),l+=2):l++;if(r.length===0)return v;var A=a-r.length,T=new Uint8Array(A),b=0;for(l=0;l<A;b++,l++)b===r[0]&&(b++,r.shift()),T[l]=v[b];return T}C.default=g},"./src/errors.ts":function(P,C,n){n.r(C),n.d(C,"ErrorTypes",function(){return s}),n.d(C,"ErrorDetails",function(){return t});var s;(function(d){d.NETWORK_ERROR="networkError",d.MEDIA_ERROR="mediaError",d.KEY_SYSTEM_ERROR="keySystemError",d.MUX_ERROR="muxError",d.OTHER_ERROR="otherError"})(s||(s={}));var t;(function(d){d.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",d.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",d.KEY_SYSTEM_NO_SESSION="keySystemNoSession",d.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",d.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",d.MANIFEST_LOAD_ERROR="manifestLoadError",d.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",d.MANIFEST_PARSING_ERROR="manifestParsingError",d.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",d.LEVEL_EMPTY_ERROR="levelEmptyError",d.LEVEL_LOAD_ERROR="levelLoadError",d.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",d.LEVEL_SWITCH_ERROR="levelSwitchError",d.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",d.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",d.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",d.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",d.FRAG_LOAD_ERROR="fragLoadError",d.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",d.FRAG_DECRYPT_ERROR="fragDecryptError",d.FRAG_PARSING_ERROR="fragParsingError",d.REMUX_ALLOC_ERROR="remuxAllocError",d.KEY_LOAD_ERROR="keyLoadError",d.KEY_LOAD_TIMEOUT="keyLoadTimeOut",d.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",d.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",d.BUFFER_APPEND_ERROR="bufferAppendError",d.BUFFER_APPENDING_ERROR="bufferAppendingError",d.BUFFER_STALLED_ERROR="bufferStalledError",d.BUFFER_FULL_ERROR="bufferFullError",d.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",d.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",d.INTERNAL_EXCEPTION="internalException",d.INTERNAL_ABORTED="aborted",d.UNKNOWN="unknown"})(t||(t={}))},"./src/events.ts":function(P,C,n){n.r(C),n.d(C,"Events",function(){return s});var s;(function(t){t.MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.BACK_BUFFER_REACHED="hlsBackBufferReached"})(s||(s={}))},"./src/hls.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return h});var s=n("./node_modules/url-toolkit/src/url-toolkit.js"),t=n("./src/loader/playlist-loader.ts"),d=n("./src/loader/key-loader.ts"),I=n("./src/controller/id3-track-controller.ts"),x=n("./src/controller/latency-controller.ts"),D=n("./src/controller/level-controller.ts"),u=n("./src/controller/fragment-tracker.ts"),i=n("./src/controller/stream-controller.ts"),f=n("./src/is-supported.ts"),p=n("./src/utils/logger.ts"),g=n("./src/config.ts"),m=n("./node_modules/eventemitter3/index.js"),S=n("./src/events.ts"),o=n("./src/errors.ts");function e(v,a){for(var r=0;r<a.length;r++){var l=a[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(v,l.key,l)}}function c(v,a,r){return a&&e(v.prototype,a),r&&e(v,r),Object.defineProperty(v,"prototype",{writable:!1}),v}var h=function(){v.isSupported=function(){return Object(f.isSupported)()};function v(r){r===void 0&&(r={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new m.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var l=this.config=Object(g.mergeConfig)(v.DefaultConfig,r);this.userConfig=r,Object(p.enableLogs)(l.debug),this._autoLevelCapping=-1,l.progressive&&Object(g.enableStreamingMode)(l);var A=l.abrController,T=l.bufferController,b=l.capLevelController,L=l.fpsController,E=this.abrController=new A(this),y=this.bufferController=new T(this),O=this.capLevelController=new b(this),M=new L(this),R=new t.default(this),F=new d.default(this),k=new I.default(this),w=this.levelController=new D.default(this),_=new u.FragmentTracker(this),B=this.streamController=new i.default(this,_);O.setStreamController(B),M.setStreamController(B);var N=[w,B];this.networkControllers=N;var U=[R,F,E,y,O,M,k,_];this.audioTrackController=this.createController(l.audioTrackController,null,N),this.createController(l.audioStreamController,_,N),this.subtitleTrackController=this.createController(l.subtitleTrackController,null,N),this.createController(l.subtitleStreamController,_,N),this.createController(l.timelineController,null,U),this.emeController=this.createController(l.emeController,null,U),this.cmcdController=this.createController(l.cmcdController,null,U),this.latencyController=this.createController(x.default,null,U),this.coreComponents=U}var a=v.prototype;return a.createController=function(l,A,T){if(l){var b=A?new l(this,A):new l(this);return T&&T.push(b),b}return null},a.on=function(l,A,T){T===void 0&&(T=this),this._emitter.on(l,A,T)},a.once=function(l,A,T){T===void 0&&(T=this),this._emitter.once(l,A,T)},a.removeAllListeners=function(l){this._emitter.removeAllListeners(l)},a.off=function(l,A,T,b){T===void 0&&(T=this),this._emitter.off(l,A,T,b)},a.listeners=function(l){return this._emitter.listeners(l)},a.emit=function(l,A,T){return this._emitter.emit(l,A,T)},a.trigger=function(l,A){if(this.config.debug)return this.emit(l,l,A);try{return this.emit(l,l,A)}catch(T){p.logger.error("An internal error happened while handling event "+l+'. Error message: "'+T.message+'". Here is a stacktrace:',T),this.trigger(S.Events.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:l,error:T})}return!1},a.listenerCount=function(l){return this._emitter.listenerCount(l)},a.destroy=function(){p.logger.log("destroy"),this.trigger(S.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(l){return l.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(l){return l.destroy()}),this.coreComponents.length=0},a.attachMedia=function(l){p.logger.log("attachMedia"),this._media=l,this.trigger(S.Events.MEDIA_ATTACHING,{media:l})},a.detachMedia=function(){p.logger.log("detachMedia"),this.trigger(S.Events.MEDIA_DETACHING,void 0),this._media=null},a.loadSource=function(l){this.stopLoad();var A=this.media,T=this.url,b=this.url=s.buildAbsoluteURL(self.location.href,l,{alwaysNormalize:!0});p.logger.log("loadSource:"+b),A&&T&&T!==b&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(A)),this.trigger(S.Events.MANIFEST_LOADING,{url:l})},a.startLoad=function(l){l===void 0&&(l=-1),p.logger.log("startLoad("+l+")"),this.networkControllers.forEach(function(A){A.startLoad(l)})},a.stopLoad=function(){p.logger.log("stopLoad"),this.networkControllers.forEach(function(l){l.stopLoad()})},a.swapAudioCodec=function(){p.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},a.recoverMediaError=function(){p.logger.log("recoverMediaError");var l=this._media;this.detachMedia(),l&&this.attachMedia(l)},a.removeLevel=function(l,A){A===void 0&&(A=0),this.levelController.removeLevel(l,A)},c(v,[{key:"levels",get:function(){var l=this.levelController.levels;return l||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(l){p.logger.log("set currentLevel:"+l),this.loadLevel=l,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(l){p.logger.log("set nextLevel:"+l),this.levelController.manualLevel=l,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(l){p.logger.log("set loadLevel:"+l),this.levelController.manualLevel=l}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(l){this.levelController.nextLoadLevel=l}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(l){p.logger.log("set firstLevel:"+l),this.levelController.firstLevel=l}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(l){p.logger.log("set startLevel:"+l),l!==-1&&(l=Math.max(l,this.minAutoLevel)),this.levelController.startLevel=l}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(l){var A=!!l;A!==this.config.capLevelToPlayerSize&&(A?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=A)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(l){this._autoLevelCapping!==l&&(p.logger.log("set autoLevelCapping:"+l),this._autoLevelCapping=l)}},{key:"bandwidthEstimate",get:function(){var l=this.abrController.bwEstimator;return l?l.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var l=this.levels,A=this.config.minAutoBitrate;if(!l)return 0;for(var T=l.length,b=0;b<T;b++)if(l[b].maxBitrate>=A)return b;return 0}},{key:"maxAutoLevel",get:function(){var l=this.levels,A=this.autoLevelCapping,T;return A===-1&&l&&l.length?T=l.length-1:T=A,T}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(l){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,l)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function(){var l=this.audioTrackController;return l?l.audioTracks:[]}},{key:"audioTrack",get:function(){var l=this.audioTrackController;return l?l.audioTrack:-1},set:function(l){var A=this.audioTrackController;A&&(A.audioTrack=l)}},{key:"subtitleTracks",get:function(){var l=this.subtitleTrackController;return l?l.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var l=this.subtitleTrackController;return l?l.subtitleTrack:-1},set:function(l){var A=this.subtitleTrackController;A&&(A.subtitleTrack=l)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var l=this.subtitleTrackController;return l?l.subtitleDisplay:!1},set:function(l){var A=this.subtitleTrackController;A&&(A.subtitleDisplay=l)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(l){this.config.lowLatencyMode=l}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.1"}},{key:"Events",get:function(){return S.Events}},{key:"ErrorTypes",get:function(){return o.ErrorTypes}},{key:"ErrorDetails",get:function(){return o.ErrorDetails}},{key:"DefaultConfig",get:function(){return v.defaultConfig?v.defaultConfig:g.hlsDefaultConfig},set:function(l){v.defaultConfig=l}}]),v}();h.defaultConfig=void 0},"./src/is-supported.ts":function(P,C,n){n.r(C),n.d(C,"isSupported",function(){return d}),n.d(C,"changeTypeSupported",function(){return I});var s=n("./src/utils/mediasource-helper.ts");function t(){return self.SourceBuffer||self.WebKitSourceBuffer}function d(){var x=Object(s.getMediaSource)();if(!x)return!1;var D=t(),u=x&&typeof x.isTypeSupported=="function"&&x.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!D||D.prototype&&typeof D.prototype.appendBuffer=="function"&&typeof D.prototype.remove=="function";return!!u&&!!i}function I(){var x,D=t();return typeof(D==null||(x=D.prototype)===null||x===void 0?void 0:x.changeType)=="function"}},"./src/loader/date-range.ts":function(P,C,n){n.r(C),n.d(C,"DateRangeAttribute",function(){return u}),n.d(C,"DateRange",function(){return i});var s=n("./src/polyfills/number.ts"),t=n("./src/utils/attr-list.ts"),d=n("./src/utils/logger.ts");function I(){return I=Object.assign?Object.assign.bind():function(f){for(var p=1;p<arguments.length;p++){var g=arguments[p];for(var m in g)Object.prototype.hasOwnProperty.call(g,m)&&(f[m]=g[m])}return f},I.apply(this,arguments)}function x(f,p){for(var g=0;g<p.length;g++){var m=p[g];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(f,m.key,m)}}function D(f,p,g){return p&&x(f.prototype,p),g&&x(f,g),Object.defineProperty(f,"prototype",{writable:!1}),f}var u;(function(f){f.ID="ID",f.CLASS="CLASS",f.START_DATE="START-DATE",f.DURATION="DURATION",f.END_DATE="END-DATE",f.END_ON_NEXT="END-ON-NEXT",f.PLANNED_DURATION="PLANNED-DURATION",f.SCTE35_OUT="SCTE35-OUT",f.SCTE35_IN="SCTE35-IN"})(u||(u={}));var i=function(){function f(p,g){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,g){var m=g.attr;for(var S in m)if(Object.prototype.hasOwnProperty.call(p,S)&&p[S]!==m[S]){d.logger.warn('DATERANGE tag attribute: "'+S+'" does not match for tags with ID: "'+p.ID+'"'),this._badValueForSameId=S;break}p=I(new t.AttrList({}),m,p)}if(this.attr=p,this._startDate=new Date(p[u.START_DATE]),u.END_DATE in this.attr){var o=new Date(this.attr[u.END_DATE]);Object(s.isFiniteNumber)(o.getTime())&&(this._endDate=o)}}return D(f,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var g=this.duration;return g!==null?new Date(this._startDate.getTime()+g*1e3):null}},{key:"duration",get:function(){if(u.DURATION in this.attr){var g=this.attr.decimalFloatingPoint(u.DURATION);if(Object(s.isFiniteNumber)(g))return g}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return u.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(u.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(u.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(s.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),f}()},"./src/loader/fragment-loader.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return g}),n.d(C,"LoadError",function(){return S});var s=n("./src/polyfills/number.ts"),t=n("./src/errors.ts");function d(o,e){o.prototype=Object.create(e.prototype),o.prototype.constructor=o,i(o,e)}function I(o){var e=typeof Map=="function"?new Map:void 0;return I=function(h){if(h===null||!u(h))return h;if(typeof h!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(h))return e.get(h);e.set(h,v)}function v(){return x(h,arguments,f(this).constructor)}return v.prototype=Object.create(h.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),i(v,h)},I(o)}function x(o,e,c){return D()?x=Reflect.construct.bind():x=function(v,a,r){var l=[null];l.push.apply(l,a);var A=Function.bind.apply(v,l),T=new A;return r&&i(T,r.prototype),T},x.apply(null,arguments)}function D(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function u(o){return Function.toString.call(o).indexOf("[native code]")!==-1}function i(o,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,v){return h.__proto__=v,h},i(o,e)}function f(o){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(c){return c.__proto__||Object.getPrototypeOf(c)},f(o)}var p=Math.pow(2,17),g=function(){function o(c){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=c}var e=o.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(h,v){var a=this,r=h.url;if(!r)return Promise.reject(new S({type:t.ErrorTypes.NETWORK_ERROR,details:t.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,networkDetails:null},"Fragment does not have a "+(r?"part list":"url")));this.abort();var l=this.config,A=l.fLoader,T=l.loader;return new Promise(function(b,L){a.loader&&a.loader.destroy();var E=a.loader=h.loader=A?new A(l):new T(l),y=m(h),O={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:h.sn==="initSegment"?1/0:p};h.stats=E.stats,E.load(y,O,{onSuccess:function(R,F,k,w){a.resetLoader(h,E),b({frag:h,part:null,payload:R.data,networkDetails:w})},onError:function(R,F,k){a.resetLoader(h,E),L(new S({type:t.ErrorTypes.NETWORK_ERROR,details:t.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,response:R,networkDetails:k}))},onAbort:function(R,F,k){a.resetLoader(h,E),L(new S({type:t.ErrorTypes.NETWORK_ERROR,details:t.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:h,networkDetails:k}))},onTimeout:function(R,F,k){a.resetLoader(h,E),L(new S({type:t.ErrorTypes.NETWORK_ERROR,details:t.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:h,networkDetails:k}))},onProgress:function(R,F,k,w){v&&v({frag:h,part:null,payload:k,networkDetails:w})}})})},e.loadPart=function(h,v,a){var r=this;this.abort();var l=this.config,A=l.fLoader,T=l.loader;return new Promise(function(b,L){r.loader&&r.loader.destroy();var E=r.loader=h.loader=A?new A(l):new T(l),y=m(h,v),O={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:p};v.stats=E.stats,E.load(y,O,{onSuccess:function(R,F,k,w){r.resetLoader(h,E),r.updateStatsFromPart(h,v);var _={frag:h,part:v,payload:R.data,networkDetails:w};a(_),b(_)},onError:function(R,F,k){r.resetLoader(h,E),L(new S({type:t.ErrorTypes.NETWORK_ERROR,details:t.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,part:v,response:R,networkDetails:k}))},onAbort:function(R,F,k){h.stats.aborted=v.stats.aborted,r.resetLoader(h,E),L(new S({type:t.ErrorTypes.NETWORK_ERROR,details:t.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:h,part:v,networkDetails:k}))},onTimeout:function(R,F,k){r.resetLoader(h,E),L(new S({type:t.ErrorTypes.NETWORK_ERROR,details:t.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:h,part:v,networkDetails:k}))}})})},e.updateStatsFromPart=function(h,v){var a=h.stats,r=v.stats,l=r.total;if(a.loaded+=r.loaded,l){var A=Math.round(h.duration/v.duration),T=Math.min(Math.round(a.loaded/l),A),b=A-T,L=b*Math.round(a.loaded/T);a.total=a.loaded+L}else a.total=Math.max(a.loaded,a.total);var E=a.loading,y=r.loading;E.start?E.first+=y.first-y.start:(E.start=y.start,E.first=y.first),E.end=y.end},e.resetLoader=function(h,v){h.loader=null,this.loader===v&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),v.destroy()},o}();function m(o,e){e===void 0&&(e=null);var c=e||o,h={frag:o,part:e,responseType:"arraybuffer",url:c.url,headers:{},rangeStart:0,rangeEnd:0},v=c.byteRangeStartOffset,a=c.byteRangeEndOffset;return Object(s.isFiniteNumber)(v)&&Object(s.isFiniteNumber)(a)&&(h.rangeStart=v,h.rangeEnd=a),h}var S=function(o){d(e,o);function e(c){for(var h,v=arguments.length,a=new Array(v>1?v-1:0),r=1;r<v;r++)a[r-1]=arguments[r];return h=o.call.apply(o,[this].concat(a))||this,h.data=void 0,h.data=c,h}return e}(I(Error))},"./src/loader/fragment.ts":function(P,C,n){n.r(C),n.d(C,"ElementaryStreamTypes",function(){return p}),n.d(C,"BaseSegment",function(){return g}),n.d(C,"Fragment",function(){return m}),n.d(C,"Part",function(){return S});var s=n("./src/polyfills/number.ts"),t=n("./node_modules/url-toolkit/src/url-toolkit.js"),d=n("./src/utils/logger.ts"),I=n("./src/loader/level-key.ts"),x=n("./src/loader/load-stats.ts");function D(o,e){o.prototype=Object.create(e.prototype),o.prototype.constructor=o,u(o,e)}function u(o,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,v){return h.__proto__=v,h},u(o,e)}function i(o,e){for(var c=0;c<e.length;c++){var h=e[c];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(o,h.key,h)}}function f(o,e,c){return e&&i(o.prototype,e),c&&i(o,c),Object.defineProperty(o,"prototype",{writable:!1}),o}var p;(function(o){o.AUDIO="audio",o.VIDEO="video",o.AUDIOVIDEO="audiovideo"})(p||(p={}));var g=function(){function o(c){var h;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(h={},h[p.AUDIO]=null,h[p.VIDEO]=null,h[p.AUDIOVIDEO]=null,h),this.baseurl=c}var e=o.prototype;return e.setByteRange=function(h,v){var a=h.split("@",2),r=[];a.length===1?r[0]=v?v.byteRangeEndOffset:0:r[0]=parseInt(a[1]),r[1]=parseInt(a[0])+r[0],this._byteRange=r},f(o,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(t.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(h){this._url=h}}]),o}(),m=function(o){D(e,o);function e(h,v){var a;return a=o.call(this,v)||this,a._decryptdata=null,a.rawProgramDateTime=null,a.programDateTime=null,a.tagList=[],a.duration=0,a.sn=0,a.levelkey=void 0,a.type=void 0,a.loader=null,a.level=-1,a.cc=0,a.startPTS=void 0,a.endPTS=void 0,a.appendedPTS=void 0,a.startDTS=void 0,a.endDTS=void 0,a.start=0,a.deltaPTS=void 0,a.maxStartPTS=void 0,a.minEndPTS=void 0,a.stats=new x.LoadStats,a.urlId=0,a.data=void 0,a.bitrateTest=!1,a.title=null,a.initSegment=null,a.type=h,a}var c=e.prototype;return c.createInitializationVector=function(v){for(var a=new Uint8Array(16),r=12;r<16;r++)a[r]=v>>8*(15-r)&255;return a},c.setDecryptDataFromLevelKey=function(v,a){var r=v;return(v==null?void 0:v.method)==="AES-128"&&v.uri&&!v.iv&&(r=I.LevelKey.fromURI(v.uri),r.method=v.method,r.iv=this.createInitializationVector(a),r.keyFormat="identity"),r},c.setElementaryStreamInfo=function(v,a,r,l,A,T){T===void 0&&(T=!1);var b=this.elementaryStreams,L=b[v];if(!L){b[v]={startPTS:a,endPTS:r,startDTS:l,endDTS:A,partial:T};return}L.startPTS=Math.min(L.startPTS,a),L.endPTS=Math.max(L.endPTS,r),L.startDTS=Math.min(L.startDTS,l),L.endDTS=Math.max(L.endDTS,A)},c.clearElementaryStreamInfo=function(){var v=this.elementaryStreams;v[p.AUDIO]=null,v[p.VIDEO]=null,v[p.AUDIOVIDEO]=null},f(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var v=this.sn;typeof v!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&d.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),v=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,v)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(s.isFiniteNumber)(this.programDateTime))return null;var v=Object(s.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+v*1e3}},{key:"encrypted",get:function(){var v;return!!((v=this.decryptdata)!==null&&v!==void 0&&v.keyFormat&&this.decryptdata.uri)}}]),e}(g),S=function(o){D(e,o);function e(c,h,v,a,r){var l;l=o.call(this,v)||this,l.fragOffset=0,l.duration=0,l.gap=!1,l.independent=!1,l.relurl=void 0,l.fragment=void 0,l.index=void 0,l.stats=new x.LoadStats,l.duration=c.decimalFloatingPoint("DURATION"),l.gap=c.bool("GAP"),l.independent=c.bool("INDEPENDENT"),l.relurl=c.enumeratedString("URI"),l.fragment=h,l.index=a;var A=c.enumeratedString("BYTERANGE");return A&&l.setByteRange(A,r),r&&(l.fragOffset=r.fragOffset+r.duration),l}return f(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var h=this.elementaryStreams;return!!(h.audio||h.video||h.audiovideo)}}]),e}(g)},"./src/loader/key-loader.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return I});var s=n("./src/events.ts"),t=n("./src/errors.ts"),d=n("./src/utils/logger.ts"),I=function(){function x(u){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=u,this._registerListeners()}var D=x.prototype;return D._registerListeners=function(){this.hls.on(s.Events.KEY_LOADING,this.onKeyLoading,this)},D._unregisterListeners=function(){this.hls.off(s.Events.KEY_LOADING,this.onKeyLoading)},D.destroy=function(){this._unregisterListeners();for(var i in this.loaders){var f=this.loaders[i];f&&f.destroy()}this.loaders={}},D.onKeyLoading=function(i,f){var p=f.frag,g=p.type,m=this.loaders[g];if(!p.decryptdata){d.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var S=p.decryptdata.uri;if(S!==this.decrypturl||this.decryptkey===null){var o=this.hls.config;if(m&&(d.logger.warn("abort previous key loader for type:"+g),m.abort()),!S){d.logger.warn("key uri is falsy");return}var e=o.loader,c=p.loader=this.loaders[g]=new e(o);this.decrypturl=S,this.decryptkey=null;var h={url:S,frag:p,responseType:"arraybuffer"},v={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:0},a={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};c.load(h,v,a)}else this.decryptkey&&(p.decryptdata.key=this.decryptkey,this.hls.trigger(s.Events.KEY_LOADED,{frag:p}))},D.loadsuccess=function(i,f,p){var g=p.frag;if(!g.decryptdata){d.logger.error("after key load, decryptdata unset");return}this.decryptkey=g.decryptdata.key=new Uint8Array(i.data),g.loader=null,delete this.loaders[g.type],this.hls.trigger(s.Events.KEY_LOADED,{frag:g})},D.loaderror=function(i,f){var p=f.frag,g=p.loader;g&&g.abort(),delete this.loaders[p.type],this.hls.trigger(s.Events.ERROR,{type:t.ErrorTypes.NETWORK_ERROR,details:t.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:p,response:i})},D.loadtimeout=function(i,f){var p=f.frag,g=p.loader;g&&g.abort(),delete this.loaders[p.type],this.hls.trigger(s.Events.ERROR,{type:t.ErrorTypes.NETWORK_ERROR,details:t.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:p})},x}()},"./src/loader/level-details.ts":function(P,C,n){n.r(C),n.d(C,"LevelDetails",function(){return x});var s=n("./src/polyfills/number.ts");function t(D,u){for(var i=0;i<u.length;i++){var f=u[i];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(D,f.key,f)}}function d(D,u,i){return u&&t(D.prototype,u),i&&t(D,i),Object.defineProperty(D,"prototype",{writable:!1}),D}var I=10,x=function(){function D(i){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=i}var u=D.prototype;return u.reloaded=function(f){if(!f){this.advanced=!0,this.updated=!0;return}var p=this.lastPartSn-f.lastPartSn,g=this.lastPartIndex-f.lastPartIndex;this.updated=this.endSN!==f.endSN||!!g||!!p,this.advanced=this.endSN>f.endSN||p>0||p===0&&g>0,this.updated||this.advanced?this.misses=Math.floor(f.misses*.6):this.misses=f.misses+1,this.availabilityDelay=f.availabilityDelay},d(D,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(s.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||I}},{key:"drift",get:function(){var f=this.driftEndTime-this.driftStartTime;if(f>0){var p=this.driftEnd-this.driftStart;return p*1e3/f}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var f;return(f=this.partList)!==null&&f!==void 0&&f.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var f;return(f=this.fragments)!==null&&f!==void 0&&f.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var f;return(f=this.partList)!==null&&f!==void 0&&f.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var f;return(f=this.partList)!==null&&f!==void 0&&f.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),D}()},"./src/loader/level-key.ts":function(P,C,n){n.r(C),n.d(C,"LevelKey",function(){return I});var s=n("./node_modules/url-toolkit/src/url-toolkit.js");function t(x,D){for(var u=0;u<D.length;u++){var i=D[u];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(x,i.key,i)}}function d(x,D,u){return D&&t(x.prototype,D),u&&t(x,u),Object.defineProperty(x,"prototype",{writable:!1}),x}var I=function(){x.fromURL=function(u,i){return new x(u,i)},x.fromURI=function(u){return new x(u)};function x(D,u){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,u?this._uri=Object(s.buildAbsoluteURL)(D,u,{alwaysNormalize:!0}):this._uri=D}return d(x,[{key:"uri",get:function(){return this._uri}}]),x}()},"./src/loader/load-stats.ts":function(P,C,n){n.r(C),n.d(C,"LoadStats",function(){return s});var s=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return c});var s=n("./src/polyfills/number.ts"),t=n("./node_modules/url-toolkit/src/url-toolkit.js"),d=n("./src/loader/date-range.ts"),I=n("./src/loader/fragment.ts"),x=n("./src/loader/level-details.ts"),D=n("./src/loader/level-key.ts"),u=n("./src/utils/attr-list.ts"),i=n("./src/utils/logger.ts"),f=n("./src/utils/codecs.ts"),p=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,g=/#EXT-X-MEDIA:(.*)/g,m=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),S=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),o=/\.(mp4|m4s|m4v|m4a)$/i;function e(A){var T,b;return o.test((T=(b=t.parseURL(A))===null||b===void 0?void 0:b.path)!=null?T:"")}var c=function(){function A(){}return A.findGroup=function(b,L){for(var E=0;E<b.length;E++){var y=b[E];if(y.id===L)return y}},A.convertAVC1ToAVCOTI=function(b){var L=b.split(".");if(L.length>2){var E=L.shift()+".";return E+=parseInt(L.shift()).toString(16),E+=("000"+parseInt(L.shift()).toString(16)).slice(-4),E}return b},A.resolve=function(b,L){return t.buildAbsoluteURL(L,b,{alwaysNormalize:!0})},A.parseMasterPlaylist=function(b,L){var E=[],y={},O=!1;p.lastIndex=0;for(var M;(M=p.exec(b))!=null;)if(M[1]){var R=new u.AttrList(M[1]),F={attrs:R,bitrate:R.decimalInteger("AVERAGE-BANDWIDTH")||R.decimalInteger("BANDWIDTH"),name:R.NAME,url:A.resolve(M[2],L)},k=R.decimalResolution("RESOLUTION");k&&(F.width=k.width,F.height=k.height),h((R.CODECS||"").split(/[ ,]+/).filter(function(_){return _}),F),F.videoCodec&&F.videoCodec.indexOf("avc1")!==-1&&(F.videoCodec=A.convertAVC1ToAVCOTI(F.videoCodec)),E.push(F)}else if(M[3]){var w=new u.AttrList(M[3]);w["DATA-ID"]&&(O=!0,y[w["DATA-ID"]]=w)}return{levels:E,sessionData:O?y:null}},A.parseMasterPlaylistMedia=function(b,L,E,y){y===void 0&&(y=[]);var O,M=[],R=0;for(g.lastIndex=0;(O=g.exec(b))!==null;){var F=new u.AttrList(O[1]);if(F.TYPE===E){var k={attrs:F,bitrate:0,id:R++,groupId:F["GROUP-ID"],instreamId:F["INSTREAM-ID"],name:F.NAME||F.LANGUAGE||"",type:E,default:F.bool("DEFAULT"),autoselect:F.bool("AUTOSELECT"),forced:F.bool("FORCED"),lang:F.LANGUAGE,url:F.URI?A.resolve(F.URI,L):""};if(y.length){var w=A.findGroup(y,k.groupId)||y[0];v(k,w,"audioCodec"),v(k,w,"textCodec")}M.push(k)}}return M},A.parseLevelPlaylist=function(b,L,E,y,O){var M=new x.LevelDetails(L),R=M.fragments,F=null,k=0,w=0,_=0,B=0,N=null,U=new I.Fragment(y,L),j,K,H,G=-1,W=!1;for(m.lastIndex=0,M.m3u8=b;(j=m.exec(b))!==null;){W&&(W=!1,U=new I.Fragment(y,L),U.start=_,U.sn=k,U.cc=B,U.level=E,F&&(U.initSegment=F,U.rawProgramDateTime=F.rawProgramDateTime,F.rawProgramDateTime=null));var X=j[1];if(X){U.duration=parseFloat(X);var V=(" "+j[2]).slice(1);U.title=V||null,U.tagList.push(V?["INF",X,V]:["INF",X])}else if(j[3])Object(s.isFiniteNumber)(U.duration)&&(U.start=_,H&&(U.levelkey=H),U.sn=k,U.level=E,U.cc=B,U.urlId=O,R.push(U),U.relurl=(" "+j[3]).slice(1),r(U,N),N=U,_+=U.duration,k++,w=0,W=!0);else if(j[4]){var J=(" "+j[4]).slice(1);N?U.setByteRange(J,N):U.setByteRange(J)}else if(j[5])U.rawProgramDateTime=(" "+j[5]).slice(1),U.tagList.push(["PROGRAM-DATE-TIME",U.rawProgramDateTime]),G===-1&&(G=R.length);else{if(j=j[0].match(S),!j){i.logger.warn("No matches on slow regex match for level playlist!");continue}for(K=1;K<j.length&&!(typeof j[K]<"u");K++);var $=(" "+j[K]).slice(1),z=(" "+j[K+1]).slice(1),Q=j[K+2]?(" "+j[K+2]).slice(1):"";switch($){case"PLAYLIST-TYPE":M.type=z.toUpperCase();break;case"MEDIA-SEQUENCE":k=M.startSN=parseInt(z);break;case"SKIP":{var q=new u.AttrList(z),tt=q.decimalInteger("SKIPPED-SEGMENTS");if(Object(s.isFiniteNumber)(tt)){M.skippedSegments=tt;for(var et=tt;et--;)R.unshift(null);k+=tt}var rt=q.enumeratedString("RECENTLY-REMOVED-DATERANGES");rt&&(M.recentlyRemovedDateranges=rt.split("	"));break}case"TARGETDURATION":M.targetduration=parseFloat(z);break;case"VERSION":M.version=parseInt(z);break;case"EXTM3U":break;case"ENDLIST":M.live=!1;break;case"#":(z||Q)&&U.tagList.push(Q?[z,Q]:[z]);break;case"DISCONTINUITY":B++,U.tagList.push(["DIS"]);break;case"GAP":U.tagList.push([$]);break;case"BITRATE":U.tagList.push([$,z]);break;case"DATERANGE":{var Y=new u.AttrList(z),it=new d.DateRange(Y,M.dateRanges[Y.ID]);it.isValid||M.skippedSegments?M.dateRanges[it.id]=it:i.logger.warn('Ignoring invalid DATERANGE tag: "'+z+'"'),U.tagList.push(["EXT-X-DATERANGE",z]);break}case"DISCONTINUITY-SEQUENCE":B=parseInt(z);break;case"KEY":{var nt,at=new u.AttrList(z),ut=at.enumeratedString("METHOD"),st=at.URI,vt=at.hexadecimalInteger("IV"),ot=at.enumeratedString("KEYFORMATVERSIONS"),ft=at.enumeratedString("KEYID"),pt=(nt=at.enumeratedString("KEYFORMAT"))!=null?nt:"identity",yt=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(yt.indexOf(pt)>-1){i.logger.warn("Keyformat "+pt+" is not supported from the manifest");continue}else if(pt!=="identity")continue;ut&&(H=D.LevelKey.fromURL(L,st),st&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(ut)>=0&&(H.method=ut,H.keyFormat=pt,ft&&(H.keyID=ft),ot&&(H.keyFormatVersions=ot),H.iv=vt));break}case"START":{var mt=new u.AttrList(z),lt=mt.decimalFloatingPoint("TIME-OFFSET");Object(s.isFiniteNumber)(lt)&&(M.startTimeOffset=lt);break}case"MAP":{var dt=new u.AttrList(z);if(U.duration){var ct=new I.Fragment(y,L);l(ct,dt,E,H),F=ct,U.initSegment=F,F.rawProgramDateTime&&!U.rawProgramDateTime&&(U.rawProgramDateTime=F.rawProgramDateTime)}else l(U,dt,E,H),F=U,W=!0;break}case"SERVER-CONTROL":{var Z=new u.AttrList(z);M.canBlockReload=Z.bool("CAN-BLOCK-RELOAD"),M.canSkipUntil=Z.optionalFloat("CAN-SKIP-UNTIL",0),M.canSkipDateRanges=M.canSkipUntil>0&&Z.bool("CAN-SKIP-DATERANGES"),M.partHoldBack=Z.optionalFloat("PART-HOLD-BACK",0),M.holdBack=Z.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Et=new u.AttrList(z);M.partTarget=Et.decimalFloatingPoint("PART-TARGET");break}case"PART":{var ht=M.partList;ht||(ht=M.partList=[]);var gt=w>0?ht[ht.length-1]:void 0,St=w++,bt=new I.Part(new u.AttrList(z),U,L,St,gt);ht.push(bt),U.duration+=bt.duration;break}case"PRELOAD-HINT":{var Dt=new u.AttrList(z);M.preloadHint=Dt;break}case"RENDITION-REPORT":{var Tt=new u.AttrList(z);M.renditionReports=M.renditionReports||[],M.renditionReports.push(Tt);break}default:i.logger.warn("line parsed but not handled: "+j);break}}}N&&!N.relurl?(R.pop(),_-=N.duration,M.partList&&(M.fragmentHint=N)):M.partList&&(r(U,N),U.cc=B,M.fragmentHint=U);var Ot=R.length,It=R[0],Lt=R[Ot-1];if(_+=M.skippedSegments*M.targetduration,_>0&&Ot&&Lt){M.averagetargetduration=_/Ot;var Mt=Lt.sn;M.endSN=Mt!=="initSegment"?Mt:0,It&&(M.startCC=It.cc,It.initSegment||M.fragments.every(function(At){return At.relurl&&e(At.relurl)})&&(i.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),U=new I.Fragment(y,L),U.relurl=Lt.relurl,U.level=E,U.sn="initSegment",It.initSegment=U,M.needSidxRanges=!0))}else M.endSN=0,M.startCC=0;return M.fragmentHint&&(_+=M.fragmentHint.duration),M.totalduration=_,M.endCC=B,G>0&&a(R,G),M},A}();function h(A,T){["video","audio","text"].forEach(function(b){var L=A.filter(function(y){return Object(f.isCodecType)(y,b)});if(L.length){var E=L.filter(function(y){return y.lastIndexOf("avc1",0)===0||y.lastIndexOf("mp4a",0)===0});T[b+"Codec"]=E.length>0?E[0]:L[0],A=A.filter(function(y){return L.indexOf(y)===-1})}}),T.unknownCodecs=A}function v(A,T,b){var L=T[b];L&&(A[b]=L)}function a(A,T){for(var b=A[T],L=T;L--;){var E=A[L];if(!E)return;E.programDateTime=b.programDateTime-E.duration*1e3,b=E}}function r(A,T){A.rawProgramDateTime?A.programDateTime=Date.parse(A.rawProgramDateTime):T!=null&&T.programDateTime&&(A.programDateTime=T.endProgramDateTime),Object(s.isFiniteNumber)(A.programDateTime)||(A.programDateTime=null,A.rawProgramDateTime=null)}function l(A,T,b,L){A.relurl=T.URI,T.BYTERANGE&&A.setByteRange(T.BYTERANGE),A.level=b,A.sn="initSegment",L&&(A.levelkey=L),A.initSegment=null}},"./src/loader/playlist-loader.ts":function(P,C,n){n.r(C);var s=n("./src/polyfills/number.ts"),t=n("./src/events.ts"),d=n("./src/errors.ts"),I=n("./src/utils/logger.ts"),x=n("./src/utils/mp4-tools.ts"),D=n("./src/loader/m3u8-parser.ts"),u=n("./src/types/loader.ts"),i=n("./src/utils/attr-list.ts");function f(m){var S=m.type;switch(S){case u.PlaylistContextType.AUDIO_TRACK:return u.PlaylistLevelType.AUDIO;case u.PlaylistContextType.SUBTITLE_TRACK:return u.PlaylistLevelType.SUBTITLE;default:return u.PlaylistLevelType.MAIN}}function p(m,S){var o=m.url;return(o===void 0||o.indexOf("data:")===0)&&(o=S.url),o}var g=function(){function m(o){this.hls=void 0,this.loaders=Object.create(null),this.hls=o,this.registerListeners()}var S=m.prototype;return S.registerListeners=function(){var e=this.hls;e.on(t.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(t.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(t.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(t.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},S.unregisterListeners=function(){var e=this.hls;e.off(t.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(t.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(t.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(t.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},S.createInternalLoader=function(e){var c=this.hls.config,h=c.pLoader,v=c.loader,a=h||v,r=new a(c);return e.loader=r,this.loaders[e.type]=r,r},S.getInternalLoader=function(e){return this.loaders[e.type]},S.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},S.destroyInternalLoaders=function(){for(var e in this.loaders){var c=this.loaders[e];c&&c.destroy(),this.resetInternalLoader(e)}},S.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},S.onManifestLoading=function(e,c){var h=c.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:u.PlaylistContextType.MANIFEST,url:h,deliveryDirectives:null})},S.onLevelLoading=function(e,c){var h=c.id,v=c.level,a=c.url,r=c.deliveryDirectives;this.load({id:h,groupId:null,level:v,responseType:"text",type:u.PlaylistContextType.LEVEL,url:a,deliveryDirectives:r})},S.onAudioTrackLoading=function(e,c){var h=c.id,v=c.groupId,a=c.url,r=c.deliveryDirectives;this.load({id:h,groupId:v,level:null,responseType:"text",type:u.PlaylistContextType.AUDIO_TRACK,url:a,deliveryDirectives:r})},S.onSubtitleTrackLoading=function(e,c){var h=c.id,v=c.groupId,a=c.url,r=c.deliveryDirectives;this.load({id:h,groupId:v,level:null,responseType:"text",type:u.PlaylistContextType.SUBTITLE_TRACK,url:a,deliveryDirectives:r})},S.load=function(e){var c,h=this.hls.config,v=this.getInternalLoader(e);if(v){var a=v.context;if(a&&a.url===e.url){I.logger.trace("[playlist-loader]: playlist request ongoing");return}I.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),v.abort()}var r,l,A,T;switch(e.type){case u.PlaylistContextType.MANIFEST:r=h.manifestLoadingMaxRetry,l=h.manifestLoadingTimeOut,A=h.manifestLoadingRetryDelay,T=h.manifestLoadingMaxRetryTimeout;break;case u.PlaylistContextType.LEVEL:case u.PlaylistContextType.AUDIO_TRACK:case u.PlaylistContextType.SUBTITLE_TRACK:r=0,l=h.levelLoadingTimeOut;break;default:r=h.levelLoadingMaxRetry,l=h.levelLoadingTimeOut,A=h.levelLoadingRetryDelay,T=h.levelLoadingMaxRetryTimeout;break}if(v=this.createInternalLoader(e),(c=e.deliveryDirectives)!==null&&c!==void 0&&c.part){var b;if(e.type===u.PlaylistContextType.LEVEL&&e.level!==null?b=this.hls.levels[e.level].details:e.type===u.PlaylistContextType.AUDIO_TRACK&&e.id!==null?b=this.hls.audioTracks[e.id].details:e.type===u.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(b=this.hls.subtitleTracks[e.id].details),b){var L=b.partTarget,E=b.targetduration;L&&E&&(l=Math.min(Math.max(L*3,E*.8)*1e3,l))}}var y={timeout:l,maxRetry:r,retryDelay:A,maxRetryDelay:T,highWaterMark:0},O={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};v.load(e,y,O)},S.loadsuccess=function(e,c,h,v){if(v===void 0&&(v=null),h.isSidxRequest){this.handleSidxRequest(e,h),this.handlePlaylistLoaded(e,c,h,v);return}this.resetInternalLoader(h.type);var a=e.data;if(a.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(e,h,"no EXTM3U delimiter",v);return}c.parsing.start=performance.now(),a.indexOf("#EXTINF:")>0||a.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,c,h,v):this.handleMasterPlaylist(e,c,h,v)},S.loaderror=function(e,c,h){h===void 0&&(h=null),this.handleNetworkError(c,h,!1,e)},S.loadtimeout=function(e,c,h){h===void 0&&(h=null),this.handleNetworkError(c,h,!0)},S.handleMasterPlaylist=function(e,c,h,v){var a=this.hls,r=e.data,l=p(e,h),A=D.default.parseMasterPlaylist(r,l),T=A.levels,b=A.sessionData;if(!T.length){this.handleManifestParsingError(e,h,"no level found in manifest",v);return}var L=T.map(function(F){return{id:F.attrs.AUDIO,audioCodec:F.audioCodec}}),E=T.map(function(F){return{id:F.attrs.SUBTITLES,textCodec:F.textCodec}}),y=D.default.parseMasterPlaylistMedia(r,l,"AUDIO",L),O=D.default.parseMasterPlaylistMedia(r,l,"SUBTITLES",E),M=D.default.parseMasterPlaylistMedia(r,l,"CLOSED-CAPTIONS");if(y.length){var R=y.some(function(F){return!F.url});!R&&T[0].audioCodec&&!T[0].attrs.AUDIO&&(I.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),y.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new i.AttrList({}),bitrate:0,url:""}))}a.trigger(t.Events.MANIFEST_LOADED,{levels:T,audioTracks:y,subtitles:O,captions:M,url:l,stats:c,networkDetails:v,sessionData:b})},S.handleTrackOrLevelPlaylist=function(e,c,h,v){var a=this.hls,r=h.id,l=h.level,A=h.type,T=p(e,h),b=Object(s.isFiniteNumber)(r)?r:0,L=Object(s.isFiniteNumber)(l)?l:b,E=f(h),y=D.default.parseLevelPlaylist(e.data,T,L,E,b);if(!y.fragments.length){a.trigger(t.Events.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:T,reason:"no fragments found in level",level:typeof h.level=="number"?h.level:void 0});return}if(A===u.PlaylistContextType.MANIFEST){var O={attrs:new i.AttrList({}),bitrate:0,details:y,name:"",url:T};a.trigger(t.Events.MANIFEST_LOADED,{levels:[O],audioTracks:[],url:T,stats:c,networkDetails:v,sessionData:null})}if(c.parsing.end=performance.now(),y.needSidxRanges){var M,R=(M=y.fragments[0].initSegment)===null||M===void 0?void 0:M.url;this.load({url:R,isSidxRequest:!0,type:A,level:l,levelDetails:y,id:r,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}h.levelDetails=y,this.handlePlaylistLoaded(e,c,h,v)},S.handleSidxRequest=function(e,c){var h=new Uint8Array(e.data),v=Object(x.findBox)(h,["sidx"])[0];if(!!v){var a=Object(x.parseSegmentIndex)(v);if(!!a){var r=a.references,l=c.levelDetails;r.forEach(function(A,T){var b=A.info,L=l.fragments[T];if(L.byteRange.length===0&&L.setByteRange(String(1+b.end-b.start)+"@"+String(b.start)),L.initSegment){var E=Object(x.findBox)(h,["moov"])[0],y=E?E.length:null;L.initSegment.setByteRange(String(y)+"@0")}})}}},S.handleManifestParsingError=function(e,c,h,v){this.hls.trigger(t.Events.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:c.type===u.PlaylistContextType.MANIFEST,url:e.url,reason:h,response:e,context:c,networkDetails:v})},S.handleNetworkError=function(e,c,h,v){h===void 0&&(h=!1),I.logger.warn("[playlist-loader]: A network "+(h?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var a=d.ErrorDetails.UNKNOWN,r=!1,l=this.getInternalLoader(e);switch(e.type){case u.PlaylistContextType.MANIFEST:a=h?d.ErrorDetails.MANIFEST_LOAD_TIMEOUT:d.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case u.PlaylistContextType.LEVEL:a=h?d.ErrorDetails.LEVEL_LOAD_TIMEOUT:d.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case u.PlaylistContextType.AUDIO_TRACK:a=h?d.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:d.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1;break;case u.PlaylistContextType.SUBTITLE_TRACK:a=h?d.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:d.ErrorDetails.SUBTITLE_LOAD_ERROR,r=!1;break}l&&this.resetInternalLoader(e.type);var A={type:d.ErrorTypes.NETWORK_ERROR,details:a,fatal:r,url:e.url,loader:l,context:e,networkDetails:c};v&&(A.response=v),this.hls.trigger(t.Events.ERROR,A)},S.handlePlaylistLoaded=function(e,c,h,v){var a=h.type,r=h.level,l=h.id,A=h.groupId,T=h.loader,b=h.levelDetails,L=h.deliveryDirectives;if(!(b!=null&&b.targetduration)){this.handleManifestParsingError(e,h,"invalid target duration",v);return}if(!!T)switch(b.live&&(T.getCacheAge&&(b.ageHeader=T.getCacheAge()||0),(!T.getCacheAge||isNaN(b.ageHeader))&&(b.ageHeader=0)),a){case u.PlaylistContextType.MANIFEST:case u.PlaylistContextType.LEVEL:this.hls.trigger(t.Events.LEVEL_LOADED,{details:b,level:r||0,id:l||0,stats:c,networkDetails:v,deliveryDirectives:L});break;case u.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(t.Events.AUDIO_TRACK_LOADED,{details:b,id:l||0,groupId:A||"",stats:c,networkDetails:v,deliveryDirectives:L});break;case u.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(t.Events.SUBTITLE_TRACK_LOADED,{details:b,id:l||0,groupId:A||"",stats:c,networkDetails:v,deliveryDirectives:L});break}},m}();C.default=g},"./src/polyfills/number.ts":function(P,C,n){n.r(C),n.d(C,"isFiniteNumber",function(){return s}),n.d(C,"MAX_SAFE_INTEGER",function(){return t});var s=Number.isFinite||function(d){return typeof d=="number"&&isFinite(d)},t=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(P,C,n){n.r(C);var s=function(){function t(){}return t.getSilentFrame=function(I,x){switch(I){case"mp4a.40.2":if(x===1)return new Uint8Array([0,200,0,128,35,128]);if(x===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(x===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(x===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(x===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(x===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(x===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(x===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(x===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},t}();C.default=s},"./src/remux/mp4-generator.ts":function(P,C,n){n.r(C);var s=Math.pow(2,32)-1,t=function(){function d(){}return d.init=function(){d.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var x;for(x in d.types)d.types.hasOwnProperty(x)&&(d.types[x]=[x.charCodeAt(0),x.charCodeAt(1),x.charCodeAt(2),x.charCodeAt(3)]);var D=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),u=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);d.HDLR_TYPES={video:D,audio:u};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]);d.STTS=d.STSC=d.STCO=f,d.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),d.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),d.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),d.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var p=new Uint8Array([105,115,111,109]),g=new Uint8Array([97,118,99,49]),m=new Uint8Array([0,0,0,1]);d.FTYP=d.box(d.types.ftyp,p,m,p,g),d.DINF=d.box(d.types.dinf,d.box(d.types.dref,i))},d.box=function(x){for(var D=8,u=arguments.length,i=new Array(u>1?u-1:0),f=1;f<u;f++)i[f-1]=arguments[f];for(var p=i.length,g=p;p--;)D+=i[p].byteLength;var m=new Uint8Array(D);for(m[0]=D>>24&255,m[1]=D>>16&255,m[2]=D>>8&255,m[3]=D&255,m.set(x,4),p=0,D=8;p<g;p++)m.set(i[p],D),D+=i[p].byteLength;return m},d.hdlr=function(x){return d.box(d.types.hdlr,d.HDLR_TYPES[x])},d.mdat=function(x){return d.box(d.types.mdat,x)},d.mdhd=function(x,D){D*=x;var u=Math.floor(D/(s+1)),i=Math.floor(D%(s+1));return d.box(d.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,x>>24&255,x>>16&255,x>>8&255,x&255,u>>24,u>>16&255,u>>8&255,u&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))},d.mdia=function(x){return d.box(d.types.mdia,d.mdhd(x.timescale,x.duration),d.hdlr(x.type),d.minf(x))},d.mfhd=function(x){return d.box(d.types.mfhd,new Uint8Array([0,0,0,0,x>>24,x>>16&255,x>>8&255,x&255]))},d.minf=function(x){return x.type==="audio"?d.box(d.types.minf,d.box(d.types.smhd,d.SMHD),d.DINF,d.stbl(x)):d.box(d.types.minf,d.box(d.types.vmhd,d.VMHD),d.DINF,d.stbl(x))},d.moof=function(x,D,u){return d.box(d.types.moof,d.mfhd(x),d.traf(u,D))},d.moov=function(x){for(var D=x.length,u=[];D--;)u[D]=d.trak(x[D]);return d.box.apply(null,[d.types.moov,d.mvhd(x[0].timescale,x[0].duration)].concat(u).concat(d.mvex(x)))},d.mvex=function(x){for(var D=x.length,u=[];D--;)u[D]=d.trex(x[D]);return d.box.apply(null,[d.types.mvex].concat(u))},d.mvhd=function(x,D){D*=x;var u=Math.floor(D/(s+1)),i=Math.floor(D%(s+1)),f=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,x>>24&255,x>>16&255,x>>8&255,x&255,u>>24,u>>16&255,u>>8&255,u&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return d.box(d.types.mvhd,f)},d.sdtp=function(x){var D=x.samples||[],u=new Uint8Array(4+D.length),i,f;for(i=0;i<D.length;i++)f=D[i].flags,u[i+4]=f.dependsOn<<4|f.isDependedOn<<2|f.hasRedundancy;return d.box(d.types.sdtp,u)},d.stbl=function(x){return d.box(d.types.stbl,d.stsd(x),d.box(d.types.stts,d.STTS),d.box(d.types.stsc,d.STSC),d.box(d.types.stsz,d.STSZ),d.box(d.types.stco,d.STCO))},d.avc1=function(x){var D=[],u=[],i,f,p;for(i=0;i<x.sps.length;i++)f=x.sps[i],p=f.byteLength,D.push(p>>>8&255),D.push(p&255),D=D.concat(Array.prototype.slice.call(f));for(i=0;i<x.pps.length;i++)f=x.pps[i],p=f.byteLength,u.push(p>>>8&255),u.push(p&255),u=u.concat(Array.prototype.slice.call(f));var g=d.box(d.types.avcC,new Uint8Array([1,D[3],D[4],D[5],255,224|x.sps.length].concat(D).concat([x.pps.length]).concat(u))),m=x.width,S=x.height,o=x.pixelRatio[0],e=x.pixelRatio[1];return d.box(d.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,m&255,S>>8&255,S&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),g,d.box(d.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),d.box(d.types.pasp,new Uint8Array([o>>24,o>>16&255,o>>8&255,o&255,e>>24,e>>16&255,e>>8&255,e&255])))},d.esds=function(x){var D=x.config.length;return new Uint8Array([0,0,0,0,3,23+D,0,1,0,4,15+D,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([D]).concat(x.config).concat([6,1,2]))},d.mp4a=function(x){var D=x.samplerate;return d.box(d.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,x.channelCount,0,16,0,0,0,0,D>>8&255,D&255,0,0]),d.box(d.types.esds,d.esds(x)))},d.mp3=function(x){var D=x.samplerate;return d.box(d.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,x.channelCount,0,16,0,0,0,0,D>>8&255,D&255,0,0]))},d.stsd=function(x){return x.type==="audio"?x.segmentCodec==="mp3"&&x.codec==="mp3"?d.box(d.types.stsd,d.STSD,d.mp3(x)):d.box(d.types.stsd,d.STSD,d.mp4a(x)):d.box(d.types.stsd,d.STSD,d.avc1(x))},d.tkhd=function(x){var D=x.id,u=x.duration*x.timescale,i=x.width,f=x.height,p=Math.floor(u/(s+1)),g=Math.floor(u%(s+1));return d.box(d.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,D>>24&255,D>>16&255,D>>8&255,D&255,0,0,0,0,p>>24,p>>16&255,p>>8&255,p&255,g>>24,g>>16&255,g>>8&255,g&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,f>>8&255,f&255,0,0]))},d.traf=function(x,D){var u=d.sdtp(x),i=x.id,f=Math.floor(D/(s+1)),p=Math.floor(D%(s+1));return d.box(d.types.traf,d.box(d.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),d.box(d.types.tfdt,new Uint8Array([1,0,0,0,f>>24,f>>16&255,f>>8&255,f&255,p>>24,p>>16&255,p>>8&255,p&255])),d.trun(x,u.length+16+20+8+16+8+8),u)},d.trak=function(x){return x.duration=x.duration||4294967295,d.box(d.types.trak,d.tkhd(x),d.mdia(x))},d.trex=function(x){var D=x.id;return d.box(d.types.trex,new Uint8Array([0,0,0,0,D>>24,D>>16&255,D>>8&255,D&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},d.trun=function(x,D){var u=x.samples||[],i=u.length,f=12+16*i,p=new Uint8Array(f),g,m,S,o,e,c;for(D+=8+f,p.set([0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,D>>>24&255,D>>>16&255,D>>>8&255,D&255],0),g=0;g<i;g++)m=u[g],S=m.duration,o=m.size,e=m.flags,c=m.cts,p.set([S>>>24&255,S>>>16&255,S>>>8&255,S&255,o>>>24&255,o>>>16&255,o>>>8&255,o&255,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.paddingValue<<1|e.isNonSync,e.degradPrio&240<<8,e.degradPrio&15,c>>>24&255,c>>>16&255,c>>>8&255,c&255],12+16*g);return d.box(d.types.trun,p)},d.initSegment=function(x){d.types||d.init();var D=d.moov(x),u=new Uint8Array(d.FTYP.byteLength+D.byteLength);return u.set(d.FTYP),u.set(D,d.FTYP.byteLength),u},d}();t.types=void 0,t.HDLR_TYPES=void 0,t.STTS=void 0,t.STSC=void 0,t.STCO=void 0,t.STSZ=void 0,t.VMHD=void 0,t.SMHD=void 0,t.STSD=void 0,t.FTYP=void 0,t.DINF=void 0,C.default=t},"./src/remux/mp4-remuxer.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return c}),n.d(C,"normalizePts",function(){return h}),n.d(C,"flushTextTrackMetadataCueSamples",function(){return a}),n.d(C,"flushTextTrackUserdataCueSamples",function(){return r});var s=n("./src/polyfills/number.ts"),t=n("./src/remux/aac-helper.ts"),d=n("./src/remux/mp4-generator.ts"),I=n("./src/events.ts"),x=n("./src/errors.ts"),D=n("./src/utils/logger.ts"),u=n("./src/types/loader.ts"),i=n("./src/utils/timescale-conversion.ts");function f(){return f=Object.assign?Object.assign.bind():function(T){for(var b=1;b<arguments.length;b++){var L=arguments[b];for(var E in L)Object.prototype.hasOwnProperty.call(L,E)&&(T[E]=L[E])}return T},f.apply(this,arguments)}var p=10*1e3,g=1024,m=1152,S=null,o=null,e=!1,c=function(){function T(L,E,y,O){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=L,this.config=E,this.typeSupported=y,this.ISGenerated=!1,S===null){var M=navigator.userAgent||"",R=M.match(/Chrome\/(\d+)/i);S=R?parseInt(R[1]):0}if(o===null){var F=navigator.userAgent.match(/Safari\/(\d+)/i);o=F?parseInt(F[1]):0}e=!(!!S&&S>=75||!!o&&o>=600)}var b=T.prototype;return b.destroy=function(){},b.resetTimeStamp=function(E){D.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=E},b.resetNextTimestamp=function(){D.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},b.resetInitSegment=function(){D.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},b.getVideoStartPts=function(E){var y=!1,O=E.reduce(function(M,R){var F=R.pts-M;return F<-4294967296?(y=!0,h(M,R.pts)):F>0?M:R.pts},E[0].pts);return y&&D.logger.debug("PTS rollover detected"),O},b.remux=function(E,y,O,M,R,F,k,w){var _,B,N,U,j,K,H=R,G=R,W=E.pid>-1,X=y.pid>-1,V=y.samples.length,J=E.samples.length>0,$=k&&V>0||V>1,z=(!W||J)&&(!X||$)||this.ISGenerated||k;if(z){this.ISGenerated||(N=this.generateIS(E,y,R));var Q=this.isVideoContiguous,q=-1,tt;if($&&(q=v(y.samples),!Q&&this.config.forceKeyFrameOnDiscontinuity))if(K=!0,q>0){D.logger.warn("[mp4-remuxer]: Dropped "+q+" out of "+V+" video samples due to a missing keyframe");var et=this.getVideoStartPts(y.samples);y.samples=y.samples.slice(q),y.dropped+=q,G+=(y.samples[0].pts-et)/y.inputTimeScale,tt=G}else q===-1&&(D.logger.warn("[mp4-remuxer]: No keyframe found out of "+V+" video samples"),K=!1);if(this.ISGenerated){if(J&&$){var rt=this.getVideoStartPts(y.samples),Y=h(E.samples[0].pts,rt)-rt,it=Y/y.inputTimeScale;H+=Math.max(0,it),G+=Math.max(0,-it)}if(J){if(E.samplerate||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),N=this.generateIS(E,y,R)),B=this.remuxAudio(E,H,this.isAudioContiguous,F,X||$||w===u.PlaylistLevelType.AUDIO?G:void 0),$){var nt=B?B.endPTS-B.startPTS:0;y.inputTimeScale||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),N=this.generateIS(E,y,R)),_=this.remuxVideo(y,G,Q,nt)}}else $&&(_=this.remuxVideo(y,G,Q,0));_&&(_.firstKeyFrame=q,_.independent=q!==-1,_.firstKeyFramePTS=tt)}}return this.ISGenerated&&(O.samples.length&&(j=a(O,R,this._initPTS,this._initDTS)),M.samples.length&&(U=r(M,R,this._initPTS))),{audio:B,video:_,initSegment:N,independent:K,text:U,id3:j}},b.generateIS=function(E,y,O){var M=E.samples,R=y.samples,F=this.typeSupported,k={},w=!Object(s.isFiniteNumber)(this._initPTS),_="audio/mp4",B,N,U;if(w&&(B=N=1/0),E.config&&M.length){switch(E.timescale=E.samplerate,E.segmentCodec){case"mp3":F.mpeg?(_="audio/mpeg",E.codec=""):F.mp3&&(E.codec="mp3");break}k.audio={id:"audio",container:_,codec:E.codec,initSegment:E.segmentCodec==="mp3"&&F.mpeg?new Uint8Array(0):d.default.initSegment([E]),metadata:{channelCount:E.channelCount}},w&&(U=E.inputTimeScale,B=N=M[0].pts-Math.round(U*O))}if(y.sps&&y.pps&&R.length&&(y.timescale=y.inputTimeScale,k.video={id:"main",container:"video/mp4",codec:y.codec,initSegment:d.default.initSegment([y]),metadata:{width:y.width,height:y.height}},w)){U=y.inputTimeScale;var j=this.getVideoStartPts(R),K=Math.round(U*O);N=Math.min(N,h(R[0].dts,j)-K),B=Math.min(B,j-K)}if(Object.keys(k).length)return this.ISGenerated=!0,w&&(this._initPTS=B,this._initDTS=N),{tracks:k,initPTS:B,timescale:U}},b.remuxVideo=function(E,y,O,M){var R=E.inputTimeScale,F=E.samples,k=[],w=F.length,_=this._initPTS,B=this.nextAvcDts,N=8,U=this.videoSampleDuration,j,K,H=Number.POSITIVE_INFINITY,G=Number.NEGATIVE_INFINITY,W=0,X=!1;if(!O||B===null){var V=y*R,J=F[0].pts-h(F[0].dts,F[0].pts);B=V-J}for(var $=0;$<w;$++){var z=F[$];if(z.pts=h(z.pts-_,B),z.dts=h(z.dts-_,B),z.dts>z.pts){var Q=18e3;W=Math.max(Math.min(W,z.pts-z.dts),-1*Q)}z.dts<F[$>0?$-1:$].dts&&(X=!0)}X&&F.sort(function(Ft,Bt){var Vt=Ft.dts-Bt.dts,zt=Ft.pts-Bt.pts;return Vt||zt}),j=F[0].dts,K=F[F.length-1].dts;var q=K-j,tt=q?Math.round(q/(w-1)):U||E.inputTimeScale/30;if(W<0){if(W<tt*-2){D.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(i.toMsFromMpegTsClock)(-tt,!0)+" ms");for(var et=W,rt=0;rt<w;rt++)F[rt].dts=et=Math.max(et,F[rt].pts-tt),F[rt].pts=Math.max(et,F[rt].pts)}else{D.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(i.toMsFromMpegTsClock)(W,!0)+" ms to overcome this issue");for(var Y=0;Y<w;Y++)F[Y].dts=F[Y].dts+W}j=F[0].dts}if(O){var it=j-B,nt=it>tt,at=it<-1;if(nt||at){nt?D.logger.warn("AVC: "+Object(i.toMsFromMpegTsClock)(it,!0)+" ms ("+it+"dts) hole between fragments detected, filling it"):D.logger.warn("AVC: "+Object(i.toMsFromMpegTsClock)(-it,!0)+" ms ("+it+"dts) overlapping between fragments detected"),j=B;var ut=F[0].pts-it;F[0].dts=j,F[0].pts=ut,D.logger.log("Video: First PTS/DTS adjusted: "+Object(i.toMsFromMpegTsClock)(ut,!0)+"/"+Object(i.toMsFromMpegTsClock)(j,!0)+", delta: "+Object(i.toMsFromMpegTsClock)(it,!0)+" ms")}}e&&(j=Math.max(0,j));for(var st=0,vt=0,ot=0;ot<w;ot++){for(var ft=F[ot],pt=ft.units,yt=pt.length,mt=0,lt=0;lt<yt;lt++)mt+=pt[lt].data.length;vt+=mt,st+=yt,ft.length=mt,ft.dts=Math.max(ft.dts,j),ft.pts=Math.max(ft.pts,ft.dts,0),H=Math.min(ft.pts,H),G=Math.max(ft.pts,G)}K=F[w-1].dts;var dt=vt+4*st+8,ct;try{ct=new Uint8Array(dt)}catch{this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:x.ErrorTypes.MUX_ERROR,details:x.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:dt,reason:"fail allocating video mdat "+dt});return}var Z=new DataView(ct.buffer);Z.setUint32(0,dt),ct.set(d.default.types.mdat,4);for(var Et=!1,ht=0;ht<w;ht++){for(var gt=F[ht],St=gt.units,bt=0,Dt=0,Tt=St.length;Dt<Tt;Dt++){var Ot=St[Dt],It=Ot.data,Lt=Ot.data.byteLength;Z.setUint32(N,Lt),N+=4,ct.set(It,N),N+=Lt,bt+=4+Lt}if(ht<w-1)U=F[ht+1].dts-gt.dts;else{var Mt=this.config,At=ht>0?gt.dts-F[ht-1].dts:tt;if(Mt.stretchShortVideoTrack&&this.nextAudioPts!==null){var Kt=Math.floor(Mt.maxBufferHole*R),Ct=(M?H+M*R:this.nextAudioPts)-gt.pts;Ct>Kt?(U=Ct-At,U<0?U=At:Et=!0,D.logger.log("[mp4-remuxer]: It is approximately "+Ct/90+" ms to the next segment; using duration "+U/90+" ms for the last video frame.")):U=At}else U=At}var Wt=Math.round(gt.pts-gt.dts);k.push(new l(gt.key,U,bt,Wt))}if(k.length&&S&&S<70){var _t=k[0].flags;_t.dependsOn=2,_t.isNonSync=0}console.assert(U!==null,"mp4SampleDuration must be computed"),U=Et||!U?tt:U,this.nextAvcDts=B=K+U,this.videoSampleDuration=U,this.isVideoContiguous=!0;var Ht=d.default.moof(E.sequenceNumber++,j,f({},E,{samples:k})),Gt="video",$t={data1:Ht,data2:ct,startPTS:H/R,endPTS:(G+U)/R,startDTS:j/R,endDTS:B/R,type:Gt,hasAudio:!1,hasVideo:!0,nb:k.length,dropped:E.dropped};return E.samples=[],E.dropped=0,console.assert(ct.length,"MDAT length must not be zero"),$t},b.remuxAudio=function(E,y,O,M,R){var F=E.inputTimeScale,k=E.samplerate?E.samplerate:F,w=F/k,_=E.segmentCodec==="aac"?g:m,B=_*w,N=this._initPTS,U=E.segmentCodec==="mp3"&&this.typeSupported.mpeg,j=[],K=R!==void 0,H=E.samples,G=U?0:8,W=this.nextAudioPts||-1,X=y*F;if(this.isAudioContiguous=O=O||H.length&&W>0&&(M&&Math.abs(X-W)<9e3||Math.abs(h(H[0].pts-N,X)-W)<20*B),H.forEach(function(Tt){Tt.pts=h(Tt.pts-N,X)}),!O||W<0){if(H=H.filter(function(Tt){return Tt.pts>=0}),!H.length)return;R===0?W=0:M&&!K?W=Math.max(0,X):W=H[0].pts}if(E.segmentCodec==="aac")for(var V=this.config.maxAudioFramesDrift,J=0,$=W;J<H.length;J++){var z=H[J],Q=z.pts,q=Q-$,tt=Math.abs(1e3*q/F);if(q<=-V*B&&K)J===0&&(D.logger.warn("Audio frame @ "+(Q/F).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*q/F)+" ms."),this.nextAudioPts=W=$=Q);else if(q>=V*B&&tt<p&&K){var et=Math.round(q/B);$=Q-et*B,$<0&&(et--,$+=B),J===0&&(this.nextAudioPts=W=$),D.logger.warn("[mp4-remuxer]: Injecting "+et+" audio frame @ "+($/F).toFixed(3)+"s due to "+Math.round(1e3*q/F)+" ms gap.");for(var rt=0;rt<et;rt++){var Y=Math.max($,0),it=t.default.getSilentFrame(E.manifestCodec||E.codec,E.channelCount);it||(D.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),it=z.unit.subarray()),H.splice(J,0,{unit:it,pts:Y}),$+=B,J++}}z.pts=$,$+=B}for(var nt=null,at=null,ut,st=0,vt=H.length;vt--;)st+=H[vt].unit.byteLength;for(var ot=0,ft=H.length;ot<ft;ot++){var pt=H[ot],yt=pt.unit,mt=pt.pts;if(at!==null){var lt=j[ot-1];lt.duration=Math.round((mt-at)/w)}else if(O&&E.segmentCodec==="aac"&&(mt=W),nt=mt,st>0){st+=G;try{ut=new Uint8Array(st)}catch{this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:x.ErrorTypes.MUX_ERROR,details:x.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:st,reason:"fail allocating audio mdat "+st});return}if(!U){var dt=new DataView(ut.buffer);dt.setUint32(0,st),ut.set(d.default.types.mdat,4)}}else return;ut.set(yt,G);var ct=yt.byteLength;G+=ct,j.push(new l(!0,_,ct,0)),at=mt}var Z=j.length;if(!!Z){var Et=j[j.length-1];this.nextAudioPts=W=at+w*Et.duration;var ht=U?new Uint8Array(0):d.default.moof(E.sequenceNumber++,nt/w,f({},E,{samples:j}));E.samples=[];var gt=nt/F,St=W/F,bt="audio",Dt={data1:ht,data2:ut,startPTS:gt,endPTS:St,startDTS:gt,endDTS:St,type:bt,hasAudio:!0,hasVideo:!1,nb:Z};return this.isAudioContiguous=!0,console.assert(ut.length,"MDAT length must not be zero"),Dt}},b.remuxEmptyAudio=function(E,y,O,M){var R=E.inputTimeScale,F=E.samplerate?E.samplerate:R,k=R/F,w=this.nextAudioPts,_=(w!==null?w:M.startDTS*R)+this._initDTS,B=M.endDTS*R+this._initDTS,N=k*g,U=Math.ceil((B-_)/N),j=t.default.getSilentFrame(E.manifestCodec||E.codec,E.channelCount);if(D.logger.warn("[mp4-remuxer]: remux empty Audio"),!j){D.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var K=[],H=0;H<U;H++){var G=_+H*N;K.push({unit:j,pts:G,dts:G})}return E.samples=K,this.remuxAudio(E,y,O,!1)},T}();function h(T,b){var L;if(b===null)return T;for(b<T?L=-8589934592:L=8589934592;Math.abs(T-b)>4294967296;)T+=L;return T}function v(T){for(var b=0;b<T.length;b++)if(T[b].key)return b;return-1}function a(T,b,L,E){var y=T.samples.length;if(!!y){for(var O=T.inputTimeScale,M=0;M<y;M++){var R=T.samples[M];R.pts=h(R.pts-L,b*O)/O,R.dts=h(R.dts-E,b*O)/O}var F=T.samples;return T.samples=[],{samples:F}}}function r(T,b,L){var E=T.samples.length;if(!!E){for(var y=T.inputTimeScale,O=0;O<E;O++){var M=T.samples[O];M.pts=h(M.pts-L,b*y)/y}T.samples.sort(function(F,k){return F.pts-k.pts});var R=T.samples;return T.samples=[],{samples:R}}}var l=function(b,L,E,y){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=L,this.size=E,this.cts=y,this.flags=new A(b)},A=function(b){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=b?2:1,this.isNonSync=b?0:1}},"./src/remux/passthrough-remuxer.ts":function(P,C,n){n.r(C);var s=n("./src/polyfills/number.ts"),t=n("./src/remux/mp4-remuxer.ts"),d=n("./src/utils/mp4-tools.ts"),I=n("./src/loader/fragment.ts"),x=n("./src/utils/logger.ts"),D=function(){function f(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var p=f.prototype;return p.destroy=function(){},p.resetTimeStamp=function(m){this.initPTS=m,this.lastEndDTS=null},p.resetNextTimestamp=function(){this.lastEndDTS=null},p.resetInitSegment=function(m,S,o){this.audioCodec=S,this.videoCodec=o,this.generateInitSegment(m),this.emitInitSegment=!0},p.generateInitSegment=function(m){var S=this.audioCodec,o=this.videoCodec;if(!m||!m.byteLength){this.initTracks=void 0,this.initData=void 0;return}var e=this.initData=Object(d.parseInitSegment)(m);S||(S=i(e.audio,I.ElementaryStreamTypes.AUDIO)),o||(o=i(e.video,I.ElementaryStreamTypes.VIDEO));var c={};e.audio&&e.video?c.audiovideo={container:"video/mp4",codec:S+","+o,initSegment:m,id:"main"}:e.audio?c.audio={container:"audio/mp4",codec:S,initSegment:m,id:"audio"}:e.video?c.video={container:"video/mp4",codec:o,initSegment:m,id:"main"}:x.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=c},p.remux=function(m,S,o,e,c){var h,v=this.initPTS,a=this.lastEndDTS,r={audio:void 0,video:void 0,text:e,id3:o,initSegment:void 0};Object(s.isFiniteNumber)(a)||(a=this.lastEndDTS=c||0);var l=S.samples;if(!l||!l.length)return r;var A={initPTS:void 0,timescale:1},T=this.initData;if((!T||!T.length)&&(this.generateInitSegment(l),T=this.initData),!T||!T.length)return x.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),r;this.emitInitSegment&&(A.tracks=this.initTracks,this.emitInitSegment=!1),Object(s.isFiniteNumber)(v)||(this.initPTS=A.initPTS=v=u(T,l,a));var b=Object(d.getDuration)(l,T),L=a,E=b+L;Object(d.offsetStartDTS)(T,l,v),b>0?this.lastEndDTS=E:(x.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var y=!!T.audio,O=!!T.video,M="";y&&(M+="audio"),O&&(M+="video");var R={data1:l,startPTS:L,startDTS:L,endPTS:E,endDTS:E,type:M,hasAudio:y,hasVideo:O,nb:1,dropped:0};r.audio=R.type==="audio"?R:void 0,r.video=R.type!=="audio"?R:void 0,r.initSegment=A;var F=(h=this.initPTS)!=null?h:0;return r.id3=Object(t.flushTextTrackMetadataCueSamples)(o,c,F,F),e.samples.length&&(r.text=Object(t.flushTextTrackUserdataCueSamples)(e,c,F)),r},f}(),u=function(p,g,m){return Object(d.getStartDTS)(p,g)-m};function i(f,p){var g=f==null?void 0:f.codec;return g&&g.length>4?g:g==="hvc1"||g==="hev1"?"hvc1.1.c.L120.90":g==="av01"?"av01.0.04M.08":g==="avc1"||p===I.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}C.default=D},"./src/task-loop.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return s});var s=function(){function t(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var d=t.prototype;return d.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},d.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},d.onHandlerDestroyed=function(){},d.hasInterval=function(){return!!this._tickInterval},d.hasNextTick=function(){return!!this._tickTimer},d.setInterval=function(x){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,x),!0)},d.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},d.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},d.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},d.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},d.doTick=function(){},t}()},"./src/types/cmcd.ts":function(P,C,n){n.r(C),n.d(C,"CMCDVersion",function(){return s}),n.d(C,"CMCDObjectType",function(){return t}),n.d(C,"CMCDStreamingFormat",function(){return d}),n.d(C,"CMCDStreamType",function(){return I});var s=1,t;(function(x){x.MANIFEST="m",x.AUDIO="a",x.VIDEO="v",x.MUXED="av",x.INIT="i",x.CAPTION="c",x.TIMED_TEXT="tt",x.KEY="k",x.OTHER="o"})(t||(t={}));var d;(function(x){x.DASH="d",x.HLS="h",x.SMOOTH="s",x.OTHER="o"})(d||(d={}));var I;(function(x){x.VOD="v",x.LIVE="l"})(I||(I={}))},"./src/types/demuxer.ts":function(P,C,n){n.r(C),n.d(C,"MetadataSchema",function(){return s});var s;(function(t){t.audioId3="org.id3",t.dateRange="com.apple.quicktime.HLS",t.emsg="https://aomedia.org/emsg/ID3"})(s||(s={}))},"./src/types/level.ts":function(P,C,n){n.r(C),n.d(C,"HlsSkip",function(){return d}),n.d(C,"getSkipValue",function(){return I}),n.d(C,"HlsUrlParameters",function(){return x}),n.d(C,"Level",function(){return D});function s(u,i){for(var f=0;f<i.length;f++){var p=i[f];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(u,p.key,p)}}function t(u,i,f){return i&&s(u.prototype,i),f&&s(u,f),Object.defineProperty(u,"prototype",{writable:!1}),u}var d;(function(u){u.No="",u.Yes="YES",u.v2="v2"})(d||(d={}));function I(u,i){var f=u.canSkipUntil,p=u.canSkipDateRanges,g=u.endSN,m=i!==void 0?i-g:0;return f&&m<f?p?d.v2:d.Yes:d.No}var x=function(){function u(f,p,g){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=f,this.part=p,this.skip=g}var i=u.prototype;return i.addDirectives=function(p){var g=new self.URL(p);return this.msn!==void 0&&g.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&g.searchParams.set("_HLS_part",this.part.toString()),this.skip&&g.searchParams.set("_HLS_skip",this.skip),g.toString()},u}(),D=function(){function u(i){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[i.url],this.attrs=i.attrs,this.bitrate=i.bitrate,i.details&&(this.details=i.details),this.id=i.id||0,this.name=i.name,this.width=i.width||0,this.height=i.height||0,this.audioCodec=i.audioCodec,this.videoCodec=i.videoCodec,this.unknownCodecs=i.unknownCodecs,this.codecSet=[i.videoCodec,i.audioCodec].filter(function(f){return f}).join(",").replace(/\.[^.,]+/g,"")}return t(u,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(f){var p=f%this.url.length;this._urlId!==p&&(this.details=void 0,this._urlId=p)}}]),u}()},"./src/types/loader.ts":function(P,C,n){n.r(C),n.d(C,"PlaylistContextType",function(){return s}),n.d(C,"PlaylistLevelType",function(){return t});var s;(function(d){d.MANIFEST="manifest",d.LEVEL="level",d.AUDIO_TRACK="audioTrack",d.SUBTITLE_TRACK="subtitleTrack"})(s||(s={}));var t;(function(d){d.MAIN="main",d.AUDIO="audio",d.SUBTITLE="subtitle"})(t||(t={}))},"./src/types/transmuxer.ts":function(P,C,n){n.r(C),n.d(C,"ChunkMetadata",function(){return s});var s=function(I,x,D,u,i,f){u===void 0&&(u=0),i===void 0&&(i=-1),f===void 0&&(f=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=t(),this.buffering={audio:t(),video:t(),audiovideo:t()},this.level=I,this.sn=x,this.id=D,this.size=u,this.part=i,this.partial=f};function t(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(P,C,n){n.r(C),n.d(C,"AttrList",function(){return d});var s=/^(\d+)x(\d+)$/,t=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,d=function(){function I(D){typeof D=="string"&&(D=I.parseAttrList(D));for(var u in D)D.hasOwnProperty(u)&&(this[u]=D[u])}var x=I.prototype;return x.decimalInteger=function(u){var i=parseInt(this[u],10);return i>Number.MAX_SAFE_INTEGER?1/0:i},x.hexadecimalInteger=function(u){if(this[u]){var i=(this[u]||"0x").slice(2);i=(i.length&1?"0":"")+i;for(var f=new Uint8Array(i.length/2),p=0;p<i.length/2;p++)f[p]=parseInt(i.slice(p*2,p*2+2),16);return f}else return null},x.hexadecimalIntegerAsNumber=function(u){var i=parseInt(this[u],16);return i>Number.MAX_SAFE_INTEGER?1/0:i},x.decimalFloatingPoint=function(u){return parseFloat(this[u])},x.optionalFloat=function(u,i){var f=this[u];return f?parseFloat(f):i},x.enumeratedString=function(u){return this[u]},x.bool=function(u){return this[u]==="YES"},x.decimalResolution=function(u){var i=s.exec(this[u]);if(i!==null)return{width:parseInt(i[1],10),height:parseInt(i[2],10)}},I.parseAttrList=function(u){var i,f={},p='"';for(t.lastIndex=0;(i=t.exec(u))!==null;){var g=i[2];g.indexOf(p)===0&&g.lastIndexOf(p)===g.length-1&&(g=g.slice(1,-1)),f[i[1]]=g}return f},I}()},"./src/utils/binary-search.ts":function(P,C,n){n.r(C);var s={search:function(d,I){for(var x=0,D=d.length-1,u=null,i=null;x<=D;){u=(x+D)/2|0,i=d[u];var f=I(i);if(f>0)x=u+1;else if(f<0)D=u-1;else return i}return null}};C.default=s},"./src/utils/buffer-helper.ts":function(P,C,n){n.r(C),n.d(C,"BufferHelper",function(){return d});var s=n("./src/utils/logger.ts"),t={length:0,start:function(){return 0},end:function(){return 0}},d=function(){function I(){}return I.isBuffered=function(D,u){try{if(D){for(var i=I.getBuffered(D),f=0;f<i.length;f++)if(u>=i.start(f)&&u<=i.end(f))return!0}}catch{}return!1},I.bufferInfo=function(D,u,i){try{if(D){var f=I.getBuffered(D),p=[],g;for(g=0;g<f.length;g++)p.push({start:f.start(g),end:f.end(g)});return this.bufferedInfo(p,u,i)}}catch{}return{len:0,start:u,end:u,nextStart:void 0}},I.bufferedInfo=function(D,u,i){u=Math.max(0,u),D.sort(function(r,l){var A=r.start-l.start;return A||l.end-r.end});var f=[];if(i)for(var p=0;p<D.length;p++){var g=f.length;if(g){var m=f[g-1].end;D[p].start-m<i?D[p].end>m&&(f[g-1].end=D[p].end):f.push(D[p])}else f.push(D[p])}else f=D;for(var S=0,o,e=u,c=u,h=0;h<f.length;h++){var v=f[h].start,a=f[h].end;if(u+i>=v&&u<a)e=v,c=a,S=c-u;else if(u+i<v){o=v;break}}return{len:S,start:e||0,end:c||0,nextStart:o}},I.getBuffered=function(D){try{return D.buffered}catch(u){return s.logger.log("failed to get media.buffered",u),t}},I}()},"./src/utils/cea-608-parser.ts":function(P,C,n){n.r(C),n.d(C,"Row",function(){return c}),n.d(C,"CaptionScreen",function(){return h});var s=n("./src/utils/logger.ts"),t={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},d=function(b){var L=b;return t.hasOwnProperty(b)&&(L=t[b]),String.fromCharCode(L)},I=15,x=100,D={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},u={17:2,18:4,21:6,22:8,23:10,19:13,20:15},i={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},f={25:2,26:4,29:6,30:8,31:10,27:13,28:15},p=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],g;(function(T){T[T.ERROR=0]="ERROR",T[T.TEXT=1]="TEXT",T[T.WARNING=2]="WARNING",T[T.INFO=2]="INFO",T[T.DEBUG=3]="DEBUG",T[T.DATA=3]="DATA"})(g||(g={}));var m=function(){function T(){this.time=null,this.verboseLevel=g.ERROR}var b=T.prototype;return b.log=function(E,y){this.verboseLevel>=E&&s.logger.log(this.time+" ["+E+"] "+y)},T}(),S=function(b){for(var L=[],E=0;E<b.length;E++)L.push(b[E].toString(16));return L},o=function(){function T(L,E,y,O,M){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=L||"white",this.underline=E||!1,this.italics=y||!1,this.background=O||"black",this.flash=M||!1}var b=T.prototype;return b.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},b.setStyles=function(E){for(var y=["foreground","underline","italics","background","flash"],O=0;O<y.length;O++){var M=y[O];E.hasOwnProperty(M)&&(this[M]=E[M])}},b.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},b.equals=function(E){return this.foreground===E.foreground&&this.underline===E.underline&&this.italics===E.italics&&this.background===E.background&&this.flash===E.flash},b.copy=function(E){this.foreground=E.foreground,this.underline=E.underline,this.italics=E.italics,this.background=E.background,this.flash=E.flash},b.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},T}(),e=function(){function T(L,E,y,O,M,R){this.uchar=void 0,this.penState=void 0,this.uchar=L||" ",this.penState=new o(E,y,O,M,R)}var b=T.prototype;return b.reset=function(){this.uchar=" ",this.penState.reset()},b.setChar=function(E,y){this.uchar=E,this.penState.copy(y)},b.setPenState=function(E){this.penState.copy(E)},b.equals=function(E){return this.uchar===E.uchar&&this.penState.equals(E.penState)},b.copy=function(E){this.uchar=E.uchar,this.penState.copy(E.penState)},b.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},T}(),c=function(){function T(L){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var E=0;E<x;E++)this.chars.push(new e);this.logger=L,this.pos=0,this.currPenState=new o}var b=T.prototype;return b.equals=function(E){for(var y=!0,O=0;O<x;O++)if(!this.chars[O].equals(E.chars[O])){y=!1;break}return y},b.copy=function(E){for(var y=0;y<x;y++)this.chars[y].copy(E.chars[y])},b.isEmpty=function(){for(var E=!0,y=0;y<x;y++)if(!this.chars[y].isEmpty()){E=!1;break}return E},b.setCursor=function(E){this.pos!==E&&(this.pos=E),this.pos<0?(this.logger.log(g.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>x&&(this.logger.log(g.DEBUG,"Too large cursor position "+this.pos),this.pos=x)},b.moveCursor=function(E){var y=this.pos+E;if(E>1)for(var O=this.pos+1;O<y+1;O++)this.chars[O].setPenState(this.currPenState);this.setCursor(y)},b.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},b.insertChar=function(E){E>=144&&this.backSpace();var y=d(E);if(this.pos>=x){this.logger.log(g.ERROR,"Cannot insert "+E.toString(16)+" ("+y+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(y,this.currPenState),this.moveCursor(1)},b.clearFromPos=function(E){var y;for(y=E;y<x;y++)this.chars[y].reset()},b.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},b.clearToEndOfRow=function(){this.clearFromPos(this.pos)},b.getTextString=function(){for(var E=[],y=!0,O=0;O<x;O++){var M=this.chars[O].uchar;M!==" "&&(y=!1),E.push(M)}return y?"":E.join("")},b.setPenStyles=function(E){this.currPenState.setStyles(E);var y=this.chars[this.pos];y.setPenState(this.currPenState)},T}(),h=function(){function T(L){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var E=0;E<I;E++)this.rows.push(new c(L));this.logger=L,this.currRow=I-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var b=T.prototype;return b.reset=function(){for(var E=0;E<I;E++)this.rows[E].clear();this.currRow=I-1},b.equals=function(E){for(var y=!0,O=0;O<I;O++)if(!this.rows[O].equals(E.rows[O])){y=!1;break}return y},b.copy=function(E){for(var y=0;y<I;y++)this.rows[y].copy(E.rows[y])},b.isEmpty=function(){for(var E=!0,y=0;y<I;y++)if(!this.rows[y].isEmpty()){E=!1;break}return E},b.backSpace=function(){var E=this.rows[this.currRow];E.backSpace()},b.clearToEndOfRow=function(){var E=this.rows[this.currRow];E.clearToEndOfRow()},b.insertChar=function(E){var y=this.rows[this.currRow];y.insertChar(E)},b.setPen=function(E){var y=this.rows[this.currRow];y.setPenStyles(E)},b.moveCursor=function(E){var y=this.rows[this.currRow];y.moveCursor(E)},b.setCursor=function(E){this.logger.log(g.INFO,"setCursor: "+E);var y=this.rows[this.currRow];y.setCursor(E)},b.setPAC=function(E){this.logger.log(g.INFO,"pacData = "+JSON.stringify(E));var y=E.row-1;if(this.nrRollUpRows&&y<this.nrRollUpRows-1&&(y=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==y){for(var O=0;O<I;O++)this.rows[O].clear();var M=this.currRow+1-this.nrRollUpRows,R=this.lastOutputScreen;if(R){var F=R.rows[M].cueStartTime,k=this.logger.time;if(F&&k!==null&&F<k)for(var w=0;w<this.nrRollUpRows;w++)this.rows[y-this.nrRollUpRows+w+1].copy(R.rows[M+w])}}this.currRow=y;var _=this.rows[this.currRow];if(E.indent!==null){var B=E.indent,N=Math.max(B-1,0);_.setCursor(E.indent),E.color=_.chars[N].penState.foreground}var U={foreground:E.color,underline:E.underline,italics:E.italics,background:"black",flash:!1};this.setPen(U)},b.setBkgData=function(E){this.logger.log(g.INFO,"bkgData = "+JSON.stringify(E)),this.backSpace(),this.setPen(E),this.insertChar(32)},b.setRollUpRows=function(E){this.nrRollUpRows=E},b.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(g.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(g.TEXT,this.getDisplayText());var E=this.currRow+1-this.nrRollUpRows,y=this.rows.splice(E,1)[0];y.clear(),this.rows.splice(this.currRow,0,y),this.logger.log(g.INFO,"Rolling up")},b.getDisplayText=function(E){E=E||!1;for(var y=[],O="",M=-1,R=0;R<I;R++){var F=this.rows[R].getTextString();F&&(M=R+1,E?y.push("Row "+M+": '"+F+"'"):y.push(F.trim()))}return y.length>0&&(E?O="["+y.join(" | ")+"]":O=y.join(`
`)),O},b.getTextAndFormat=function(){return this.rows},T}(),v=function(){function T(L,E,y){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=L,this.outputFilter=E,this.mode=null,this.verbose=0,this.displayedMemory=new h(y),this.nonDisplayedMemory=new h(y),this.lastOutputScreen=new h(y),this.currRollUpRow=this.displayedMemory.rows[I-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=y}var b=T.prototype;return b.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[I-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},b.getHandler=function(){return this.outputFilter},b.setHandler=function(E){this.outputFilter=E},b.setPAC=function(E){this.writeScreen.setPAC(E)},b.setBkgData=function(E){this.writeScreen.setBkgData(E)},b.setMode=function(E){E!==this.mode&&(this.mode=E,this.logger.log(g.INFO,"MODE="+E),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=E)},b.insertChars=function(E){for(var y=0;y<E.length;y++)this.writeScreen.insertChar(E[y]);var O=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(g.INFO,O+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(g.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},b.ccRCL=function(){this.logger.log(g.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},b.ccBS=function(){this.logger.log(g.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},b.ccAOF=function(){},b.ccAON=function(){},b.ccDER=function(){this.logger.log(g.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},b.ccRU=function(E){this.logger.log(g.INFO,"RU("+E+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(E)},b.ccFON=function(){this.logger.log(g.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},b.ccRDC=function(){this.logger.log(g.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},b.ccTR=function(){this.logger.log(g.INFO,"TR"),this.setMode("MODE_TEXT")},b.ccRTD=function(){this.logger.log(g.INFO,"RTD"),this.setMode("MODE_TEXT")},b.ccEDM=function(){this.logger.log(g.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},b.ccCR=function(){this.logger.log(g.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},b.ccENM=function(){this.logger.log(g.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},b.ccEOC=function(){if(this.logger.log(g.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var E=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=E,this.writeScreen=this.nonDisplayedMemory,this.logger.log(g.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},b.ccTO=function(E){this.logger.log(g.INFO,"TO("+E+") - Tab Offset"),this.writeScreen.moveCursor(E)},b.ccMIDROW=function(E){var y={flash:!1};if(y.underline=E%2===1,y.italics=E>=46,y.italics)y.foreground="white";else{var O=Math.floor(E/2)-16,M=["white","green","blue","cyan","red","yellow","magenta"];y.foreground=M[O]}this.logger.log(g.INFO,"MIDROW: "+JSON.stringify(y)),this.writeScreen.setPen(y)},b.outputDataUpdate=function(E){E===void 0&&(E=!1);var y=this.logger.time;y!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=y:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,y,this.lastOutputScreen),E&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:y),this.lastOutputScreen.copy(this.displayedMemory))},b.cueSplitAtTime=function(E){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,E,this.displayedMemory),this.cueStartTime=E))},T}(),a=function(){function T(L,E,y){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var O=new m;this.channels=[null,new v(L,E,O),new v(L+1,y,O)],this.cmdHistory=A(),this.logger=O}var b=T.prototype;return b.getHandler=function(E){return this.channels[E].getHandler()},b.setHandler=function(E,y){this.channels[E].setHandler(y)},b.addData=function(E,y){var O,M,R,F=!1;this.logger.time=E;for(var k=0;k<y.length;k+=2)if(M=y[k]&127,R=y[k+1]&127,!(M===0&&R===0)){if(this.logger.log(g.DATA,"["+S([y[k],y[k+1]])+"] -> ("+S([M,R])+")"),O=this.parseCmd(M,R),O||(O=this.parseMidrow(M,R)),O||(O=this.parsePAC(M,R)),O||(O=this.parseBackgroundAttributes(M,R)),!O&&(F=this.parseChars(M,R),F)){var w=this.currentChannel;if(w&&w>0){var _=this.channels[w];_.insertChars(F)}else this.logger.log(g.WARNING,"No channel found yet. TEXT-MODE?")}!O&&!F&&this.logger.log(g.WARNING,"Couldn't parse cleaned data "+S([M,R])+" orig: "+S([y[k],y[k+1]]))}},b.parseCmd=function(E,y){var O=this.cmdHistory,M=(E===20||E===28||E===21||E===29)&&y>=32&&y<=47,R=(E===23||E===31)&&y>=33&&y<=35;if(!(M||R))return!1;if(l(E,y,O))return r(null,null,O),this.logger.log(g.DEBUG,"Repeated command ("+S([E,y])+") is dropped"),!0;var F=E===20||E===21||E===23?1:2,k=this.channels[F];return E===20||E===21||E===28||E===29?y===32?k.ccRCL():y===33?k.ccBS():y===34?k.ccAOF():y===35?k.ccAON():y===36?k.ccDER():y===37?k.ccRU(2):y===38?k.ccRU(3):y===39?k.ccRU(4):y===40?k.ccFON():y===41?k.ccRDC():y===42?k.ccTR():y===43?k.ccRTD():y===44?k.ccEDM():y===45?k.ccCR():y===46?k.ccENM():y===47&&k.ccEOC():k.ccTO(y-32),r(E,y,O),this.currentChannel=F,!0},b.parseMidrow=function(E,y){var O=0;if((E===17||E===25)&&y>=32&&y<=47){if(E===17?O=1:O=2,O!==this.currentChannel)return this.logger.log(g.ERROR,"Mismatch channel in midrow parsing"),!1;var M=this.channels[O];return M?(M.ccMIDROW(y),this.logger.log(g.DEBUG,"MIDROW ("+S([E,y])+")"),!0):!1}return!1},b.parsePAC=function(E,y){var O,M=this.cmdHistory,R=(E>=17&&E<=23||E>=25&&E<=31)&&y>=64&&y<=127,F=(E===16||E===24)&&y>=64&&y<=95;if(!(R||F))return!1;if(l(E,y,M))return r(null,null,M),!0;var k=E<=23?1:2;y>=64&&y<=95?O=k===1?D[E]:i[E]:O=k===1?u[E]:f[E];var w=this.channels[k];return w?(w.setPAC(this.interpretPAC(O,y)),r(E,y,M),this.currentChannel=k,!0):!1},b.interpretPAC=function(E,y){var O,M={color:null,italics:!1,indent:null,underline:!1,row:E};return y>95?O=y-96:O=y-64,M.underline=(O&1)===1,O<=13?M.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(O/2)]:O<=15?(M.italics=!0,M.color="white"):M.indent=Math.floor((O-16)/2)*4,M},b.parseChars=function(E,y){var O,M=null,R=null;if(E>=25?(O=2,R=E-8):(O=1,R=E),R>=17&&R<=19){var F;R===17?F=y+80:R===18?F=y+112:F=y+144,this.logger.log(g.INFO,"Special char '"+d(F)+"' in channel "+O),M=[F]}else E>=32&&E<=127&&(M=y===0?[E]:[E,y]);if(M){var k=S(M);this.logger.log(g.DEBUG,"Char codes =  "+k.join(",")),r(E,y,this.cmdHistory)}return M},b.parseBackgroundAttributes=function(E,y){var O=(E===16||E===24)&&y>=32&&y<=47,M=(E===23||E===31)&&y>=45&&y<=47;if(!(O||M))return!1;var R,F={};E===16||E===24?(R=Math.floor((y-32)/2),F.background=p[R],y%2===1&&(F.background=F.background+"_semi")):y===45?F.background="transparent":(F.foreground="black",y===47&&(F.underline=!0));var k=E<=23?1:2,w=this.channels[k];return w.setBkgData(F),r(E,y,this.cmdHistory),!0},b.reset=function(){for(var E=0;E<Object.keys(this.channels).length;E++){var y=this.channels[E];y&&y.reset()}this.cmdHistory=A()},b.cueSplitAtTime=function(E){for(var y=0;y<this.channels.length;y++){var O=this.channels[y];O&&O.cueSplitAtTime(E)}},T}();function r(T,b,L){L.a=T,L.b=b}function l(T,b,L){return L.a===T&&L.b===b}function A(){return{a:null,b:null}}C.default=a},"./src/utils/codecs.ts":function(P,C,n){n.r(C),n.d(C,"isCodecType",function(){return t}),n.d(C,"isCodecSupportedInMp4",function(){return d});var s={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function t(I,x){var D=s[x];return!!D&&D[I.slice(0,4)]===!0}function d(I,x){return MediaSource.isTypeSupported((x||"video")+'/mp4;codecs="'+I+'"')}},"./src/utils/cues.ts":function(P,C,n){n.r(C);var s=n("./src/utils/vttparser.ts"),t=n("./src/utils/webvtt-parser.ts"),d=n("./src/utils/texttrack-utils.ts"),I=/\s/,x={newCue:function(u,i,f,p){for(var g=[],m,S,o,e,c,h=self.VTTCue||self.TextTrackCue,v=0;v<p.rows.length;v++)if(m=p.rows[v],o=!0,e=0,c="",!m.isEmpty()){for(var a=0;a<m.chars.length;a++)I.test(m.chars[a].uchar)&&o?e++:(c+=m.chars[a].uchar,o=!1);m.cueStartTime=i,i===f&&(f+=1e-4),e>=16?e--:e++;var r=Object(s.fixLineBreaks)(c.trim()),l=Object(t.generateCueId)(i,f,r);(!u||!u.cues||!u.cues.getCueById(l))&&(S=new h(i,f,r),S.id=l,S.line=v+1,S.align="left",S.position=10+Math.min(80,Math.floor(e*8/32)*10),g.push(S))}return u&&g.length&&(g.sort(function(A,T){return A.line==="auto"||T.line==="auto"?0:A.line>8&&T.line>8?T.line-A.line:A.line-T.line}),g.forEach(function(A){return Object(d.addCueToTrack)(u,A)})),g}};C.default=x},"./src/utils/discontinuities.ts":function(P,C,n){n.r(C),n.d(C,"findFirstFragWithCC",function(){return I}),n.d(C,"shouldAlignOnDiscontinuities",function(){return x}),n.d(C,"findDiscontinuousReferenceFrag",function(){return D}),n.d(C,"adjustSlidingStart",function(){return i}),n.d(C,"alignStream",function(){return f}),n.d(C,"alignPDT",function(){return g}),n.d(C,"alignFragmentByPDTDelta",function(){return m}),n.d(C,"alignMediaPlaylistByPDT",function(){return S});var s=n("./src/polyfills/number.ts"),t=n("./src/utils/logger.ts"),d=n("./src/controller/level-helper.ts");function I(o,e){for(var c=null,h=0,v=o.length;h<v;h++){var a=o[h];if(a&&a.cc===e){c=a;break}}return c}function x(o,e,c){return!!(e.details&&(c.endCC>c.startCC||o&&o.cc<c.startCC))}function D(o,e){var c=o.fragments,h=e.fragments;if(!h.length||!c.length){t.logger.log("No fragments to align");return}var v=I(c,h[0].cc);if(!v||v&&!v.startPTS){t.logger.log("No frag in previous level to align on");return}return v}function u(o,e){if(o){var c=o.start+e;o.start=o.startPTS=c,o.endPTS=c+o.duration}}function i(o,e){for(var c=e.fragments,h=0,v=c.length;h<v;h++)u(c[h],o);e.fragmentHint&&u(e.fragmentHint,o),e.alignedSliding=!0}function f(o,e,c){!e||(p(o,c,e),!c.alignedSliding&&e.details&&g(c,e.details),!c.alignedSliding&&e.details&&!c.skippedSegments&&Object(d.adjustSliding)(e.details,c))}function p(o,e,c){if(x(o,c,e)){var h=D(c.details,e);h&&Object(s.isFiniteNumber)(h.start)&&(t.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),i(h.start,e))}}function g(o,e){if(!(!e.fragments.length||!o.hasProgramDateTime||!e.hasProgramDateTime)){var c=e.fragments[0].programDateTime,h=o.fragments[0].programDateTime,v=(h-c)/1e3+e.fragments[0].start;v&&Object(s.isFiniteNumber)(v)&&(t.logger.log("Adjusting PTS using programDateTime delta "+(h-c)+"ms, sliding:"+v.toFixed(3)+" "+o.url+" "),i(v,o))}}function m(o,e){var c=o.programDateTime;if(!!c){var h=(c-e)/1e3;o.start=o.startPTS=h,o.endPTS=h+o.duration}}function S(o,e){if(!(!e.fragments.length||!o.hasProgramDateTime||!e.hasProgramDateTime)){var c=e.fragments[0].programDateTime,h=e.fragments[0].start,v=c-h*1e3;o.fragments.forEach(function(a){m(a,v)}),o.fragmentHint&&m(o.fragmentHint,v),o.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(P,C,n){n.r(C);var s=n("./src/utils/ewma.ts"),t=function(){function d(x,D,u){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=u,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new s.default(x),this.fast_=new s.default(D)}var I=d.prototype;return I.update=function(D,u){var i=this.slow_,f=this.fast_;this.slow_.halfLife!==D&&(this.slow_=new s.default(D,i.getEstimate(),i.getTotalWeight())),this.fast_.halfLife!==u&&(this.fast_=new s.default(u,f.getEstimate(),f.getTotalWeight()))},I.sample=function(D,u){D=Math.max(D,this.minDelayMs_);var i=8*u,f=D/1e3,p=i/f;this.fast_.sample(f,p),this.slow_.sample(f,p)},I.canEstimate=function(){var D=this.fast_;return D&&D.getTotalWeight()>=this.minWeight_},I.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},I.destroy=function(){},d}();C.default=t},"./src/utils/ewma.ts":function(P,C,n){n.r(C);var s=function(){function t(I,x,D){x===void 0&&(x=0),D===void 0&&(D=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=I,this.alpha_=I?Math.exp(Math.log(.5)/I):0,this.estimate_=x,this.totalWeight_=D}var d=t.prototype;return d.sample=function(x,D){var u=Math.pow(this.alpha_,x);this.estimate_=D*(1-u)+u*this.estimate_,this.totalWeight_+=x},d.getTotalWeight=function(){return this.totalWeight_},d.getEstimate=function(){if(this.alpha_){var x=1-Math.pow(this.alpha_,this.totalWeight_);if(x)return this.estimate_/x}return this.estimate_},t}();C.default=s},"./src/utils/fetch-loader.ts":function(P,C,n){n.r(C),n.d(C,"fetchSupported",function(){return m});var s=n("./src/polyfills/number.ts"),t=n("./src/loader/load-stats.ts"),d=n("./src/demux/chunk-cache.ts");function I(h,v){h.prototype=Object.create(v.prototype),h.prototype.constructor=h,f(h,v)}function x(h){var v=typeof Map=="function"?new Map:void 0;return x=function(r){if(r===null||!i(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof v<"u"){if(v.has(r))return v.get(r);v.set(r,l)}function l(){return D(r,arguments,p(this).constructor)}return l.prototype=Object.create(r.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),f(l,r)},x(h)}function D(h,v,a){return u()?D=Reflect.construct.bind():D=function(l,A,T){var b=[null];b.push.apply(b,A);var L=Function.bind.apply(l,b),E=new L;return T&&f(E,T.prototype),E},D.apply(null,arguments)}function u(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function i(h){return Function.toString.call(h).indexOf("[native code]")!==-1}function f(h,v){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,l){return r.__proto__=l,r},f(h,v)}function p(h){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},p(h)}function g(){return g=Object.assign?Object.assign.bind():function(h){for(var v=1;v<arguments.length;v++){var a=arguments[v];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(h[r]=a[r])}return h},g.apply(this,arguments)}function m(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var S=function(){function h(a){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=a.fetchSetup||e,this.controller=new self.AbortController,this.stats=new t.LoadStats}var v=h.prototype;return v.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},v.abortInternal=function(){var r=this.response;(!r||!r.ok)&&(this.stats.aborted=!0,this.controller.abort())},v.abort=function(){var r;this.abortInternal(),(r=this.callbacks)!==null&&r!==void 0&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},v.load=function(r,l,A){var T=this,b=this.stats;if(b.loading.start)throw new Error("Loader can only be used once.");b.loading.start=self.performance.now();var L=o(r,this.controller.signal),E=A.onProgress,y=r.responseType==="arraybuffer",O=y?"byteLength":"length";this.context=r,this.config=l,this.callbacks=A,this.request=this.fetchSetup(r,L),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){T.abortInternal(),A.onTimeout(b,r,T.response)},l.timeout),self.fetch(this.request).then(function(M){if(T.response=T.loader=M,!M.ok){var R=M.status,F=M.statusText;throw new c(F||"fetch, bad network response",R,M)}return b.loading.first=Math.max(self.performance.now(),b.loading.start),b.total=parseInt(M.headers.get("Content-Length")||"0"),E&&Object(s.isFiniteNumber)(l.highWaterMark)?T.loadProgressively(M,b,r,l.highWaterMark,E):y?M.arrayBuffer():M.text()}).then(function(M){var R=T.response;self.clearTimeout(T.requestTimeout),b.loading.end=Math.max(self.performance.now(),b.loading.first),b.loaded=b.total=M[O];var F={url:R.url,data:M};E&&!Object(s.isFiniteNumber)(l.highWaterMark)&&E(b,r,M,R),A.onSuccess(F,b,r,R)}).catch(function(M){if(self.clearTimeout(T.requestTimeout),!b.aborted){var R=M&&M.code||0,F=M?M.message:null;A.onError({code:R,text:F},r,M?M.details:null)}})},v.getCacheAge=function(){var r=null;if(this.response){var l=this.response.headers.get("age");r=l?parseFloat(l):null}return r},v.loadProgressively=function(r,l,A,T,b){T===void 0&&(T=0);var L=new d.default,E=r.body.getReader(),y=function O(){return E.read().then(function(M){if(M.done)return L.dataLength&&b(l,A,L.flush(),r),Promise.resolve(new ArrayBuffer(0));var R=M.value,F=R.length;return l.loaded+=F,F<T||L.dataLength?(L.push(R),L.dataLength>=T&&b(l,A,L.flush(),r)):b(l,A,R,r),O()}).catch(function(){return Promise.reject()})};return y()},h}();function o(h,v){var a={method:"GET",mode:"cors",credentials:"same-origin",signal:v,headers:new self.Headers(g({},h.headers))};return h.rangeEnd&&a.headers.set("Range","bytes="+h.rangeStart+"-"+String(h.rangeEnd-1)),a}function e(h,v){return new self.Request(h.url,v)}var c=function(h){I(v,h);function v(a,r,l){var A;return A=h.call(this,a)||this,A.code=void 0,A.details=void 0,A.code=r,A.details=l,A}return v}(x(Error));C.default=S},"./src/utils/imsc1-ttml-parser.ts":function(P,C,n){n.r(C),n.d(C,"IMSC1_CODEC",function(){return i}),n.d(C,"parseIMSC1",function(){return m});var s=n("./src/utils/mp4-tools.ts"),t=n("./src/utils/vttparser.ts"),d=n("./src/utils/vttcue.ts"),I=n("./src/demux/id3.ts"),x=n("./src/utils/timescale-conversion.ts"),D=n("./src/utils/webvtt-parser.ts");function u(){return u=Object.assign?Object.assign.bind():function(T){for(var b=1;b<arguments.length;b++){var L=arguments[b];for(var E in L)Object.prototype.hasOwnProperty.call(L,E)&&(T[E]=L[E])}return T},u.apply(this,arguments)}var i="stpp.ttml.im1t",f=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,p=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,g={left:"start",center:"center",right:"end",start:"start",end:"end"};function m(T,b,L,E,y){var O=Object(s.findBox)(new Uint8Array(T),["mdat"]);if(O.length===0){y(new Error("Could not parse IMSC1 mdat"));return}var M=O.map(function(F){return Object(I.utf8ArrayToStr)(F)}),R=Object(x.toTimescaleFromScale)(b,1,L);try{M.forEach(function(F){return E(S(F,R))})}catch(F){y(F)}}function S(T,b){var L=new DOMParser,E=L.parseFromString(T,"text/xml"),y=E.getElementsByTagName("tt")[0];if(!y)throw new Error("Invalid ttml");var O={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},M=Object.keys(O).reduce(function(_,B){return _[B]=y.getAttribute("ttp:"+B)||O[B],_},{}),R=y.getAttribute("xml:space")!=="preserve",F=e(o(y,"styling","style")),k=e(o(y,"layout","region")),w=o(y,"body","[begin]");return[].map.call(w,function(_){var B=c(_,R);if(!B||!_.hasAttribute("begin"))return null;var N=r(_.getAttribute("begin"),M),U=r(_.getAttribute("dur"),M),j=r(_.getAttribute("end"),M);if(N===null)throw a(_);if(j===null){if(U===null)throw a(_);j=N+U}var K=new d.default(N-b,j-b,B);K.id=Object(D.generateCueId)(K.startTime,K.endTime,K.text);var H=k[_.getAttribute("region")],G=F[_.getAttribute("style")];K.position=10,K.size=80;var W=h(H,G,F),X=W.textAlign;if(X){var V=g[X];V&&(K.lineAlign=V),K.align=X}return u(K,W),K}).filter(function(_){return _!==null})}function o(T,b,L){var E=T.getElementsByTagName(b)[0];return E?[].slice.call(E.querySelectorAll(L)):[]}function e(T){return T.reduce(function(b,L){var E=L.getAttribute("xml:id");return E&&(b[E]=L),b},{})}function c(T,b){return[].slice.call(T.childNodes).reduce(function(L,E,y){var O;return E.nodeName==="br"&&y?L+`
`:(O=E.childNodes)!==null&&O!==void 0&&O.length?c(E,b):b?L+E.textContent.trim().replace(/\s+/g," "):L+E.textContent},"")}function h(T,b,L){var E="http://www.w3.org/ns/ttml#styling",y=null,O=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],M=T!=null&&T.hasAttribute("style")?T.getAttribute("style"):null;return M&&L.hasOwnProperty(M)&&(y=L[M]),O.reduce(function(R,F){var k=v(b,E,F)||v(T,E,F)||v(y,E,F);return k&&(R[F]=k),R},{})}function v(T,b,L){return T&&T.hasAttributeNS(b,L)?T.getAttributeNS(b,L):null}function a(T){return new Error("Could not parse ttml timestamp "+T)}function r(T,b){if(!T)return null;var L=Object(t.parseTimeStamp)(T);return L===null&&(f.test(T)?L=l(T,b):p.test(T)&&(L=A(T,b))),L}function l(T,b){var L=f.exec(T),E=(L[4]|0)+(L[5]|0)/b.subFrameRate;return(L[1]|0)*3600+(L[2]|0)*60+(L[3]|0)+E/b.frameRate}function A(T,b){var L=p.exec(T),E=Number(L[1]),y=L[2];switch(y){case"h":return E*3600;case"m":return E*60;case"ms":return E*1e3;case"f":return E/b.frameRate;case"t":return E/b.tickRate}return E}},"./src/utils/logger.ts":function(P,C,n){n.r(C),n.d(C,"enableLogs",function(){return D}),n.d(C,"logger",function(){return u});var s=function(){},t={trace:s,debug:s,log:s,warn:s,info:s,error:s},d=t;function I(i){var f=self.console[i];return f?f.bind(self.console,"["+i+"] >"):s}function x(i){for(var f=arguments.length,p=new Array(f>1?f-1:0),g=1;g<f;g++)p[g-1]=arguments[g];p.forEach(function(m){d[m]=i[m]?i[m].bind(i):I(m)})}function D(i){if(self.console&&i===!0||typeof i=="object"){x(i,"debug","log","info","warn","error");try{d.log()}catch{d=t}}else d=t}var u=d},"./src/utils/mediakeys-helper.ts":function(P,C,n){n.r(C),n.d(C,"KeySystems",function(){return s}),n.d(C,"requestMediaKeySystemAccess",function(){return t});var s;(function(d){d.WIDEVINE="com.widevine.alpha",d.PLAYREADY="com.microsoft.playready"})(s||(s={}));var t=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(P,C,n){n.r(C),n.d(C,"getMediaSource",function(){return s});function s(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(P,C,n){n.r(C),n.d(C,"RemuxerTrackIdConfig",function(){return D}),n.d(C,"bin2str",function(){return u}),n.d(C,"readUint16",function(){return i}),n.d(C,"readUint32",function(){return f}),n.d(C,"readSint32",function(){return p}),n.d(C,"writeUint32",function(){return g}),n.d(C,"findBox",function(){return m}),n.d(C,"parseSegmentIndex",function(){return S}),n.d(C,"parseInitSegment",function(){return o}),n.d(C,"getStartDTS",function(){return e}),n.d(C,"getDuration",function(){return c}),n.d(C,"computeRawDurationFromSamples",function(){return h}),n.d(C,"offsetStartDTS",function(){return v}),n.d(C,"segmentValidRange",function(){return a}),n.d(C,"appendUint8Array",function(){return r}),n.d(C,"parseSamples",function(){return l}),n.d(C,"parseSEIMessageFromNALu",function(){return b}),n.d(C,"parseEmsg",function(){return E});var s=n("./src/utils/typed-array.ts"),t=n("./src/loader/fragment.ts"),d=n("./src/demux/id3.ts"),I=Math.pow(2,32)-1,x=[].push,D={video:1,audio:2,id3:3,text:4};function u(y){return String.fromCharCode.apply(null,y)}function i(y,O){var M=y[O]<<8|y[O+1];return M<0?65536+M:M}function f(y,O){var M=p(y,O);return M<0?4294967296+M:M}function p(y,O){return y[O]<<24|y[O+1]<<16|y[O+2]<<8|y[O+3]}function g(y,O,M){y[O]=M>>24,y[O+1]=M>>16&255,y[O+2]=M>>8&255,y[O+3]=M&255}function m(y,O){var M=[];if(!O.length)return M;for(var R=y.byteLength,F=0;F<R;){var k=f(y,F),w=u(y.subarray(F+4,F+8)),_=k>1?F+k:R;if(w===O[0])if(O.length===1)M.push(y.subarray(F+8,_));else{var B=m(y.subarray(F+8,_),O.slice(1));B.length&&x.apply(M,B)}F=_}return M}function S(y){var O=[],M=y[0],R=8,F=f(y,R);R+=4;var k=0,w=0;M===0?R+=8:R+=16,R+=2;var _=y.length+w,B=i(y,R);R+=2;for(var N=0;N<B;N++){var U=R,j=f(y,U);U+=4;var K=j&2147483647,H=(j&2147483648)>>>31;if(H===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var G=f(y,U);U+=4,O.push({referenceSize:K,subsegmentDuration:G,info:{duration:G/F,start:_,end:_+K-1}}),_+=K,U+=4,R=U}return{earliestPresentationTime:k,timescale:F,version:M,referencesCount:B,references:O}}function o(y){for(var O=[],M=m(y,["moov","trak"]),R=0;R<M.length;R++){var F=M[R],k=m(F,["tkhd"])[0];if(k){var w=k[0],_=w===0?12:20,B=f(k,_),N=m(F,["mdia","mdhd"])[0];if(N){w=N[0],_=w===0?12:20;var U=f(N,_),j=m(F,["mdia","hdlr"])[0];if(j){var K=u(j.subarray(8,12)),H={soun:t.ElementaryStreamTypes.AUDIO,vide:t.ElementaryStreamTypes.VIDEO}[K];if(H){var G=m(F,["mdia","minf","stbl","stsd"])[0],W=void 0;G&&(W=u(G.subarray(12,16))),O[B]={timescale:U,type:H},O[H]={timescale:U,id:B,codec:W}}}}}}var X=m(y,["moov","mvex","trex"]);return X.forEach(function(V){var J=f(V,4),$=O[J];$&&($.default={duration:f(V,12),flags:f(V,20)})}),O}function e(y,O){return m(O,["moof","traf"]).reduce(function(M,R){var F=m(R,["tfdt"])[0],k=F[0],w=m(R,["tfhd"]).reduce(function(_,B){var N=f(B,4),U=y[N];if(U){var j=f(F,4);k===1&&(j*=Math.pow(2,32),j+=f(F,8));var K=U.timescale||9e4,H=j/K;if(isFinite(H)&&(_===null||H<_))return H}return _},null);return w!==null&&isFinite(w)&&(M===null||w<M)?w:M},null)||0}function c(y,O){for(var M=0,R=0,F=0,k=m(y,["moof","traf"]),w=0;w<k.length;w++){var _=k[w],B=m(_,["tfhd"])[0],N=f(B,4),U=O[N];if(!!U){var j=U.default,K=f(B,0)|(j==null?void 0:j.flags),H=j==null?void 0:j.duration;K&8&&(K&2?H=f(B,12):H=f(B,8));for(var G=U.timescale||9e4,W=m(_,["trun"]),X=0;X<W.length;X++){if(M=h(W[X]),!M&&H){var V=f(W[X],4);M=H*V}U.type===t.ElementaryStreamTypes.VIDEO?R+=M/G:U.type===t.ElementaryStreamTypes.AUDIO&&(F+=M/G)}}}if(R===0&&F===0){for(var J=0,$=m(y,["sidx"]),z=0;z<$.length;z++){var Q=S($[z]);Q!=null&&Q.references&&(J+=Q.references.reduce(function(q,tt){return q+tt.info.duration||0},0))}return J}return R||F}function h(y){var O=f(y,0),M=8;O&1&&(M+=4),O&4&&(M+=4);for(var R=0,F=f(y,4),k=0;k<F;k++){if(O&256){var w=f(y,M);R+=w,M+=4}O&512&&(M+=4),O&1024&&(M+=4),O&2048&&(M+=4)}return R}function v(y,O,M){m(O,["moof","traf"]).forEach(function(R){m(R,["tfhd"]).forEach(function(F){var k=f(F,4),w=y[k];if(!!w){var _=w.timescale||9e4;m(R,["tfdt"]).forEach(function(B){var N=B[0],U=f(B,4);if(N===0)U-=M*_,U=Math.max(U,0),g(B,4,U);else{U*=Math.pow(2,32),U+=f(B,8),U-=M*_,U=Math.max(U,0);var j=Math.floor(U/(I+1)),K=Math.floor(U%(I+1));g(B,4,j),g(B,8,K)}})}})})}function a(y){var O={valid:null,remainder:null},M=m(y,["moof"]);if(M){if(M.length<2)return O.remainder=y,O}else return O;var R=M[M.length-1];return O.valid=Object(s.sliceUint8)(y,0,R.byteOffset-8),O.remainder=Object(s.sliceUint8)(y,R.byteOffset-8),O}function r(y,O){var M=new Uint8Array(y.length+O.length);return M.set(y),M.set(O,y.length),M}function l(y,O){var M=[],R=O.samples,F=O.timescale,k=O.id,w=!1,_=m(R,["moof"]);return _.map(function(B){var N=B.byteOffset-8,U=m(B,["traf"]);U.map(function(j){var K=m(j,["tfdt"]).map(function(H){var G=H[0],W=f(H,4);return G===1&&(W*=Math.pow(2,32),W+=f(H,8)),W/F})[0];return K!==void 0&&(y=K),m(j,["tfhd"]).map(function(H){var G=f(H,4),W=f(H,0)&16777215,X=(W&1)!==0,V=(W&2)!==0,J=(W&8)!==0,$=0,z=(W&16)!==0,Q=0,q=(W&32)!==0,tt=8;G===k&&(X&&(tt+=8),V&&(tt+=4),J&&($=f(H,tt),tt+=4),z&&(Q=f(H,tt),tt+=4),q&&(tt+=4),O.type==="video"&&(w=A(O.codec)),m(j,["trun"]).map(function(et){var rt=et[0],Y=f(et,0)&16777215,it=(Y&1)!==0,nt=0,at=(Y&4)!==0,ut=(Y&256)!==0,st=0,vt=(Y&512)!==0,ot=0,ft=(Y&1024)!==0,pt=(Y&2048)!==0,yt=0,mt=f(et,4),lt=8;it&&(nt=f(et,lt),lt+=4),at&&(lt+=4);for(var dt=nt+N,ct=0;ct<mt;ct++){if(ut?(st=f(et,lt),lt+=4):st=$,vt?(ot=f(et,lt),lt+=4):ot=Q,ft&&(lt+=4),pt&&(rt===0?yt=f(et,lt):yt=p(et,lt),lt+=4),O.type===t.ElementaryStreamTypes.VIDEO)for(var Z=0;Z<ot;){var Et=f(R,dt);dt+=4;var ht=R[dt]&31;if(T(w,ht)){var gt=R.subarray(dt,dt+Et);b(gt,y+yt/F,M)}dt+=Et,Z+=Et+4}y+=st/F}}))})})}),M}function A(y){if(!y)return!1;var O=y.indexOf("."),M=O<0?y:y.substring(0,O);return M==="hvc1"||M==="hev1"||M==="dvh1"||M==="dvhe"}function T(y,O){return y?O===39||O===40:O===6}function b(y,O,M){var R=L(y),F=0;F++;for(var k=0,w=0,_=!1,B=0;F<R.length;){k=0;do{if(F>=R.length)break;B=R[F++],k+=B}while(B===255);w=0;do{if(F>=R.length)break;B=R[F++],w+=B}while(B===255);var N=R.length-F;if(!_&&k===4&&F<R.length){_=!0;var U=R[F++];if(U===181){var j=i(R,F);if(F+=2,j===49){var K=f(R,F);if(F+=4,K===1195456820){var H=R[F++];if(H===3){var G=R[F++],W=31&G,X=64&G,V=X?2+W*3:0,J=new Uint8Array(V);if(X){J[0]=G;for(var $=1;$<V;$++)J[$]=R[F++]}M.push({type:H,payloadType:k,pts:O,bytes:J})}}}}}else if(k===5&&w<N){if(_=!0,w>16){for(var z=[],Q=0;Q<16;Q++){var q=R[F++].toString(16);z.push(q.length==1?"0"+q:q),(Q===3||Q===5||Q===7||Q===9)&&z.push("-")}for(var tt=w-16,et=new Uint8Array(tt),rt=0;rt<tt;rt++)et[rt]=R[F++];M.push({payloadType:k,pts:O,uuid:z.join(""),userData:Object(d.utf8ArrayToStr)(et),userDataBytes:et})}}else if(w<N)F+=w;else if(w>N)break}}function L(y){for(var O=y.byteLength,M=[],R=1;R<O-2;)y[R]===0&&y[R+1]===0&&y[R+2]===3?(M.push(R+2),R+=2):R++;if(M.length===0)return y;var F=O-M.length,k=new Uint8Array(F),w=0;for(R=0;R<F;w++,R++)w===M[0]&&(w++,M.shift()),k[R]=y[w];return k}function E(y){var O=y[0],M="",R="",F=0,k=0,w=0,_=0,B=0,N=0;if(O===0){for(;u(y.subarray(N,N+1))!=="\0";)M+=u(y.subarray(N,N+1)),N+=1;for(M+=u(y.subarray(N,N+1)),N+=1;u(y.subarray(N,N+1))!=="\0";)R+=u(y.subarray(N,N+1)),N+=1;R+=u(y.subarray(N,N+1)),N+=1,F=f(y,12),k=f(y,16),_=f(y,20),B=f(y,24),N=28}else if(O===1){N+=4,F=f(y,N),N+=4;var U=f(y,N);N+=4;var j=f(y,N);for(N+=4,w=Math.pow(2,32)*U+j,Number.isSafeInteger(w)||(w=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),_=f(y,N),N+=4,B=f(y,N),N+=4;u(y.subarray(N,N+1))!=="\0";)M+=u(y.subarray(N,N+1)),N+=1;for(M+=u(y.subarray(N,N+1)),N+=1;u(y.subarray(N,N+1))!=="\0";)R+=u(y.subarray(N,N+1)),N+=1;R+=u(y.subarray(N,N+1)),N+=1}var K=y.subarray(N,y.byteLength);return{schemeIdUri:M,value:R,timeScale:F,presentationTime:w,presentationTimeDelta:k,eventDuration:_,id:B,payload:K}}},"./src/utils/output-filter.ts":function(P,C,n){n.r(C),n.d(C,"default",function(){return s});var s=function(){function t(I,x){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=I,this.trackName=x}var d=t.prototype;return d.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},d.newCue=function(x,D,u){(this.startTime===null||this.startTime>x)&&(this.startTime=x),this.endTime=D,this.screen=u,this.timelineController.createCaptionsTrack(this.trackName)},d.reset=function(){this.cueRanges=[],this.startTime=null},t}()},"./src/utils/texttrack-utils.ts":function(P,C,n){n.r(C),n.d(C,"sendAddTrackEvent",function(){return t}),n.d(C,"addCueToTrack",function(){return d}),n.d(C,"clearCurrentCues",function(){return I}),n.d(C,"removeCuesInRange",function(){return x}),n.d(C,"getCuesInRange",function(){return u});var s=n("./src/utils/logger.ts");function t(i,f){var p;try{p=new Event("addtrack")}catch{p=document.createEvent("Event"),p.initEvent("addtrack",!1,!1)}p.track=i,f.dispatchEvent(p)}function d(i,f){var p=i.mode;if(p==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(f.id))try{if(i.addCue(f),!i.cues.getCueById(f.id))throw new Error("addCue is failed for: "+f)}catch(m){s.logger.debug("[texttrack-utils]: "+m);var g=new self.TextTrackCue(f.startTime,f.endTime,f.text);g.id=f.id,i.addCue(g)}p==="disabled"&&(i.mode=p)}function I(i){var f=i.mode;if(f==="disabled"&&(i.mode="hidden"),i.cues)for(var p=i.cues.length;p--;)i.removeCue(i.cues[p]);f==="disabled"&&(i.mode=f)}function x(i,f,p,g){var m=i.mode;if(m==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0)for(var S=u(i.cues,f,p),o=0;o<S.length;o++)(!g||g(S[o]))&&i.removeCue(S[o]);m==="disabled"&&(i.mode=m)}function D(i,f){if(f<i[0].startTime)return 0;var p=i.length-1;if(f>i[p].endTime)return-1;for(var g=0,m=p;g<=m;){var S=Math.floor((m+g)/2);if(f<i[S].startTime)m=S-1;else if(f>i[S].startTime&&g<p)g=S+1;else return S}return i[g].startTime-f<f-i[m].startTime?g:m}function u(i,f,p){var g=[],m=D(i,f);if(m>-1)for(var S=m,o=i.length;S<o;S++){var e=i[S];if(e.startTime>=f&&e.endTime<=p)g.push(e);else if(e.startTime>p)return g}return g}},"./src/utils/time-ranges.ts":function(P,C,n){n.r(C);var s={toString:function(d){for(var I="",x=d.length,D=0;D<x;D++)I+="["+d.start(D).toFixed(3)+","+d.end(D).toFixed(3)+"]";return I}};C.default=s},"./src/utils/timescale-conversion.ts":function(P,C,n){n.r(C),n.d(C,"toTimescaleFromBase",function(){return t}),n.d(C,"toTimescaleFromScale",function(){return d}),n.d(C,"toMsFromMpegTsClock",function(){return I}),n.d(C,"toMpegTsClockFromTimescale",function(){return x});var s=9e4;function t(D,u,i,f){i===void 0&&(i=1),f===void 0&&(f=!1);var p=D*u*i;return f?Math.round(p):p}function d(D,u,i,f){return i===void 0&&(i=1),f===void 0&&(f=!1),t(D,u,1/i,f)}function I(D,u){return u===void 0&&(u=!1),t(D,1e3,1/s,u)}function x(D,u){return u===void 0&&(u=1),t(D,s,1/u)}},"./src/utils/typed-array.ts":function(P,C,n){n.r(C),n.d(C,"sliceUint8",function(){return s});function s(t,d,I){return Uint8Array.prototype.slice?t.slice(d,I):new Uint8Array(Array.prototype.slice.call(t,d,I))}},"./src/utils/vttcue.ts":function(P,C,n){n.r(C),C.default=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var s=["","lr","rl"],t=["start","middle","end","left","right"];function d(i,f){if(typeof f!="string"||!Array.isArray(i))return!1;var p=f.toLowerCase();return~i.indexOf(p)?p:!1}function I(i){return d(s,i)}function x(i){return d(t,i)}function D(i){for(var f=arguments.length,p=new Array(f>1?f-1:0),g=1;g<f;g++)p[g-1]=arguments[g];for(var m=1;m<arguments.length;m++){var S=arguments[m];for(var o in S)i[o]=S[o]}return i}function u(i,f,p){var g=this,m={enumerable:!0};g.hasBeenReset=!1;var S="",o=!1,e=i,c=f,h=p,v=null,a="",r=!0,l="auto",A="start",T=50,b="middle",L=50,E="middle";Object.defineProperty(g,"id",D({},m,{get:function(){return S},set:function(O){S=""+O}})),Object.defineProperty(g,"pauseOnExit",D({},m,{get:function(){return o},set:function(O){o=!!O}})),Object.defineProperty(g,"startTime",D({},m,{get:function(){return e},set:function(O){if(typeof O!="number")throw new TypeError("Start time must be set to a number.");e=O,this.hasBeenReset=!0}})),Object.defineProperty(g,"endTime",D({},m,{get:function(){return c},set:function(O){if(typeof O!="number")throw new TypeError("End time must be set to a number.");c=O,this.hasBeenReset=!0}})),Object.defineProperty(g,"text",D({},m,{get:function(){return h},set:function(O){h=""+O,this.hasBeenReset=!0}})),Object.defineProperty(g,"region",D({},m,{get:function(){return v},set:function(O){v=O,this.hasBeenReset=!0}})),Object.defineProperty(g,"vertical",D({},m,{get:function(){return a},set:function(O){var M=I(O);if(M===!1)throw new SyntaxError("An invalid or illegal string was specified.");a=M,this.hasBeenReset=!0}})),Object.defineProperty(g,"snapToLines",D({},m,{get:function(){return r},set:function(O){r=!!O,this.hasBeenReset=!0}})),Object.defineProperty(g,"line",D({},m,{get:function(){return l},set:function(O){if(typeof O!="number"&&O!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");l=O,this.hasBeenReset=!0}})),Object.defineProperty(g,"lineAlign",D({},m,{get:function(){return A},set:function(O){var M=x(O);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");A=M,this.hasBeenReset=!0}})),Object.defineProperty(g,"position",D({},m,{get:function(){return T},set:function(O){if(O<0||O>100)throw new Error("Position must be between 0 and 100.");T=O,this.hasBeenReset=!0}})),Object.defineProperty(g,"positionAlign",D({},m,{get:function(){return b},set:function(O){var M=x(O);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");b=M,this.hasBeenReset=!0}})),Object.defineProperty(g,"size",D({},m,{get:function(){return L},set:function(O){if(O<0||O>100)throw new Error("Size must be between 0 and 100.");L=O,this.hasBeenReset=!0}})),Object.defineProperty(g,"align",D({},m,{get:function(){return E},set:function(O){var M=x(O);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");E=M,this.hasBeenReset=!0}})),g.displayState=void 0}return u.prototype.getCueAsHTML=function(){var i=self.WebVTT;return i.convertCueToDOMTree(self,this.text)},u}()},"./src/utils/vttparser.ts":function(P,C,n){n.r(C),n.d(C,"parseTimeStamp",function(){return d}),n.d(C,"fixLineBreaks",function(){return f}),n.d(C,"VTTParser",function(){return p});var s=n("./src/utils/vttcue.ts"),t=function(){function g(){}var m=g.prototype;return m.decode=function(o,e){if(!o)return"";if(typeof o!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(o))},g}();function d(g){function m(o,e,c,h){return(o|0)*3600+(e|0)*60+(c|0)+parseFloat(h||0)}var S=g.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return S?parseFloat(S[2])>59?m(S[2],S[3],0,S[4]):m(S[1],S[2],S[3],S[4]):null}var I=function(){function g(){this.values=Object.create(null)}var m=g.prototype;return m.set=function(o,e){!this.get(o)&&e!==""&&(this.values[o]=e)},m.get=function(o,e,c){return c?this.has(o)?this.values[o]:e[c]:this.has(o)?this.values[o]:e},m.has=function(o){return o in this.values},m.alt=function(o,e,c){for(var h=0;h<c.length;++h)if(e===c[h]){this.set(o,e);break}},m.integer=function(o,e){/^-?\d+$/.test(e)&&this.set(o,parseInt(e,10))},m.percent=function(o,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var c=parseFloat(e);if(c>=0&&c<=100)return this.set(o,c),!0}return!1},g}();function x(g,m,S,o){var e=o?g.split(o):[g];for(var c in e)if(typeof e[c]=="string"){var h=e[c].split(S);if(h.length===2){var v=h[0],a=h[1];m(v,a)}}}var D=new s.default(0,0,""),u=D.align==="middle"?"middle":"center";function i(g,m,S){var o=g;function e(){var v=d(g);if(v===null)throw new Error("Malformed timestamp: "+o);return g=g.replace(/^[^\sa-zA-Z-]+/,""),v}function c(v,a){var r=new I;x(v,function(T,b){var L;switch(T){case"region":for(var E=S.length-1;E>=0;E--)if(S[E].id===b){r.set(T,S[E].region);break}break;case"vertical":r.alt(T,b,["rl","lr"]);break;case"line":L=b.split(","),r.integer(T,L[0]),r.percent(T,L[0])&&r.set("snapToLines",!1),r.alt(T,L[0],["auto"]),L.length===2&&r.alt("lineAlign",L[1],["start",u,"end"]);break;case"position":L=b.split(","),r.percent(T,L[0]),L.length===2&&r.alt("positionAlign",L[1],["start",u,"end","line-left","line-right","auto"]);break;case"size":r.percent(T,b);break;case"align":r.alt(T,b,["start",u,"end","left","right"]);break}},/:/,/\s/),a.region=r.get("region",null),a.vertical=r.get("vertical","");var l=r.get("line","auto");l==="auto"&&D.line===-1&&(l=-1),a.line=l,a.lineAlign=r.get("lineAlign","start"),a.snapToLines=r.get("snapToLines",!0),a.size=r.get("size",100),a.align=r.get("align",u);var A=r.get("position","auto");A==="auto"&&D.position===50&&(A=a.align==="start"||a.align==="left"?0:a.align==="end"||a.align==="right"?100:50),a.position=A}function h(){g=g.replace(/^\s+/,"")}if(h(),m.startTime=e(),h(),g.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+o);g=g.slice(3),h(),m.endTime=e(),h(),c(g,m)}function f(g){return g.replace(/<br(?: \/)?>/gi,`
`)}var p=function(){function g(){this.state="INITIAL",this.buffer="",this.decoder=new t,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var m=g.prototype;return m.parse=function(o){var e=this;o&&(e.buffer+=e.decoder.decode(o,{stream:!0}));function c(){var A=e.buffer,T=0;for(A=f(A);T<A.length&&A[T]!=="\r"&&A[T]!==`
`;)++T;var b=A.slice(0,T);return A[T]==="\r"&&++T,A[T]===`
`&&++T,e.buffer=A.slice(T),b}function h(A){x(A,function(T,b){},/:/)}try{var v="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;v=c();var a=v.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var r=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(r?r=!1:v=c(),e.state){case"HEADER":/:/.test(v)?h(v):v||(e.state="ID");continue;case"NOTE":v||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(v)){e.state="NOTE";break}if(!v)continue;if(e.cue=new s.default(0,0,""),e.state="CUE",v.indexOf("-->")===-1){e.cue.id=v;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{i(v,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var l=v.indexOf("-->")!==-1;if(!v||l&&(r=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=v}continue;case"BADCUE":v||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},m.flush=function(){var o=this;try{if((o.cue||o.state==="HEADER")&&(o.buffer+=`

`,o.parse()),o.state==="INITIAL"||o.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){o.onparsingerror&&o.onparsingerror(e)}return o.onflush&&o.onflush(),this},g}()},"./src/utils/webvtt-parser.ts":function(P,C,n){n.r(C),n.d(C,"generateCueId",function(){return p}),n.d(C,"parseWebVTT",function(){return m});var s=n("./src/polyfills/number.ts"),t=n("./src/utils/vttparser.ts"),d=n("./src/demux/id3.ts"),I=n("./src/utils/timescale-conversion.ts"),x=n("./src/remux/mp4-remuxer.ts"),D=/\r\n|\n\r|\n|\r/g,u=function(o,e,c){return c===void 0&&(c=0),o.slice(c,c+e.length)===e},i=function(o){var e=parseInt(o.slice(-3)),c=parseInt(o.slice(-6,-4)),h=parseInt(o.slice(-9,-7)),v=o.length>9?parseInt(o.substring(0,o.indexOf(":"))):0;if(!Object(s.isFiniteNumber)(e)||!Object(s.isFiniteNumber)(c)||!Object(s.isFiniteNumber)(h)||!Object(s.isFiniteNumber)(v))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+o);return e+=1e3*c,e+=60*1e3*h,e+=60*60*1e3*v,e},f=function(o){for(var e=5381,c=o.length;c;)e=e*33^o.charCodeAt(--c);return(e>>>0).toString()};function p(S,o,e){return f(S.toString())+f(o.toString())+f(e)}var g=function(o,e,c){var h=o[e],v=o[h.prevCC];if(!v||!v.new&&h.new){o.ccOffset=o.presentationOffset=h.start,h.new=!1;return}for(;(a=v)!==null&&a!==void 0&&a.new;){var a;o.ccOffset+=h.start-v.start,h.new=!1,h=v,v=o[h.prevCC]}o.presentationOffset=c};function m(S,o,e,c,h,v,a,r){var l=new t.VTTParser,A=Object(d.utf8ArrayToStr)(new Uint8Array(S)).trim().replace(D,`
`).split(`
`),T=[],b=Object(I.toMpegTsClockFromTimescale)(o,e),L="00:00.000",E=0,y=0,O,M=!0;l.oncue=function(R){var F=c[h],k=c.ccOffset,w=(E-b)/9e4;F!=null&&F.new&&(y!==void 0?k=c.ccOffset=F.start:g(c,h,w)),w&&(k=w-c.presentationOffset);var _=R.endTime-R.startTime,B=Object(x.normalizePts)((R.startTime+k-y)*9e4,v*9e4)/9e4;R.startTime=Math.max(B,0),R.endTime=Math.max(B+_,0);var N=R.text.trim();R.text=decodeURIComponent(encodeURIComponent(N)),R.id||(R.id=p(R.startTime,R.endTime,N)),R.endTime>0&&T.push(R)},l.onparsingerror=function(R){O=R},l.onflush=function(){if(O){r(O);return}a(T)},A.forEach(function(R){if(M)if(u(R,"X-TIMESTAMP-MAP=")){M=!1,R.slice(16).split(",").forEach(function(F){u(F,"LOCAL:")?L=F.slice(6):u(F,"MPEGTS:")&&(E=parseInt(F.slice(7)))});try{y=i(L)/1e3}catch(F){O=F}return}else R===""&&(M=!1);l.parse(R+`
`)}),l.flush()}},"./src/utils/xhr-loader.ts":function(P,C,n){n.r(C);var s=n("./src/utils/logger.ts"),t=n("./src/loader/load-stats.ts"),d=/^age:\s*[\d.]+\s*$/m,I=function(){function x(u){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=u?u.xhrSetup:null,this.stats=new t.LoadStats,this.retryDelay=0}var D=x.prototype;return D.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},D.abortInternal=function(){var i=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),i&&(i.onreadystatechange=null,i.onprogress=null,i.readyState!==4&&(this.stats.aborted=!0,i.abort()))},D.abort=function(){var i;this.abortInternal(),(i=this.callbacks)!==null&&i!==void 0&&i.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},D.load=function(i,f,p){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=i,this.config=f,this.callbacks=p,this.retryDelay=f.retryDelay,this.loadInternal()},D.loadInternal=function(){var i=this.config,f=this.context;if(!!i){var p=this.loader=new self.XMLHttpRequest,g=this.stats;g.loading.first=0,g.loaded=0;var m=this.xhrSetup;try{if(m)try{m(p,f.url)}catch{p.open("GET",f.url,!0),m(p,f.url)}p.readyState||p.open("GET",f.url,!0);var S=this.context.headers;if(S)for(var o in S)p.setRequestHeader(o,S[o])}catch(e){this.callbacks.onError({code:p.status,text:e.message},f,p);return}f.rangeEnd&&p.setRequestHeader("Range","bytes="+f.rangeStart+"-"+(f.rangeEnd-1)),p.onreadystatechange=this.readystatechange.bind(this),p.onprogress=this.loadprogress.bind(this),p.responseType=f.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),p.send()}},D.readystatechange=function(){var i=this.context,f=this.loader,p=this.stats;if(!(!i||!f)){var g=f.readyState,m=this.config;if(!p.aborted&&g>=2)if(self.clearTimeout(this.requestTimeout),p.loading.first===0&&(p.loading.first=Math.max(self.performance.now(),p.loading.start)),g===4){f.onreadystatechange=null,f.onprogress=null;var S=f.status;if(S>=200&&S<300){p.loading.end=Math.max(self.performance.now(),p.loading.first);var o,e;if(i.responseType==="arraybuffer"?(o=f.response,e=o.byteLength):(o=f.responseText,e=o.length),p.loaded=p.total=e,!this.callbacks)return;var c=this.callbacks.onProgress;if(c&&c(p,i,o,f),!this.callbacks)return;var h={url:f.responseURL,data:o};this.callbacks.onSuccess(h,p,i,f)}else p.retry>=m.maxRetry||S>=400&&S<499?(s.logger.error(S+" while loading "+i.url),this.callbacks.onError({code:S,text:f.statusText},i,f)):(s.logger.warn(S+" while loading "+i.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,m.maxRetryDelay),p.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),m.timeout)}},D.loadtimeout=function(){s.logger.warn("timeout while loading "+this.context.url);var i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))},D.loadprogress=function(i){var f=this.stats;f.loaded=i.loaded,i.lengthComputable&&(f.total=i.total)},D.getCacheAge=function(){var i=null;if(this.loader&&d.test(this.loader.getAllResponseHeaders())){var f=this.loader.getResponseHeader("age");i=f?parseFloat(f):null}return i},x}();C.default=I}}).default})})(jt);const Qt=wt(jt.exports);export{Xt as A,Qt as H,Jt as a};
